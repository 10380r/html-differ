
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="ja" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>6.3. difflib  差分の計算を助ける  Python 3.6.5 ドキュメント</title>
<link href="../_static/pydoctheme.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
<script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/underscore.js" type="text/javascript"></script>
<script src="../_static/doctools.js" type="text/javascript"></script>
<script src="../_static/translations.js" type="text/javascript"></script>
<script src="../_static/sidebar.js" type="text/javascript"></script>
<link href="../_static/opensearch.xml" rel="search" title="Python 3.6.5 ドキュメント 内を検索" type="application/opensearchdescription+xml"/>
<link href="../about.html" rel="author" title="このドキュメントについて"/>
<link href="../genindex.html" rel="index" title="索引"/>
<link href="../search.html" rel="search" title="検索"/>
<link href="../copyright.html" rel="copyright" title="Copyright"/>
<link href="textwrap.html" rel="next" title="6.4. textwrap  テキストの折り返しと詰め込み"/>
<link href="re.html" rel="prev" title="6.2. re  正規表現操作"/>
<link href="../_static/py.png" rel="shortcut icon" type="image/png"/>
<link href="https://docs.python.jp/3/library/difflib.html" rel="canonical"/><script type="text/javascript">
    $(document).ready(function() {
      var base = 'https://docs.python.org/3.6/library/difflib.html';
      $('a.headerlink').each(function() {
        var html = '<a href="' + base + $(this).attr('href') +
                   '" title="原文へのリンク"><small>(原文)</small></a>';
        $(this).after(html);
      })
    });
    </script>
<script src="../_static/copybutton.js" type="text/javascript"></script>
<script src="../_static/version_switch.js" type="text/javascript"></script>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-34175846-1', 'python.jp');
        ga('send', 'pageview');

      </script>
<body>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a accesskey="I" href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a accesskey="N" href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a accesskey="P" href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a accesskey="U" href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body" role="main">
<div class="section" id="module-difflib">
<span id="difflib-helpers-for-computing-deltas"></span><h1>6.3. <a class="reference internal" href="#module-difflib" title="difflib: Helpers for computing differences between objects."><code class="xref py py-mod docutils literal"><span class="pre">difflib</span></code></a>  差分の計算を助ける<a class="headerlink" href="#module-difflib" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><strong>ソースコード:</strong> <a class="reference external" href="https://github.com/python/cpython/tree/3.6/Lib/difflib.py">Lib/difflib.py</a></p>
<hr class="docutils"/>
<p>このモジュールは、シーケンスを比較するためのクラスや関数を提供しています。例えば、ファイルの差分を計算して、それを HTML や context diff, unified diff などいろいろなフォーマットで出力するために、このモジュールを利用することができます。ディレクトリやファイル群を比較するためには、 <a class="reference internal" href="filecmp.html#module-filecmp" title="filecmp: Compare files efficiently."><code class="xref py py-mod docutils literal"><span class="pre">filecmp</span></code></a> モジュールも参照してください。</p>
<dl class="class">
<dt id="difflib.SequenceMatcher">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><a class="headerlink" href="#difflib.SequenceMatcher" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>柔軟性のあるクラスで、二つのシーケンスの要素がハッシュ化できる(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)型であれば、どの型の要素を含むシーケンスも比較可能です。基本的なアルゴリズムは、1980年代の後半に発表された Ratcliff と Obershelp による"ゲシュタルトパターンマッチング"と大げさに名づけられたアルゴリズム以前から知られている、やや凝ったアルゴリズムです。その考え方は、"junk" 要素を含まない最も長い互いに隣接したマッチ列を探すことです。ここで、  "junk" 要素とは、空行や空白などの、意味を持たない要素のことです。 (junk を処理するのは、Ratcliff と Obershelp のアルゴリズムに追加された拡張です。)この考え方は、マッチ列の左右に隣接するシーケンスの断片に対して再帰的にあてはめられます。この方法では編集を最小にするシーケンスは生まれませんが、人間の目からみて「正しい感じ」にマッチする傾向があります。</p>
<p><strong>実行時間:</strong> 基本的な Ratcliff-Obershelp アルゴリズムは、最悪の場合3乗、期待値で2乗となります。 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトでは、最悪のケースで2乗、期待値は比較されるシーケンス中に共通に現れる要素数に非常にややこしく依存しています。最良の場合は線形時間になります。</p>
<p><strong>自動 junk ヒューリスティック:</strong> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> は、シーケンスの特定の要素を自動的に junk として扱うヒューリスティックをサポートしています。このヒューリスティックは、各個要素がシーケンス内に何回現れるかを数えます。ある要素の重複数が (最初のものは除いて) 合計でシーケンスの 1% 以上になり、そのシーケンスが 200 要素以上なら、その要素は "popular" であるものとしてマークされ、シーケンスのマッチングの目的からは junk として扱われます。このヒューリスティックは、 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> の作成時に <code class="docutils literal"><span class="pre">autojunk</span></code> パラメタを <code class="docutils literal"><span class="pre">False</span></code> に設定することで無効化できます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
</dd></dl>
<dl class="class">
<dt id="difflib.Differ">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><a class="headerlink" href="#difflib.Differ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>テキスト行からなるシーケンスを比較するクラスです。人が読むことのできる差分を作成します。 Differ クラスは <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスを利用して、行からなるシーケンスを比較したり、(ほぼ)同一の行内の文字を比較したりします。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> クラスによる差分の各行は、2文字のコードで始まります:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%"/>
<col width="81%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">コード</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'-</span> <span class="pre">'</span></code></td>
<td>行はシーケンス1にのみ存在する</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'+</span> <span class="pre">'</span></code></td>
<td>行はシーケンス2にのみ存在する</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'</span> <span class="pre">'</span></code></td>
<td>行は両方のシーケンスで同一</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'?</span> <span class="pre">'</span></code></td>
<td>行は入力シーケンスのどちらにも存在しない</td>
</tr>
</tbody>
</table>
<p>'<code class="docutils literal"><span class="pre">?</span></code>' で始まる行は、行内のどこに差異が存在するかに注意を向けようとします。その行は、入力されたシーケンスのどちらにも存在しません。シーケンスがタブ文字を含むとき、これらの行は判別しづらいものになることがあります。</p>
</dd></dl>
<dl class="class">
<dt id="difflib.HtmlDiff">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">HtmlDiff</code><a class="headerlink" href="#difflib.HtmlDiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このクラスは、二つのテキストを左右に並べて比較表示し、行間あるいは行内の変更点を強調表示するような HTML テーブル (またはテーブルの入った完全な HTML ファイル) を生成するために使います。テーブルは完全差分モード、コンテキスト差分モードのいずれでも生成できます。</p>
<p>このクラスのコンストラクタは以下のようになっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>tabsize=8</em>, <em>wrapcolumn=None</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.__init__" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> のインスタンスを初期化します。</p>
<p><em>tabsize</em> はオプションのキーワード引数で、タブストップ幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">8</span></code> です。</p>
<p><em>wrapcolumn</em> はオプションのキーワード引数で、テキストを折り返すカラム幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> で折り返しを行いません。</p>
<p><em>linejunk</em> および <em>charjunk</em> はオプションのキーワード引数で、 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a>  (<a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> はこの関数を使って左右のテキストの差分を HTML で生成します) に渡されます。それぞれの引数のデフォルト値および説明は <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> のドキュメントを参照してください。</p>
</dd></dl>
<p>以下のメソッドが public になっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.make_file">
<code class="descname">make_file</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em>, <em>*</em>, <em>charset='utf-8'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_file" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った表を持つ完全な HTML ファイルを文字列で返します。</p>
<p><em>fromdesc</em> および <em>todesc</em> はオプションのキーワード引数で、差分表示テーブルにおけるそれぞれ差分元、差分先ファイルのカラムのヘッダになる文字列を指定します (いずれもデフォルト値は空文字列です)。</p>
<p><em>context</em> および <em>numlines</em> はともにオプションのキーワード引数です。<em>context</em> を <code class="docutils literal"><span class="pre">True</span></code> にするとコンテキスト差分を表示し、デフォルトの <code class="docutils literal"><span class="pre">False</span></code> にすると完全なファイル差分を表示します。<em>numlines</em> のデフォルト値は <code class="docutils literal"><span class="pre">5</span></code> で、<em>context</em> が <code class="docutils literal"><span class="pre">True</span></code> の場合、<em>numlines</em> は強調部分の前後にあるコンテキスト行の数を制御します。<em>context</em> が <code class="docutils literal"><span class="pre">False</span></code> の場合、<em>numlines</em> は "next" と書かれたハイパーリンクをたどった時に到達する場所が次の変更部分より何行前にあるかを制御します (値をゼロにした場合、"next" ハイパーリンクを辿ると変更部分の強調表示がブラウザの最上部に表示されるようになります)。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.5 で変更: </span><em>charset</em> キーワード専用引数が追加されました。HTML 文書のデフォルトの文字集合が <code class="docutils literal"><span class="pre">'ISO-8859-1'</span></code> から <code class="docutils literal"><span class="pre">'utf-8'</span></code> に変更されました。</p>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.HtmlDiff.make_table">
<code class="descname">make_table</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った完全な HTML テーブルを文字列で返します。</p>
<p>このメソッドの引数は、 <a class="reference internal" href="#difflib.HtmlDiff.make_file" title="difflib.HtmlDiff.make_file"><code class="xref py py-meth docutils literal"><span class="pre">make_file()</span></code></a> メソッドの引数と同じです。</p>
</dd></dl>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> はこのクラスへのコマンドラインフロントエンドで、使い方を学ぶ上で格好の例題が入っています。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.context_diff">
<code class="descclassname">difflib.</code><code class="descname">context_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.context_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 context diff のフォーマット(以下「コンテクスト形式」)で返します。</p>
<p>コンテクスト形式は、変更があった行に前後数行を加えてある、コンパクトな表現方法です。変更箇所は、変更前/変更後に分けて表します。コンテクスト (変更箇所前後の行) の行数は <em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">***</span></code> や <code class="docutils literal"><span class="pre">---</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">context_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">*** before.py</span>
<span class="go">--- after.py</span>
<span class="go">***************</span>
<span class="go">*** 1,4 ****</span>
<span class="go">! bacon</span>
<span class="go">! eggs</span>
<span class="go">! ham</span>
<span class="go">  guido</span>
<span class="go">--- 1,4 ----</span>
<span class="go">! python</span>
<span class="go">! eggy</span>
<span class="go">! hamster</span>
<span class="go">  guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.get_close_matches">
<code class="descclassname">difflib.</code><code class="descname">get_close_matches</code><span class="sig-paren">(</span><em>word</em>, <em>possibilities</em>, <em>n=3</em>, <em>cutoff=0.6</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.get_close_matches" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>「十分」なマッチの上位のリストを返します。<em>word</em> はマッチさせたいシーケンス (大概は文字列) です。<em>possibilities</em> は <em>word</em> にマッチさせるシーケンスのリスト (大概は文字列のリスト) です。</p>
<p>オプションの引数 <em>n</em> (デフォルトでは <code class="docutils literal"><span class="pre">3</span></code>)はメソッドの返すマッチの最大数です。<em>n</em> は <code class="docutils literal"><span class="pre">0</span></code> より大きくなければなりません。</p>
<p>オプションの引数 <em>cutoff</em> (デフォルトでは <code class="docutils literal"><span class="pre">0.6</span></code>)は、区間 [0, 1] に入る小数の値です。<em>word</em> との一致率がそれ未満の <em>possibilities</em> の要素は無視されます。</p>
<p><em>possibilities</em> の要素でマッチした上位(多くても <em>n</em> 個)は、類似度のスコアに応じて(一番似たものを先頭に)ソートされたリストとして返されます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'appel'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ape'</span><span class="p">,</span> <span class="s1">'apple'</span><span class="p">,</span> <span class="s1">'peach'</span><span class="p">,</span> <span class="s1">'puppy'</span><span class="p">])</span>
<span class="go">['apple', 'ape']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">keyword</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'wheel'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['while']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'pineapple'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'accept'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['except']</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.ndiff">
<code class="descclassname">difflib.</code><code class="descname">ndiff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.ndiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> のスタイルで返します。</p>
<p>オプションのキーワード引数 <em>linejunk</em> と <em>charjunk</em> には、フィルタ関数 (または <code class="docutils literal"><span class="pre">None</span></code>) を渡します。</p>
<p><em>linejunk</em>: 文字列型の引数 1 つを受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは <code class="docutils literal"><span class="pre">None</span></code> です。モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_LINE_JUNK" title="difflib.IS_LINE_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_LINE_JUNK()</span></code></a> は、高々 1 つのシャープ記号(<code class="docutils literal"><span class="pre">'#'</span></code>)を除いて可視の文字を含まない行をフィルタリングするものです。しかし、下層にある <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスが、どの行が雑音となるほど頻繁に登場するかを動的に分析します。このクラスによる分析は、この関数を使用するよりも通常うまく動作します。</p>
<p><em>charjunk</em>: 文字 (長さ1の文字列) を受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは、モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_CHARACTER_JUNK" title="difflib.IS_CHARACTER_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_CHARACTER_JUNK()</span></code></a> であり、これは空白文字類 (空白またはタブ、改行文字をこれに含めてはいけません) をフィルタして排除します。</p>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/ndiff.py</span></code> は、この関数のコマンドラインのフロントエンド（インターフェイス）です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">diff</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">- one</span>
<span class="go">?  ^</span>
<span class="go">+ ore</span>
<span class="go">?  ^</span>
<span class="go">- two</span>
<span class="go">- three</span>
<span class="go">?  -</span>
<span class="go">+ tree</span>
<span class="go">+ emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.restore">
<code class="descclassname">difflib.</code><code class="descname">restore</code><span class="sig-paren">(</span><em>sequence</em>, <em>which</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.restore" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>差分を生成した元の二つのシーケンスのうち一つを返します。</p>
<p><a class="reference internal" href="#difflib.Differ.compare" title="difflib.Differ.compare"><code class="xref py py-meth docutils literal"><span class="pre">Differ.compare()</span></code></a> または <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> によって生成された <em>sequence</em> を与えられると、行頭のプレフィクスを取りのぞいてファイル 1 または 2 (引数 <em>which</em> で指定される) に由来する行を復元します。</p>
<p>例:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="c1"># materialize the generated delta into a list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">one</span>
<span class="go">two</span>
<span class="go">three</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">ore</span>
<span class="go">tree</span>
<span class="go">emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.unified_diff">
<code class="descclassname">difflib.</code><code class="descname">unified_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.unified_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 unified diff フォーマット(以下「ユニファイド形式」)で返します。</p>
<p>ユニファイド形式は変更があった行にコンテキストとなる前後数行を加えた、コンパクトな表現方法です。変更箇所は (変更前/変更後を分離したブロックではなく) インラインスタイルで表されます。コンテクストの行数は、<em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">---</span></code>, <code class="docutils literal"><span class="pre">+++</span></code>, <code class="docutils literal"><span class="pre">@@</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">--- before.py</span>
<span class="go">+++ after.py</span>
<span class="go">@@ -1,4 +1,4 @@</span>
<span class="go">-bacon</span>
<span class="go">-eggs</span>
<span class="go">-ham</span>
<span class="go">+python</span>
<span class="go">+eggy</span>
<span class="go">+hamster</span>
<span class="go"> guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.diff_bytes">
<code class="descclassname">difflib.</code><code class="descname">diff_bytes</code><span class="sig-paren">(</span><em>dfunc</em>, <em>a</em>, <em>b</em>, <em>fromfile=b''</em>, <em>tofile=b''</em>, <em>fromfiledate=b''</em>, <em>tofiledate=b''</em>, <em>n=3</em>, <em>lineterm=b'\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.diff_bytes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>dfunc</em> を使用して <em>a</em> と <em>b</em> (bytes オブジェクトのリスト) を比較して、差分形式の行 (これも bytes オブジェクトです) を*dfunc* の戻り値の形式で返します。<em>dfunc</em> は、呼び出し可能である必要があります。一般に、これは <a class="reference internal" href="#difflib.unified_diff" title="difflib.unified_diff"><code class="xref py py-func docutils literal"><span class="pre">unified_diff()</span></code></a> または <a class="reference internal" href="#difflib.context_diff" title="difflib.context_diff"><code class="xref py py-func docutils literal"><span class="pre">context_diff()</span></code></a> です。</p>
<p>未知のエンコーディングまたは一貫性のないエンコーディングのデータ同士を比較できます。<em>n</em> 以外のすべての入力は、bytes オブジェクトである必要があります。<em>n</em> 以外のすべての入力を損失なく str に変換して、<code class="docutils literal"><span class="pre">dfunc(a,</span> <span class="pre">b,</span> <span class="pre">fromfile,</span> <span class="pre">tofile,</span> <span class="pre">fromfiledate,</span> <span class="pre">tofiledate,</span> <span class="pre">n,</span> <span class="pre">lineterm)</span></code> を呼び出すことにより動作します。<em>dfunc</em> の出力は、bytes 型に変換されます。これにより、受け取る差分形式の行のエンコーディングは、<em>a</em> と <em>b</em> の未知または一貫性のないエンコーディングと同一になります。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_LINE_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_LINE_JUNK</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_LINE_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる行のとき真を返します。行 <em>line</em> は空白、または  <code class="docutils literal"><span class="pre">'#'</span></code> ひとつのときに無視できます。それ以外のときには無視できません。古いバージョンでは <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>linejunk</em> にデフォルトで使用されました。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_CHARACTER_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_CHARACTER_JUNK</code><span class="sig-paren">(</span><em>ch</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_CHARACTER_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる文字のとき真を返します。文字 <em>ch</em> が空白、またはタブ文字のときには無視できます。それ以外の時には無視できません。 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>charjunk</em> としてデフォルトで使用されます。</p>
</dd></dl>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><a class="reference external" href="http://www.drdobbs.com/database/pattern-matching-the-gestalt-approach/184407970">Pattern Matching: The Gestalt Approach</a></dt>
<dd>John W. Ratcliff と D. E. Metzener による類似のアルゴリズムに関する議論。<a class="reference external" href="http://www.drdobbs.com/">Dr. Dobb’s Journal</a> 1988年7月号掲載。</dd>
</dl>
</div>
<div class="section" id="sequencematcher-objects">
<span id="sequence-matcher"></span><h2>6.3.1. SequenceMatcherオブジェクト<a class="headerlink" href="#sequencematcher-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスには、以下のようなコンストラクタがあります:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><span class="sig-paren">(</span><em>isjunk=None</em>, <em>a=''</em>, <em>b=''</em>, <em>autojunk=True</em><span class="sig-paren">)</span></dt>
<dd><p>オプションの引数 <em>isjunk</em> は、<code class="docutils literal"><span class="pre">None</span></code> (デフォルトの値です) にするか、単一の引数をとる関数でなければなりません。後者の場合、関数はシーケンスの要素を受け取り、要素が junk であり、無視すべきである場合に限り真を返すようにしなければなりません。<em>isjunk</em> に <code class="docutils literal"><span class="pre">None</span></code> を渡すと、<code class="docutils literal"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">0</span></code> を渡したのと同じになります; すなわち、いかなる要素も無視しなくなります。例えば以下のような引数を渡すと:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">" </span><span class="se">\t</span><span class="s2">"</span>
</pre></div>
</div>
<p>空白とタブ文字を無視して文字のシーケンスを比較します。</p>
<p>オプションの引数 <em>a</em> と <em>b</em> は、比較される文字列で、デフォルトでは空の文字列です。両方のシーケンスの要素は、ハッシュ化可能(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)である必要があります。</p>
<p>オプションの引数 <em>autojunk</em> は、自動 junk ヒューリスティックを無効にするために使えます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
<p>SequenceMatcher オブジェクトは3つのデータ属性を持っています: <em>bjunk</em> は、 <em>isjunk</em> が <code class="docutils literal"><span class="pre">True</span></code> であるような <em>b</em> の要素の集合です; <em>bpopular</em> は、 (無効でなければ) ヒューリスティックによって popular であると考えられる非ジャンク要素の集合です; <em>b2j</em> は、 <em>b</em> の残りの要素をそれらが生じる位置のリストに写像する dict です。この 3 つは <a class="reference internal" href="#difflib.SequenceMatcher.set_seqs" title="difflib.SequenceMatcher.set_seqs"><code class="xref py py-meth docutils literal"><span class="pre">set_seqs()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> で <em>b</em> がリセットされる場合は常にリセットされます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>bjunk</em> および <em>bpopular</em> 属性。</p>
</div>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは以下のメソッドを持ちます:</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seqs">
<code class="descname">set_seqs</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seqs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較される2つの文字列を設定します。</p>
</dd></dl>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは、2つ目のシーケンスについての詳細な情報を計算し、キャッシュします。 1つのシーケンスをいくつものシーケンスと比較する場合、まず <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> を使って文字列を設定しておき、別の文字列を1つずつ比較するために、繰り返し <a class="reference internal" href="#difflib.SequenceMatcher.set_seq1" title="difflib.SequenceMatcher.set_seq1"><code class="xref py py-meth docutils literal"><span class="pre">set_seq1()</span></code></a> を呼び出します。</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq1">
<code class="descname">set_seq1</code><span class="sig-paren">(</span><em>a</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq1" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う1つ目のシーケンスを設定します。比較される2つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq2">
<code class="descname">set_seq2</code><span class="sig-paren">(</span><em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq2" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う2つ目のシーケンスを設定します。比較される1つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.find_longest_match">
<code class="descname">find_longest_match</code><span class="sig-paren">(</span><em>alo</em>, <em>ahi</em>, <em>blo</em>, <em>bhi</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.find_longest_match" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">a[alo:ahi]</span></code> と <code class="docutils literal"><span class="pre">b[blo:bhi]</span></code> の中から、最長のマッチ列を探します。</p>
<p><em>isjunk</em> が省略されたか <code class="docutils literal"><span class="pre">None</span></code> の時、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> は <code class="docutils literal"><span class="pre">a[i:i+k]</span></code> が <code class="docutils literal"><span class="pre">b[j:j+k]</span></code> と等しいような <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">k)</span></code> を返します。その値は <code class="docutils literal"><span class="pre">alo</span> <span class="pre">&lt;=</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i+k</span> <span class="pre">&lt;=</span> <span class="pre">ahi</span></code> かつ <code class="docutils literal"><span class="pre">blo</span> <span class="pre">&lt;=</span> <span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j+k</span> <span class="pre">&lt;=</span> <span class="pre">bhi</span></code> となります。 <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">k')</span></code> でも、同じようになります。さらに <code class="docutils literal"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">k'</span></code>, <code class="docutils literal"><span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i'</span></code> が <code class="docutils literal"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">i'</span></code>, <code class="docutils literal"><span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j'</span></code> でも同様です。言い換えると、いくつものマッチ列すべてのうち、 <em>a</em> 内で最初に始まるものを返します。そしてその <em>a</em> 内で最初のマッチ列すべてのうち <em>b</em> 内で最初に始まるものを返します。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=0, b=4, size=5)</span>
</pre></div>
</div>
<p>引数 <em>isjunk</em> が与えられている場合、上記の通り、はじめに最長のマッチ列を判定します。ブロック内に junk 要素が見当たらないような追加条件の際はこれに該当しません。次にそのマッチ列を、その両側の junk 要素にマッチするよう、できる限り広げていきます。そのため結果となる列は、探している列のたまたま直前にあった同一の junk 以外の junk にはマッチしません。</p>
<p>以下は前と同じサンプルですが、空白を junk とみなしています。これは <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> が2つ目の列の末尾にある <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> にマッチしないようにしています。代わりに <code class="docutils literal"><span class="pre">'abcd'</span></code> にはマッチします。そして 2つ目の文字列中、一番左の <code class="docutils literal"><span class="pre">'abcd'</span></code> にマッチします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">==</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=1, b=0, size=4)</span>
</pre></div>
</div>
<p>どんな列にもマッチしない時は、<code class="docutils literal"><span class="pre">(alo,</span> <span class="pre">blo,</span> <span class="pre">0)</span></code> を返します。</p>
<p>このメソッドは <a class="reference internal" href="../glossary.html#term-named-tuple"><span class="xref std std-term">named tuple</span></a> <code class="docutils literal"><span class="pre">Match(a,</span> <span class="pre">b,</span> <span class="pre">size)</span></code> を返します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_matching_blocks">
<code class="descname">get_matching_blocks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_matching_blocks" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>マッチしたシーケンス中で個別にマッチしたシーケンスをあらわす、3つの値のリストを返します。それぞれの値は <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> という形式であらわされ、<code class="docutils literal"><span class="pre">a[i:i+n]</span> <span class="pre">==</span> <span class="pre">b[j:j+n]</span></code> という関係を意味します。3つの値は <em>i</em> と <em>j</em> の間で単調に増加します。</p>
<p>最後のタプルはダミーで、<code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> という値を持ちます。これは <code class="docutils literal"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">0</span></code> である唯一のタプルです。もし <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> と <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">n')</span></code> がリストで並んでいる3つ組で、2つ目が最後の3つ組でなければ、<code class="docutils literal"><span class="pre">i+n</span> <span class="pre">!=</span> <span class="pre">i'</span></code> または <code class="docutils literal"><span class="pre">j+n</span> <span class="pre">!=</span> <span class="pre">j'</span></code> です。言い換えると並んでいる3つ組は常に隣接していない同じブロックを表しています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abxcd"</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">()</span>
<span class="go">[Match(a=0, b=0, size=2), Match(a=3, b=2, size=2), Match(a=5, b=4, size=0)]</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_opcodes">
<code class="descname">get_opcodes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> を <em>b</em> にするための方法を記述する5つのタプルを返します。それぞれのタプルは <code class="docutils literal"><span class="pre">(tag,</span> <span class="pre">i1,</span> <span class="pre">i2,</span> <span class="pre">j1,</span> <span class="pre">j2)</span></code> という形式であらわされます。最初のタプルは <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">j1</span> <span class="pre">==</span> <span class="pre">0</span></code> であり、<em>i1</em> はその前にあるタプルの <em>i2</em> と同じ値です。同様に <em>j1</em> は前の <em>j2</em> と同じ値になります。</p>
<p><em>tag</em> の値は文字列であり、次のような意味です:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%"/>
<col width="75%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'replace'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は <code class="docutils literal"><span class="pre">b[j1:j2]</span></code> に置き換えられる。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'delete'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は削除される。この時、<code class="docutils literal"><span class="pre">j1</span> <span class="pre">==</span> <span class="pre">j2</span></code> である。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'insert'</span></code></td>
<td><code class="docutils literal"><span class="pre">b[j1:j2]</span></code> が <code class="docutils literal"><span class="pre">a[i1:i1]</span></code> に挿入される。この時 <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">i2</span></code> である。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'equal'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span> <span class="pre">==</span> <span class="pre">b[j1:j2]</span></code> (サブシーケンスは等しい).</td>
</tr>
</tbody>
</table>
<p>例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="s2">"qabxcd"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="s2">"abycdf"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{:7}</span><span class="s1">   a[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] --&gt; b[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] </span><span class="si">{!r:&gt;8}</span><span class="s1"> --&gt; </span><span class="si">{!r}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">]))</span>
<span class="go">delete    a[0:1] --&gt; b[0:0]      'q' --&gt; ''</span>
<span class="go">equal     a[1:3] --&gt; b[0:2]     'ab' --&gt; 'ab'</span>
<span class="go">replace   a[3:4] --&gt; b[2:3]      'x' --&gt; 'y'</span>
<span class="go">equal     a[4:6] --&gt; b[3:5]     'cd' --&gt; 'cd'</span>
<span class="go">insert    a[6:6] --&gt; b[5:6]       '' --&gt; 'f'</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_grouped_opcodes">
<code class="descname">get_grouped_opcodes</code><span class="sig-paren">(</span><em>n=3</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_grouped_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>最大 <em>n</em> 行までのコンテクストを含むグループを生成するような、ジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)を返します。</p>
<p>このメソッドは、 <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> で返されるグループの中から、似たような差異のかたまりに分け、間に挟まっている変更の無い部分を省きます。</p>
<p>グループは <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> と同じ書式で返されます。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.ratio">
<code class="descname">ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>[0, 1] の範囲の浮動小数点数で、シーケンスの類似度を測る値を返します。</p>
<p>T が2つのシーケンスの要素数の総計だと仮定し、M をマッチした数とすると、この値は 2.0*M / T であらわされます。もしシーケンスがまったく同じ場合、値は <code class="docutils literal"><span class="pre">1.0</span></code> となり、まったく異なる場合には <code class="docutils literal"><span class="pre">0.0</span></code> となります。</p>
<p>このメソッドは <a class="reference internal" href="#difflib.SequenceMatcher.get_matching_blocks" title="difflib.SequenceMatcher.get_matching_blocks"><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> がまだ呼び出されていない場合には非常にコストが高いです。この場合、上限を素早く計算するために、 <a class="reference internal" href="#difflib.SequenceMatcher.quick_ratio" title="difflib.SequenceMatcher.quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code></a> もしくは <a class="reference internal" href="#difflib.SequenceMatcher.real_quick_ratio" title="difflib.SequenceMatcher.real_quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code></a> を最初に試してみる方がいいかもしれません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.quick_ratio">
<code class="descname">quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、より高速に計算します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.real_quick_ratio">
<code class="descname">real_quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.real_quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、非常に高速に計算します。</p>
</dd></dl>
</dd></dl>
<p>この文字列全体のマッチ率を返す3つのメソッドは、精度の異なる近似値を返します。 <code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code> と <code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code> は、常に <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> 以上の値を返します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">,</span> <span class="s2">"bcde"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">quick_ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">real_quick_ratio</span><span class="p">()</span>
<span class="go">1.0</span>
</pre></div>
</div>
</div>
<div class="section" id="sequencematcher-examples">
<span id="id1"></span><h2>6.3.2. SequenceMatcher の例<a class="headerlink" href="#sequencematcher-examples" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は2つの文字列を比較します。空白を "junk" とします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">" "</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private Thread currentThread;"</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private volatile Thread currentThread;"</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> は、[0, 1] の範囲の値を返し、シーケンスの類似度を測ります。経験によると、 <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> の値が0.6を超えると、シーケンスがよく似ていることを示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="go">0.866</span>
</pre></div>
</div>
<p>シーケンスのどこがマッチしているかにだけ興味のある時には <code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が手軽でしょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"a[</span><span class="si">%d</span><span class="s2">] and b[</span><span class="si">%d</span><span class="s2">] match for </span><span class="si">%d</span><span class="s2"> elements"</span> <span class="o">%</span> <span class="n">block</span><span class="p">)</span>
<span class="go">a[0] and b[0] match for 8 elements</span>
<span class="go">a[8] and b[17] match for 21 elements</span>
<span class="go">a[29] and b[38] match for 0 elements</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が返す最後のタプルが常にダミーであることに注目してください。このダミーは <code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> であり、これはタプルの最後の要素（マッチする要素の数）が <code class="docutils literal"><span class="pre">0</span></code> となる唯一のケースです。</p>
<p>はじめのシーケンスがどのようにして2番目のものになるのかを知るには、 <code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code> を使います:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%6s</span><span class="s2"> a[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">] b[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">]"</span> <span class="o">%</span> <span class="n">opcode</span><span class="p">)</span>
<span class="go"> equal a[0:8] b[0:8]</span>
<span class="go">insert a[8:8] b[8:17]</span>
<span class="go"> equal a[8:29] b[17:38]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<ul class="last simple">
<li><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> を使った、シンプルで使えるコードを知るには、このモジュールの関数 <a class="reference internal" href="#difflib.get_close_matches" title="difflib.get_close_matches"><code class="xref py py-func docutils literal"><span class="pre">get_close_matches()</span></code></a> を参照してください。</li>
<li><a class="reference external" href="https://code.activestate.com/recipes/576729/">Simple version control recipe</a> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> で作った小規模アプリケーション。</li>
</ul>
</div>
</div>
<div class="section" id="differ-objects">
<span id="id2"></span><h2>6.3.3. Differ オブジェクト<a class="headerlink" href="#differ-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトによって生成された差分が <strong>最小</strong> であるなどとは言いません。むしろ、最小の差分はしばしば直観に反しています。その理由は、どこでもできるとなれば一致を見いだしてしまうからで、ときには思いがけなく100ページも離れたマッチになってしまうのです。一致点を互いに隣接したマッチに制限することで、場合によって長めの差分を出力するというコストを掛けることにはなっても、ある種の局所性を保つことができるのです。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> は、以下のようなコンストラクタを持ちます:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><span class="sig-paren">(</span><em>linejunk=None</em>, <em>charjunk=None</em><span class="sig-paren">)</span></dt>
<dd><p>オプションのキーワードパラメータ <em>linejunk</em> と <em>charjunk</em> は、フィルタ関数を渡します (使わないときは <code class="docutils literal"><span class="pre">None</span></code>):</p>
<p><em>linejunk</em>: ひとつの文字列引数を受け取る関数です。文字列が junk のときに真を返します。デフォルトでは、<code class="docutils literal"><span class="pre">None</span></code> であり、どんな行であっても junk とは見なされません。</p>
<p><em>charjunk</em>: この関数は文字(長さ1の文字列)を引数として受け取り、文字が junk であるときに真を返します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> であり、どんな文字も junk とは見なされません。</p>
<p>これらの junk フィルター関数により、差分を発見するマッチングが高速化し、差分の行や文字が無視されることがなくなります。説明については、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> メソッドの <em>isjunk</em> 引数の説明をご覧ください。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトは、以下の1つのメソッドを通して利用されます。（差分を生成します）:</p>
<dl class="method">
<dt id="difflib.Differ.compare">
<code class="descname">compare</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.Differ.compare" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>文字列からなる2つのシーケンスを比較し、差分（を表す文字列からなるシーケンス）を生成します。</p>
<p>各シーケンスの要素は、改行で終わる独立した単一行からなる文字列でなければなりません。そのようなシーケンスは、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code></a> メソッドによって得ることができます。（得られる）差分は改行文字で終了する文字列のシーケンスとして得られ、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-meth docutils literal"><span class="pre">writelines()</span></code></a> メソッドによって出力できる形になっています。</p>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="differ-example">
<span id="differ-examples"></span><h2>6.3.4. Differ の例<a class="headerlink" href="#differ-example" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下の例は2つのテキストを比較しています。最初に、テキストを行毎に改行で終わる文字列のシーケンスにセットアップします (そのようなシーケンスは、ファイル風オブジェクトの <code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code> メソッドからも得ることができます):</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  2. Explicit is better than implicit.</span>
<span class="gp">... </span><span class="s1">  3. Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complex is better than complicated.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">'\n'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text2</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  3.   Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complicated is better than complex.</span>
<span class="gp">... </span><span class="s1">  5. Flat is better than nested.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>次に Differ オブジェクトをインスタンス化します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Differ</span><span class="p">()</span>
</pre></div>
</div>
<p>注意:  <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトをインスタンス化するとき、行 junk と文字 junk をフィルタリングする関数を渡すことができます。詳細は <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-meth docutils literal"><span class="pre">Differ()</span></code></a> コンストラクタを参照してください。</p>
<p>最後に、2つを比較します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">result</span></code> は文字列のリストなので、pretty-printしてみましょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">['    1. Beautiful is better than ugly.\n',</span>
<span class="go"> '-   2. Explicit is better than implicit.\n',</span>
<span class="go"> '-   3. Simple is better than complex.\n',</span>
<span class="go"> '+   3.   Simple is better than complex.\n',</span>
<span class="go"> '?     ++\n',</span>
<span class="go"> '-   4. Complex is better than complicated.\n',</span>
<span class="go"> '?            ^                     ---- ^\n',</span>
<span class="go"> '+   4. Complicated is better than complex.\n',</span>
<span class="go"> '?           ++++ ^                      ^\n',</span>
<span class="go"> '+   5. Flat is better than nested.\n']</span>
</pre></div>
</div>
<p>これは、複数行の文字列として、次のように出力されます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">    1. Beautiful is better than ugly.</span>
<span class="go">-   2. Explicit is better than implicit.</span>
<span class="go">-   3. Simple is better than complex.</span>
<span class="go">+   3.   Simple is better than complex.</span>
<span class="go">?     ++</span>
<span class="go">-   4. Complex is better than complicated.</span>
<span class="go">?            ^                     ---- ^</span>
<span class="go">+   4. Complicated is better than complex.</span>
<span class="go">?           ++++ ^                      ^</span>
<span class="go">+   5. Flat is better than nested.</span>
</pre></div>
</div>
</div>
<div class="section" id="a-command-line-interface-to-difflib">
<span id="difflib-interface"></span><h2>6.3.5. difflib のコマンドラインインタフェース<a class="headerlink" href="#a-command-line-interface-to-difflib" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は、 difflib を使って <code class="docutils literal"><span class="pre">diff</span></code> に似たユーティリティーを作成する方法を示します。これは、 Python のソース配布物にも、 <code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> として含まれています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">""" Command line interface to difflib.py providing diffs in four formats:</span>

<span class="sd">* ndiff:    lists every line and highlights interline changes.</span>
<span class="sd">* context:  highlights clusters of changes in a before/after format.</span>
<span class="sd">* unified:  highlights clusters of changes in an inline format.</span>
<span class="sd">* html:     generates side by side comparison with change highlights.</span>

<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">difflib</span><span class="o">,</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="k">def</span> <span class="nf">file_mtime</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span>
                               <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a context format diff (default)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-u'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a unified format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-m'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce HTML side by side diff '</span>
                             <span class="s1">'(can use -c and -l in conjunction)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-n'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a ndiff format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-l'</span><span class="p">,</span> <span class="s1">'--lines'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Set number of context lines (default 3)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'fromfile'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'tofile'</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">lines</span>
    <span class="n">fromfile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">fromfile</span>
    <span class="n">tofile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">tofile</span>

    <span class="n">fromdate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span>
    <span class="n">todate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">fromlines</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
        <span class="n">tolines</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">u</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">m</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">HtmlDiff</span><span class="p">()</span><span class="o">.</span><span class="n">make_file</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span><span class="n">tolines</span><span class="p">,</span><span class="n">fromfile</span><span class="p">,</span><span class="n">tofile</span><span class="p">,</span><span class="n">context</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">numlines</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">context_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div aria-label="main navigation" class="sphinxsidebar" role="navigation">
<div class="sphinxsidebarwrapper">
<h3><a href="../contents.html">目次</a></h3>
<ul>
<li><a class="reference internal" href="#">6.3. <code class="docutils literal"><span class="pre">difflib</span></code>  差分の計算を助ける</a><ul>
<li><a class="reference internal" href="#sequencematcher-objects">6.3.1. SequenceMatcherオブジェクト</a></li>
<li><a class="reference internal" href="#sequencematcher-examples">6.3.2. SequenceMatcher の例</a></li>
<li><a class="reference internal" href="#differ-objects">6.3.3. Differ オブジェクト</a></li>
<li><a class="reference internal" href="#differ-example">6.3.4. Differ の例</a></li>
<li><a class="reference internal" href="#a-command-line-interface-to-difflib">6.3.5. difflib のコマンドラインインタフェース</a></li>
</ul>
</li>
</ul>
<h4>前のトピックへ</h4>
<p class="topless"><a href="re.html" title="前の章へ">6.2. <code class="docutils literal"><span class="pre">re</span></code>  正規表現操作</a></p>
<h4>次のトピックへ</h4>
<p class="topless"><a href="textwrap.html" title="次の章へ">6.4. <code class="docutils literal"><span class="pre">textwrap</span></code>  テキストの折り返しと詰め込み</a></p>
<div aria-label="source link" role="note">
<h3>このページ</h3>
<ul class="this-page-menu">
<li><a href="../bugs.html">バグ報告</a></li>
<li>
<a href="https://github.com/python/cpython/blob/3.6/Doc/library/difflib.rst" rel="nofollow">ソースの表示
        </a>
</li>
</ul>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="footer">
     <a href="../copyright.html">Copyright</a> 2001-2018, Python Software Foundation.
    <br/>
    Python Software Foundation は非営利団体です。
    <a href="https://www.python.org/psf/donations/">寄付</a>
<br/>
    最終更新日時: 7月 29, 2018
    <a href="../bugs.html">バグを見つけたら</a>?
    <br/>
    このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.5 を使って作成されました。
    </div>
</body>
</head></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="ja" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>6.3. difflib  差分の計算を助ける  Python 3.6.5 ドキュメント</title>
<link href="../_static/pydoctheme.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
<script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/underscore.js" type="text/javascript"></script>
<script src="../_static/doctools.js" type="text/javascript"></script>
<script src="../_static/translations.js" type="text/javascript"></script>
<script src="../_static/sidebar.js" type="text/javascript"></script>
<link href="../_static/opensearch.xml" rel="search" title="Python 3.6.5 ドキュメント 内を検索" type="application/opensearchdescription+xml"/>
<link href="../about.html" rel="author" title="このドキュメントについて"/>
<link href="../genindex.html" rel="index" title="索引"/>
<link href="../search.html" rel="search" title="検索"/>
<link href="../copyright.html" rel="copyright" title="Copyright"/>
<link href="textwrap.html" rel="next" title="6.4. textwrap  テキストの折り返しと詰め込み"/>
<link href="re.html" rel="prev" title="6.2. re  正規表現操作"/>
<link href="../_static/py.png" rel="shortcut icon" type="image/png"/>
<link href="https://docs.python.jp/3/library/difflib.html" rel="canonical"/><script type="text/javascript">
    $(document).ready(function() {
      var base = 'https://docs.python.org/3.6/library/difflib.html';
      $('a.headerlink').each(function() {
        var html = '<a href="' + base + $(this).attr('href') +
                   '" title="原文へのリンク"><small>(原文)</small></a>';
        $(this).after(html);
      })
    });
    </script>
<script src="../_static/copybutton.js" type="text/javascript"></script>
<script src="../_static/version_switch.js" type="text/javascript"></script>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-34175846-1', 'python.jp');
        ga('send', 'pageview');

      </script>
<body>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a accesskey="I" href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a accesskey="N" href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a accesskey="P" href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a accesskey="U" href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body" role="main">
<div class="section" id="module-difflib">
<span id="difflib-helpers-for-computing-deltas"></span><h1>6.3. <a class="reference internal" href="#module-difflib" title="difflib: Helpers for computing differences between objects."><code class="xref py py-mod docutils literal"><span class="pre">difflib</span></code></a>  差分の計算を助ける<a class="headerlink" href="#module-difflib" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><strong>ソースコード:</strong> <a class="reference external" href="https://github.com/python/cpython/tree/3.6/Lib/difflib.py">Lib/difflib.py</a></p>
<hr class="docutils"/>
<p>このモジュールは、シーケンスを比較するためのクラスや関数を提供しています。例えば、ファイルの差分を計算して、それを HTML や context diff, unified diff などいろいろなフォーマットで出力するために、このモジュールを利用することができます。ディレクトリやファイル群を比較するためには、 <a class="reference internal" href="filecmp.html#module-filecmp" title="filecmp: Compare files efficiently."><code class="xref py py-mod docutils literal"><span class="pre">filecmp</span></code></a> モジュールも参照してください。</p>
<dl class="class">
<dt id="difflib.SequenceMatcher">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><a class="headerlink" href="#difflib.SequenceMatcher" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>柔軟性のあるクラスで、二つのシーケンスの要素がハッシュ化できる(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)型であれば、どの型の要素を含むシーケンスも比較可能です。基本的なアルゴリズムは、1980年代の後半に発表された Ratcliff と Obershelp による"ゲシュタルトパターンマッチング"と大げさに名づけられたアルゴリズム以前から知られている、やや凝ったアルゴリズムです。その考え方は、"junk" 要素を含まない最も長い互いに隣接したマッチ列を探すことです。ここで、  "junk" 要素とは、空行や空白などの、意味を持たない要素のことです。 (junk を処理するのは、Ratcliff と Obershelp のアルゴリズムに追加された拡張です。)この考え方は、マッチ列の左右に隣接するシーケンスの断片に対して再帰的にあてはめられます。この方法では編集を最小にするシーケンスは生まれませんが、人間の目からみて「正しい感じ」にマッチする傾向があります。</p>
<p><strong>実行時間:</strong> 基本的な Ratcliff-Obershelp アルゴリズムは、最悪の場合3乗、期待値で2乗となります。 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトでは、最悪のケースで2乗、期待値は比較されるシーケンス中に共通に現れる要素数に非常にややこしく依存しています。最良の場合は線形時間になります。</p>
<p><strong>自動 junk ヒューリスティック:</strong> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> は、シーケンスの特定の要素を自動的に junk として扱うヒューリスティックをサポートしています。このヒューリスティックは、各個要素がシーケンス内に何回現れるかを数えます。ある要素の重複数が (最初のものは除いて) 合計でシーケンスの 1% 以上になり、そのシーケンスが 200 要素以上なら、その要素は "popular" であるものとしてマークされ、シーケンスのマッチングの目的からは junk として扱われます。このヒューリスティックは、 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> の作成時に <code class="docutils literal"><span class="pre">autojunk</span></code> パラメタを <code class="docutils literal"><span class="pre">False</span></code> に設定することで無効化できます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
</dd></dl>
<dl class="class">
<dt id="difflib.Differ">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><a class="headerlink" href="#difflib.Differ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>テキスト行からなるシーケンスを比較するクラスです。人が読むことのできる差分を作成します。 Differ クラスは <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスを利用して、行からなるシーケンスを比較したり、(ほぼ)同一の行内の文字を比較したりします。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> クラスによる差分の各行は、2文字のコードで始まります:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%"/>
<col width="81%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">コード</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'-</span> <span class="pre">'</span></code></td>
<td>行はシーケンス1にのみ存在する</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'+</span> <span class="pre">'</span></code></td>
<td>行はシーケンス2にのみ存在する</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'</span> <span class="pre">'</span></code></td>
<td>行は両方のシーケンスで同一</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'?</span> <span class="pre">'</span></code></td>
<td>行は入力シーケンスのどちらにも存在しない</td>
</tr>
</tbody>
</table>
<p>'<code class="docutils literal"><span class="pre">?</span></code>' で始まる行は、行内のどこに差異が存在するかに注意を向けようとします。その行は、入力されたシーケンスのどちらにも存在しません。シーケンスがタブ文字を含むとき、これらの行は判別しづらいものになることがあります。</p>
</dd></dl>
<dl class="class">
<dt id="difflib.HtmlDiff">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">HtmlDiff</code><a class="headerlink" href="#difflib.HtmlDiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このクラスは、二つのテキストを左右に並べて比較表示し、行間あるいは行内の変更点を強調表示するような HTML テーブル (またはテーブルの入った完全な HTML ファイル) を生成するために使います。テーブルは完全差分モード、コンテキスト差分モードのいずれでも生成できます。</p>
<p>このクラスのコンストラクタは以下のようになっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>tabsize=8</em>, <em>wrapcolumn=None</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.__init__" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> のインスタンスを初期化します。</p>
<p><em>tabsize</em> はオプションのキーワード引数で、タブストップ幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">8</span></code> です。</p>
<p><em>wrapcolumn</em> はオプションのキーワード引数で、テキストを折り返すカラム幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> で折り返しを行いません。</p>
<p><em>linejunk</em> および <em>charjunk</em> はオプションのキーワード引数で、 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a>  (<a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> はこの関数を使って左右のテキストの差分を HTML で生成します) に渡されます。それぞれの引数のデフォルト値および説明は <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> のドキュメントを参照してください。</p>
</dd></dl>
<p>以下のメソッドが public になっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.make_file">
<code class="descname">make_file</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em>, <em>*</em>, <em>charset='utf-8'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_file" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った表を持つ完全な HTML ファイルを文字列で返します。</p>
<p><em>fromdesc</em> および <em>todesc</em> はオプションのキーワード引数で、差分表示テーブルにおけるそれぞれ差分元、差分先ファイルのカラムのヘッダになる文字列を指定します (いずれもデフォルト値は空文字列です)。</p>
<p><em>context</em> および <em>numlines</em> はともにオプションのキーワード引数です。<em>context</em> を <code class="docutils literal"><span class="pre">True</span></code> にするとコンテキスト差分を表示し、デフォルトの <code class="docutils literal"><span class="pre">False</span></code> にすると完全なファイル差分を表示します。<em>numlines</em> のデフォルト値は <code class="docutils literal"><span class="pre">5</span></code> で、<em>context</em> が <code class="docutils literal"><span class="pre">True</span></code> の場合、<em>numlines</em> は強調部分の前後にあるコンテキスト行の数を制御します。<em>context</em> が <code class="docutils literal"><span class="pre">False</span></code> の場合、<em>numlines</em> は "next" と書かれたハイパーリンクをたどった時に到達する場所が次の変更部分より何行前にあるかを制御します (値をゼロにした場合、"next" ハイパーリンクを辿ると変更部分の強調表示がブラウザの最上部に表示されるようになります)。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.5 で変更: </span><em>charset</em> キーワード専用引数が追加されました。HTML 文書のデフォルトの文字集合が <code class="docutils literal"><span class="pre">'ISO-8859-1'</span></code> から <code class="docutils literal"><span class="pre">'utf-8'</span></code> に変更されました。</p>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.HtmlDiff.make_table">
<code class="descname">make_table</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った完全な HTML テーブルを文字列で返します。</p>
<p>このメソッドの引数は、 <a class="reference internal" href="#difflib.HtmlDiff.make_file" title="difflib.HtmlDiff.make_file"><code class="xref py py-meth docutils literal"><span class="pre">make_file()</span></code></a> メソッドの引数と同じです。</p>
</dd></dl>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> はこのクラスへのコマンドラインフロントエンドで、使い方を学ぶ上で格好の例題が入っています。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.context_diff">
<code class="descclassname">difflib.</code><code class="descname">context_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.context_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 context diff のフォーマット(以下「コンテクスト形式」)で返します。</p>
<p>コンテクスト形式は、変更があった行に前後数行を加えてある、コンパクトな表現方法です。変更箇所は、変更前/変更後に分けて表します。コンテクスト (変更箇所前後の行) の行数は <em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">***</span></code> や <code class="docutils literal"><span class="pre">---</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">context_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">*** before.py</span>
<span class="go">--- after.py</span>
<span class="go">***************</span>
<span class="go">*** 1,4 ****</span>
<span class="go">! bacon</span>
<span class="go">! eggs</span>
<span class="go">! ham</span>
<span class="go">  guido</span>
<span class="go">--- 1,4 ----</span>
<span class="go">! python</span>
<span class="go">! eggy</span>
<span class="go">! hamster</span>
<span class="go">  guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.get_close_matches">
<code class="descclassname">difflib.</code><code class="descname">get_close_matches</code><span class="sig-paren">(</span><em>word</em>, <em>possibilities</em>, <em>n=3</em>, <em>cutoff=0.6</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.get_close_matches" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>「十分」なマッチの上位のリストを返します。<em>word</em> はマッチさせたいシーケンス (大概は文字列) です。<em>possibilities</em> は <em>word</em> にマッチさせるシーケンスのリスト (大概は文字列のリスト) です。</p>
<p>オプションの引数 <em>n</em> (デフォルトでは <code class="docutils literal"><span class="pre">3</span></code>)はメソッドの返すマッチの最大数です。<em>n</em> は <code class="docutils literal"><span class="pre">0</span></code> より大きくなければなりません。</p>
<p>オプションの引数 <em>cutoff</em> (デフォルトでは <code class="docutils literal"><span class="pre">0.6</span></code>)は、区間 [0, 1] に入る小数の値です。<em>word</em> との一致率がそれ未満の <em>possibilities</em> の要素は無視されます。</p>
<p><em>possibilities</em> の要素でマッチした上位(多くても <em>n</em> 個)は、類似度のスコアに応じて(一番似たものを先頭に)ソートされたリストとして返されます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'appel'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ape'</span><span class="p">,</span> <span class="s1">'apple'</span><span class="p">,</span> <span class="s1">'peach'</span><span class="p">,</span> <span class="s1">'puppy'</span><span class="p">])</span>
<span class="go">['apple', 'ape']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">keyword</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'wheel'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['while']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'pineapple'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'accept'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['except']</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.ndiff">
<code class="descclassname">difflib.</code><code class="descname">ndiff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.ndiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> のスタイルで返します。</p>
<p>オプションのキーワード引数 <em>linejunk</em> と <em>charjunk</em> には、フィルタ関数 (または <code class="docutils literal"><span class="pre">None</span></code>) を渡します。</p>
<p><em>linejunk</em>: 文字列型の引数 1 つを受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは <code class="docutils literal"><span class="pre">None</span></code> です。モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_LINE_JUNK" title="difflib.IS_LINE_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_LINE_JUNK()</span></code></a> は、高々 1 つのシャープ記号(<code class="docutils literal"><span class="pre">'#'</span></code>)を除いて可視の文字を含まない行をフィルタリングするものです。しかし、下層にある <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスが、どの行が雑音となるほど頻繁に登場するかを動的に分析します。このクラスによる分析は、この関数を使用するよりも通常うまく動作します。</p>
<p><em>charjunk</em>: 文字 (長さ1の文字列) を受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは、モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_CHARACTER_JUNK" title="difflib.IS_CHARACTER_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_CHARACTER_JUNK()</span></code></a> であり、これは空白文字類 (空白またはタブ、改行文字をこれに含めてはいけません) をフィルタして排除します。</p>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/ndiff.py</span></code> は、この関数のコマンドラインのフロントエンド（インターフェイス）です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">diff</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">- one</span>
<span class="go">?  ^</span>
<span class="go">+ ore</span>
<span class="go">?  ^</span>
<span class="go">- two</span>
<span class="go">- three</span>
<span class="go">?  -</span>
<span class="go">+ tree</span>
<span class="go">+ emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.restore">
<code class="descclassname">difflib.</code><code class="descname">restore</code><span class="sig-paren">(</span><em>sequence</em>, <em>which</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.restore" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>差分を生成した元の二つのシーケンスのうち一つを返します。</p>
<p><a class="reference internal" href="#difflib.Differ.compare" title="difflib.Differ.compare"><code class="xref py py-meth docutils literal"><span class="pre">Differ.compare()</span></code></a> または <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> によって生成された <em>sequence</em> を与えられると、行頭のプレフィクスを取りのぞいてファイル 1 または 2 (引数 <em>which</em> で指定される) に由来する行を復元します。</p>
<p>例:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="c1"># materialize the generated delta into a list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">one</span>
<span class="go">two</span>
<span class="go">three</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">ore</span>
<span class="go">tree</span>
<span class="go">emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.unified_diff">
<code class="descclassname">difflib.</code><code class="descname">unified_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.unified_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 unified diff フォーマット(以下「ユニファイド形式」)で返します。</p>
<p>ユニファイド形式は変更があった行にコンテキストとなる前後数行を加えた、コンパクトな表現方法です。変更箇所は (変更前/変更後を分離したブロックではなく) インラインスタイルで表されます。コンテクストの行数は、<em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">---</span></code>, <code class="docutils literal"><span class="pre">+++</span></code>, <code class="docutils literal"><span class="pre">@@</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">--- before.py</span>
<span class="go">+++ after.py</span>
<span class="go">@@ -1,4 +1,4 @@</span>
<span class="go">-bacon</span>
<span class="go">-eggs</span>
<span class="go">-ham</span>
<span class="go">+python</span>
<span class="go">+eggy</span>
<span class="go">+hamster</span>
<span class="go"> guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.diff_bytes">
<code class="descclassname">difflib.</code><code class="descname">diff_bytes</code><span class="sig-paren">(</span><em>dfunc</em>, <em>a</em>, <em>b</em>, <em>fromfile=b''</em>, <em>tofile=b''</em>, <em>fromfiledate=b''</em>, <em>tofiledate=b''</em>, <em>n=3</em>, <em>lineterm=b'\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.diff_bytes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>dfunc</em> を使用して <em>a</em> と <em>b</em> (bytes オブジェクトのリスト) を比較して、差分形式の行 (これも bytes オブジェクトです) を*dfunc* の戻り値の形式で返します。<em>dfunc</em> は、呼び出し可能である必要があります。一般に、これは <a class="reference internal" href="#difflib.unified_diff" title="difflib.unified_diff"><code class="xref py py-func docutils literal"><span class="pre">unified_diff()</span></code></a> または <a class="reference internal" href="#difflib.context_diff" title="difflib.context_diff"><code class="xref py py-func docutils literal"><span class="pre">context_diff()</span></code></a> です。</p>
<p>未知のエンコーディングまたは一貫性のないエンコーディングのデータ同士を比較できます。<em>n</em> 以外のすべての入力は、bytes オブジェクトである必要があります。<em>n</em> 以外のすべての入力を損失なく str に変換して、<code class="docutils literal"><span class="pre">dfunc(a,</span> <span class="pre">b,</span> <span class="pre">fromfile,</span> <span class="pre">tofile,</span> <span class="pre">fromfiledate,</span> <span class="pre">tofiledate,</span> <span class="pre">n,</span> <span class="pre">lineterm)</span></code> を呼び出すことにより動作します。<em>dfunc</em> の出力は、bytes 型に変換されます。これにより、受け取る差分形式の行のエンコーディングは、<em>a</em> と <em>b</em> の未知または一貫性のないエンコーディングと同一になります。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_LINE_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_LINE_JUNK</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_LINE_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる行のとき真を返します。行 <em>line</em> は空白、または  <code class="docutils literal"><span class="pre">'#'</span></code> ひとつのときに無視できます。それ以外のときには無視できません。古いバージョンでは <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>linejunk</em> にデフォルトで使用されました。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_CHARACTER_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_CHARACTER_JUNK</code><span class="sig-paren">(</span><em>ch</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_CHARACTER_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる文字のとき真を返します。文字 <em>ch</em> が空白、またはタブ文字のときには無視できます。それ以外の時には無視できません。 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>charjunk</em> としてデフォルトで使用されます。</p>
</dd></dl>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><a class="reference external" href="http://www.drdobbs.com/database/pattern-matching-the-gestalt-approach/184407970">Pattern Matching: The Gestalt Approach</a></dt>
<dd>John W. Ratcliff と D. E. Metzener による類似のアルゴリズムに関する議論。<a class="reference external" href="http://www.drdobbs.com/">Dr. Dobb’s Journal</a> 1988年7月号掲載。</dd>
</dl>
</div>
<div class="section" id="sequencematcher-objects">
<span id="sequence-matcher"></span><h2>6.3.1. SequenceMatcherオブジェクト<a class="headerlink" href="#sequencematcher-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスには、以下のようなコンストラクタがあります:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><span class="sig-paren">(</span><em>isjunk=None</em>, <em>a=''</em>, <em>b=''</em>, <em>autojunk=True</em><span class="sig-paren">)</span></dt>
<dd><p>オプションの引数 <em>isjunk</em> は、<code class="docutils literal"><span class="pre">None</span></code> (デフォルトの値です) にするか、単一の引数をとる関数でなければなりません。後者の場合、関数はシーケンスの要素を受け取り、要素が junk であり、無視すべきである場合に限り真を返すようにしなければなりません。<em>isjunk</em> に <code class="docutils literal"><span class="pre">None</span></code> を渡すと、<code class="docutils literal"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">0</span></code> を渡したのと同じになります; すなわち、いかなる要素も無視しなくなります。例えば以下のような引数を渡すと:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">" </span><span class="se">\t</span><span class="s2">"</span>
</pre></div>
</div>
<p>空白とタブ文字を無視して文字のシーケンスを比較します。</p>
<p>オプションの引数 <em>a</em> と <em>b</em> は、比較される文字列で、デフォルトでは空の文字列です。両方のシーケンスの要素は、ハッシュ化可能(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)である必要があります。</p>
<p>オプションの引数 <em>autojunk</em> は、自動 junk ヒューリスティックを無効にするために使えます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
<p>SequenceMatcher オブジェクトは3つのデータ属性を持っています: <em>bjunk</em> は、 <em>isjunk</em> が <code class="docutils literal"><span class="pre">True</span></code> であるような <em>b</em> の要素の集合です; <em>bpopular</em> は、 (無効でなければ) ヒューリスティックによって popular であると考えられる非ジャンク要素の集合です; <em>b2j</em> は、 <em>b</em> の残りの要素をそれらが生じる位置のリストに写像する dict です。この 3 つは <a class="reference internal" href="#difflib.SequenceMatcher.set_seqs" title="difflib.SequenceMatcher.set_seqs"><code class="xref py py-meth docutils literal"><span class="pre">set_seqs()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> で <em>b</em> がリセットされる場合は常にリセットされます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>bjunk</em> および <em>bpopular</em> 属性。</p>
</div>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは以下のメソッドを持ちます:</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seqs">
<code class="descname">set_seqs</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seqs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較される2つの文字列を設定します。</p>
</dd></dl>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは、2つ目のシーケンスについての詳細な情報を計算し、キャッシュします。 1つのシーケンスをいくつものシーケンスと比較する場合、まず <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> を使って文字列を設定しておき、別の文字列を1つずつ比較するために、繰り返し <a class="reference internal" href="#difflib.SequenceMatcher.set_seq1" title="difflib.SequenceMatcher.set_seq1"><code class="xref py py-meth docutils literal"><span class="pre">set_seq1()</span></code></a> を呼び出します。</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq1">
<code class="descname">set_seq1</code><span class="sig-paren">(</span><em>a</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq1" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う1つ目のシーケンスを設定します。比較される2つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq2">
<code class="descname">set_seq2</code><span class="sig-paren">(</span><em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq2" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う2つ目のシーケンスを設定します。比較される1つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.find_longest_match">
<code class="descname">find_longest_match</code><span class="sig-paren">(</span><em>alo</em>, <em>ahi</em>, <em>blo</em>, <em>bhi</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.find_longest_match" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">a[alo:ahi]</span></code> と <code class="docutils literal"><span class="pre">b[blo:bhi]</span></code> の中から、最長のマッチ列を探します。</p>
<p><em>isjunk</em> が省略されたか <code class="docutils literal"><span class="pre">None</span></code> の時、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> は <code class="docutils literal"><span class="pre">a[i:i+k]</span></code> が <code class="docutils literal"><span class="pre">b[j:j+k]</span></code> と等しいような <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">k)</span></code> を返します。その値は <code class="docutils literal"><span class="pre">alo</span> <span class="pre">&lt;=</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i+k</span> <span class="pre">&lt;=</span> <span class="pre">ahi</span></code> かつ <code class="docutils literal"><span class="pre">blo</span> <span class="pre">&lt;=</span> <span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j+k</span> <span class="pre">&lt;=</span> <span class="pre">bhi</span></code> となります。 <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">k')</span></code> でも、同じようになります。さらに <code class="docutils literal"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">k'</span></code>, <code class="docutils literal"><span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i'</span></code> が <code class="docutils literal"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">i'</span></code>, <code class="docutils literal"><span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j'</span></code> でも同様です。言い換えると、いくつものマッチ列すべてのうち、 <em>a</em> 内で最初に始まるものを返します。そしてその <em>a</em> 内で最初のマッチ列すべてのうち <em>b</em> 内で最初に始まるものを返します。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=0, b=4, size=5)</span>
</pre></div>
</div>
<p>引数 <em>isjunk</em> が与えられている場合、上記の通り、はじめに最長のマッチ列を判定します。ブロック内に junk 要素が見当たらないような追加条件の際はこれに該当しません。次にそのマッチ列を、その両側の junk 要素にマッチするよう、できる限り広げていきます。そのため結果となる列は、探している列のたまたま直前にあった同一の junk 以外の junk にはマッチしません。</p>
<p>以下は前と同じサンプルですが、空白を junk とみなしています。これは <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> が2つ目の列の末尾にある <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> にマッチしないようにしています。代わりに <code class="docutils literal"><span class="pre">'abcd'</span></code> にはマッチします。そして 2つ目の文字列中、一番左の <code class="docutils literal"><span class="pre">'abcd'</span></code> にマッチします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">==</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=1, b=0, size=4)</span>
</pre></div>
</div>
<p>どんな列にもマッチしない時は、<code class="docutils literal"><span class="pre">(alo,</span> <span class="pre">blo,</span> <span class="pre">0)</span></code> を返します。</p>
<p>このメソッドは <a class="reference internal" href="../glossary.html#term-named-tuple"><span class="xref std std-term">named tuple</span></a> <code class="docutils literal"><span class="pre">Match(a,</span> <span class="pre">b,</span> <span class="pre">size)</span></code> を返します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_matching_blocks">
<code class="descname">get_matching_blocks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_matching_blocks" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>マッチしたシーケンス中で個別にマッチしたシーケンスをあらわす、3つの値のリストを返します。それぞれの値は <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> という形式であらわされ、<code class="docutils literal"><span class="pre">a[i:i+n]</span> <span class="pre">==</span> <span class="pre">b[j:j+n]</span></code> という関係を意味します。3つの値は <em>i</em> と <em>j</em> の間で単調に増加します。</p>
<p>最後のタプルはダミーで、<code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> という値を持ちます。これは <code class="docutils literal"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">0</span></code> である唯一のタプルです。もし <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> と <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">n')</span></code> がリストで並んでいる3つ組で、2つ目が最後の3つ組でなければ、<code class="docutils literal"><span class="pre">i+n</span> <span class="pre">!=</span> <span class="pre">i'</span></code> または <code class="docutils literal"><span class="pre">j+n</span> <span class="pre">!=</span> <span class="pre">j'</span></code> です。言い換えると並んでいる3つ組は常に隣接していない同じブロックを表しています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abxcd"</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">()</span>
<span class="go">[Match(a=0, b=0, size=2), Match(a=3, b=2, size=2), Match(a=5, b=4, size=0)]</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_opcodes">
<code class="descname">get_opcodes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> を <em>b</em> にするための方法を記述する5つのタプルを返します。それぞれのタプルは <code class="docutils literal"><span class="pre">(tag,</span> <span class="pre">i1,</span> <span class="pre">i2,</span> <span class="pre">j1,</span> <span class="pre">j2)</span></code> という形式であらわされます。最初のタプルは <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">j1</span> <span class="pre">==</span> <span class="pre">0</span></code> であり、<em>i1</em> はその前にあるタプルの <em>i2</em> と同じ値です。同様に <em>j1</em> は前の <em>j2</em> と同じ値になります。</p>
<p><em>tag</em> の値は文字列であり、次のような意味です:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%"/>
<col width="75%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'replace'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は <code class="docutils literal"><span class="pre">b[j1:j2]</span></code> に置き換えられる。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'delete'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は削除される。この時、<code class="docutils literal"><span class="pre">j1</span> <span class="pre">==</span> <span class="pre">j2</span></code> である。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'insert'</span></code></td>
<td><code class="docutils literal"><span class="pre">b[j1:j2]</span></code> が <code class="docutils literal"><span class="pre">a[i1:i1]</span></code> に挿入される。この時 <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">i2</span></code> である。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'equal'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span> <span class="pre">==</span> <span class="pre">b[j1:j2]</span></code> (サブシーケンスは等しい).</td>
</tr>
</tbody>
</table>
<p>例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="s2">"qabxcd"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="s2">"abycdf"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{:7}</span><span class="s1">   a[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] --&gt; b[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] </span><span class="si">{!r:&gt;8}</span><span class="s1"> --&gt; </span><span class="si">{!r}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">]))</span>
<span class="go">delete    a[0:1] --&gt; b[0:0]      'q' --&gt; ''</span>
<span class="go">equal     a[1:3] --&gt; b[0:2]     'ab' --&gt; 'ab'</span>
<span class="go">replace   a[3:4] --&gt; b[2:3]      'x' --&gt; 'y'</span>
<span class="go">equal     a[4:6] --&gt; b[3:5]     'cd' --&gt; 'cd'</span>
<span class="go">insert    a[6:6] --&gt; b[5:6]       '' --&gt; 'f'</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_grouped_opcodes">
<code class="descname">get_grouped_opcodes</code><span class="sig-paren">(</span><em>n=3</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_grouped_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>最大 <em>n</em> 行までのコンテクストを含むグループを生成するような、ジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)を返します。</p>
<p>このメソッドは、 <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> で返されるグループの中から、似たような差異のかたまりに分け、間に挟まっている変更の無い部分を省きます。</p>
<p>グループは <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> と同じ書式で返されます。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.ratio">
<code class="descname">ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>[0, 1] の範囲の浮動小数点数で、シーケンスの類似度を測る値を返します。</p>
<p>T が2つのシーケンスの要素数の総計だと仮定し、M をマッチした数とすると、この値は 2.0*M / T であらわされます。もしシーケンスがまったく同じ場合、値は <code class="docutils literal"><span class="pre">1.0</span></code> となり、まったく異なる場合には <code class="docutils literal"><span class="pre">0.0</span></code> となります。</p>
<p>このメソッドは <a class="reference internal" href="#difflib.SequenceMatcher.get_matching_blocks" title="difflib.SequenceMatcher.get_matching_blocks"><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> がまだ呼び出されていない場合には非常にコストが高いです。この場合、上限を素早く計算するために、 <a class="reference internal" href="#difflib.SequenceMatcher.quick_ratio" title="difflib.SequenceMatcher.quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code></a> もしくは <a class="reference internal" href="#difflib.SequenceMatcher.real_quick_ratio" title="difflib.SequenceMatcher.real_quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code></a> を最初に試してみる方がいいかもしれません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.quick_ratio">
<code class="descname">quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、より高速に計算します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.real_quick_ratio">
<code class="descname">real_quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.real_quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、非常に高速に計算します。</p>
</dd></dl>
</dd></dl>
<p>この文字列全体のマッチ率を返す3つのメソッドは、精度の異なる近似値を返します。 <code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code> と <code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code> は、常に <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> 以上の値を返します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">,</span> <span class="s2">"bcde"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">quick_ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">real_quick_ratio</span><span class="p">()</span>
<span class="go">1.0</span>
</pre></div>
</div>
</div>
<div class="section" id="sequencematcher-examples">
<span id="id1"></span><h2>6.3.2. SequenceMatcher の例<a class="headerlink" href="#sequencematcher-examples" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は2つの文字列を比較します。空白を "junk" とします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">" "</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private Thread currentThread;"</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private volatile Thread currentThread;"</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> は、[0, 1] の範囲の値を返し、シーケンスの類似度を測ります。経験によると、 <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> の値が0.6を超えると、シーケンスがよく似ていることを示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="go">0.866</span>
</pre></div>
</div>
<p>シーケンスのどこがマッチしているかにだけ興味のある時には <code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が手軽でしょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"a[</span><span class="si">%d</span><span class="s2">] and b[</span><span class="si">%d</span><span class="s2">] match for </span><span class="si">%d</span><span class="s2"> elements"</span> <span class="o">%</span> <span class="n">block</span><span class="p">)</span>
<span class="go">a[0] and b[0] match for 8 elements</span>
<span class="go">a[8] and b[17] match for 21 elements</span>
<span class="go">a[29] and b[38] match for 0 elements</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が返す最後のタプルが常にダミーであることに注目してください。このダミーは <code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> であり、これはタプルの最後の要素（マッチする要素の数）が <code class="docutils literal"><span class="pre">0</span></code> となる唯一のケースです。</p>
<p>はじめのシーケンスがどのようにして2番目のものになるのかを知るには、 <code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code> を使います:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%6s</span><span class="s2"> a[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">] b[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">]"</span> <span class="o">%</span> <span class="n">opcode</span><span class="p">)</span>
<span class="go"> equal a[0:8] b[0:8]</span>
<span class="go">insert a[8:8] b[8:17]</span>
<span class="go"> equal a[8:29] b[17:38]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<ul class="last simple">
<li><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> を使った、シンプルで使えるコードを知るには、このモジュールの関数 <a class="reference internal" href="#difflib.get_close_matches" title="difflib.get_close_matches"><code class="xref py py-func docutils literal"><span class="pre">get_close_matches()</span></code></a> を参照してください。</li>
<li><a class="reference external" href="https://code.activestate.com/recipes/576729/">Simple version control recipe</a> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> で作った小規模アプリケーション。</li>
</ul>
</div>
</div>
<div class="section" id="differ-objects">
<span id="id2"></span><h2>6.3.3. Differ オブジェクト<a class="headerlink" href="#differ-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトによって生成された差分が <strong>最小</strong> であるなどとは言いません。むしろ、最小の差分はしばしば直観に反しています。その理由は、どこでもできるとなれば一致を見いだしてしまうからで、ときには思いがけなく100ページも離れたマッチになってしまうのです。一致点を互いに隣接したマッチに制限することで、場合によって長めの差分を出力するというコストを掛けることにはなっても、ある種の局所性を保つことができるのです。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> は、以下のようなコンストラクタを持ちます:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><span class="sig-paren">(</span><em>linejunk=None</em>, <em>charjunk=None</em><span class="sig-paren">)</span></dt>
<dd><p>オプションのキーワードパラメータ <em>linejunk</em> と <em>charjunk</em> は、フィルタ関数を渡します (使わないときは <code class="docutils literal"><span class="pre">None</span></code>):</p>
<p><em>linejunk</em>: ひとつの文字列引数を受け取る関数です。文字列が junk のときに真を返します。デフォルトでは、<code class="docutils literal"><span class="pre">None</span></code> であり、どんな行であっても junk とは見なされません。</p>
<p><em>charjunk</em>: この関数は文字(長さ1の文字列)を引数として受け取り、文字が junk であるときに真を返します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> であり、どんな文字も junk とは見なされません。</p>
<p>これらの junk フィルター関数により、差分を発見するマッチングが高速化し、差分の行や文字が無視されることがなくなります。説明については、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> メソッドの <em>isjunk</em> 引数の説明をご覧ください。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトは、以下の1つのメソッドを通して利用されます。（差分を生成します）:</p>
<dl class="method">
<dt id="difflib.Differ.compare">
<code class="descname">compare</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.Differ.compare" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>文字列からなる2つのシーケンスを比較し、差分（を表す文字列からなるシーケンス）を生成します。</p>
<p>各シーケンスの要素は、改行で終わる独立した単一行からなる文字列でなければなりません。そのようなシーケンスは、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code></a> メソッドによって得ることができます。（得られる）差分は改行文字で終了する文字列のシーケンスとして得られ、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-meth docutils literal"><span class="pre">writelines()</span></code></a> メソッドによって出力できる形になっています。</p>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="differ-example">
<span id="differ-examples"></span><h2>6.3.4. Differ の例<a class="headerlink" href="#differ-example" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下の例は2つのテキストを比較しています。最初に、テキストを行毎に改行で終わる文字列のシーケンスにセットアップします (そのようなシーケンスは、ファイル風オブジェクトの <code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code> メソッドからも得ることができます):</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  2. Explicit is better than implicit.</span>
<span class="gp">... </span><span class="s1">  3. Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complex is better than complicated.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">'\n'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text2</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  3.   Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complicated is better than complex.</span>
<span class="gp">... </span><span class="s1">  5. Flat is better than nested.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>次に Differ オブジェクトをインスタンス化します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Differ</span><span class="p">()</span>
</pre></div>
</div>
<p>注意:  <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトをインスタンス化するとき、行 junk と文字 junk をフィルタリングする関数を渡すことができます。詳細は <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-meth docutils literal"><span class="pre">Differ()</span></code></a> コンストラクタを参照してください。</p>
<p>最後に、2つを比較します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">result</span></code> は文字列のリストなので、pretty-printしてみましょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">['    1. Beautiful is better than ugly.\n',</span>
<span class="go"> '-   2. Explicit is better than implicit.\n',</span>
<span class="go"> '-   3. Simple is better than complex.\n',</span>
<span class="go"> '+   3.   Simple is better than complex.\n',</span>
<span class="go"> '?     ++\n',</span>
<span class="go"> '-   4. Complex is better than complicated.\n',</span>
<span class="go"> '?            ^                     ---- ^\n',</span>
<span class="go"> '+   4. Complicated is better than complex.\n',</span>
<span class="go"> '?           ++++ ^                      ^\n',</span>
<span class="go"> '+   5. Flat is better than nested.\n']</span>
</pre></div>
</div>
<p>これは、複数行の文字列として、次のように出力されます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">    1. Beautiful is better than ugly.</span>
<span class="go">-   2. Explicit is better than implicit.</span>
<span class="go">-   3. Simple is better than complex.</span>
<span class="go">+   3.   Simple is better than complex.</span>
<span class="go">?     ++</span>
<span class="go">-   4. Complex is better than complicated.</span>
<span class="go">?            ^                     ---- ^</span>
<span class="go">+   4. Complicated is better than complex.</span>
<span class="go">?           ++++ ^                      ^</span>
<span class="go">+   5. Flat is better than nested.</span>
</pre></div>
</div>
</div>
<div class="section" id="a-command-line-interface-to-difflib">
<span id="difflib-interface"></span><h2>6.3.5. difflib のコマンドラインインタフェース<a class="headerlink" href="#a-command-line-interface-to-difflib" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は、 difflib を使って <code class="docutils literal"><span class="pre">diff</span></code> に似たユーティリティーを作成する方法を示します。これは、 Python のソース配布物にも、 <code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> として含まれています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">""" Command line interface to difflib.py providing diffs in four formats:</span>

<span class="sd">* ndiff:    lists every line and highlights interline changes.</span>
<span class="sd">* context:  highlights clusters of changes in a before/after format.</span>
<span class="sd">* unified:  highlights clusters of changes in an inline format.</span>
<span class="sd">* html:     generates side by side comparison with change highlights.</span>

<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">difflib</span><span class="o">,</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="k">def</span> <span class="nf">file_mtime</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span>
                               <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a context format diff (default)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-u'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a unified format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-m'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce HTML side by side diff '</span>
                             <span class="s1">'(can use -c and -l in conjunction)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-n'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a ndiff format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-l'</span><span class="p">,</span> <span class="s1">'--lines'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Set number of context lines (default 3)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'fromfile'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'tofile'</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">lines</span>
    <span class="n">fromfile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">fromfile</span>
    <span class="n">tofile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">tofile</span>

    <span class="n">fromdate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span>
    <span class="n">todate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">fromlines</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
        <span class="n">tolines</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">u</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">m</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">HtmlDiff</span><span class="p">()</span><span class="o">.</span><span class="n">make_file</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span><span class="n">tolines</span><span class="p">,</span><span class="n">fromfile</span><span class="p">,</span><span class="n">tofile</span><span class="p">,</span><span class="n">context</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">numlines</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">context_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div aria-label="main navigation" class="sphinxsidebar" role="navigation">
<div class="sphinxsidebarwrapper">
<h3><a href="../contents.html">目次</a></h3>
<ul>
<li><a class="reference internal" href="#">6.3. <code class="docutils literal"><span class="pre">difflib</span></code>  差分の計算を助ける</a><ul>
<li><a class="reference internal" href="#sequencematcher-objects">6.3.1. SequenceMatcherオブジェクト</a></li>
<li><a class="reference internal" href="#sequencematcher-examples">6.3.2. SequenceMatcher の例</a></li>
<li><a class="reference internal" href="#differ-objects">6.3.3. Differ オブジェクト</a></li>
<li><a class="reference internal" href="#differ-example">6.3.4. Differ の例</a></li>
<li><a class="reference internal" href="#a-command-line-interface-to-difflib">6.3.5. difflib のコマンドラインインタフェース</a></li>
</ul>
</li>
</ul>
<h4>前のトピックへ</h4>
<p class="topless"><a href="re.html" title="前の章へ">6.2. <code class="docutils literal"><span class="pre">re</span></code>  正規表現操作</a></p>
<h4>次のトピックへ</h4>
<p class="topless"><a href="textwrap.html" title="次の章へ">6.4. <code class="docutils literal"><span class="pre">textwrap</span></code>  テキストの折り返しと詰め込み</a></p>
<div aria-label="source link" role="note">
<h3>このページ</h3>
<ul class="this-page-menu">
<li><a href="../bugs.html">バグ報告</a></li>
<li>
<a href="https://github.com/python/cpython/blob/3.6/Doc/library/difflib.rst" rel="nofollow">ソースの表示
        </a>
</li>
</ul>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="footer">
     <a href="../copyright.html">Copyright</a> 2001-2018, Python Software Foundation.
    <br/>
    Python Software Foundation は非営利団体です。
    <a href="https://www.python.org/psf/donations/">寄付</a>
<br/>
    最終更新日時: 7月 29, 2018
    <a href="../bugs.html">バグを見つけたら</a>?
    <br/>
    このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.5 を使って作成されました。
    </div>
</body>
</head></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="ja" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>6.3. difflib  差分の計算を助ける  Python 3.6.5 ドキュメント</title>
<link href="../_static/pydoctheme.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
<script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/underscore.js" type="text/javascript"></script>
<script src="../_static/doctools.js" type="text/javascript"></script>
<script src="../_static/translations.js" type="text/javascript"></script>
<script src="../_static/sidebar.js" type="text/javascript"></script>
<link href="../_static/opensearch.xml" rel="search" title="Python 3.6.5 ドキュメント 内を検索" type="application/opensearchdescription+xml"/>
<link href="../about.html" rel="author" title="このドキュメントについて"/>
<link href="../genindex.html" rel="index" title="索引"/>
<link href="../search.html" rel="search" title="検索"/>
<link href="../copyright.html" rel="copyright" title="Copyright"/>
<link href="textwrap.html" rel="next" title="6.4. textwrap  テキストの折り返しと詰め込み"/>
<link href="re.html" rel="prev" title="6.2. re  正規表現操作"/>
<link href="../_static/py.png" rel="shortcut icon" type="image/png"/>
<link href="https://docs.python.jp/3/library/difflib.html" rel="canonical"/><script type="text/javascript">
    $(document).ready(function() {
      var base = 'https://docs.python.org/3.6/library/difflib.html';
      $('a.headerlink').each(function() {
        var html = '<a href="' + base + $(this).attr('href') +
                   '" title="原文へのリンク"><small>(原文)</small></a>';
        $(this).after(html);
      })
    });
    </script>
<script src="../_static/copybutton.js" type="text/javascript"></script>
<script src="../_static/version_switch.js" type="text/javascript"></script>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-34175846-1', 'python.jp');
        ga('send', 'pageview');

      </script>
<body>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a accesskey="I" href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a accesskey="N" href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a accesskey="P" href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a accesskey="U" href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body" role="main">
<div class="section" id="module-difflib">
<span id="difflib-helpers-for-computing-deltas"></span><h1>6.3. <a class="reference internal" href="#module-difflib" title="difflib: Helpers for computing differences between objects."><code class="xref py py-mod docutils literal"><span class="pre">difflib</span></code></a>  差分の計算を助ける<a class="headerlink" href="#module-difflib" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><strong>ソースコード:</strong> <a class="reference external" href="https://github.com/python/cpython/tree/3.6/Lib/difflib.py">Lib/difflib.py</a></p>
<hr class="docutils"/>
<p>このモジュールは、シーケンスを比較するためのクラスや関数を提供しています。例えば、ファイルの差分を計算して、それを HTML や context diff, unified diff などいろいろなフォーマットで出力するために、このモジュールを利用することができます。ディレクトリやファイル群を比較するためには、 <a class="reference internal" href="filecmp.html#module-filecmp" title="filecmp: Compare files efficiently."><code class="xref py py-mod docutils literal"><span class="pre">filecmp</span></code></a> モジュールも参照してください。</p>
<dl class="class">
<dt id="difflib.SequenceMatcher">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><a class="headerlink" href="#difflib.SequenceMatcher" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>柔軟性のあるクラスで、二つのシーケンスの要素がハッシュ化できる(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)型であれば、どの型の要素を含むシーケンスも比較可能です。基本的なアルゴリズムは、1980年代の後半に発表された Ratcliff と Obershelp による"ゲシュタルトパターンマッチング"と大げさに名づけられたアルゴリズム以前から知られている、やや凝ったアルゴリズムです。その考え方は、"junk" 要素を含まない最も長い互いに隣接したマッチ列を探すことです。ここで、  "junk" 要素とは、空行や空白などの、意味を持たない要素のことです。 (junk を処理するのは、Ratcliff と Obershelp のアルゴリズムに追加された拡張です。)この考え方は、マッチ列の左右に隣接するシーケンスの断片に対して再帰的にあてはめられます。この方法では編集を最小にするシーケンスは生まれませんが、人間の目からみて「正しい感じ」にマッチする傾向があります。</p>
<p><strong>実行時間:</strong> 基本的な Ratcliff-Obershelp アルゴリズムは、最悪の場合3乗、期待値で2乗となります。 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトでは、最悪のケースで2乗、期待値は比較されるシーケンス中に共通に現れる要素数に非常にややこしく依存しています。最良の場合は線形時間になります。</p>
<p><strong>自動 junk ヒューリスティック:</strong> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> は、シーケンスの特定の要素を自動的に junk として扱うヒューリスティックをサポートしています。このヒューリスティックは、各個要素がシーケンス内に何回現れるかを数えます。ある要素の重複数が (最初のものは除いて) 合計でシーケンスの 1% 以上になり、そのシーケンスが 200 要素以上なら、その要素は "popular" であるものとしてマークされ、シーケンスのマッチングの目的からは junk として扱われます。このヒューリスティックは、 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> の作成時に <code class="docutils literal"><span class="pre">autojunk</span></code> パラメタを <code class="docutils literal"><span class="pre">False</span></code> に設定することで無効化できます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
</dd></dl>
<dl class="class">
<dt id="difflib.Differ">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><a class="headerlink" href="#difflib.Differ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>テキスト行からなるシーケンスを比較するクラスです。人が読むことのできる差分を作成します。 Differ クラスは <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスを利用して、行からなるシーケンスを比較したり、(ほぼ)同一の行内の文字を比較したりします。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> クラスによる差分の各行は、2文字のコードで始まります:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%"/>
<col width="81%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">コード</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'-</span> <span class="pre">'</span></code></td>
<td>行はシーケンス1にのみ存在する</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'+</span> <span class="pre">'</span></code></td>
<td>行はシーケンス2にのみ存在する</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'</span> <span class="pre">'</span></code></td>
<td>行は両方のシーケンスで同一</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'?</span> <span class="pre">'</span></code></td>
<td>行は入力シーケンスのどちらにも存在しない</td>
</tr>
</tbody>
</table>
<p>'<code class="docutils literal"><span class="pre">?</span></code>' で始まる行は、行内のどこに差異が存在するかに注意を向けようとします。その行は、入力されたシーケンスのどちらにも存在しません。シーケンスがタブ文字を含むとき、これらの行は判別しづらいものになることがあります。</p>
</dd></dl>
<dl class="class">
<dt id="difflib.HtmlDiff">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">HtmlDiff</code><a class="headerlink" href="#difflib.HtmlDiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このクラスは、二つのテキストを左右に並べて比較表示し、行間あるいは行内の変更点を強調表示するような HTML テーブル (またはテーブルの入った完全な HTML ファイル) を生成するために使います。テーブルは完全差分モード、コンテキスト差分モードのいずれでも生成できます。</p>
<p>このクラスのコンストラクタは以下のようになっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>tabsize=8</em>, <em>wrapcolumn=None</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.__init__" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> のインスタンスを初期化します。</p>
<p><em>tabsize</em> はオプションのキーワード引数で、タブストップ幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">8</span></code> です。</p>
<p><em>wrapcolumn</em> はオプションのキーワード引数で、テキストを折り返すカラム幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> で折り返しを行いません。</p>
<p><em>linejunk</em> および <em>charjunk</em> はオプションのキーワード引数で、 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a>  (<a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> はこの関数を使って左右のテキストの差分を HTML で生成します) に渡されます。それぞれの引数のデフォルト値および説明は <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> のドキュメントを参照してください。</p>
</dd></dl>
<p>以下のメソッドが public になっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.make_file">
<code class="descname">make_file</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em>, <em>*</em>, <em>charset='utf-8'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_file" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った表を持つ完全な HTML ファイルを文字列で返します。</p>
<p><em>fromdesc</em> および <em>todesc</em> はオプションのキーワード引数で、差分表示テーブルにおけるそれぞれ差分元、差分先ファイルのカラムのヘッダになる文字列を指定します (いずれもデフォルト値は空文字列です)。</p>
<p><em>context</em> および <em>numlines</em> はともにオプションのキーワード引数です。<em>context</em> を <code class="docutils literal"><span class="pre">True</span></code> にするとコンテキスト差分を表示し、デフォルトの <code class="docutils literal"><span class="pre">False</span></code> にすると完全なファイル差分を表示します。<em>numlines</em> のデフォルト値は <code class="docutils literal"><span class="pre">5</span></code> で、<em>context</em> が <code class="docutils literal"><span class="pre">True</span></code> の場合、<em>numlines</em> は強調部分の前後にあるコンテキスト行の数を制御します。<em>context</em> が <code class="docutils literal"><span class="pre">False</span></code> の場合、<em>numlines</em> は "next" と書かれたハイパーリンクをたどった時に到達する場所が次の変更部分より何行前にあるかを制御します (値をゼロにした場合、"next" ハイパーリンクを辿ると変更部分の強調表示がブラウザの最上部に表示されるようになります)。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.5 で変更: </span><em>charset</em> キーワード専用引数が追加されました。HTML 文書のデフォルトの文字集合が <code class="docutils literal"><span class="pre">'ISO-8859-1'</span></code> から <code class="docutils literal"><span class="pre">'utf-8'</span></code> に変更されました。</p>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.HtmlDiff.make_table">
<code class="descname">make_table</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った完全な HTML テーブルを文字列で返します。</p>
<p>このメソッドの引数は、 <a class="reference internal" href="#difflib.HtmlDiff.make_file" title="difflib.HtmlDiff.make_file"><code class="xref py py-meth docutils literal"><span class="pre">make_file()</span></code></a> メソッドの引数と同じです。</p>
</dd></dl>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> はこのクラスへのコマンドラインフロントエンドで、使い方を学ぶ上で格好の例題が入っています。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.context_diff">
<code class="descclassname">difflib.</code><code class="descname">context_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.context_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 context diff のフォーマット(以下「コンテクスト形式」)で返します。</p>
<p>コンテクスト形式は、変更があった行に前後数行を加えてある、コンパクトな表現方法です。変更箇所は、変更前/変更後に分けて表します。コンテクスト (変更箇所前後の行) の行数は <em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">***</span></code> や <code class="docutils literal"><span class="pre">---</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">context_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">*** before.py</span>
<span class="go">--- after.py</span>
<span class="go">***************</span>
<span class="go">*** 1,4 ****</span>
<span class="go">! bacon</span>
<span class="go">! eggs</span>
<span class="go">! ham</span>
<span class="go">  guido</span>
<span class="go">--- 1,4 ----</span>
<span class="go">! python</span>
<span class="go">! eggy</span>
<span class="go">! hamster</span>
<span class="go">  guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.get_close_matches">
<code class="descclassname">difflib.</code><code class="descname">get_close_matches</code><span class="sig-paren">(</span><em>word</em>, <em>possibilities</em>, <em>n=3</em>, <em>cutoff=0.6</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.get_close_matches" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>「十分」なマッチの上位のリストを返します。<em>word</em> はマッチさせたいシーケンス (大概は文字列) です。<em>possibilities</em> は <em>word</em> にマッチさせるシーケンスのリスト (大概は文字列のリスト) です。</p>
<p>オプションの引数 <em>n</em> (デフォルトでは <code class="docutils literal"><span class="pre">3</span></code>)はメソッドの返すマッチの最大数です。<em>n</em> は <code class="docutils literal"><span class="pre">0</span></code> より大きくなければなりません。</p>
<p>オプションの引数 <em>cutoff</em> (デフォルトでは <code class="docutils literal"><span class="pre">0.6</span></code>)は、区間 [0, 1] に入る小数の値です。<em>word</em> との一致率がそれ未満の <em>possibilities</em> の要素は無視されます。</p>
<p><em>possibilities</em> の要素でマッチした上位(多くても <em>n</em> 個)は、類似度のスコアに応じて(一番似たものを先頭に)ソートされたリストとして返されます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'appel'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ape'</span><span class="p">,</span> <span class="s1">'apple'</span><span class="p">,</span> <span class="s1">'peach'</span><span class="p">,</span> <span class="s1">'puppy'</span><span class="p">])</span>
<span class="go">['apple', 'ape']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">keyword</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'wheel'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['while']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'pineapple'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'accept'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['except']</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.ndiff">
<code class="descclassname">difflib.</code><code class="descname">ndiff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.ndiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> のスタイルで返します。</p>
<p>オプションのキーワード引数 <em>linejunk</em> と <em>charjunk</em> には、フィルタ関数 (または <code class="docutils literal"><span class="pre">None</span></code>) を渡します。</p>
<p><em>linejunk</em>: 文字列型の引数 1 つを受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは <code class="docutils literal"><span class="pre">None</span></code> です。モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_LINE_JUNK" title="difflib.IS_LINE_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_LINE_JUNK()</span></code></a> は、高々 1 つのシャープ記号(<code class="docutils literal"><span class="pre">'#'</span></code>)を除いて可視の文字を含まない行をフィルタリングするものです。しかし、下層にある <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスが、どの行が雑音となるほど頻繁に登場するかを動的に分析します。このクラスによる分析は、この関数を使用するよりも通常うまく動作します。</p>
<p><em>charjunk</em>: 文字 (長さ1の文字列) を受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは、モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_CHARACTER_JUNK" title="difflib.IS_CHARACTER_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_CHARACTER_JUNK()</span></code></a> であり、これは空白文字類 (空白またはタブ、改行文字をこれに含めてはいけません) をフィルタして排除します。</p>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/ndiff.py</span></code> は、この関数のコマンドラインのフロントエンド（インターフェイス）です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">diff</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">- one</span>
<span class="go">?  ^</span>
<span class="go">+ ore</span>
<span class="go">?  ^</span>
<span class="go">- two</span>
<span class="go">- three</span>
<span class="go">?  -</span>
<span class="go">+ tree</span>
<span class="go">+ emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.restore">
<code class="descclassname">difflib.</code><code class="descname">restore</code><span class="sig-paren">(</span><em>sequence</em>, <em>which</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.restore" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>差分を生成した元の二つのシーケンスのうち一つを返します。</p>
<p><a class="reference internal" href="#difflib.Differ.compare" title="difflib.Differ.compare"><code class="xref py py-meth docutils literal"><span class="pre">Differ.compare()</span></code></a> または <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> によって生成された <em>sequence</em> を与えられると、行頭のプレフィクスを取りのぞいてファイル 1 または 2 (引数 <em>which</em> で指定される) に由来する行を復元します。</p>
<p>例:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="c1"># materialize the generated delta into a list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">one</span>
<span class="go">two</span>
<span class="go">three</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">ore</span>
<span class="go">tree</span>
<span class="go">emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.unified_diff">
<code class="descclassname">difflib.</code><code class="descname">unified_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.unified_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 unified diff フォーマット(以下「ユニファイド形式」)で返します。</p>
<p>ユニファイド形式は変更があった行にコンテキストとなる前後数行を加えた、コンパクトな表現方法です。変更箇所は (変更前/変更後を分離したブロックではなく) インラインスタイルで表されます。コンテクストの行数は、<em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">---</span></code>, <code class="docutils literal"><span class="pre">+++</span></code>, <code class="docutils literal"><span class="pre">@@</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">--- before.py</span>
<span class="go">+++ after.py</span>
<span class="go">@@ -1,4 +1,4 @@</span>
<span class="go">-bacon</span>
<span class="go">-eggs</span>
<span class="go">-ham</span>
<span class="go">+python</span>
<span class="go">+eggy</span>
<span class="go">+hamster</span>
<span class="go"> guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.diff_bytes">
<code class="descclassname">difflib.</code><code class="descname">diff_bytes</code><span class="sig-paren">(</span><em>dfunc</em>, <em>a</em>, <em>b</em>, <em>fromfile=b''</em>, <em>tofile=b''</em>, <em>fromfiledate=b''</em>, <em>tofiledate=b''</em>, <em>n=3</em>, <em>lineterm=b'\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.diff_bytes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>dfunc</em> を使用して <em>a</em> と <em>b</em> (bytes オブジェクトのリスト) を比較して、差分形式の行 (これも bytes オブジェクトです) を*dfunc* の戻り値の形式で返します。<em>dfunc</em> は、呼び出し可能である必要があります。一般に、これは <a class="reference internal" href="#difflib.unified_diff" title="difflib.unified_diff"><code class="xref py py-func docutils literal"><span class="pre">unified_diff()</span></code></a> または <a class="reference internal" href="#difflib.context_diff" title="difflib.context_diff"><code class="xref py py-func docutils literal"><span class="pre">context_diff()</span></code></a> です。</p>
<p>未知のエンコーディングまたは一貫性のないエンコーディングのデータ同士を比較できます。<em>n</em> 以外のすべての入力は、bytes オブジェクトである必要があります。<em>n</em> 以外のすべての入力を損失なく str に変換して、<code class="docutils literal"><span class="pre">dfunc(a,</span> <span class="pre">b,</span> <span class="pre">fromfile,</span> <span class="pre">tofile,</span> <span class="pre">fromfiledate,</span> <span class="pre">tofiledate,</span> <span class="pre">n,</span> <span class="pre">lineterm)</span></code> を呼び出すことにより動作します。<em>dfunc</em> の出力は、bytes 型に変換されます。これにより、受け取る差分形式の行のエンコーディングは、<em>a</em> と <em>b</em> の未知または一貫性のないエンコーディングと同一になります。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_LINE_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_LINE_JUNK</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_LINE_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる行のとき真を返します。行 <em>line</em> は空白、または  <code class="docutils literal"><span class="pre">'#'</span></code> ひとつのときに無視できます。それ以外のときには無視できません。古いバージョンでは <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>linejunk</em> にデフォルトで使用されました。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_CHARACTER_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_CHARACTER_JUNK</code><span class="sig-paren">(</span><em>ch</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_CHARACTER_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる文字のとき真を返します。文字 <em>ch</em> が空白、またはタブ文字のときには無視できます。それ以外の時には無視できません。 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>charjunk</em> としてデフォルトで使用されます。</p>
</dd></dl>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><a class="reference external" href="http://www.drdobbs.com/database/pattern-matching-the-gestalt-approach/184407970">Pattern Matching: The Gestalt Approach</a></dt>
<dd>John W. Ratcliff と D. E. Metzener による類似のアルゴリズムに関する議論。<a class="reference external" href="http://www.drdobbs.com/">Dr. Dobb’s Journal</a> 1988年7月号掲載。</dd>
</dl>
</div>
<div class="section" id="sequencematcher-objects">
<span id="sequence-matcher"></span><h2>6.3.1. SequenceMatcherオブジェクト<a class="headerlink" href="#sequencematcher-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスには、以下のようなコンストラクタがあります:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><span class="sig-paren">(</span><em>isjunk=None</em>, <em>a=''</em>, <em>b=''</em>, <em>autojunk=True</em><span class="sig-paren">)</span></dt>
<dd><p>オプションの引数 <em>isjunk</em> は、<code class="docutils literal"><span class="pre">None</span></code> (デフォルトの値です) にするか、単一の引数をとる関数でなければなりません。後者の場合、関数はシーケンスの要素を受け取り、要素が junk であり、無視すべきである場合に限り真を返すようにしなければなりません。<em>isjunk</em> に <code class="docutils literal"><span class="pre">None</span></code> を渡すと、<code class="docutils literal"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">0</span></code> を渡したのと同じになります; すなわち、いかなる要素も無視しなくなります。例えば以下のような引数を渡すと:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">" </span><span class="se">\t</span><span class="s2">"</span>
</pre></div>
</div>
<p>空白とタブ文字を無視して文字のシーケンスを比較します。</p>
<p>オプションの引数 <em>a</em> と <em>b</em> は、比較される文字列で、デフォルトでは空の文字列です。両方のシーケンスの要素は、ハッシュ化可能(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)である必要があります。</p>
<p>オプションの引数 <em>autojunk</em> は、自動 junk ヒューリスティックを無効にするために使えます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
<p>SequenceMatcher オブジェクトは3つのデータ属性を持っています: <em>bjunk</em> は、 <em>isjunk</em> が <code class="docutils literal"><span class="pre">True</span></code> であるような <em>b</em> の要素の集合です; <em>bpopular</em> は、 (無効でなければ) ヒューリスティックによって popular であると考えられる非ジャンク要素の集合です; <em>b2j</em> は、 <em>b</em> の残りの要素をそれらが生じる位置のリストに写像する dict です。この 3 つは <a class="reference internal" href="#difflib.SequenceMatcher.set_seqs" title="difflib.SequenceMatcher.set_seqs"><code class="xref py py-meth docutils literal"><span class="pre">set_seqs()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> で <em>b</em> がリセットされる場合は常にリセットされます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>bjunk</em> および <em>bpopular</em> 属性。</p>
</div>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは以下のメソッドを持ちます:</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seqs">
<code class="descname">set_seqs</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seqs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較される2つの文字列を設定します。</p>
</dd></dl>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは、2つ目のシーケンスについての詳細な情報を計算し、キャッシュします。 1つのシーケンスをいくつものシーケンスと比較する場合、まず <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> を使って文字列を設定しておき、別の文字列を1つずつ比較するために、繰り返し <a class="reference internal" href="#difflib.SequenceMatcher.set_seq1" title="difflib.SequenceMatcher.set_seq1"><code class="xref py py-meth docutils literal"><span class="pre">set_seq1()</span></code></a> を呼び出します。</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq1">
<code class="descname">set_seq1</code><span class="sig-paren">(</span><em>a</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq1" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う1つ目のシーケンスを設定します。比較される2つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq2">
<code class="descname">set_seq2</code><span class="sig-paren">(</span><em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq2" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う2つ目のシーケンスを設定します。比較される1つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.find_longest_match">
<code class="descname">find_longest_match</code><span class="sig-paren">(</span><em>alo</em>, <em>ahi</em>, <em>blo</em>, <em>bhi</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.find_longest_match" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">a[alo:ahi]</span></code> と <code class="docutils literal"><span class="pre">b[blo:bhi]</span></code> の中から、最長のマッチ列を探します。</p>
<p><em>isjunk</em> が省略されたか <code class="docutils literal"><span class="pre">None</span></code> の時、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> は <code class="docutils literal"><span class="pre">a[i:i+k]</span></code> が <code class="docutils literal"><span class="pre">b[j:j+k]</span></code> と等しいような <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">k)</span></code> を返します。その値は <code class="docutils literal"><span class="pre">alo</span> <span class="pre">&lt;=</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i+k</span> <span class="pre">&lt;=</span> <span class="pre">ahi</span></code> かつ <code class="docutils literal"><span class="pre">blo</span> <span class="pre">&lt;=</span> <span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j+k</span> <span class="pre">&lt;=</span> <span class="pre">bhi</span></code> となります。 <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">k')</span></code> でも、同じようになります。さらに <code class="docutils literal"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">k'</span></code>, <code class="docutils literal"><span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i'</span></code> が <code class="docutils literal"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">i'</span></code>, <code class="docutils literal"><span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j'</span></code> でも同様です。言い換えると、いくつものマッチ列すべてのうち、 <em>a</em> 内で最初に始まるものを返します。そしてその <em>a</em> 内で最初のマッチ列すべてのうち <em>b</em> 内で最初に始まるものを返します。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=0, b=4, size=5)</span>
</pre></div>
</div>
<p>引数 <em>isjunk</em> が与えられている場合、上記の通り、はじめに最長のマッチ列を判定します。ブロック内に junk 要素が見当たらないような追加条件の際はこれに該当しません。次にそのマッチ列を、その両側の junk 要素にマッチするよう、できる限り広げていきます。そのため結果となる列は、探している列のたまたま直前にあった同一の junk 以外の junk にはマッチしません。</p>
<p>以下は前と同じサンプルですが、空白を junk とみなしています。これは <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> が2つ目の列の末尾にある <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> にマッチしないようにしています。代わりに <code class="docutils literal"><span class="pre">'abcd'</span></code> にはマッチします。そして 2つ目の文字列中、一番左の <code class="docutils literal"><span class="pre">'abcd'</span></code> にマッチします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">==</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=1, b=0, size=4)</span>
</pre></div>
</div>
<p>どんな列にもマッチしない時は、<code class="docutils literal"><span class="pre">(alo,</span> <span class="pre">blo,</span> <span class="pre">0)</span></code> を返します。</p>
<p>このメソッドは <a class="reference internal" href="../glossary.html#term-named-tuple"><span class="xref std std-term">named tuple</span></a> <code class="docutils literal"><span class="pre">Match(a,</span> <span class="pre">b,</span> <span class="pre">size)</span></code> を返します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_matching_blocks">
<code class="descname">get_matching_blocks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_matching_blocks" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>マッチしたシーケンス中で個別にマッチしたシーケンスをあらわす、3つの値のリストを返します。それぞれの値は <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> という形式であらわされ、<code class="docutils literal"><span class="pre">a[i:i+n]</span> <span class="pre">==</span> <span class="pre">b[j:j+n]</span></code> という関係を意味します。3つの値は <em>i</em> と <em>j</em> の間で単調に増加します。</p>
<p>最後のタプルはダミーで、<code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> という値を持ちます。これは <code class="docutils literal"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">0</span></code> である唯一のタプルです。もし <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> と <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">n')</span></code> がリストで並んでいる3つ組で、2つ目が最後の3つ組でなければ、<code class="docutils literal"><span class="pre">i+n</span> <span class="pre">!=</span> <span class="pre">i'</span></code> または <code class="docutils literal"><span class="pre">j+n</span> <span class="pre">!=</span> <span class="pre">j'</span></code> です。言い換えると並んでいる3つ組は常に隣接していない同じブロックを表しています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abxcd"</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">()</span>
<span class="go">[Match(a=0, b=0, size=2), Match(a=3, b=2, size=2), Match(a=5, b=4, size=0)]</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_opcodes">
<code class="descname">get_opcodes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> を <em>b</em> にするための方法を記述する5つのタプルを返します。それぞれのタプルは <code class="docutils literal"><span class="pre">(tag,</span> <span class="pre">i1,</span> <span class="pre">i2,</span> <span class="pre">j1,</span> <span class="pre">j2)</span></code> という形式であらわされます。最初のタプルは <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">j1</span> <span class="pre">==</span> <span class="pre">0</span></code> であり、<em>i1</em> はその前にあるタプルの <em>i2</em> と同じ値です。同様に <em>j1</em> は前の <em>j2</em> と同じ値になります。</p>
<p><em>tag</em> の値は文字列であり、次のような意味です:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%"/>
<col width="75%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'replace'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は <code class="docutils literal"><span class="pre">b[j1:j2]</span></code> に置き換えられる。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'delete'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は削除される。この時、<code class="docutils literal"><span class="pre">j1</span> <span class="pre">==</span> <span class="pre">j2</span></code> である。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'insert'</span></code></td>
<td><code class="docutils literal"><span class="pre">b[j1:j2]</span></code> が <code class="docutils literal"><span class="pre">a[i1:i1]</span></code> に挿入される。この時 <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">i2</span></code> である。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'equal'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span> <span class="pre">==</span> <span class="pre">b[j1:j2]</span></code> (サブシーケンスは等しい).</td>
</tr>
</tbody>
</table>
<p>例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="s2">"qabxcd"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="s2">"abycdf"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{:7}</span><span class="s1">   a[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] --&gt; b[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] </span><span class="si">{!r:&gt;8}</span><span class="s1"> --&gt; </span><span class="si">{!r}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">]))</span>
<span class="go">delete    a[0:1] --&gt; b[0:0]      'q' --&gt; ''</span>
<span class="go">equal     a[1:3] --&gt; b[0:2]     'ab' --&gt; 'ab'</span>
<span class="go">replace   a[3:4] --&gt; b[2:3]      'x' --&gt; 'y'</span>
<span class="go">equal     a[4:6] --&gt; b[3:5]     'cd' --&gt; 'cd'</span>
<span class="go">insert    a[6:6] --&gt; b[5:6]       '' --&gt; 'f'</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_grouped_opcodes">
<code class="descname">get_grouped_opcodes</code><span class="sig-paren">(</span><em>n=3</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_grouped_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>最大 <em>n</em> 行までのコンテクストを含むグループを生成するような、ジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)を返します。</p>
<p>このメソッドは、 <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> で返されるグループの中から、似たような差異のかたまりに分け、間に挟まっている変更の無い部分を省きます。</p>
<p>グループは <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> と同じ書式で返されます。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.ratio">
<code class="descname">ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>[0, 1] の範囲の浮動小数点数で、シーケンスの類似度を測る値を返します。</p>
<p>T が2つのシーケンスの要素数の総計だと仮定し、M をマッチした数とすると、この値は 2.0*M / T であらわされます。もしシーケンスがまったく同じ場合、値は <code class="docutils literal"><span class="pre">1.0</span></code> となり、まったく異なる場合には <code class="docutils literal"><span class="pre">0.0</span></code> となります。</p>
<p>このメソッドは <a class="reference internal" href="#difflib.SequenceMatcher.get_matching_blocks" title="difflib.SequenceMatcher.get_matching_blocks"><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> がまだ呼び出されていない場合には非常にコストが高いです。この場合、上限を素早く計算するために、 <a class="reference internal" href="#difflib.SequenceMatcher.quick_ratio" title="difflib.SequenceMatcher.quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code></a> もしくは <a class="reference internal" href="#difflib.SequenceMatcher.real_quick_ratio" title="difflib.SequenceMatcher.real_quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code></a> を最初に試してみる方がいいかもしれません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.quick_ratio">
<code class="descname">quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、より高速に計算します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.real_quick_ratio">
<code class="descname">real_quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.real_quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、非常に高速に計算します。</p>
</dd></dl>
</dd></dl>
<p>この文字列全体のマッチ率を返す3つのメソッドは、精度の異なる近似値を返します。 <code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code> と <code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code> は、常に <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> 以上の値を返します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">,</span> <span class="s2">"bcde"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">quick_ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">real_quick_ratio</span><span class="p">()</span>
<span class="go">1.0</span>
</pre></div>
</div>
</div>
<div class="section" id="sequencematcher-examples">
<span id="id1"></span><h2>6.3.2. SequenceMatcher の例<a class="headerlink" href="#sequencematcher-examples" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は2つの文字列を比較します。空白を "junk" とします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">" "</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private Thread currentThread;"</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private volatile Thread currentThread;"</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> は、[0, 1] の範囲の値を返し、シーケンスの類似度を測ります。経験によると、 <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> の値が0.6を超えると、シーケンスがよく似ていることを示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="go">0.866</span>
</pre></div>
</div>
<p>シーケンスのどこがマッチしているかにだけ興味のある時には <code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が手軽でしょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"a[</span><span class="si">%d</span><span class="s2">] and b[</span><span class="si">%d</span><span class="s2">] match for </span><span class="si">%d</span><span class="s2"> elements"</span> <span class="o">%</span> <span class="n">block</span><span class="p">)</span>
<span class="go">a[0] and b[0] match for 8 elements</span>
<span class="go">a[8] and b[17] match for 21 elements</span>
<span class="go">a[29] and b[38] match for 0 elements</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が返す最後のタプルが常にダミーであることに注目してください。このダミーは <code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> であり、これはタプルの最後の要素（マッチする要素の数）が <code class="docutils literal"><span class="pre">0</span></code> となる唯一のケースです。</p>
<p>はじめのシーケンスがどのようにして2番目のものになるのかを知るには、 <code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code> を使います:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%6s</span><span class="s2"> a[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">] b[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">]"</span> <span class="o">%</span> <span class="n">opcode</span><span class="p">)</span>
<span class="go"> equal a[0:8] b[0:8]</span>
<span class="go">insert a[8:8] b[8:17]</span>
<span class="go"> equal a[8:29] b[17:38]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<ul class="last simple">
<li><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> を使った、シンプルで使えるコードを知るには、このモジュールの関数 <a class="reference internal" href="#difflib.get_close_matches" title="difflib.get_close_matches"><code class="xref py py-func docutils literal"><span class="pre">get_close_matches()</span></code></a> を参照してください。</li>
<li><a class="reference external" href="https://code.activestate.com/recipes/576729/">Simple version control recipe</a> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> で作った小規模アプリケーション。</li>
</ul>
</div>
</div>
<div class="section" id="differ-objects">
<span id="id2"></span><h2>6.3.3. Differ オブジェクト<a class="headerlink" href="#differ-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトによって生成された差分が <strong>最小</strong> であるなどとは言いません。むしろ、最小の差分はしばしば直観に反しています。その理由は、どこでもできるとなれば一致を見いだしてしまうからで、ときには思いがけなく100ページも離れたマッチになってしまうのです。一致点を互いに隣接したマッチに制限することで、場合によって長めの差分を出力するというコストを掛けることにはなっても、ある種の局所性を保つことができるのです。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> は、以下のようなコンストラクタを持ちます:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><span class="sig-paren">(</span><em>linejunk=None</em>, <em>charjunk=None</em><span class="sig-paren">)</span></dt>
<dd><p>オプションのキーワードパラメータ <em>linejunk</em> と <em>charjunk</em> は、フィルタ関数を渡します (使わないときは <code class="docutils literal"><span class="pre">None</span></code>):</p>
<p><em>linejunk</em>: ひとつの文字列引数を受け取る関数です。文字列が junk のときに真を返します。デフォルトでは、<code class="docutils literal"><span class="pre">None</span></code> であり、どんな行であっても junk とは見なされません。</p>
<p><em>charjunk</em>: この関数は文字(長さ1の文字列)を引数として受け取り、文字が junk であるときに真を返します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> であり、どんな文字も junk とは見なされません。</p>
<p>これらの junk フィルター関数により、差分を発見するマッチングが高速化し、差分の行や文字が無視されることがなくなります。説明については、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> メソッドの <em>isjunk</em> 引数の説明をご覧ください。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトは、以下の1つのメソッドを通して利用されます。（差分を生成します）:</p>
<dl class="method">
<dt id="difflib.Differ.compare">
<code class="descname">compare</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.Differ.compare" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>文字列からなる2つのシーケンスを比較し、差分（を表す文字列からなるシーケンス）を生成します。</p>
<p>各シーケンスの要素は、改行で終わる独立した単一行からなる文字列でなければなりません。そのようなシーケンスは、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code></a> メソッドによって得ることができます。（得られる）差分は改行文字で終了する文字列のシーケンスとして得られ、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-meth docutils literal"><span class="pre">writelines()</span></code></a> メソッドによって出力できる形になっています。</p>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="differ-example">
<span id="differ-examples"></span><h2>6.3.4. Differ の例<a class="headerlink" href="#differ-example" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下の例は2つのテキストを比較しています。最初に、テキストを行毎に改行で終わる文字列のシーケンスにセットアップします (そのようなシーケンスは、ファイル風オブジェクトの <code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code> メソッドからも得ることができます):</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  2. Explicit is better than implicit.</span>
<span class="gp">... </span><span class="s1">  3. Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complex is better than complicated.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">'\n'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text2</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  3.   Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complicated is better than complex.</span>
<span class="gp">... </span><span class="s1">  5. Flat is better than nested.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>次に Differ オブジェクトをインスタンス化します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Differ</span><span class="p">()</span>
</pre></div>
</div>
<p>注意:  <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトをインスタンス化するとき、行 junk と文字 junk をフィルタリングする関数を渡すことができます。詳細は <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-meth docutils literal"><span class="pre">Differ()</span></code></a> コンストラクタを参照してください。</p>
<p>最後に、2つを比較します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">result</span></code> は文字列のリストなので、pretty-printしてみましょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">['    1. Beautiful is better than ugly.\n',</span>
<span class="go"> '-   2. Explicit is better than implicit.\n',</span>
<span class="go"> '-   3. Simple is better than complex.\n',</span>
<span class="go"> '+   3.   Simple is better than complex.\n',</span>
<span class="go"> '?     ++\n',</span>
<span class="go"> '-   4. Complex is better than complicated.\n',</span>
<span class="go"> '?            ^                     ---- ^\n',</span>
<span class="go"> '+   4. Complicated is better than complex.\n',</span>
<span class="go"> '?           ++++ ^                      ^\n',</span>
<span class="go"> '+   5. Flat is better than nested.\n']</span>
</pre></div>
</div>
<p>これは、複数行の文字列として、次のように出力されます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">    1. Beautiful is better than ugly.</span>
<span class="go">-   2. Explicit is better than implicit.</span>
<span class="go">-   3. Simple is better than complex.</span>
<span class="go">+   3.   Simple is better than complex.</span>
<span class="go">?     ++</span>
<span class="go">-   4. Complex is better than complicated.</span>
<span class="go">?            ^                     ---- ^</span>
<span class="go">+   4. Complicated is better than complex.</span>
<span class="go">?           ++++ ^                      ^</span>
<span class="go">+   5. Flat is better than nested.</span>
</pre></div>
</div>
</div>
<div class="section" id="a-command-line-interface-to-difflib">
<span id="difflib-interface"></span><h2>6.3.5. difflib のコマンドラインインタフェース<a class="headerlink" href="#a-command-line-interface-to-difflib" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は、 difflib を使って <code class="docutils literal"><span class="pre">diff</span></code> に似たユーティリティーを作成する方法を示します。これは、 Python のソース配布物にも、 <code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> として含まれています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">""" Command line interface to difflib.py providing diffs in four formats:</span>

<span class="sd">* ndiff:    lists every line and highlights interline changes.</span>
<span class="sd">* context:  highlights clusters of changes in a before/after format.</span>
<span class="sd">* unified:  highlights clusters of changes in an inline format.</span>
<span class="sd">* html:     generates side by side comparison with change highlights.</span>

<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">difflib</span><span class="o">,</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="k">def</span> <span class="nf">file_mtime</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span>
                               <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a context format diff (default)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-u'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a unified format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-m'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce HTML side by side diff '</span>
                             <span class="s1">'(can use -c and -l in conjunction)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-n'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a ndiff format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-l'</span><span class="p">,</span> <span class="s1">'--lines'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Set number of context lines (default 3)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'fromfile'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'tofile'</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">lines</span>
    <span class="n">fromfile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">fromfile</span>
    <span class="n">tofile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">tofile</span>

    <span class="n">fromdate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span>
    <span class="n">todate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">fromlines</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
        <span class="n">tolines</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">u</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">m</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">HtmlDiff</span><span class="p">()</span><span class="o">.</span><span class="n">make_file</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span><span class="n">tolines</span><span class="p">,</span><span class="n">fromfile</span><span class="p">,</span><span class="n">tofile</span><span class="p">,</span><span class="n">context</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">numlines</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">context_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div aria-label="main navigation" class="sphinxsidebar" role="navigation">
<div class="sphinxsidebarwrapper">
<h3><a href="../contents.html">目次</a></h3>
<ul>
<li><a class="reference internal" href="#">6.3. <code class="docutils literal"><span class="pre">difflib</span></code>  差分の計算を助ける</a><ul>
<li><a class="reference internal" href="#sequencematcher-objects">6.3.1. SequenceMatcherオブジェクト</a></li>
<li><a class="reference internal" href="#sequencematcher-examples">6.3.2. SequenceMatcher の例</a></li>
<li><a class="reference internal" href="#differ-objects">6.3.3. Differ オブジェクト</a></li>
<li><a class="reference internal" href="#differ-example">6.3.4. Differ の例</a></li>
<li><a class="reference internal" href="#a-command-line-interface-to-difflib">6.3.5. difflib のコマンドラインインタフェース</a></li>
</ul>
</li>
</ul>
<h4>前のトピックへ</h4>
<p class="topless"><a href="re.html" title="前の章へ">6.2. <code class="docutils literal"><span class="pre">re</span></code>  正規表現操作</a></p>
<h4>次のトピックへ</h4>
<p class="topless"><a href="textwrap.html" title="次の章へ">6.4. <code class="docutils literal"><span class="pre">textwrap</span></code>  テキストの折り返しと詰め込み</a></p>
<div aria-label="source link" role="note">
<h3>このページ</h3>
<ul class="this-page-menu">
<li><a href="../bugs.html">バグ報告</a></li>
<li>
<a href="https://github.com/python/cpython/blob/3.6/Doc/library/difflib.rst" rel="nofollow">ソースの表示
        </a>
</li>
</ul>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="footer">
     <a href="../copyright.html">Copyright</a> 2001-2018, Python Software Foundation.
    <br/>
    Python Software Foundation は非営利団体です。
    <a href="https://www.python.org/psf/donations/">寄付</a>
<br/>
    最終更新日時: 7月 29, 2018
    <a href="../bugs.html">バグを見つけたら</a>?
    <br/>
    このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.5 を使って作成されました。
    </div>
</body>
</head></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="ja" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>6.3. difflib  差分の計算を助ける  Python 3.6.5 ドキュメント</title>
<link href="../_static/pydoctheme.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
<script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/underscore.js" type="text/javascript"></script>
<script src="../_static/doctools.js" type="text/javascript"></script>
<script src="../_static/translations.js" type="text/javascript"></script>
<script src="../_static/sidebar.js" type="text/javascript"></script>
<link href="../_static/opensearch.xml" rel="search" title="Python 3.6.5 ドキュメント 内を検索" type="application/opensearchdescription+xml"/>
<link href="../about.html" rel="author" title="このドキュメントについて"/>
<link href="../genindex.html" rel="index" title="索引"/>
<link href="../search.html" rel="search" title="検索"/>
<link href="../copyright.html" rel="copyright" title="Copyright"/>
<link href="textwrap.html" rel="next" title="6.4. textwrap  テキストの折り返しと詰め込み"/>
<link href="re.html" rel="prev" title="6.2. re  正規表現操作"/>
<link href="../_static/py.png" rel="shortcut icon" type="image/png"/>
<link href="https://docs.python.jp/3/library/difflib.html" rel="canonical"/><script type="text/javascript">
    $(document).ready(function() {
      var base = 'https://docs.python.org/3.6/library/difflib.html';
      $('a.headerlink').each(function() {
        var html = '<a href="' + base + $(this).attr('href') +
                   '" title="原文へのリンク"><small>(原文)</small></a>';
        $(this).after(html);
      })
    });
    </script>
<script src="../_static/copybutton.js" type="text/javascript"></script>
<script src="../_static/version_switch.js" type="text/javascript"></script>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-34175846-1', 'python.jp');
        ga('send', 'pageview');

      </script>
<body>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a accesskey="I" href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a accesskey="N" href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a accesskey="P" href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a accesskey="U" href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body" role="main">
<div class="section" id="module-difflib">
<span id="difflib-helpers-for-computing-deltas"></span><h1>6.3. <a class="reference internal" href="#module-difflib" title="difflib: Helpers for computing differences between objects."><code class="xref py py-mod docutils literal"><span class="pre">difflib</span></code></a>  差分の計算を助ける<a class="headerlink" href="#module-difflib" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><strong>ソースコード:</strong> <a class="reference external" href="https://github.com/python/cpython/tree/3.6/Lib/difflib.py">Lib/difflib.py</a></p>
<hr class="docutils"/>
<p>このモジュールは、シーケンスを比較するためのクラスや関数を提供しています。例えば、ファイルの差分を計算して、それを HTML や context diff, unified diff などいろいろなフォーマットで出力するために、このモジュールを利用することができます。ディレクトリやファイル群を比較するためには、 <a class="reference internal" href="filecmp.html#module-filecmp" title="filecmp: Compare files efficiently."><code class="xref py py-mod docutils literal"><span class="pre">filecmp</span></code></a> モジュールも参照してください。</p>
<dl class="class">
<dt id="difflib.SequenceMatcher">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><a class="headerlink" href="#difflib.SequenceMatcher" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>柔軟性のあるクラスで、二つのシーケンスの要素がハッシュ化できる(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)型であれば、どの型の要素を含むシーケンスも比較可能です。基本的なアルゴリズムは、1980年代の後半に発表された Ratcliff と Obershelp による"ゲシュタルトパターンマッチング"と大げさに名づけられたアルゴリズム以前から知られている、やや凝ったアルゴリズムです。その考え方は、"junk" 要素を含まない最も長い互いに隣接したマッチ列を探すことです。ここで、  "junk" 要素とは、空行や空白などの、意味を持たない要素のことです。 (junk を処理するのは、Ratcliff と Obershelp のアルゴリズムに追加された拡張です。)この考え方は、マッチ列の左右に隣接するシーケンスの断片に対して再帰的にあてはめられます。この方法では編集を最小にするシーケンスは生まれませんが、人間の目からみて「正しい感じ」にマッチする傾向があります。</p>
<p><strong>実行時間:</strong> 基本的な Ratcliff-Obershelp アルゴリズムは、最悪の場合3乗、期待値で2乗となります。 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトでは、最悪のケースで2乗、期待値は比較されるシーケンス中に共通に現れる要素数に非常にややこしく依存しています。最良の場合は線形時間になります。</p>
<p><strong>自動 junk ヒューリスティック:</strong> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> は、シーケンスの特定の要素を自動的に junk として扱うヒューリスティックをサポートしています。このヒューリスティックは、各個要素がシーケンス内に何回現れるかを数えます。ある要素の重複数が (最初のものは除いて) 合計でシーケンスの 1% 以上になり、そのシーケンスが 200 要素以上なら、その要素は "popular" であるものとしてマークされ、シーケンスのマッチングの目的からは junk として扱われます。このヒューリスティックは、 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> の作成時に <code class="docutils literal"><span class="pre">autojunk</span></code> パラメタを <code class="docutils literal"><span class="pre">False</span></code> に設定することで無効化できます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
</dd></dl>
<dl class="class">
<dt id="difflib.Differ">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><a class="headerlink" href="#difflib.Differ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>テキスト行からなるシーケンスを比較するクラスです。人が読むことのできる差分を作成します。 Differ クラスは <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスを利用して、行からなるシーケンスを比較したり、(ほぼ)同一の行内の文字を比較したりします。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> クラスによる差分の各行は、2文字のコードで始まります:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%"/>
<col width="81%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">コード</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'-</span> <span class="pre">'</span></code></td>
<td>行はシーケンス1にのみ存在する</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'+</span> <span class="pre">'</span></code></td>
<td>行はシーケンス2にのみ存在する</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'</span> <span class="pre">'</span></code></td>
<td>行は両方のシーケンスで同一</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'?</span> <span class="pre">'</span></code></td>
<td>行は入力シーケンスのどちらにも存在しない</td>
</tr>
</tbody>
</table>
<p>'<code class="docutils literal"><span class="pre">?</span></code>' で始まる行は、行内のどこに差異が存在するかに注意を向けようとします。その行は、入力されたシーケンスのどちらにも存在しません。シーケンスがタブ文字を含むとき、これらの行は判別しづらいものになることがあります。</p>
</dd></dl>
<dl class="class">
<dt id="difflib.HtmlDiff">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">HtmlDiff</code><a class="headerlink" href="#difflib.HtmlDiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このクラスは、二つのテキストを左右に並べて比較表示し、行間あるいは行内の変更点を強調表示するような HTML テーブル (またはテーブルの入った完全な HTML ファイル) を生成するために使います。テーブルは完全差分モード、コンテキスト差分モードのいずれでも生成できます。</p>
<p>このクラスのコンストラクタは以下のようになっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>tabsize=8</em>, <em>wrapcolumn=None</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.__init__" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> のインスタンスを初期化します。</p>
<p><em>tabsize</em> はオプションのキーワード引数で、タブストップ幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">8</span></code> です。</p>
<p><em>wrapcolumn</em> はオプションのキーワード引数で、テキストを折り返すカラム幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> で折り返しを行いません。</p>
<p><em>linejunk</em> および <em>charjunk</em> はオプションのキーワード引数で、 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a>  (<a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> はこの関数を使って左右のテキストの差分を HTML で生成します) に渡されます。それぞれの引数のデフォルト値および説明は <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> のドキュメントを参照してください。</p>
</dd></dl>
<p>以下のメソッドが public になっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.make_file">
<code class="descname">make_file</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em>, <em>*</em>, <em>charset='utf-8'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_file" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った表を持つ完全な HTML ファイルを文字列で返します。</p>
<p><em>fromdesc</em> および <em>todesc</em> はオプションのキーワード引数で、差分表示テーブルにおけるそれぞれ差分元、差分先ファイルのカラムのヘッダになる文字列を指定します (いずれもデフォルト値は空文字列です)。</p>
<p><em>context</em> および <em>numlines</em> はともにオプションのキーワード引数です。<em>context</em> を <code class="docutils literal"><span class="pre">True</span></code> にするとコンテキスト差分を表示し、デフォルトの <code class="docutils literal"><span class="pre">False</span></code> にすると完全なファイル差分を表示します。<em>numlines</em> のデフォルト値は <code class="docutils literal"><span class="pre">5</span></code> で、<em>context</em> が <code class="docutils literal"><span class="pre">True</span></code> の場合、<em>numlines</em> は強調部分の前後にあるコンテキスト行の数を制御します。<em>context</em> が <code class="docutils literal"><span class="pre">False</span></code> の場合、<em>numlines</em> は "next" と書かれたハイパーリンクをたどった時に到達する場所が次の変更部分より何行前にあるかを制御します (値をゼロにした場合、"next" ハイパーリンクを辿ると変更部分の強調表示がブラウザの最上部に表示されるようになります)。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.5 で変更: </span><em>charset</em> キーワード専用引数が追加されました。HTML 文書のデフォルトの文字集合が <code class="docutils literal"><span class="pre">'ISO-8859-1'</span></code> から <code class="docutils literal"><span class="pre">'utf-8'</span></code> に変更されました。</p>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.HtmlDiff.make_table">
<code class="descname">make_table</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った完全な HTML テーブルを文字列で返します。</p>
<p>このメソッドの引数は、 <a class="reference internal" href="#difflib.HtmlDiff.make_file" title="difflib.HtmlDiff.make_file"><code class="xref py py-meth docutils literal"><span class="pre">make_file()</span></code></a> メソッドの引数と同じです。</p>
</dd></dl>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> はこのクラスへのコマンドラインフロントエンドで、使い方を学ぶ上で格好の例題が入っています。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.context_diff">
<code class="descclassname">difflib.</code><code class="descname">context_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.context_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 context diff のフォーマット(以下「コンテクスト形式」)で返します。</p>
<p>コンテクスト形式は、変更があった行に前後数行を加えてある、コンパクトな表現方法です。変更箇所は、変更前/変更後に分けて表します。コンテクスト (変更箇所前後の行) の行数は <em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">***</span></code> や <code class="docutils literal"><span class="pre">---</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">context_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">*** before.py</span>
<span class="go">--- after.py</span>
<span class="go">***************</span>
<span class="go">*** 1,4 ****</span>
<span class="go">! bacon</span>
<span class="go">! eggs</span>
<span class="go">! ham</span>
<span class="go">  guido</span>
<span class="go">--- 1,4 ----</span>
<span class="go">! python</span>
<span class="go">! eggy</span>
<span class="go">! hamster</span>
<span class="go">  guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.get_close_matches">
<code class="descclassname">difflib.</code><code class="descname">get_close_matches</code><span class="sig-paren">(</span><em>word</em>, <em>possibilities</em>, <em>n=3</em>, <em>cutoff=0.6</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.get_close_matches" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>「十分」なマッチの上位のリストを返します。<em>word</em> はマッチさせたいシーケンス (大概は文字列) です。<em>possibilities</em> は <em>word</em> にマッチさせるシーケンスのリスト (大概は文字列のリスト) です。</p>
<p>オプションの引数 <em>n</em> (デフォルトでは <code class="docutils literal"><span class="pre">3</span></code>)はメソッドの返すマッチの最大数です。<em>n</em> は <code class="docutils literal"><span class="pre">0</span></code> より大きくなければなりません。</p>
<p>オプションの引数 <em>cutoff</em> (デフォルトでは <code class="docutils literal"><span class="pre">0.6</span></code>)は、区間 [0, 1] に入る小数の値です。<em>word</em> との一致率がそれ未満の <em>possibilities</em> の要素は無視されます。</p>
<p><em>possibilities</em> の要素でマッチした上位(多くても <em>n</em> 個)は、類似度のスコアに応じて(一番似たものを先頭に)ソートされたリストとして返されます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'appel'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ape'</span><span class="p">,</span> <span class="s1">'apple'</span><span class="p">,</span> <span class="s1">'peach'</span><span class="p">,</span> <span class="s1">'puppy'</span><span class="p">])</span>
<span class="go">['apple', 'ape']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">keyword</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'wheel'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['while']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'pineapple'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'accept'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['except']</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.ndiff">
<code class="descclassname">difflib.</code><code class="descname">ndiff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.ndiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> のスタイルで返します。</p>
<p>オプションのキーワード引数 <em>linejunk</em> と <em>charjunk</em> には、フィルタ関数 (または <code class="docutils literal"><span class="pre">None</span></code>) を渡します。</p>
<p><em>linejunk</em>: 文字列型の引数 1 つを受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは <code class="docutils literal"><span class="pre">None</span></code> です。モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_LINE_JUNK" title="difflib.IS_LINE_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_LINE_JUNK()</span></code></a> は、高々 1 つのシャープ記号(<code class="docutils literal"><span class="pre">'#'</span></code>)を除いて可視の文字を含まない行をフィルタリングするものです。しかし、下層にある <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスが、どの行が雑音となるほど頻繁に登場するかを動的に分析します。このクラスによる分析は、この関数を使用するよりも通常うまく動作します。</p>
<p><em>charjunk</em>: 文字 (長さ1の文字列) を受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは、モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_CHARACTER_JUNK" title="difflib.IS_CHARACTER_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_CHARACTER_JUNK()</span></code></a> であり、これは空白文字類 (空白またはタブ、改行文字をこれに含めてはいけません) をフィルタして排除します。</p>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/ndiff.py</span></code> は、この関数のコマンドラインのフロントエンド（インターフェイス）です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">diff</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">- one</span>
<span class="go">?  ^</span>
<span class="go">+ ore</span>
<span class="go">?  ^</span>
<span class="go">- two</span>
<span class="go">- three</span>
<span class="go">?  -</span>
<span class="go">+ tree</span>
<span class="go">+ emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.restore">
<code class="descclassname">difflib.</code><code class="descname">restore</code><span class="sig-paren">(</span><em>sequence</em>, <em>which</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.restore" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>差分を生成した元の二つのシーケンスのうち一つを返します。</p>
<p><a class="reference internal" href="#difflib.Differ.compare" title="difflib.Differ.compare"><code class="xref py py-meth docutils literal"><span class="pre">Differ.compare()</span></code></a> または <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> によって生成された <em>sequence</em> を与えられると、行頭のプレフィクスを取りのぞいてファイル 1 または 2 (引数 <em>which</em> で指定される) に由来する行を復元します。</p>
<p>例:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="c1"># materialize the generated delta into a list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">one</span>
<span class="go">two</span>
<span class="go">three</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">ore</span>
<span class="go">tree</span>
<span class="go">emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.unified_diff">
<code class="descclassname">difflib.</code><code class="descname">unified_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.unified_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 unified diff フォーマット(以下「ユニファイド形式」)で返します。</p>
<p>ユニファイド形式は変更があった行にコンテキストとなる前後数行を加えた、コンパクトな表現方法です。変更箇所は (変更前/変更後を分離したブロックではなく) インラインスタイルで表されます。コンテクストの行数は、<em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">---</span></code>, <code class="docutils literal"><span class="pre">+++</span></code>, <code class="docutils literal"><span class="pre">@@</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">--- before.py</span>
<span class="go">+++ after.py</span>
<span class="go">@@ -1,4 +1,4 @@</span>
<span class="go">-bacon</span>
<span class="go">-eggs</span>
<span class="go">-ham</span>
<span class="go">+python</span>
<span class="go">+eggy</span>
<span class="go">+hamster</span>
<span class="go"> guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.diff_bytes">
<code class="descclassname">difflib.</code><code class="descname">diff_bytes</code><span class="sig-paren">(</span><em>dfunc</em>, <em>a</em>, <em>b</em>, <em>fromfile=b''</em>, <em>tofile=b''</em>, <em>fromfiledate=b''</em>, <em>tofiledate=b''</em>, <em>n=3</em>, <em>lineterm=b'\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.diff_bytes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>dfunc</em> を使用して <em>a</em> と <em>b</em> (bytes オブジェクトのリスト) を比較して、差分形式の行 (これも bytes オブジェクトです) を*dfunc* の戻り値の形式で返します。<em>dfunc</em> は、呼び出し可能である必要があります。一般に、これは <a class="reference internal" href="#difflib.unified_diff" title="difflib.unified_diff"><code class="xref py py-func docutils literal"><span class="pre">unified_diff()</span></code></a> または <a class="reference internal" href="#difflib.context_diff" title="difflib.context_diff"><code class="xref py py-func docutils literal"><span class="pre">context_diff()</span></code></a> です。</p>
<p>未知のエンコーディングまたは一貫性のないエンコーディングのデータ同士を比較できます。<em>n</em> 以外のすべての入力は、bytes オブジェクトである必要があります。<em>n</em> 以外のすべての入力を損失なく str に変換して、<code class="docutils literal"><span class="pre">dfunc(a,</span> <span class="pre">b,</span> <span class="pre">fromfile,</span> <span class="pre">tofile,</span> <span class="pre">fromfiledate,</span> <span class="pre">tofiledate,</span> <span class="pre">n,</span> <span class="pre">lineterm)</span></code> を呼び出すことにより動作します。<em>dfunc</em> の出力は、bytes 型に変換されます。これにより、受け取る差分形式の行のエンコーディングは、<em>a</em> と <em>b</em> の未知または一貫性のないエンコーディングと同一になります。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_LINE_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_LINE_JUNK</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_LINE_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる行のとき真を返します。行 <em>line</em> は空白、または  <code class="docutils literal"><span class="pre">'#'</span></code> ひとつのときに無視できます。それ以外のときには無視できません。古いバージョンでは <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>linejunk</em> にデフォルトで使用されました。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_CHARACTER_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_CHARACTER_JUNK</code><span class="sig-paren">(</span><em>ch</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_CHARACTER_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる文字のとき真を返します。文字 <em>ch</em> が空白、またはタブ文字のときには無視できます。それ以外の時には無視できません。 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>charjunk</em> としてデフォルトで使用されます。</p>
</dd></dl>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><a class="reference external" href="http://www.drdobbs.com/database/pattern-matching-the-gestalt-approach/184407970">Pattern Matching: The Gestalt Approach</a></dt>
<dd>John W. Ratcliff と D. E. Metzener による類似のアルゴリズムに関する議論。<a class="reference external" href="http://www.drdobbs.com/">Dr. Dobb’s Journal</a> 1988年7月号掲載。</dd>
</dl>
</div>
<div class="section" id="sequencematcher-objects">
<span id="sequence-matcher"></span><h2>6.3.1. SequenceMatcherオブジェクト<a class="headerlink" href="#sequencematcher-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスには、以下のようなコンストラクタがあります:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><span class="sig-paren">(</span><em>isjunk=None</em>, <em>a=''</em>, <em>b=''</em>, <em>autojunk=True</em><span class="sig-paren">)</span></dt>
<dd><p>オプションの引数 <em>isjunk</em> は、<code class="docutils literal"><span class="pre">None</span></code> (デフォルトの値です) にするか、単一の引数をとる関数でなければなりません。後者の場合、関数はシーケンスの要素を受け取り、要素が junk であり、無視すべきである場合に限り真を返すようにしなければなりません。<em>isjunk</em> に <code class="docutils literal"><span class="pre">None</span></code> を渡すと、<code class="docutils literal"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">0</span></code> を渡したのと同じになります; すなわち、いかなる要素も無視しなくなります。例えば以下のような引数を渡すと:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">" </span><span class="se">\t</span><span class="s2">"</span>
</pre></div>
</div>
<p>空白とタブ文字を無視して文字のシーケンスを比較します。</p>
<p>オプションの引数 <em>a</em> と <em>b</em> は、比較される文字列で、デフォルトでは空の文字列です。両方のシーケンスの要素は、ハッシュ化可能(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)である必要があります。</p>
<p>オプションの引数 <em>autojunk</em> は、自動 junk ヒューリスティックを無効にするために使えます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
<p>SequenceMatcher オブジェクトは3つのデータ属性を持っています: <em>bjunk</em> は、 <em>isjunk</em> が <code class="docutils literal"><span class="pre">True</span></code> であるような <em>b</em> の要素の集合です; <em>bpopular</em> は、 (無効でなければ) ヒューリスティックによって popular であると考えられる非ジャンク要素の集合です; <em>b2j</em> は、 <em>b</em> の残りの要素をそれらが生じる位置のリストに写像する dict です。この 3 つは <a class="reference internal" href="#difflib.SequenceMatcher.set_seqs" title="difflib.SequenceMatcher.set_seqs"><code class="xref py py-meth docutils literal"><span class="pre">set_seqs()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> で <em>b</em> がリセットされる場合は常にリセットされます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>bjunk</em> および <em>bpopular</em> 属性。</p>
</div>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは以下のメソッドを持ちます:</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seqs">
<code class="descname">set_seqs</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seqs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較される2つの文字列を設定します。</p>
</dd></dl>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは、2つ目のシーケンスについての詳細な情報を計算し、キャッシュします。 1つのシーケンスをいくつものシーケンスと比較する場合、まず <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> を使って文字列を設定しておき、別の文字列を1つずつ比較するために、繰り返し <a class="reference internal" href="#difflib.SequenceMatcher.set_seq1" title="difflib.SequenceMatcher.set_seq1"><code class="xref py py-meth docutils literal"><span class="pre">set_seq1()</span></code></a> を呼び出します。</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq1">
<code class="descname">set_seq1</code><span class="sig-paren">(</span><em>a</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq1" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う1つ目のシーケンスを設定します。比較される2つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq2">
<code class="descname">set_seq2</code><span class="sig-paren">(</span><em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq2" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う2つ目のシーケンスを設定します。比較される1つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.find_longest_match">
<code class="descname">find_longest_match</code><span class="sig-paren">(</span><em>alo</em>, <em>ahi</em>, <em>blo</em>, <em>bhi</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.find_longest_match" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">a[alo:ahi]</span></code> と <code class="docutils literal"><span class="pre">b[blo:bhi]</span></code> の中から、最長のマッチ列を探します。</p>
<p><em>isjunk</em> が省略されたか <code class="docutils literal"><span class="pre">None</span></code> の時、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> は <code class="docutils literal"><span class="pre">a[i:i+k]</span></code> が <code class="docutils literal"><span class="pre">b[j:j+k]</span></code> と等しいような <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">k)</span></code> を返します。その値は <code class="docutils literal"><span class="pre">alo</span> <span class="pre">&lt;=</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i+k</span> <span class="pre">&lt;=</span> <span class="pre">ahi</span></code> かつ <code class="docutils literal"><span class="pre">blo</span> <span class="pre">&lt;=</span> <span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j+k</span> <span class="pre">&lt;=</span> <span class="pre">bhi</span></code> となります。 <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">k')</span></code> でも、同じようになります。さらに <code class="docutils literal"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">k'</span></code>, <code class="docutils literal"><span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i'</span></code> が <code class="docutils literal"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">i'</span></code>, <code class="docutils literal"><span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j'</span></code> でも同様です。言い換えると、いくつものマッチ列すべてのうち、 <em>a</em> 内で最初に始まるものを返します。そしてその <em>a</em> 内で最初のマッチ列すべてのうち <em>b</em> 内で最初に始まるものを返します。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=0, b=4, size=5)</span>
</pre></div>
</div>
<p>引数 <em>isjunk</em> が与えられている場合、上記の通り、はじめに最長のマッチ列を判定します。ブロック内に junk 要素が見当たらないような追加条件の際はこれに該当しません。次にそのマッチ列を、その両側の junk 要素にマッチするよう、できる限り広げていきます。そのため結果となる列は、探している列のたまたま直前にあった同一の junk 以外の junk にはマッチしません。</p>
<p>以下は前と同じサンプルですが、空白を junk とみなしています。これは <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> が2つ目の列の末尾にある <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> にマッチしないようにしています。代わりに <code class="docutils literal"><span class="pre">'abcd'</span></code> にはマッチします。そして 2つ目の文字列中、一番左の <code class="docutils literal"><span class="pre">'abcd'</span></code> にマッチします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">==</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=1, b=0, size=4)</span>
</pre></div>
</div>
<p>どんな列にもマッチしない時は、<code class="docutils literal"><span class="pre">(alo,</span> <span class="pre">blo,</span> <span class="pre">0)</span></code> を返します。</p>
<p>このメソッドは <a class="reference internal" href="../glossary.html#term-named-tuple"><span class="xref std std-term">named tuple</span></a> <code class="docutils literal"><span class="pre">Match(a,</span> <span class="pre">b,</span> <span class="pre">size)</span></code> を返します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_matching_blocks">
<code class="descname">get_matching_blocks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_matching_blocks" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>マッチしたシーケンス中で個別にマッチしたシーケンスをあらわす、3つの値のリストを返します。それぞれの値は <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> という形式であらわされ、<code class="docutils literal"><span class="pre">a[i:i+n]</span> <span class="pre">==</span> <span class="pre">b[j:j+n]</span></code> という関係を意味します。3つの値は <em>i</em> と <em>j</em> の間で単調に増加します。</p>
<p>最後のタプルはダミーで、<code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> という値を持ちます。これは <code class="docutils literal"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">0</span></code> である唯一のタプルです。もし <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> と <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">n')</span></code> がリストで並んでいる3つ組で、2つ目が最後の3つ組でなければ、<code class="docutils literal"><span class="pre">i+n</span> <span class="pre">!=</span> <span class="pre">i'</span></code> または <code class="docutils literal"><span class="pre">j+n</span> <span class="pre">!=</span> <span class="pre">j'</span></code> です。言い換えると並んでいる3つ組は常に隣接していない同じブロックを表しています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abxcd"</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">()</span>
<span class="go">[Match(a=0, b=0, size=2), Match(a=3, b=2, size=2), Match(a=5, b=4, size=0)]</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_opcodes">
<code class="descname">get_opcodes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> を <em>b</em> にするための方法を記述する5つのタプルを返します。それぞれのタプルは <code class="docutils literal"><span class="pre">(tag,</span> <span class="pre">i1,</span> <span class="pre">i2,</span> <span class="pre">j1,</span> <span class="pre">j2)</span></code> という形式であらわされます。最初のタプルは <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">j1</span> <span class="pre">==</span> <span class="pre">0</span></code> であり、<em>i1</em> はその前にあるタプルの <em>i2</em> と同じ値です。同様に <em>j1</em> は前の <em>j2</em> と同じ値になります。</p>
<p><em>tag</em> の値は文字列であり、次のような意味です:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%"/>
<col width="75%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'replace'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は <code class="docutils literal"><span class="pre">b[j1:j2]</span></code> に置き換えられる。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'delete'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は削除される。この時、<code class="docutils literal"><span class="pre">j1</span> <span class="pre">==</span> <span class="pre">j2</span></code> である。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'insert'</span></code></td>
<td><code class="docutils literal"><span class="pre">b[j1:j2]</span></code> が <code class="docutils literal"><span class="pre">a[i1:i1]</span></code> に挿入される。この時 <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">i2</span></code> である。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'equal'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span> <span class="pre">==</span> <span class="pre">b[j1:j2]</span></code> (サブシーケンスは等しい).</td>
</tr>
</tbody>
</table>
<p>例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="s2">"qabxcd"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="s2">"abycdf"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{:7}</span><span class="s1">   a[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] --&gt; b[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] </span><span class="si">{!r:&gt;8}</span><span class="s1"> --&gt; </span><span class="si">{!r}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">]))</span>
<span class="go">delete    a[0:1] --&gt; b[0:0]      'q' --&gt; ''</span>
<span class="go">equal     a[1:3] --&gt; b[0:2]     'ab' --&gt; 'ab'</span>
<span class="go">replace   a[3:4] --&gt; b[2:3]      'x' --&gt; 'y'</span>
<span class="go">equal     a[4:6] --&gt; b[3:5]     'cd' --&gt; 'cd'</span>
<span class="go">insert    a[6:6] --&gt; b[5:6]       '' --&gt; 'f'</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_grouped_opcodes">
<code class="descname">get_grouped_opcodes</code><span class="sig-paren">(</span><em>n=3</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_grouped_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>最大 <em>n</em> 行までのコンテクストを含むグループを生成するような、ジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)を返します。</p>
<p>このメソッドは、 <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> で返されるグループの中から、似たような差異のかたまりに分け、間に挟まっている変更の無い部分を省きます。</p>
<p>グループは <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> と同じ書式で返されます。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.ratio">
<code class="descname">ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>[0, 1] の範囲の浮動小数点数で、シーケンスの類似度を測る値を返します。</p>
<p>T が2つのシーケンスの要素数の総計だと仮定し、M をマッチした数とすると、この値は 2.0*M / T であらわされます。もしシーケンスがまったく同じ場合、値は <code class="docutils literal"><span class="pre">1.0</span></code> となり、まったく異なる場合には <code class="docutils literal"><span class="pre">0.0</span></code> となります。</p>
<p>このメソッドは <a class="reference internal" href="#difflib.SequenceMatcher.get_matching_blocks" title="difflib.SequenceMatcher.get_matching_blocks"><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> がまだ呼び出されていない場合には非常にコストが高いです。この場合、上限を素早く計算するために、 <a class="reference internal" href="#difflib.SequenceMatcher.quick_ratio" title="difflib.SequenceMatcher.quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code></a> もしくは <a class="reference internal" href="#difflib.SequenceMatcher.real_quick_ratio" title="difflib.SequenceMatcher.real_quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code></a> を最初に試してみる方がいいかもしれません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.quick_ratio">
<code class="descname">quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、より高速に計算します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.real_quick_ratio">
<code class="descname">real_quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.real_quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、非常に高速に計算します。</p>
</dd></dl>
</dd></dl>
<p>この文字列全体のマッチ率を返す3つのメソッドは、精度の異なる近似値を返します。 <code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code> と <code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code> は、常に <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> 以上の値を返します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">,</span> <span class="s2">"bcde"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">quick_ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">real_quick_ratio</span><span class="p">()</span>
<span class="go">1.0</span>
</pre></div>
</div>
</div>
<div class="section" id="sequencematcher-examples">
<span id="id1"></span><h2>6.3.2. SequenceMatcher の例<a class="headerlink" href="#sequencematcher-examples" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は2つの文字列を比較します。空白を "junk" とします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">" "</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private Thread currentThread;"</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private volatile Thread currentThread;"</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> は、[0, 1] の範囲の値を返し、シーケンスの類似度を測ります。経験によると、 <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> の値が0.6を超えると、シーケンスがよく似ていることを示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="go">0.866</span>
</pre></div>
</div>
<p>シーケンスのどこがマッチしているかにだけ興味のある時には <code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が手軽でしょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"a[</span><span class="si">%d</span><span class="s2">] and b[</span><span class="si">%d</span><span class="s2">] match for </span><span class="si">%d</span><span class="s2"> elements"</span> <span class="o">%</span> <span class="n">block</span><span class="p">)</span>
<span class="go">a[0] and b[0] match for 8 elements</span>
<span class="go">a[8] and b[17] match for 21 elements</span>
<span class="go">a[29] and b[38] match for 0 elements</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が返す最後のタプルが常にダミーであることに注目してください。このダミーは <code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> であり、これはタプルの最後の要素（マッチする要素の数）が <code class="docutils literal"><span class="pre">0</span></code> となる唯一のケースです。</p>
<p>はじめのシーケンスがどのようにして2番目のものになるのかを知るには、 <code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code> を使います:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%6s</span><span class="s2"> a[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">] b[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">]"</span> <span class="o">%</span> <span class="n">opcode</span><span class="p">)</span>
<span class="go"> equal a[0:8] b[0:8]</span>
<span class="go">insert a[8:8] b[8:17]</span>
<span class="go"> equal a[8:29] b[17:38]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<ul class="last simple">
<li><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> を使った、シンプルで使えるコードを知るには、このモジュールの関数 <a class="reference internal" href="#difflib.get_close_matches" title="difflib.get_close_matches"><code class="xref py py-func docutils literal"><span class="pre">get_close_matches()</span></code></a> を参照してください。</li>
<li><a class="reference external" href="https://code.activestate.com/recipes/576729/">Simple version control recipe</a> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> で作った小規模アプリケーション。</li>
</ul>
</div>
</div>
<div class="section" id="differ-objects">
<span id="id2"></span><h2>6.3.3. Differ オブジェクト<a class="headerlink" href="#differ-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトによって生成された差分が <strong>最小</strong> であるなどとは言いません。むしろ、最小の差分はしばしば直観に反しています。その理由は、どこでもできるとなれば一致を見いだしてしまうからで、ときには思いがけなく100ページも離れたマッチになってしまうのです。一致点を互いに隣接したマッチに制限することで、場合によって長めの差分を出力するというコストを掛けることにはなっても、ある種の局所性を保つことができるのです。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> は、以下のようなコンストラクタを持ちます:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><span class="sig-paren">(</span><em>linejunk=None</em>, <em>charjunk=None</em><span class="sig-paren">)</span></dt>
<dd><p>オプションのキーワードパラメータ <em>linejunk</em> と <em>charjunk</em> は、フィルタ関数を渡します (使わないときは <code class="docutils literal"><span class="pre">None</span></code>):</p>
<p><em>linejunk</em>: ひとつの文字列引数を受け取る関数です。文字列が junk のときに真を返します。デフォルトでは、<code class="docutils literal"><span class="pre">None</span></code> であり、どんな行であっても junk とは見なされません。</p>
<p><em>charjunk</em>: この関数は文字(長さ1の文字列)を引数として受け取り、文字が junk であるときに真を返します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> であり、どんな文字も junk とは見なされません。</p>
<p>これらの junk フィルター関数により、差分を発見するマッチングが高速化し、差分の行や文字が無視されることがなくなります。説明については、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> メソッドの <em>isjunk</em> 引数の説明をご覧ください。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトは、以下の1つのメソッドを通して利用されます。（差分を生成します）:</p>
<dl class="method">
<dt id="difflib.Differ.compare">
<code class="descname">compare</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.Differ.compare" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>文字列からなる2つのシーケンスを比較し、差分（を表す文字列からなるシーケンス）を生成します。</p>
<p>各シーケンスの要素は、改行で終わる独立した単一行からなる文字列でなければなりません。そのようなシーケンスは、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code></a> メソッドによって得ることができます。（得られる）差分は改行文字で終了する文字列のシーケンスとして得られ、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-meth docutils literal"><span class="pre">writelines()</span></code></a> メソッドによって出力できる形になっています。</p>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="differ-example">
<span id="differ-examples"></span><h2>6.3.4. Differ の例<a class="headerlink" href="#differ-example" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下の例は2つのテキストを比較しています。最初に、テキストを行毎に改行で終わる文字列のシーケンスにセットアップします (そのようなシーケンスは、ファイル風オブジェクトの <code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code> メソッドからも得ることができます):</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  2. Explicit is better than implicit.</span>
<span class="gp">... </span><span class="s1">  3. Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complex is better than complicated.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">'\n'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text2</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  3.   Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complicated is better than complex.</span>
<span class="gp">... </span><span class="s1">  5. Flat is better than nested.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>次に Differ オブジェクトをインスタンス化します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Differ</span><span class="p">()</span>
</pre></div>
</div>
<p>注意:  <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトをインスタンス化するとき、行 junk と文字 junk をフィルタリングする関数を渡すことができます。詳細は <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-meth docutils literal"><span class="pre">Differ()</span></code></a> コンストラクタを参照してください。</p>
<p>最後に、2つを比較します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">result</span></code> は文字列のリストなので、pretty-printしてみましょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">['    1. Beautiful is better than ugly.\n',</span>
<span class="go"> '-   2. Explicit is better than implicit.\n',</span>
<span class="go"> '-   3. Simple is better than complex.\n',</span>
<span class="go"> '+   3.   Simple is better than complex.\n',</span>
<span class="go"> '?     ++\n',</span>
<span class="go"> '-   4. Complex is better than complicated.\n',</span>
<span class="go"> '?            ^                     ---- ^\n',</span>
<span class="go"> '+   4. Complicated is better than complex.\n',</span>
<span class="go"> '?           ++++ ^                      ^\n',</span>
<span class="go"> '+   5. Flat is better than nested.\n']</span>
</pre></div>
</div>
<p>これは、複数行の文字列として、次のように出力されます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">    1. Beautiful is better than ugly.</span>
<span class="go">-   2. Explicit is better than implicit.</span>
<span class="go">-   3. Simple is better than complex.</span>
<span class="go">+   3.   Simple is better than complex.</span>
<span class="go">?     ++</span>
<span class="go">-   4. Complex is better than complicated.</span>
<span class="go">?            ^                     ---- ^</span>
<span class="go">+   4. Complicated is better than complex.</span>
<span class="go">?           ++++ ^                      ^</span>
<span class="go">+   5. Flat is better than nested.</span>
</pre></div>
</div>
</div>
<div class="section" id="a-command-line-interface-to-difflib">
<span id="difflib-interface"></span><h2>6.3.5. difflib のコマンドラインインタフェース<a class="headerlink" href="#a-command-line-interface-to-difflib" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は、 difflib を使って <code class="docutils literal"><span class="pre">diff</span></code> に似たユーティリティーを作成する方法を示します。これは、 Python のソース配布物にも、 <code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> として含まれています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">""" Command line interface to difflib.py providing diffs in four formats:</span>

<span class="sd">* ndiff:    lists every line and highlights interline changes.</span>
<span class="sd">* context:  highlights clusters of changes in a before/after format.</span>
<span class="sd">* unified:  highlights clusters of changes in an inline format.</span>
<span class="sd">* html:     generates side by side comparison with change highlights.</span>

<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">difflib</span><span class="o">,</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="k">def</span> <span class="nf">file_mtime</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span>
                               <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a context format diff (default)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-u'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a unified format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-m'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce HTML side by side diff '</span>
                             <span class="s1">'(can use -c and -l in conjunction)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-n'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a ndiff format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-l'</span><span class="p">,</span> <span class="s1">'--lines'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Set number of context lines (default 3)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'fromfile'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'tofile'</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">lines</span>
    <span class="n">fromfile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">fromfile</span>
    <span class="n">tofile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">tofile</span>

    <span class="n">fromdate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span>
    <span class="n">todate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">fromlines</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
        <span class="n">tolines</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">u</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">m</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">HtmlDiff</span><span class="p">()</span><span class="o">.</span><span class="n">make_file</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span><span class="n">tolines</span><span class="p">,</span><span class="n">fromfile</span><span class="p">,</span><span class="n">tofile</span><span class="p">,</span><span class="n">context</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">numlines</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">context_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div aria-label="main navigation" class="sphinxsidebar" role="navigation">
<div class="sphinxsidebarwrapper">
<h3><a href="../contents.html">目次</a></h3>
<ul>
<li><a class="reference internal" href="#">6.3. <code class="docutils literal"><span class="pre">difflib</span></code>  差分の計算を助ける</a><ul>
<li><a class="reference internal" href="#sequencematcher-objects">6.3.1. SequenceMatcherオブジェクト</a></li>
<li><a class="reference internal" href="#sequencematcher-examples">6.3.2. SequenceMatcher の例</a></li>
<li><a class="reference internal" href="#differ-objects">6.3.3. Differ オブジェクト</a></li>
<li><a class="reference internal" href="#differ-example">6.3.4. Differ の例</a></li>
<li><a class="reference internal" href="#a-command-line-interface-to-difflib">6.3.5. difflib のコマンドラインインタフェース</a></li>
</ul>
</li>
</ul>
<h4>前のトピックへ</h4>
<p class="topless"><a href="re.html" title="前の章へ">6.2. <code class="docutils literal"><span class="pre">re</span></code>  正規表現操作</a></p>
<h4>次のトピックへ</h4>
<p class="topless"><a href="textwrap.html" title="次の章へ">6.4. <code class="docutils literal"><span class="pre">textwrap</span></code>  テキストの折り返しと詰め込み</a></p>
<div aria-label="source link" role="note">
<h3>このページ</h3>
<ul class="this-page-menu">
<li><a href="../bugs.html">バグ報告</a></li>
<li>
<a href="https://github.com/python/cpython/blob/3.6/Doc/library/difflib.rst" rel="nofollow">ソースの表示
        </a>
</li>
</ul>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="footer">
     <a href="../copyright.html">Copyright</a> 2001-2018, Python Software Foundation.
    <br/>
    Python Software Foundation は非営利団体です。
    <a href="https://www.python.org/psf/donations/">寄付</a>
<br/>
    最終更新日時: 7月 29, 2018
    <a href="../bugs.html">バグを見つけたら</a>?
    <br/>
    このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.5 を使って作成されました。
    </div>
</body>
</head></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="ja" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>6.3. difflib  差分の計算を助ける  Python 3.6.5 ドキュメント</title>
<link href="../_static/pydoctheme.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
<script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/underscore.js" type="text/javascript"></script>
<script src="../_static/doctools.js" type="text/javascript"></script>
<script src="../_static/translations.js" type="text/javascript"></script>
<script src="../_static/sidebar.js" type="text/javascript"></script>
<link href="../_static/opensearch.xml" rel="search" title="Python 3.6.5 ドキュメント 内を検索" type="application/opensearchdescription+xml"/>
<link href="../about.html" rel="author" title="このドキュメントについて"/>
<link href="../genindex.html" rel="index" title="索引"/>
<link href="../search.html" rel="search" title="検索"/>
<link href="../copyright.html" rel="copyright" title="Copyright"/>
<link href="textwrap.html" rel="next" title="6.4. textwrap  テキストの折り返しと詰め込み"/>
<link href="re.html" rel="prev" title="6.2. re  正規表現操作"/>
<link href="../_static/py.png" rel="shortcut icon" type="image/png"/>
<link href="https://docs.python.jp/3/library/difflib.html" rel="canonical"/><script type="text/javascript">
    $(document).ready(function() {
      var base = 'https://docs.python.org/3.6/library/difflib.html';
      $('a.headerlink').each(function() {
        var html = '<a href="' + base + $(this).attr('href') +
                   '" title="原文へのリンク"><small>(原文)</small></a>';
        $(this).after(html);
      })
    });
    </script>
<script src="../_static/copybutton.js" type="text/javascript"></script>
<script src="../_static/version_switch.js" type="text/javascript"></script>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-34175846-1', 'python.jp');
        ga('send', 'pageview');

      </script>
<body>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a accesskey="I" href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a accesskey="N" href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a accesskey="P" href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a accesskey="U" href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body" role="main">
<div class="section" id="module-difflib">
<span id="difflib-helpers-for-computing-deltas"></span><h1>6.3. <a class="reference internal" href="#module-difflib" title="difflib: Helpers for computing differences between objects."><code class="xref py py-mod docutils literal"><span class="pre">difflib</span></code></a>  差分の計算を助ける<a class="headerlink" href="#module-difflib" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><strong>ソースコード:</strong> <a class="reference external" href="https://github.com/python/cpython/tree/3.6/Lib/difflib.py">Lib/difflib.py</a></p>
<hr class="docutils"/>
<p>このモジュールは、シーケンスを比較するためのクラスや関数を提供しています。例えば、ファイルの差分を計算して、それを HTML や context diff, unified diff などいろいろなフォーマットで出力するために、このモジュールを利用することができます。ディレクトリやファイル群を比較するためには、 <a class="reference internal" href="filecmp.html#module-filecmp" title="filecmp: Compare files efficiently."><code class="xref py py-mod docutils literal"><span class="pre">filecmp</span></code></a> モジュールも参照してください。</p>
<dl class="class">
<dt id="difflib.SequenceMatcher">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><a class="headerlink" href="#difflib.SequenceMatcher" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>柔軟性のあるクラスで、二つのシーケンスの要素がハッシュ化できる(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)型であれば、どの型の要素を含むシーケンスも比較可能です。基本的なアルゴリズムは、1980年代の後半に発表された Ratcliff と Obershelp による"ゲシュタルトパターンマッチング"と大げさに名づけられたアルゴリズム以前から知られている、やや凝ったアルゴリズムです。その考え方は、"junk" 要素を含まない最も長い互いに隣接したマッチ列を探すことです。ここで、  "junk" 要素とは、空行や空白などの、意味を持たない要素のことです。 (junk を処理するのは、Ratcliff と Obershelp のアルゴリズムに追加された拡張です。)この考え方は、マッチ列の左右に隣接するシーケンスの断片に対して再帰的にあてはめられます。この方法では編集を最小にするシーケンスは生まれませんが、人間の目からみて「正しい感じ」にマッチする傾向があります。</p>
<p><strong>実行時間:</strong> 基本的な Ratcliff-Obershelp アルゴリズムは、最悪の場合3乗、期待値で2乗となります。 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトでは、最悪のケースで2乗、期待値は比較されるシーケンス中に共通に現れる要素数に非常にややこしく依存しています。最良の場合は線形時間になります。</p>
<p><strong>自動 junk ヒューリスティック:</strong> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> は、シーケンスの特定の要素を自動的に junk として扱うヒューリスティックをサポートしています。このヒューリスティックは、各個要素がシーケンス内に何回現れるかを数えます。ある要素の重複数が (最初のものは除いて) 合計でシーケンスの 1% 以上になり、そのシーケンスが 200 要素以上なら、その要素は "popular" であるものとしてマークされ、シーケンスのマッチングの目的からは junk として扱われます。このヒューリスティックは、 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> の作成時に <code class="docutils literal"><span class="pre">autojunk</span></code> パラメタを <code class="docutils literal"><span class="pre">False</span></code> に設定することで無効化できます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
</dd></dl>
<dl class="class">
<dt id="difflib.Differ">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><a class="headerlink" href="#difflib.Differ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>テキスト行からなるシーケンスを比較するクラスです。人が読むことのできる差分を作成します。 Differ クラスは <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスを利用して、行からなるシーケンスを比較したり、(ほぼ)同一の行内の文字を比較したりします。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> クラスによる差分の各行は、2文字のコードで始まります:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%"/>
<col width="81%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">コード</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'-</span> <span class="pre">'</span></code></td>
<td>行はシーケンス1にのみ存在する</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'+</span> <span class="pre">'</span></code></td>
<td>行はシーケンス2にのみ存在する</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'</span> <span class="pre">'</span></code></td>
<td>行は両方のシーケンスで同一</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'?</span> <span class="pre">'</span></code></td>
<td>行は入力シーケンスのどちらにも存在しない</td>
</tr>
</tbody>
</table>
<p>'<code class="docutils literal"><span class="pre">?</span></code>' で始まる行は、行内のどこに差異が存在するかに注意を向けようとします。その行は、入力されたシーケンスのどちらにも存在しません。シーケンスがタブ文字を含むとき、これらの行は判別しづらいものになることがあります。</p>
</dd></dl>
<dl class="class">
<dt id="difflib.HtmlDiff">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">HtmlDiff</code><a class="headerlink" href="#difflib.HtmlDiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このクラスは、二つのテキストを左右に並べて比較表示し、行間あるいは行内の変更点を強調表示するような HTML テーブル (またはテーブルの入った完全な HTML ファイル) を生成するために使います。テーブルは完全差分モード、コンテキスト差分モードのいずれでも生成できます。</p>
<p>このクラスのコンストラクタは以下のようになっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>tabsize=8</em>, <em>wrapcolumn=None</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.__init__" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> のインスタンスを初期化します。</p>
<p><em>tabsize</em> はオプションのキーワード引数で、タブストップ幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">8</span></code> です。</p>
<p><em>wrapcolumn</em> はオプションのキーワード引数で、テキストを折り返すカラム幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> で折り返しを行いません。</p>
<p><em>linejunk</em> および <em>charjunk</em> はオプションのキーワード引数で、 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a>  (<a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> はこの関数を使って左右のテキストの差分を HTML で生成します) に渡されます。それぞれの引数のデフォルト値および説明は <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> のドキュメントを参照してください。</p>
</dd></dl>
<p>以下のメソッドが public になっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.make_file">
<code class="descname">make_file</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em>, <em>*</em>, <em>charset='utf-8'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_file" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った表を持つ完全な HTML ファイルを文字列で返します。</p>
<p><em>fromdesc</em> および <em>todesc</em> はオプションのキーワード引数で、差分表示テーブルにおけるそれぞれ差分元、差分先ファイルのカラムのヘッダになる文字列を指定します (いずれもデフォルト値は空文字列です)。</p>
<p><em>context</em> および <em>numlines</em> はともにオプションのキーワード引数です。<em>context</em> を <code class="docutils literal"><span class="pre">True</span></code> にするとコンテキスト差分を表示し、デフォルトの <code class="docutils literal"><span class="pre">False</span></code> にすると完全なファイル差分を表示します。<em>numlines</em> のデフォルト値は <code class="docutils literal"><span class="pre">5</span></code> で、<em>context</em> が <code class="docutils literal"><span class="pre">True</span></code> の場合、<em>numlines</em> は強調部分の前後にあるコンテキスト行の数を制御します。<em>context</em> が <code class="docutils literal"><span class="pre">False</span></code> の場合、<em>numlines</em> は "next" と書かれたハイパーリンクをたどった時に到達する場所が次の変更部分より何行前にあるかを制御します (値をゼロにした場合、"next" ハイパーリンクを辿ると変更部分の強調表示がブラウザの最上部に表示されるようになります)。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.5 で変更: </span><em>charset</em> キーワード専用引数が追加されました。HTML 文書のデフォルトの文字集合が <code class="docutils literal"><span class="pre">'ISO-8859-1'</span></code> から <code class="docutils literal"><span class="pre">'utf-8'</span></code> に変更されました。</p>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.HtmlDiff.make_table">
<code class="descname">make_table</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った完全な HTML テーブルを文字列で返します。</p>
<p>このメソッドの引数は、 <a class="reference internal" href="#difflib.HtmlDiff.make_file" title="difflib.HtmlDiff.make_file"><code class="xref py py-meth docutils literal"><span class="pre">make_file()</span></code></a> メソッドの引数と同じです。</p>
</dd></dl>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> はこのクラスへのコマンドラインフロントエンドで、使い方を学ぶ上で格好の例題が入っています。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.context_diff">
<code class="descclassname">difflib.</code><code class="descname">context_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.context_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 context diff のフォーマット(以下「コンテクスト形式」)で返します。</p>
<p>コンテクスト形式は、変更があった行に前後数行を加えてある、コンパクトな表現方法です。変更箇所は、変更前/変更後に分けて表します。コンテクスト (変更箇所前後の行) の行数は <em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">***</span></code> や <code class="docutils literal"><span class="pre">---</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">context_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">*** before.py</span>
<span class="go">--- after.py</span>
<span class="go">***************</span>
<span class="go">*** 1,4 ****</span>
<span class="go">! bacon</span>
<span class="go">! eggs</span>
<span class="go">! ham</span>
<span class="go">  guido</span>
<span class="go">--- 1,4 ----</span>
<span class="go">! python</span>
<span class="go">! eggy</span>
<span class="go">! hamster</span>
<span class="go">  guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.get_close_matches">
<code class="descclassname">difflib.</code><code class="descname">get_close_matches</code><span class="sig-paren">(</span><em>word</em>, <em>possibilities</em>, <em>n=3</em>, <em>cutoff=0.6</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.get_close_matches" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>「十分」なマッチの上位のリストを返します。<em>word</em> はマッチさせたいシーケンス (大概は文字列) です。<em>possibilities</em> は <em>word</em> にマッチさせるシーケンスのリスト (大概は文字列のリスト) です。</p>
<p>オプションの引数 <em>n</em> (デフォルトでは <code class="docutils literal"><span class="pre">3</span></code>)はメソッドの返すマッチの最大数です。<em>n</em> は <code class="docutils literal"><span class="pre">0</span></code> より大きくなければなりません。</p>
<p>オプションの引数 <em>cutoff</em> (デフォルトでは <code class="docutils literal"><span class="pre">0.6</span></code>)は、区間 [0, 1] に入る小数の値です。<em>word</em> との一致率がそれ未満の <em>possibilities</em> の要素は無視されます。</p>
<p><em>possibilities</em> の要素でマッチした上位(多くても <em>n</em> 個)は、類似度のスコアに応じて(一番似たものを先頭に)ソートされたリストとして返されます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'appel'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ape'</span><span class="p">,</span> <span class="s1">'apple'</span><span class="p">,</span> <span class="s1">'peach'</span><span class="p">,</span> <span class="s1">'puppy'</span><span class="p">])</span>
<span class="go">['apple', 'ape']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">keyword</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'wheel'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['while']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'pineapple'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'accept'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['except']</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.ndiff">
<code class="descclassname">difflib.</code><code class="descname">ndiff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.ndiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> のスタイルで返します。</p>
<p>オプションのキーワード引数 <em>linejunk</em> と <em>charjunk</em> には、フィルタ関数 (または <code class="docutils literal"><span class="pre">None</span></code>) を渡します。</p>
<p><em>linejunk</em>: 文字列型の引数 1 つを受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは <code class="docutils literal"><span class="pre">None</span></code> です。モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_LINE_JUNK" title="difflib.IS_LINE_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_LINE_JUNK()</span></code></a> は、高々 1 つのシャープ記号(<code class="docutils literal"><span class="pre">'#'</span></code>)を除いて可視の文字を含まない行をフィルタリングするものです。しかし、下層にある <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスが、どの行が雑音となるほど頻繁に登場するかを動的に分析します。このクラスによる分析は、この関数を使用するよりも通常うまく動作します。</p>
<p><em>charjunk</em>: 文字 (長さ1の文字列) を受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは、モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_CHARACTER_JUNK" title="difflib.IS_CHARACTER_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_CHARACTER_JUNK()</span></code></a> であり、これは空白文字類 (空白またはタブ、改行文字をこれに含めてはいけません) をフィルタして排除します。</p>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/ndiff.py</span></code> は、この関数のコマンドラインのフロントエンド（インターフェイス）です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">diff</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">- one</span>
<span class="go">?  ^</span>
<span class="go">+ ore</span>
<span class="go">?  ^</span>
<span class="go">- two</span>
<span class="go">- three</span>
<span class="go">?  -</span>
<span class="go">+ tree</span>
<span class="go">+ emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.restore">
<code class="descclassname">difflib.</code><code class="descname">restore</code><span class="sig-paren">(</span><em>sequence</em>, <em>which</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.restore" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>差分を生成した元の二つのシーケンスのうち一つを返します。</p>
<p><a class="reference internal" href="#difflib.Differ.compare" title="difflib.Differ.compare"><code class="xref py py-meth docutils literal"><span class="pre">Differ.compare()</span></code></a> または <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> によって生成された <em>sequence</em> を与えられると、行頭のプレフィクスを取りのぞいてファイル 1 または 2 (引数 <em>which</em> で指定される) に由来する行を復元します。</p>
<p>例:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="c1"># materialize the generated delta into a list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">one</span>
<span class="go">two</span>
<span class="go">three</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">ore</span>
<span class="go">tree</span>
<span class="go">emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.unified_diff">
<code class="descclassname">difflib.</code><code class="descname">unified_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.unified_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 unified diff フォーマット(以下「ユニファイド形式」)で返します。</p>
<p>ユニファイド形式は変更があった行にコンテキストとなる前後数行を加えた、コンパクトな表現方法です。変更箇所は (変更前/変更後を分離したブロックではなく) インラインスタイルで表されます。コンテクストの行数は、<em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">---</span></code>, <code class="docutils literal"><span class="pre">+++</span></code>, <code class="docutils literal"><span class="pre">@@</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">--- before.py</span>
<span class="go">+++ after.py</span>
<span class="go">@@ -1,4 +1,4 @@</span>
<span class="go">-bacon</span>
<span class="go">-eggs</span>
<span class="go">-ham</span>
<span class="go">+python</span>
<span class="go">+eggy</span>
<span class="go">+hamster</span>
<span class="go"> guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.diff_bytes">
<code class="descclassname">difflib.</code><code class="descname">diff_bytes</code><span class="sig-paren">(</span><em>dfunc</em>, <em>a</em>, <em>b</em>, <em>fromfile=b''</em>, <em>tofile=b''</em>, <em>fromfiledate=b''</em>, <em>tofiledate=b''</em>, <em>n=3</em>, <em>lineterm=b'\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.diff_bytes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>dfunc</em> を使用して <em>a</em> と <em>b</em> (bytes オブジェクトのリスト) を比較して、差分形式の行 (これも bytes オブジェクトです) を*dfunc* の戻り値の形式で返します。<em>dfunc</em> は、呼び出し可能である必要があります。一般に、これは <a class="reference internal" href="#difflib.unified_diff" title="difflib.unified_diff"><code class="xref py py-func docutils literal"><span class="pre">unified_diff()</span></code></a> または <a class="reference internal" href="#difflib.context_diff" title="difflib.context_diff"><code class="xref py py-func docutils literal"><span class="pre">context_diff()</span></code></a> です。</p>
<p>未知のエンコーディングまたは一貫性のないエンコーディングのデータ同士を比較できます。<em>n</em> 以外のすべての入力は、bytes オブジェクトである必要があります。<em>n</em> 以外のすべての入力を損失なく str に変換して、<code class="docutils literal"><span class="pre">dfunc(a,</span> <span class="pre">b,</span> <span class="pre">fromfile,</span> <span class="pre">tofile,</span> <span class="pre">fromfiledate,</span> <span class="pre">tofiledate,</span> <span class="pre">n,</span> <span class="pre">lineterm)</span></code> を呼び出すことにより動作します。<em>dfunc</em> の出力は、bytes 型に変換されます。これにより、受け取る差分形式の行のエンコーディングは、<em>a</em> と <em>b</em> の未知または一貫性のないエンコーディングと同一になります。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_LINE_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_LINE_JUNK</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_LINE_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる行のとき真を返します。行 <em>line</em> は空白、または  <code class="docutils literal"><span class="pre">'#'</span></code> ひとつのときに無視できます。それ以外のときには無視できません。古いバージョンでは <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>linejunk</em> にデフォルトで使用されました。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_CHARACTER_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_CHARACTER_JUNK</code><span class="sig-paren">(</span><em>ch</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_CHARACTER_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる文字のとき真を返します。文字 <em>ch</em> が空白、またはタブ文字のときには無視できます。それ以外の時には無視できません。 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>charjunk</em> としてデフォルトで使用されます。</p>
</dd></dl>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><a class="reference external" href="http://www.drdobbs.com/database/pattern-matching-the-gestalt-approach/184407970">Pattern Matching: The Gestalt Approach</a></dt>
<dd>John W. Ratcliff と D. E. Metzener による類似のアルゴリズムに関する議論。<a class="reference external" href="http://www.drdobbs.com/">Dr. Dobb’s Journal</a> 1988年7月号掲載。</dd>
</dl>
</div>
<div class="section" id="sequencematcher-objects">
<span id="sequence-matcher"></span><h2>6.3.1. SequenceMatcherオブジェクト<a class="headerlink" href="#sequencematcher-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスには、以下のようなコンストラクタがあります:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><span class="sig-paren">(</span><em>isjunk=None</em>, <em>a=''</em>, <em>b=''</em>, <em>autojunk=True</em><span class="sig-paren">)</span></dt>
<dd><p>オプションの引数 <em>isjunk</em> は、<code class="docutils literal"><span class="pre">None</span></code> (デフォルトの値です) にするか、単一の引数をとる関数でなければなりません。後者の場合、関数はシーケンスの要素を受け取り、要素が junk であり、無視すべきである場合に限り真を返すようにしなければなりません。<em>isjunk</em> に <code class="docutils literal"><span class="pre">None</span></code> を渡すと、<code class="docutils literal"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">0</span></code> を渡したのと同じになります; すなわち、いかなる要素も無視しなくなります。例えば以下のような引数を渡すと:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">" </span><span class="se">\t</span><span class="s2">"</span>
</pre></div>
</div>
<p>空白とタブ文字を無視して文字のシーケンスを比較します。</p>
<p>オプションの引数 <em>a</em> と <em>b</em> は、比較される文字列で、デフォルトでは空の文字列です。両方のシーケンスの要素は、ハッシュ化可能(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)である必要があります。</p>
<p>オプションの引数 <em>autojunk</em> は、自動 junk ヒューリスティックを無効にするために使えます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
<p>SequenceMatcher オブジェクトは3つのデータ属性を持っています: <em>bjunk</em> は、 <em>isjunk</em> が <code class="docutils literal"><span class="pre">True</span></code> であるような <em>b</em> の要素の集合です; <em>bpopular</em> は、 (無効でなければ) ヒューリスティックによって popular であると考えられる非ジャンク要素の集合です; <em>b2j</em> は、 <em>b</em> の残りの要素をそれらが生じる位置のリストに写像する dict です。この 3 つは <a class="reference internal" href="#difflib.SequenceMatcher.set_seqs" title="difflib.SequenceMatcher.set_seqs"><code class="xref py py-meth docutils literal"><span class="pre">set_seqs()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> で <em>b</em> がリセットされる場合は常にリセットされます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>bjunk</em> および <em>bpopular</em> 属性。</p>
</div>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは以下のメソッドを持ちます:</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seqs">
<code class="descname">set_seqs</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seqs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較される2つの文字列を設定します。</p>
</dd></dl>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは、2つ目のシーケンスについての詳細な情報を計算し、キャッシュします。 1つのシーケンスをいくつものシーケンスと比較する場合、まず <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> を使って文字列を設定しておき、別の文字列を1つずつ比較するために、繰り返し <a class="reference internal" href="#difflib.SequenceMatcher.set_seq1" title="difflib.SequenceMatcher.set_seq1"><code class="xref py py-meth docutils literal"><span class="pre">set_seq1()</span></code></a> を呼び出します。</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq1">
<code class="descname">set_seq1</code><span class="sig-paren">(</span><em>a</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq1" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う1つ目のシーケンスを設定します。比較される2つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq2">
<code class="descname">set_seq2</code><span class="sig-paren">(</span><em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq2" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う2つ目のシーケンスを設定します。比較される1つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.find_longest_match">
<code class="descname">find_longest_match</code><span class="sig-paren">(</span><em>alo</em>, <em>ahi</em>, <em>blo</em>, <em>bhi</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.find_longest_match" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">a[alo:ahi]</span></code> と <code class="docutils literal"><span class="pre">b[blo:bhi]</span></code> の中から、最長のマッチ列を探します。</p>
<p><em>isjunk</em> が省略されたか <code class="docutils literal"><span class="pre">None</span></code> の時、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> は <code class="docutils literal"><span class="pre">a[i:i+k]</span></code> が <code class="docutils literal"><span class="pre">b[j:j+k]</span></code> と等しいような <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">k)</span></code> を返します。その値は <code class="docutils literal"><span class="pre">alo</span> <span class="pre">&lt;=</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i+k</span> <span class="pre">&lt;=</span> <span class="pre">ahi</span></code> かつ <code class="docutils literal"><span class="pre">blo</span> <span class="pre">&lt;=</span> <span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j+k</span> <span class="pre">&lt;=</span> <span class="pre">bhi</span></code> となります。 <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">k')</span></code> でも、同じようになります。さらに <code class="docutils literal"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">k'</span></code>, <code class="docutils literal"><span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i'</span></code> が <code class="docutils literal"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">i'</span></code>, <code class="docutils literal"><span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j'</span></code> でも同様です。言い換えると、いくつものマッチ列すべてのうち、 <em>a</em> 内で最初に始まるものを返します。そしてその <em>a</em> 内で最初のマッチ列すべてのうち <em>b</em> 内で最初に始まるものを返します。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=0, b=4, size=5)</span>
</pre></div>
</div>
<p>引数 <em>isjunk</em> が与えられている場合、上記の通り、はじめに最長のマッチ列を判定します。ブロック内に junk 要素が見当たらないような追加条件の際はこれに該当しません。次にそのマッチ列を、その両側の junk 要素にマッチするよう、できる限り広げていきます。そのため結果となる列は、探している列のたまたま直前にあった同一の junk 以外の junk にはマッチしません。</p>
<p>以下は前と同じサンプルですが、空白を junk とみなしています。これは <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> が2つ目の列の末尾にある <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> にマッチしないようにしています。代わりに <code class="docutils literal"><span class="pre">'abcd'</span></code> にはマッチします。そして 2つ目の文字列中、一番左の <code class="docutils literal"><span class="pre">'abcd'</span></code> にマッチします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">==</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=1, b=0, size=4)</span>
</pre></div>
</div>
<p>どんな列にもマッチしない時は、<code class="docutils literal"><span class="pre">(alo,</span> <span class="pre">blo,</span> <span class="pre">0)</span></code> を返します。</p>
<p>このメソッドは <a class="reference internal" href="../glossary.html#term-named-tuple"><span class="xref std std-term">named tuple</span></a> <code class="docutils literal"><span class="pre">Match(a,</span> <span class="pre">b,</span> <span class="pre">size)</span></code> を返します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_matching_blocks">
<code class="descname">get_matching_blocks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_matching_blocks" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>マッチしたシーケンス中で個別にマッチしたシーケンスをあらわす、3つの値のリストを返します。それぞれの値は <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> という形式であらわされ、<code class="docutils literal"><span class="pre">a[i:i+n]</span> <span class="pre">==</span> <span class="pre">b[j:j+n]</span></code> という関係を意味します。3つの値は <em>i</em> と <em>j</em> の間で単調に増加します。</p>
<p>最後のタプルはダミーで、<code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> という値を持ちます。これは <code class="docutils literal"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">0</span></code> である唯一のタプルです。もし <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> と <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">n')</span></code> がリストで並んでいる3つ組で、2つ目が最後の3つ組でなければ、<code class="docutils literal"><span class="pre">i+n</span> <span class="pre">!=</span> <span class="pre">i'</span></code> または <code class="docutils literal"><span class="pre">j+n</span> <span class="pre">!=</span> <span class="pre">j'</span></code> です。言い換えると並んでいる3つ組は常に隣接していない同じブロックを表しています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abxcd"</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">()</span>
<span class="go">[Match(a=0, b=0, size=2), Match(a=3, b=2, size=2), Match(a=5, b=4, size=0)]</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_opcodes">
<code class="descname">get_opcodes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> を <em>b</em> にするための方法を記述する5つのタプルを返します。それぞれのタプルは <code class="docutils literal"><span class="pre">(tag,</span> <span class="pre">i1,</span> <span class="pre">i2,</span> <span class="pre">j1,</span> <span class="pre">j2)</span></code> という形式であらわされます。最初のタプルは <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">j1</span> <span class="pre">==</span> <span class="pre">0</span></code> であり、<em>i1</em> はその前にあるタプルの <em>i2</em> と同じ値です。同様に <em>j1</em> は前の <em>j2</em> と同じ値になります。</p>
<p><em>tag</em> の値は文字列であり、次のような意味です:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%"/>
<col width="75%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'replace'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は <code class="docutils literal"><span class="pre">b[j1:j2]</span></code> に置き換えられる。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'delete'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は削除される。この時、<code class="docutils literal"><span class="pre">j1</span> <span class="pre">==</span> <span class="pre">j2</span></code> である。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'insert'</span></code></td>
<td><code class="docutils literal"><span class="pre">b[j1:j2]</span></code> が <code class="docutils literal"><span class="pre">a[i1:i1]</span></code> に挿入される。この時 <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">i2</span></code> である。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'equal'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span> <span class="pre">==</span> <span class="pre">b[j1:j2]</span></code> (サブシーケンスは等しい).</td>
</tr>
</tbody>
</table>
<p>例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="s2">"qabxcd"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="s2">"abycdf"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{:7}</span><span class="s1">   a[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] --&gt; b[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] </span><span class="si">{!r:&gt;8}</span><span class="s1"> --&gt; </span><span class="si">{!r}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">]))</span>
<span class="go">delete    a[0:1] --&gt; b[0:0]      'q' --&gt; ''</span>
<span class="go">equal     a[1:3] --&gt; b[0:2]     'ab' --&gt; 'ab'</span>
<span class="go">replace   a[3:4] --&gt; b[2:3]      'x' --&gt; 'y'</span>
<span class="go">equal     a[4:6] --&gt; b[3:5]     'cd' --&gt; 'cd'</span>
<span class="go">insert    a[6:6] --&gt; b[5:6]       '' --&gt; 'f'</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_grouped_opcodes">
<code class="descname">get_grouped_opcodes</code><span class="sig-paren">(</span><em>n=3</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_grouped_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>最大 <em>n</em> 行までのコンテクストを含むグループを生成するような、ジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)を返します。</p>
<p>このメソッドは、 <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> で返されるグループの中から、似たような差異のかたまりに分け、間に挟まっている変更の無い部分を省きます。</p>
<p>グループは <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> と同じ書式で返されます。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.ratio">
<code class="descname">ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>[0, 1] の範囲の浮動小数点数で、シーケンスの類似度を測る値を返します。</p>
<p>T が2つのシーケンスの要素数の総計だと仮定し、M をマッチした数とすると、この値は 2.0*M / T であらわされます。もしシーケンスがまったく同じ場合、値は <code class="docutils literal"><span class="pre">1.0</span></code> となり、まったく異なる場合には <code class="docutils literal"><span class="pre">0.0</span></code> となります。</p>
<p>このメソッドは <a class="reference internal" href="#difflib.SequenceMatcher.get_matching_blocks" title="difflib.SequenceMatcher.get_matching_blocks"><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> がまだ呼び出されていない場合には非常にコストが高いです。この場合、上限を素早く計算するために、 <a class="reference internal" href="#difflib.SequenceMatcher.quick_ratio" title="difflib.SequenceMatcher.quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code></a> もしくは <a class="reference internal" href="#difflib.SequenceMatcher.real_quick_ratio" title="difflib.SequenceMatcher.real_quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code></a> を最初に試してみる方がいいかもしれません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.quick_ratio">
<code class="descname">quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、より高速に計算します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.real_quick_ratio">
<code class="descname">real_quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.real_quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、非常に高速に計算します。</p>
</dd></dl>
</dd></dl>
<p>この文字列全体のマッチ率を返す3つのメソッドは、精度の異なる近似値を返します。 <code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code> と <code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code> は、常に <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> 以上の値を返します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">,</span> <span class="s2">"bcde"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">quick_ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">real_quick_ratio</span><span class="p">()</span>
<span class="go">1.0</span>
</pre></div>
</div>
</div>
<div class="section" id="sequencematcher-examples">
<span id="id1"></span><h2>6.3.2. SequenceMatcher の例<a class="headerlink" href="#sequencematcher-examples" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は2つの文字列を比較します。空白を "junk" とします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">" "</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private Thread currentThread;"</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private volatile Thread currentThread;"</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> は、[0, 1] の範囲の値を返し、シーケンスの類似度を測ります。経験によると、 <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> の値が0.6を超えると、シーケンスがよく似ていることを示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="go">0.866</span>
</pre></div>
</div>
<p>シーケンスのどこがマッチしているかにだけ興味のある時には <code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が手軽でしょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"a[</span><span class="si">%d</span><span class="s2">] and b[</span><span class="si">%d</span><span class="s2">] match for </span><span class="si">%d</span><span class="s2"> elements"</span> <span class="o">%</span> <span class="n">block</span><span class="p">)</span>
<span class="go">a[0] and b[0] match for 8 elements</span>
<span class="go">a[8] and b[17] match for 21 elements</span>
<span class="go">a[29] and b[38] match for 0 elements</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が返す最後のタプルが常にダミーであることに注目してください。このダミーは <code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> であり、これはタプルの最後の要素（マッチする要素の数）が <code class="docutils literal"><span class="pre">0</span></code> となる唯一のケースです。</p>
<p>はじめのシーケンスがどのようにして2番目のものになるのかを知るには、 <code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code> を使います:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%6s</span><span class="s2"> a[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">] b[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">]"</span> <span class="o">%</span> <span class="n">opcode</span><span class="p">)</span>
<span class="go"> equal a[0:8] b[0:8]</span>
<span class="go">insert a[8:8] b[8:17]</span>
<span class="go"> equal a[8:29] b[17:38]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<ul class="last simple">
<li><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> を使った、シンプルで使えるコードを知るには、このモジュールの関数 <a class="reference internal" href="#difflib.get_close_matches" title="difflib.get_close_matches"><code class="xref py py-func docutils literal"><span class="pre">get_close_matches()</span></code></a> を参照してください。</li>
<li><a class="reference external" href="https://code.activestate.com/recipes/576729/">Simple version control recipe</a> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> で作った小規模アプリケーション。</li>
</ul>
</div>
</div>
<div class="section" id="differ-objects">
<span id="id2"></span><h2>6.3.3. Differ オブジェクト<a class="headerlink" href="#differ-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトによって生成された差分が <strong>最小</strong> であるなどとは言いません。むしろ、最小の差分はしばしば直観に反しています。その理由は、どこでもできるとなれば一致を見いだしてしまうからで、ときには思いがけなく100ページも離れたマッチになってしまうのです。一致点を互いに隣接したマッチに制限することで、場合によって長めの差分を出力するというコストを掛けることにはなっても、ある種の局所性を保つことができるのです。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> は、以下のようなコンストラクタを持ちます:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><span class="sig-paren">(</span><em>linejunk=None</em>, <em>charjunk=None</em><span class="sig-paren">)</span></dt>
<dd><p>オプションのキーワードパラメータ <em>linejunk</em> と <em>charjunk</em> は、フィルタ関数を渡します (使わないときは <code class="docutils literal"><span class="pre">None</span></code>):</p>
<p><em>linejunk</em>: ひとつの文字列引数を受け取る関数です。文字列が junk のときに真を返します。デフォルトでは、<code class="docutils literal"><span class="pre">None</span></code> であり、どんな行であっても junk とは見なされません。</p>
<p><em>charjunk</em>: この関数は文字(長さ1の文字列)を引数として受け取り、文字が junk であるときに真を返します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> であり、どんな文字も junk とは見なされません。</p>
<p>これらの junk フィルター関数により、差分を発見するマッチングが高速化し、差分の行や文字が無視されることがなくなります。説明については、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> メソッドの <em>isjunk</em> 引数の説明をご覧ください。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトは、以下の1つのメソッドを通して利用されます。（差分を生成します）:</p>
<dl class="method">
<dt id="difflib.Differ.compare">
<code class="descname">compare</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.Differ.compare" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>文字列からなる2つのシーケンスを比較し、差分（を表す文字列からなるシーケンス）を生成します。</p>
<p>各シーケンスの要素は、改行で終わる独立した単一行からなる文字列でなければなりません。そのようなシーケンスは、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code></a> メソッドによって得ることができます。（得られる）差分は改行文字で終了する文字列のシーケンスとして得られ、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-meth docutils literal"><span class="pre">writelines()</span></code></a> メソッドによって出力できる形になっています。</p>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="differ-example">
<span id="differ-examples"></span><h2>6.3.4. Differ の例<a class="headerlink" href="#differ-example" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下の例は2つのテキストを比較しています。最初に、テキストを行毎に改行で終わる文字列のシーケンスにセットアップします (そのようなシーケンスは、ファイル風オブジェクトの <code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code> メソッドからも得ることができます):</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  2. Explicit is better than implicit.</span>
<span class="gp">... </span><span class="s1">  3. Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complex is better than complicated.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">'\n'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text2</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  3.   Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complicated is better than complex.</span>
<span class="gp">... </span><span class="s1">  5. Flat is better than nested.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>次に Differ オブジェクトをインスタンス化します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Differ</span><span class="p">()</span>
</pre></div>
</div>
<p>注意:  <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトをインスタンス化するとき、行 junk と文字 junk をフィルタリングする関数を渡すことができます。詳細は <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-meth docutils literal"><span class="pre">Differ()</span></code></a> コンストラクタを参照してください。</p>
<p>最後に、2つを比較します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">result</span></code> は文字列のリストなので、pretty-printしてみましょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">['    1. Beautiful is better than ugly.\n',</span>
<span class="go"> '-   2. Explicit is better than implicit.\n',</span>
<span class="go"> '-   3. Simple is better than complex.\n',</span>
<span class="go"> '+   3.   Simple is better than complex.\n',</span>
<span class="go"> '?     ++\n',</span>
<span class="go"> '-   4. Complex is better than complicated.\n',</span>
<span class="go"> '?            ^                     ---- ^\n',</span>
<span class="go"> '+   4. Complicated is better than complex.\n',</span>
<span class="go"> '?           ++++ ^                      ^\n',</span>
<span class="go"> '+   5. Flat is better than nested.\n']</span>
</pre></div>
</div>
<p>これは、複数行の文字列として、次のように出力されます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">    1. Beautiful is better than ugly.</span>
<span class="go">-   2. Explicit is better than implicit.</span>
<span class="go">-   3. Simple is better than complex.</span>
<span class="go">+   3.   Simple is better than complex.</span>
<span class="go">?     ++</span>
<span class="go">-   4. Complex is better than complicated.</span>
<span class="go">?            ^                     ---- ^</span>
<span class="go">+   4. Complicated is better than complex.</span>
<span class="go">?           ++++ ^                      ^</span>
<span class="go">+   5. Flat is better than nested.</span>
</pre></div>
</div>
</div>
<div class="section" id="a-command-line-interface-to-difflib">
<span id="difflib-interface"></span><h2>6.3.5. difflib のコマンドラインインタフェース<a class="headerlink" href="#a-command-line-interface-to-difflib" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は、 difflib を使って <code class="docutils literal"><span class="pre">diff</span></code> に似たユーティリティーを作成する方法を示します。これは、 Python のソース配布物にも、 <code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> として含まれています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">""" Command line interface to difflib.py providing diffs in four formats:</span>

<span class="sd">* ndiff:    lists every line and highlights interline changes.</span>
<span class="sd">* context:  highlights clusters of changes in a before/after format.</span>
<span class="sd">* unified:  highlights clusters of changes in an inline format.</span>
<span class="sd">* html:     generates side by side comparison with change highlights.</span>

<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">difflib</span><span class="o">,</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="k">def</span> <span class="nf">file_mtime</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span>
                               <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a context format diff (default)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-u'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a unified format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-m'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce HTML side by side diff '</span>
                             <span class="s1">'(can use -c and -l in conjunction)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-n'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a ndiff format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-l'</span><span class="p">,</span> <span class="s1">'--lines'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Set number of context lines (default 3)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'fromfile'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'tofile'</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">lines</span>
    <span class="n">fromfile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">fromfile</span>
    <span class="n">tofile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">tofile</span>

    <span class="n">fromdate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span>
    <span class="n">todate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">fromlines</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
        <span class="n">tolines</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">u</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">m</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">HtmlDiff</span><span class="p">()</span><span class="o">.</span><span class="n">make_file</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span><span class="n">tolines</span><span class="p">,</span><span class="n">fromfile</span><span class="p">,</span><span class="n">tofile</span><span class="p">,</span><span class="n">context</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">numlines</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">context_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div aria-label="main navigation" class="sphinxsidebar" role="navigation">
<div class="sphinxsidebarwrapper">
<h3><a href="../contents.html">目次</a></h3>
<ul>
<li><a class="reference internal" href="#">6.3. <code class="docutils literal"><span class="pre">difflib</span></code>  差分の計算を助ける</a><ul>
<li><a class="reference internal" href="#sequencematcher-objects">6.3.1. SequenceMatcherオブジェクト</a></li>
<li><a class="reference internal" href="#sequencematcher-examples">6.3.2. SequenceMatcher の例</a></li>
<li><a class="reference internal" href="#differ-objects">6.3.3. Differ オブジェクト</a></li>
<li><a class="reference internal" href="#differ-example">6.3.4. Differ の例</a></li>
<li><a class="reference internal" href="#a-command-line-interface-to-difflib">6.3.5. difflib のコマンドラインインタフェース</a></li>
</ul>
</li>
</ul>
<h4>前のトピックへ</h4>
<p class="topless"><a href="re.html" title="前の章へ">6.2. <code class="docutils literal"><span class="pre">re</span></code>  正規表現操作</a></p>
<h4>次のトピックへ</h4>
<p class="topless"><a href="textwrap.html" title="次の章へ">6.4. <code class="docutils literal"><span class="pre">textwrap</span></code>  テキストの折り返しと詰め込み</a></p>
<div aria-label="source link" role="note">
<h3>このページ</h3>
<ul class="this-page-menu">
<li><a href="../bugs.html">バグ報告</a></li>
<li>
<a href="https://github.com/python/cpython/blob/3.6/Doc/library/difflib.rst" rel="nofollow">ソースの表示
        </a>
</li>
</ul>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="footer">
     <a href="../copyright.html">Copyright</a> 2001-2018, Python Software Foundation.
    <br/>
    Python Software Foundation は非営利団体です。
    <a href="https://www.python.org/psf/donations/">寄付</a>
<br/>
    最終更新日時: 7月 29, 2018
    <a href="../bugs.html">バグを見つけたら</a>?
    <br/>
    このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.5 を使って作成されました。
    </div>
</body>
</head></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="ja" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>6.3. difflib  差分の計算を助ける  Python 3.6.5 ドキュメント</title>
<link href="../_static/pydoctheme.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
<script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/underscore.js" type="text/javascript"></script>
<script src="../_static/doctools.js" type="text/javascript"></script>
<script src="../_static/translations.js" type="text/javascript"></script>
<script src="../_static/sidebar.js" type="text/javascript"></script>
<link href="../_static/opensearch.xml" rel="search" title="Python 3.6.5 ドキュメント 内を検索" type="application/opensearchdescription+xml"/>
<link href="../about.html" rel="author" title="このドキュメントについて"/>
<link href="../genindex.html" rel="index" title="索引"/>
<link href="../search.html" rel="search" title="検索"/>
<link href="../copyright.html" rel="copyright" title="Copyright"/>
<link href="textwrap.html" rel="next" title="6.4. textwrap  テキストの折り返しと詰め込み"/>
<link href="re.html" rel="prev" title="6.2. re  正規表現操作"/>
<link href="../_static/py.png" rel="shortcut icon" type="image/png"/>
<link href="https://docs.python.jp/3/library/difflib.html" rel="canonical"/><script type="text/javascript">
    $(document).ready(function() {
      var base = 'https://docs.python.org/3.6/library/difflib.html';
      $('a.headerlink').each(function() {
        var html = '<a href="' + base + $(this).attr('href') +
                   '" title="原文へのリンク"><small>(原文)</small></a>';
        $(this).after(html);
      })
    });
    </script>
<script src="../_static/copybutton.js" type="text/javascript"></script>
<script src="../_static/version_switch.js" type="text/javascript"></script>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-34175846-1', 'python.jp');
        ga('send', 'pageview');

      </script>
<body>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a accesskey="I" href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a accesskey="N" href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a accesskey="P" href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a accesskey="U" href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body" role="main">
<div class="section" id="module-difflib">
<span id="difflib-helpers-for-computing-deltas"></span><h1>6.3. <a class="reference internal" href="#module-difflib" title="difflib: Helpers for computing differences between objects."><code class="xref py py-mod docutils literal"><span class="pre">difflib</span></code></a>  差分の計算を助ける<a class="headerlink" href="#module-difflib" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><strong>ソースコード:</strong> <a class="reference external" href="https://github.com/python/cpython/tree/3.6/Lib/difflib.py">Lib/difflib.py</a></p>
<hr class="docutils"/>
<p>このモジュールは、シーケンスを比較するためのクラスや関数を提供しています。例えば、ファイルの差分を計算して、それを HTML や context diff, unified diff などいろいろなフォーマットで出力するために、このモジュールを利用することができます。ディレクトリやファイル群を比較するためには、 <a class="reference internal" href="filecmp.html#module-filecmp" title="filecmp: Compare files efficiently."><code class="xref py py-mod docutils literal"><span class="pre">filecmp</span></code></a> モジュールも参照してください。</p>
<dl class="class">
<dt id="difflib.SequenceMatcher">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><a class="headerlink" href="#difflib.SequenceMatcher" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>柔軟性のあるクラスで、二つのシーケンスの要素がハッシュ化できる(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)型であれば、どの型の要素を含むシーケンスも比較可能です。基本的なアルゴリズムは、1980年代の後半に発表された Ratcliff と Obershelp による"ゲシュタルトパターンマッチング"と大げさに名づけられたアルゴリズム以前から知られている、やや凝ったアルゴリズムです。その考え方は、"junk" 要素を含まない最も長い互いに隣接したマッチ列を探すことです。ここで、  "junk" 要素とは、空行や空白などの、意味を持たない要素のことです。 (junk を処理するのは、Ratcliff と Obershelp のアルゴリズムに追加された拡張です。)この考え方は、マッチ列の左右に隣接するシーケンスの断片に対して再帰的にあてはめられます。この方法では編集を最小にするシーケンスは生まれませんが、人間の目からみて「正しい感じ」にマッチする傾向があります。</p>
<p><strong>実行時間:</strong> 基本的な Ratcliff-Obershelp アルゴリズムは、最悪の場合3乗、期待値で2乗となります。 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトでは、最悪のケースで2乗、期待値は比較されるシーケンス中に共通に現れる要素数に非常にややこしく依存しています。最良の場合は線形時間になります。</p>
<p><strong>自動 junk ヒューリスティック:</strong> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> は、シーケンスの特定の要素を自動的に junk として扱うヒューリスティックをサポートしています。このヒューリスティックは、各個要素がシーケンス内に何回現れるかを数えます。ある要素の重複数が (最初のものは除いて) 合計でシーケンスの 1% 以上になり、そのシーケンスが 200 要素以上なら、その要素は "popular" であるものとしてマークされ、シーケンスのマッチングの目的からは junk として扱われます。このヒューリスティックは、 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> の作成時に <code class="docutils literal"><span class="pre">autojunk</span></code> パラメタを <code class="docutils literal"><span class="pre">False</span></code> に設定することで無効化できます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
</dd></dl>
<dl class="class">
<dt id="difflib.Differ">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><a class="headerlink" href="#difflib.Differ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>テキスト行からなるシーケンスを比較するクラスです。人が読むことのできる差分を作成します。 Differ クラスは <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスを利用して、行からなるシーケンスを比較したり、(ほぼ)同一の行内の文字を比較したりします。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> クラスによる差分の各行は、2文字のコードで始まります:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%"/>
<col width="81%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">コード</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'-</span> <span class="pre">'</span></code></td>
<td>行はシーケンス1にのみ存在する</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'+</span> <span class="pre">'</span></code></td>
<td>行はシーケンス2にのみ存在する</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'</span> <span class="pre">'</span></code></td>
<td>行は両方のシーケンスで同一</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'?</span> <span class="pre">'</span></code></td>
<td>行は入力シーケンスのどちらにも存在しない</td>
</tr>
</tbody>
</table>
<p>'<code class="docutils literal"><span class="pre">?</span></code>' で始まる行は、行内のどこに差異が存在するかに注意を向けようとします。その行は、入力されたシーケンスのどちらにも存在しません。シーケンスがタブ文字を含むとき、これらの行は判別しづらいものになることがあります。</p>
</dd></dl>
<dl class="class">
<dt id="difflib.HtmlDiff">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">HtmlDiff</code><a class="headerlink" href="#difflib.HtmlDiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このクラスは、二つのテキストを左右に並べて比較表示し、行間あるいは行内の変更点を強調表示するような HTML テーブル (またはテーブルの入った完全な HTML ファイル) を生成するために使います。テーブルは完全差分モード、コンテキスト差分モードのいずれでも生成できます。</p>
<p>このクラスのコンストラクタは以下のようになっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>tabsize=8</em>, <em>wrapcolumn=None</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.__init__" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> のインスタンスを初期化します。</p>
<p><em>tabsize</em> はオプションのキーワード引数で、タブストップ幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">8</span></code> です。</p>
<p><em>wrapcolumn</em> はオプションのキーワード引数で、テキストを折り返すカラム幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> で折り返しを行いません。</p>
<p><em>linejunk</em> および <em>charjunk</em> はオプションのキーワード引数で、 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a>  (<a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> はこの関数を使って左右のテキストの差分を HTML で生成します) に渡されます。それぞれの引数のデフォルト値および説明は <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> のドキュメントを参照してください。</p>
</dd></dl>
<p>以下のメソッドが public になっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.make_file">
<code class="descname">make_file</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em>, <em>*</em>, <em>charset='utf-8'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_file" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った表を持つ完全な HTML ファイルを文字列で返します。</p>
<p><em>fromdesc</em> および <em>todesc</em> はオプションのキーワード引数で、差分表示テーブルにおけるそれぞれ差分元、差分先ファイルのカラムのヘッダになる文字列を指定します (いずれもデフォルト値は空文字列です)。</p>
<p><em>context</em> および <em>numlines</em> はともにオプションのキーワード引数です。<em>context</em> を <code class="docutils literal"><span class="pre">True</span></code> にするとコンテキスト差分を表示し、デフォルトの <code class="docutils literal"><span class="pre">False</span></code> にすると完全なファイル差分を表示します。<em>numlines</em> のデフォルト値は <code class="docutils literal"><span class="pre">5</span></code> で、<em>context</em> が <code class="docutils literal"><span class="pre">True</span></code> の場合、<em>numlines</em> は強調部分の前後にあるコンテキスト行の数を制御します。<em>context</em> が <code class="docutils literal"><span class="pre">False</span></code> の場合、<em>numlines</em> は "next" と書かれたハイパーリンクをたどった時に到達する場所が次の変更部分より何行前にあるかを制御します (値をゼロにした場合、"next" ハイパーリンクを辿ると変更部分の強調表示がブラウザの最上部に表示されるようになります)。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.5 で変更: </span><em>charset</em> キーワード専用引数が追加されました。HTML 文書のデフォルトの文字集合が <code class="docutils literal"><span class="pre">'ISO-8859-1'</span></code> から <code class="docutils literal"><span class="pre">'utf-8'</span></code> に変更されました。</p>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.HtmlDiff.make_table">
<code class="descname">make_table</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った完全な HTML テーブルを文字列で返します。</p>
<p>このメソッドの引数は、 <a class="reference internal" href="#difflib.HtmlDiff.make_file" title="difflib.HtmlDiff.make_file"><code class="xref py py-meth docutils literal"><span class="pre">make_file()</span></code></a> メソッドの引数と同じです。</p>
</dd></dl>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> はこのクラスへのコマンドラインフロントエンドで、使い方を学ぶ上で格好の例題が入っています。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.context_diff">
<code class="descclassname">difflib.</code><code class="descname">context_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.context_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 context diff のフォーマット(以下「コンテクスト形式」)で返します。</p>
<p>コンテクスト形式は、変更があった行に前後数行を加えてある、コンパクトな表現方法です。変更箇所は、変更前/変更後に分けて表します。コンテクスト (変更箇所前後の行) の行数は <em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">***</span></code> や <code class="docutils literal"><span class="pre">---</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">context_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">*** before.py</span>
<span class="go">--- after.py</span>
<span class="go">***************</span>
<span class="go">*** 1,4 ****</span>
<span class="go">! bacon</span>
<span class="go">! eggs</span>
<span class="go">! ham</span>
<span class="go">  guido</span>
<span class="go">--- 1,4 ----</span>
<span class="go">! python</span>
<span class="go">! eggy</span>
<span class="go">! hamster</span>
<span class="go">  guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.get_close_matches">
<code class="descclassname">difflib.</code><code class="descname">get_close_matches</code><span class="sig-paren">(</span><em>word</em>, <em>possibilities</em>, <em>n=3</em>, <em>cutoff=0.6</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.get_close_matches" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>「十分」なマッチの上位のリストを返します。<em>word</em> はマッチさせたいシーケンス (大概は文字列) です。<em>possibilities</em> は <em>word</em> にマッチさせるシーケンスのリスト (大概は文字列のリスト) です。</p>
<p>オプションの引数 <em>n</em> (デフォルトでは <code class="docutils literal"><span class="pre">3</span></code>)はメソッドの返すマッチの最大数です。<em>n</em> は <code class="docutils literal"><span class="pre">0</span></code> より大きくなければなりません。</p>
<p>オプションの引数 <em>cutoff</em> (デフォルトでは <code class="docutils literal"><span class="pre">0.6</span></code>)は、区間 [0, 1] に入る小数の値です。<em>word</em> との一致率がそれ未満の <em>possibilities</em> の要素は無視されます。</p>
<p><em>possibilities</em> の要素でマッチした上位(多くても <em>n</em> 個)は、類似度のスコアに応じて(一番似たものを先頭に)ソートされたリストとして返されます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'appel'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ape'</span><span class="p">,</span> <span class="s1">'apple'</span><span class="p">,</span> <span class="s1">'peach'</span><span class="p">,</span> <span class="s1">'puppy'</span><span class="p">])</span>
<span class="go">['apple', 'ape']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">keyword</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'wheel'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['while']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'pineapple'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'accept'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['except']</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.ndiff">
<code class="descclassname">difflib.</code><code class="descname">ndiff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.ndiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> のスタイルで返します。</p>
<p>オプションのキーワード引数 <em>linejunk</em> と <em>charjunk</em> には、フィルタ関数 (または <code class="docutils literal"><span class="pre">None</span></code>) を渡します。</p>
<p><em>linejunk</em>: 文字列型の引数 1 つを受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは <code class="docutils literal"><span class="pre">None</span></code> です。モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_LINE_JUNK" title="difflib.IS_LINE_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_LINE_JUNK()</span></code></a> は、高々 1 つのシャープ記号(<code class="docutils literal"><span class="pre">'#'</span></code>)を除いて可視の文字を含まない行をフィルタリングするものです。しかし、下層にある <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスが、どの行が雑音となるほど頻繁に登場するかを動的に分析します。このクラスによる分析は、この関数を使用するよりも通常うまく動作します。</p>
<p><em>charjunk</em>: 文字 (長さ1の文字列) を受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは、モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_CHARACTER_JUNK" title="difflib.IS_CHARACTER_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_CHARACTER_JUNK()</span></code></a> であり、これは空白文字類 (空白またはタブ、改行文字をこれに含めてはいけません) をフィルタして排除します。</p>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/ndiff.py</span></code> は、この関数のコマンドラインのフロントエンド（インターフェイス）です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">diff</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">- one</span>
<span class="go">?  ^</span>
<span class="go">+ ore</span>
<span class="go">?  ^</span>
<span class="go">- two</span>
<span class="go">- three</span>
<span class="go">?  -</span>
<span class="go">+ tree</span>
<span class="go">+ emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.restore">
<code class="descclassname">difflib.</code><code class="descname">restore</code><span class="sig-paren">(</span><em>sequence</em>, <em>which</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.restore" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>差分を生成した元の二つのシーケンスのうち一つを返します。</p>
<p><a class="reference internal" href="#difflib.Differ.compare" title="difflib.Differ.compare"><code class="xref py py-meth docutils literal"><span class="pre">Differ.compare()</span></code></a> または <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> によって生成された <em>sequence</em> を与えられると、行頭のプレフィクスを取りのぞいてファイル 1 または 2 (引数 <em>which</em> で指定される) に由来する行を復元します。</p>
<p>例:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="c1"># materialize the generated delta into a list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">one</span>
<span class="go">two</span>
<span class="go">three</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">ore</span>
<span class="go">tree</span>
<span class="go">emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.unified_diff">
<code class="descclassname">difflib.</code><code class="descname">unified_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.unified_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 unified diff フォーマット(以下「ユニファイド形式」)で返します。</p>
<p>ユニファイド形式は変更があった行にコンテキストとなる前後数行を加えた、コンパクトな表現方法です。変更箇所は (変更前/変更後を分離したブロックではなく) インラインスタイルで表されます。コンテクストの行数は、<em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">---</span></code>, <code class="docutils literal"><span class="pre">+++</span></code>, <code class="docutils literal"><span class="pre">@@</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">--- before.py</span>
<span class="go">+++ after.py</span>
<span class="go">@@ -1,4 +1,4 @@</span>
<span class="go">-bacon</span>
<span class="go">-eggs</span>
<span class="go">-ham</span>
<span class="go">+python</span>
<span class="go">+eggy</span>
<span class="go">+hamster</span>
<span class="go"> guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.diff_bytes">
<code class="descclassname">difflib.</code><code class="descname">diff_bytes</code><span class="sig-paren">(</span><em>dfunc</em>, <em>a</em>, <em>b</em>, <em>fromfile=b''</em>, <em>tofile=b''</em>, <em>fromfiledate=b''</em>, <em>tofiledate=b''</em>, <em>n=3</em>, <em>lineterm=b'\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.diff_bytes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>dfunc</em> を使用して <em>a</em> と <em>b</em> (bytes オブジェクトのリスト) を比較して、差分形式の行 (これも bytes オブジェクトです) を*dfunc* の戻り値の形式で返します。<em>dfunc</em> は、呼び出し可能である必要があります。一般に、これは <a class="reference internal" href="#difflib.unified_diff" title="difflib.unified_diff"><code class="xref py py-func docutils literal"><span class="pre">unified_diff()</span></code></a> または <a class="reference internal" href="#difflib.context_diff" title="difflib.context_diff"><code class="xref py py-func docutils literal"><span class="pre">context_diff()</span></code></a> です。</p>
<p>未知のエンコーディングまたは一貫性のないエンコーディングのデータ同士を比較できます。<em>n</em> 以外のすべての入力は、bytes オブジェクトである必要があります。<em>n</em> 以外のすべての入力を損失なく str に変換して、<code class="docutils literal"><span class="pre">dfunc(a,</span> <span class="pre">b,</span> <span class="pre">fromfile,</span> <span class="pre">tofile,</span> <span class="pre">fromfiledate,</span> <span class="pre">tofiledate,</span> <span class="pre">n,</span> <span class="pre">lineterm)</span></code> を呼び出すことにより動作します。<em>dfunc</em> の出力は、bytes 型に変換されます。これにより、受け取る差分形式の行のエンコーディングは、<em>a</em> と <em>b</em> の未知または一貫性のないエンコーディングと同一になります。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_LINE_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_LINE_JUNK</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_LINE_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる行のとき真を返します。行 <em>line</em> は空白、または  <code class="docutils literal"><span class="pre">'#'</span></code> ひとつのときに無視できます。それ以外のときには無視できません。古いバージョンでは <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>linejunk</em> にデフォルトで使用されました。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_CHARACTER_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_CHARACTER_JUNK</code><span class="sig-paren">(</span><em>ch</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_CHARACTER_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる文字のとき真を返します。文字 <em>ch</em> が空白、またはタブ文字のときには無視できます。それ以外の時には無視できません。 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>charjunk</em> としてデフォルトで使用されます。</p>
</dd></dl>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><a class="reference external" href="http://www.drdobbs.com/database/pattern-matching-the-gestalt-approach/184407970">Pattern Matching: The Gestalt Approach</a></dt>
<dd>John W. Ratcliff と D. E. Metzener による類似のアルゴリズムに関する議論。<a class="reference external" href="http://www.drdobbs.com/">Dr. Dobb’s Journal</a> 1988年7月号掲載。</dd>
</dl>
</div>
<div class="section" id="sequencematcher-objects">
<span id="sequence-matcher"></span><h2>6.3.1. SequenceMatcherオブジェクト<a class="headerlink" href="#sequencematcher-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスには、以下のようなコンストラクタがあります:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><span class="sig-paren">(</span><em>isjunk=None</em>, <em>a=''</em>, <em>b=''</em>, <em>autojunk=True</em><span class="sig-paren">)</span></dt>
<dd><p>オプションの引数 <em>isjunk</em> は、<code class="docutils literal"><span class="pre">None</span></code> (デフォルトの値です) にするか、単一の引数をとる関数でなければなりません。後者の場合、関数はシーケンスの要素を受け取り、要素が junk であり、無視すべきである場合に限り真を返すようにしなければなりません。<em>isjunk</em> に <code class="docutils literal"><span class="pre">None</span></code> を渡すと、<code class="docutils literal"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">0</span></code> を渡したのと同じになります; すなわち、いかなる要素も無視しなくなります。例えば以下のような引数を渡すと:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">" </span><span class="se">\t</span><span class="s2">"</span>
</pre></div>
</div>
<p>空白とタブ文字を無視して文字のシーケンスを比較します。</p>
<p>オプションの引数 <em>a</em> と <em>b</em> は、比較される文字列で、デフォルトでは空の文字列です。両方のシーケンスの要素は、ハッシュ化可能(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)である必要があります。</p>
<p>オプションの引数 <em>autojunk</em> は、自動 junk ヒューリスティックを無効にするために使えます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
<p>SequenceMatcher オブジェクトは3つのデータ属性を持っています: <em>bjunk</em> は、 <em>isjunk</em> が <code class="docutils literal"><span class="pre">True</span></code> であるような <em>b</em> の要素の集合です; <em>bpopular</em> は、 (無効でなければ) ヒューリスティックによって popular であると考えられる非ジャンク要素の集合です; <em>b2j</em> は、 <em>b</em> の残りの要素をそれらが生じる位置のリストに写像する dict です。この 3 つは <a class="reference internal" href="#difflib.SequenceMatcher.set_seqs" title="difflib.SequenceMatcher.set_seqs"><code class="xref py py-meth docutils literal"><span class="pre">set_seqs()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> で <em>b</em> がリセットされる場合は常にリセットされます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>bjunk</em> および <em>bpopular</em> 属性。</p>
</div>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは以下のメソッドを持ちます:</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seqs">
<code class="descname">set_seqs</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seqs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較される2つの文字列を設定します。</p>
</dd></dl>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは、2つ目のシーケンスについての詳細な情報を計算し、キャッシュします。 1つのシーケンスをいくつものシーケンスと比較する場合、まず <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> を使って文字列を設定しておき、別の文字列を1つずつ比較するために、繰り返し <a class="reference internal" href="#difflib.SequenceMatcher.set_seq1" title="difflib.SequenceMatcher.set_seq1"><code class="xref py py-meth docutils literal"><span class="pre">set_seq1()</span></code></a> を呼び出します。</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq1">
<code class="descname">set_seq1</code><span class="sig-paren">(</span><em>a</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq1" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う1つ目のシーケンスを設定します。比較される2つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq2">
<code class="descname">set_seq2</code><span class="sig-paren">(</span><em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq2" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う2つ目のシーケンスを設定します。比較される1つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.find_longest_match">
<code class="descname">find_longest_match</code><span class="sig-paren">(</span><em>alo</em>, <em>ahi</em>, <em>blo</em>, <em>bhi</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.find_longest_match" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">a[alo:ahi]</span></code> と <code class="docutils literal"><span class="pre">b[blo:bhi]</span></code> の中から、最長のマッチ列を探します。</p>
<p><em>isjunk</em> が省略されたか <code class="docutils literal"><span class="pre">None</span></code> の時、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> は <code class="docutils literal"><span class="pre">a[i:i+k]</span></code> が <code class="docutils literal"><span class="pre">b[j:j+k]</span></code> と等しいような <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">k)</span></code> を返します。その値は <code class="docutils literal"><span class="pre">alo</span> <span class="pre">&lt;=</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i+k</span> <span class="pre">&lt;=</span> <span class="pre">ahi</span></code> かつ <code class="docutils literal"><span class="pre">blo</span> <span class="pre">&lt;=</span> <span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j+k</span> <span class="pre">&lt;=</span> <span class="pre">bhi</span></code> となります。 <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">k')</span></code> でも、同じようになります。さらに <code class="docutils literal"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">k'</span></code>, <code class="docutils literal"><span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i'</span></code> が <code class="docutils literal"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">i'</span></code>, <code class="docutils literal"><span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j'</span></code> でも同様です。言い換えると、いくつものマッチ列すべてのうち、 <em>a</em> 内で最初に始まるものを返します。そしてその <em>a</em> 内で最初のマッチ列すべてのうち <em>b</em> 内で最初に始まるものを返します。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=0, b=4, size=5)</span>
</pre></div>
</div>
<p>引数 <em>isjunk</em> が与えられている場合、上記の通り、はじめに最長のマッチ列を判定します。ブロック内に junk 要素が見当たらないような追加条件の際はこれに該当しません。次にそのマッチ列を、その両側の junk 要素にマッチするよう、できる限り広げていきます。そのため結果となる列は、探している列のたまたま直前にあった同一の junk 以外の junk にはマッチしません。</p>
<p>以下は前と同じサンプルですが、空白を junk とみなしています。これは <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> が2つ目の列の末尾にある <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> にマッチしないようにしています。代わりに <code class="docutils literal"><span class="pre">'abcd'</span></code> にはマッチします。そして 2つ目の文字列中、一番左の <code class="docutils literal"><span class="pre">'abcd'</span></code> にマッチします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">==</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=1, b=0, size=4)</span>
</pre></div>
</div>
<p>どんな列にもマッチしない時は、<code class="docutils literal"><span class="pre">(alo,</span> <span class="pre">blo,</span> <span class="pre">0)</span></code> を返します。</p>
<p>このメソッドは <a class="reference internal" href="../glossary.html#term-named-tuple"><span class="xref std std-term">named tuple</span></a> <code class="docutils literal"><span class="pre">Match(a,</span> <span class="pre">b,</span> <span class="pre">size)</span></code> を返します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_matching_blocks">
<code class="descname">get_matching_blocks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_matching_blocks" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>マッチしたシーケンス中で個別にマッチしたシーケンスをあらわす、3つの値のリストを返します。それぞれの値は <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> という形式であらわされ、<code class="docutils literal"><span class="pre">a[i:i+n]</span> <span class="pre">==</span> <span class="pre">b[j:j+n]</span></code> という関係を意味します。3つの値は <em>i</em> と <em>j</em> の間で単調に増加します。</p>
<p>最後のタプルはダミーで、<code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> という値を持ちます。これは <code class="docutils literal"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">0</span></code> である唯一のタプルです。もし <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> と <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">n')</span></code> がリストで並んでいる3つ組で、2つ目が最後の3つ組でなければ、<code class="docutils literal"><span class="pre">i+n</span> <span class="pre">!=</span> <span class="pre">i'</span></code> または <code class="docutils literal"><span class="pre">j+n</span> <span class="pre">!=</span> <span class="pre">j'</span></code> です。言い換えると並んでいる3つ組は常に隣接していない同じブロックを表しています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abxcd"</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">()</span>
<span class="go">[Match(a=0, b=0, size=2), Match(a=3, b=2, size=2), Match(a=5, b=4, size=0)]</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_opcodes">
<code class="descname">get_opcodes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> を <em>b</em> にするための方法を記述する5つのタプルを返します。それぞれのタプルは <code class="docutils literal"><span class="pre">(tag,</span> <span class="pre">i1,</span> <span class="pre">i2,</span> <span class="pre">j1,</span> <span class="pre">j2)</span></code> という形式であらわされます。最初のタプルは <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">j1</span> <span class="pre">==</span> <span class="pre">0</span></code> であり、<em>i1</em> はその前にあるタプルの <em>i2</em> と同じ値です。同様に <em>j1</em> は前の <em>j2</em> と同じ値になります。</p>
<p><em>tag</em> の値は文字列であり、次のような意味です:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%"/>
<col width="75%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'replace'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は <code class="docutils literal"><span class="pre">b[j1:j2]</span></code> に置き換えられる。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'delete'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は削除される。この時、<code class="docutils literal"><span class="pre">j1</span> <span class="pre">==</span> <span class="pre">j2</span></code> である。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'insert'</span></code></td>
<td><code class="docutils literal"><span class="pre">b[j1:j2]</span></code> が <code class="docutils literal"><span class="pre">a[i1:i1]</span></code> に挿入される。この時 <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">i2</span></code> である。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'equal'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span> <span class="pre">==</span> <span class="pre">b[j1:j2]</span></code> (サブシーケンスは等しい).</td>
</tr>
</tbody>
</table>
<p>例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="s2">"qabxcd"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="s2">"abycdf"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{:7}</span><span class="s1">   a[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] --&gt; b[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] </span><span class="si">{!r:&gt;8}</span><span class="s1"> --&gt; </span><span class="si">{!r}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">]))</span>
<span class="go">delete    a[0:1] --&gt; b[0:0]      'q' --&gt; ''</span>
<span class="go">equal     a[1:3] --&gt; b[0:2]     'ab' --&gt; 'ab'</span>
<span class="go">replace   a[3:4] --&gt; b[2:3]      'x' --&gt; 'y'</span>
<span class="go">equal     a[4:6] --&gt; b[3:5]     'cd' --&gt; 'cd'</span>
<span class="go">insert    a[6:6] --&gt; b[5:6]       '' --&gt; 'f'</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_grouped_opcodes">
<code class="descname">get_grouped_opcodes</code><span class="sig-paren">(</span><em>n=3</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_grouped_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>最大 <em>n</em> 行までのコンテクストを含むグループを生成するような、ジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)を返します。</p>
<p>このメソッドは、 <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> で返されるグループの中から、似たような差異のかたまりに分け、間に挟まっている変更の無い部分を省きます。</p>
<p>グループは <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> と同じ書式で返されます。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.ratio">
<code class="descname">ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>[0, 1] の範囲の浮動小数点数で、シーケンスの類似度を測る値を返します。</p>
<p>T が2つのシーケンスの要素数の総計だと仮定し、M をマッチした数とすると、この値は 2.0*M / T であらわされます。もしシーケンスがまったく同じ場合、値は <code class="docutils literal"><span class="pre">1.0</span></code> となり、まったく異なる場合には <code class="docutils literal"><span class="pre">0.0</span></code> となります。</p>
<p>このメソッドは <a class="reference internal" href="#difflib.SequenceMatcher.get_matching_blocks" title="difflib.SequenceMatcher.get_matching_blocks"><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> がまだ呼び出されていない場合には非常にコストが高いです。この場合、上限を素早く計算するために、 <a class="reference internal" href="#difflib.SequenceMatcher.quick_ratio" title="difflib.SequenceMatcher.quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code></a> もしくは <a class="reference internal" href="#difflib.SequenceMatcher.real_quick_ratio" title="difflib.SequenceMatcher.real_quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code></a> を最初に試してみる方がいいかもしれません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.quick_ratio">
<code class="descname">quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、より高速に計算します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.real_quick_ratio">
<code class="descname">real_quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.real_quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、非常に高速に計算します。</p>
</dd></dl>
</dd></dl>
<p>この文字列全体のマッチ率を返す3つのメソッドは、精度の異なる近似値を返します。 <code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code> と <code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code> は、常に <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> 以上の値を返します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">,</span> <span class="s2">"bcde"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">quick_ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">real_quick_ratio</span><span class="p">()</span>
<span class="go">1.0</span>
</pre></div>
</div>
</div>
<div class="section" id="sequencematcher-examples">
<span id="id1"></span><h2>6.3.2. SequenceMatcher の例<a class="headerlink" href="#sequencematcher-examples" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は2つの文字列を比較します。空白を "junk" とします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">" "</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private Thread currentThread;"</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private volatile Thread currentThread;"</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> は、[0, 1] の範囲の値を返し、シーケンスの類似度を測ります。経験によると、 <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> の値が0.6を超えると、シーケンスがよく似ていることを示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="go">0.866</span>
</pre></div>
</div>
<p>シーケンスのどこがマッチしているかにだけ興味のある時には <code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が手軽でしょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"a[</span><span class="si">%d</span><span class="s2">] and b[</span><span class="si">%d</span><span class="s2">] match for </span><span class="si">%d</span><span class="s2"> elements"</span> <span class="o">%</span> <span class="n">block</span><span class="p">)</span>
<span class="go">a[0] and b[0] match for 8 elements</span>
<span class="go">a[8] and b[17] match for 21 elements</span>
<span class="go">a[29] and b[38] match for 0 elements</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が返す最後のタプルが常にダミーであることに注目してください。このダミーは <code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> であり、これはタプルの最後の要素（マッチする要素の数）が <code class="docutils literal"><span class="pre">0</span></code> となる唯一のケースです。</p>
<p>はじめのシーケンスがどのようにして2番目のものになるのかを知るには、 <code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code> を使います:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%6s</span><span class="s2"> a[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">] b[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">]"</span> <span class="o">%</span> <span class="n">opcode</span><span class="p">)</span>
<span class="go"> equal a[0:8] b[0:8]</span>
<span class="go">insert a[8:8] b[8:17]</span>
<span class="go"> equal a[8:29] b[17:38]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<ul class="last simple">
<li><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> を使った、シンプルで使えるコードを知るには、このモジュールの関数 <a class="reference internal" href="#difflib.get_close_matches" title="difflib.get_close_matches"><code class="xref py py-func docutils literal"><span class="pre">get_close_matches()</span></code></a> を参照してください。</li>
<li><a class="reference external" href="https://code.activestate.com/recipes/576729/">Simple version control recipe</a> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> で作った小規模アプリケーション。</li>
</ul>
</div>
</div>
<div class="section" id="differ-objects">
<span id="id2"></span><h2>6.3.3. Differ オブジェクト<a class="headerlink" href="#differ-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトによって生成された差分が <strong>最小</strong> であるなどとは言いません。むしろ、最小の差分はしばしば直観に反しています。その理由は、どこでもできるとなれば一致を見いだしてしまうからで、ときには思いがけなく100ページも離れたマッチになってしまうのです。一致点を互いに隣接したマッチに制限することで、場合によって長めの差分を出力するというコストを掛けることにはなっても、ある種の局所性を保つことができるのです。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> は、以下のようなコンストラクタを持ちます:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><span class="sig-paren">(</span><em>linejunk=None</em>, <em>charjunk=None</em><span class="sig-paren">)</span></dt>
<dd><p>オプションのキーワードパラメータ <em>linejunk</em> と <em>charjunk</em> は、フィルタ関数を渡します (使わないときは <code class="docutils literal"><span class="pre">None</span></code>):</p>
<p><em>linejunk</em>: ひとつの文字列引数を受け取る関数です。文字列が junk のときに真を返します。デフォルトでは、<code class="docutils literal"><span class="pre">None</span></code> であり、どんな行であっても junk とは見なされません。</p>
<p><em>charjunk</em>: この関数は文字(長さ1の文字列)を引数として受け取り、文字が junk であるときに真を返します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> であり、どんな文字も junk とは見なされません。</p>
<p>これらの junk フィルター関数により、差分を発見するマッチングが高速化し、差分の行や文字が無視されることがなくなります。説明については、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> メソッドの <em>isjunk</em> 引数の説明をご覧ください。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトは、以下の1つのメソッドを通して利用されます。（差分を生成します）:</p>
<dl class="method">
<dt id="difflib.Differ.compare">
<code class="descname">compare</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.Differ.compare" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>文字列からなる2つのシーケンスを比較し、差分（を表す文字列からなるシーケンス）を生成します。</p>
<p>各シーケンスの要素は、改行で終わる独立した単一行からなる文字列でなければなりません。そのようなシーケンスは、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code></a> メソッドによって得ることができます。（得られる）差分は改行文字で終了する文字列のシーケンスとして得られ、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-meth docutils literal"><span class="pre">writelines()</span></code></a> メソッドによって出力できる形になっています。</p>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="differ-example">
<span id="differ-examples"></span><h2>6.3.4. Differ の例<a class="headerlink" href="#differ-example" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下の例は2つのテキストを比較しています。最初に、テキストを行毎に改行で終わる文字列のシーケンスにセットアップします (そのようなシーケンスは、ファイル風オブジェクトの <code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code> メソッドからも得ることができます):</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  2. Explicit is better than implicit.</span>
<span class="gp">... </span><span class="s1">  3. Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complex is better than complicated.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">'\n'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text2</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  3.   Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complicated is better than complex.</span>
<span class="gp">... </span><span class="s1">  5. Flat is better than nested.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>次に Differ オブジェクトをインスタンス化します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Differ</span><span class="p">()</span>
</pre></div>
</div>
<p>注意:  <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトをインスタンス化するとき、行 junk と文字 junk をフィルタリングする関数を渡すことができます。詳細は <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-meth docutils literal"><span class="pre">Differ()</span></code></a> コンストラクタを参照してください。</p>
<p>最後に、2つを比較します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">result</span></code> は文字列のリストなので、pretty-printしてみましょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">['    1. Beautiful is better than ugly.\n',</span>
<span class="go"> '-   2. Explicit is better than implicit.\n',</span>
<span class="go"> '-   3. Simple is better than complex.\n',</span>
<span class="go"> '+   3.   Simple is better than complex.\n',</span>
<span class="go"> '?     ++\n',</span>
<span class="go"> '-   4. Complex is better than complicated.\n',</span>
<span class="go"> '?            ^                     ---- ^\n',</span>
<span class="go"> '+   4. Complicated is better than complex.\n',</span>
<span class="go"> '?           ++++ ^                      ^\n',</span>
<span class="go"> '+   5. Flat is better than nested.\n']</span>
</pre></div>
</div>
<p>これは、複数行の文字列として、次のように出力されます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">    1. Beautiful is better than ugly.</span>
<span class="go">-   2. Explicit is better than implicit.</span>
<span class="go">-   3. Simple is better than complex.</span>
<span class="go">+   3.   Simple is better than complex.</span>
<span class="go">?     ++</span>
<span class="go">-   4. Complex is better than complicated.</span>
<span class="go">?            ^                     ---- ^</span>
<span class="go">+   4. Complicated is better than complex.</span>
<span class="go">?           ++++ ^                      ^</span>
<span class="go">+   5. Flat is better than nested.</span>
</pre></div>
</div>
</div>
<div class="section" id="a-command-line-interface-to-difflib">
<span id="difflib-interface"></span><h2>6.3.5. difflib のコマンドラインインタフェース<a class="headerlink" href="#a-command-line-interface-to-difflib" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は、 difflib を使って <code class="docutils literal"><span class="pre">diff</span></code> に似たユーティリティーを作成する方法を示します。これは、 Python のソース配布物にも、 <code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> として含まれています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">""" Command line interface to difflib.py providing diffs in four formats:</span>

<span class="sd">* ndiff:    lists every line and highlights interline changes.</span>
<span class="sd">* context:  highlights clusters of changes in a before/after format.</span>
<span class="sd">* unified:  highlights clusters of changes in an inline format.</span>
<span class="sd">* html:     generates side by side comparison with change highlights.</span>

<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">difflib</span><span class="o">,</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="k">def</span> <span class="nf">file_mtime</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span>
                               <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a context format diff (default)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-u'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a unified format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-m'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce HTML side by side diff '</span>
                             <span class="s1">'(can use -c and -l in conjunction)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-n'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a ndiff format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-l'</span><span class="p">,</span> <span class="s1">'--lines'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Set number of context lines (default 3)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'fromfile'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'tofile'</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">lines</span>
    <span class="n">fromfile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">fromfile</span>
    <span class="n">tofile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">tofile</span>

    <span class="n">fromdate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span>
    <span class="n">todate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">fromlines</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
        <span class="n">tolines</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">u</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">m</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">HtmlDiff</span><span class="p">()</span><span class="o">.</span><span class="n">make_file</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span><span class="n">tolines</span><span class="p">,</span><span class="n">fromfile</span><span class="p">,</span><span class="n">tofile</span><span class="p">,</span><span class="n">context</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">numlines</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">context_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div aria-label="main navigation" class="sphinxsidebar" role="navigation">
<div class="sphinxsidebarwrapper">
<h3><a href="../contents.html">目次</a></h3>
<ul>
<li><a class="reference internal" href="#">6.3. <code class="docutils literal"><span class="pre">difflib</span></code>  差分の計算を助ける</a><ul>
<li><a class="reference internal" href="#sequencematcher-objects">6.3.1. SequenceMatcherオブジェクト</a></li>
<li><a class="reference internal" href="#sequencematcher-examples">6.3.2. SequenceMatcher の例</a></li>
<li><a class="reference internal" href="#differ-objects">6.3.3. Differ オブジェクト</a></li>
<li><a class="reference internal" href="#differ-example">6.3.4. Differ の例</a></li>
<li><a class="reference internal" href="#a-command-line-interface-to-difflib">6.3.5. difflib のコマンドラインインタフェース</a></li>
</ul>
</li>
</ul>
<h4>前のトピックへ</h4>
<p class="topless"><a href="re.html" title="前の章へ">6.2. <code class="docutils literal"><span class="pre">re</span></code>  正規表現操作</a></p>
<h4>次のトピックへ</h4>
<p class="topless"><a href="textwrap.html" title="次の章へ">6.4. <code class="docutils literal"><span class="pre">textwrap</span></code>  テキストの折り返しと詰め込み</a></p>
<div aria-label="source link" role="note">
<h3>このページ</h3>
<ul class="this-page-menu">
<li><a href="../bugs.html">バグ報告</a></li>
<li>
<a href="https://github.com/python/cpython/blob/3.6/Doc/library/difflib.rst" rel="nofollow">ソースの表示
        </a>
</li>
</ul>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="footer">
     <a href="../copyright.html">Copyright</a> 2001-2018, Python Software Foundation.
    <br/>
    Python Software Foundation は非営利団体です。
    <a href="https://www.python.org/psf/donations/">寄付</a>
<br/>
    最終更新日時: 7月 29, 2018
    <a href="../bugs.html">バグを見つけたら</a>?
    <br/>
    このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.5 を使って作成されました。
    </div>
</body>
</head></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="ja" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>6.3. difflib  差分の計算を助ける  Python 3.6.5 ドキュメント</title>
<link href="../_static/pydoctheme.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
<script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/underscore.js" type="text/javascript"></script>
<script src="../_static/doctools.js" type="text/javascript"></script>
<script src="../_static/translations.js" type="text/javascript"></script>
<script src="../_static/sidebar.js" type="text/javascript"></script>
<link href="../_static/opensearch.xml" rel="search" title="Python 3.6.5 ドキュメント 内を検索" type="application/opensearchdescription+xml"/>
<link href="../about.html" rel="author" title="このドキュメントについて"/>
<link href="../genindex.html" rel="index" title="索引"/>
<link href="../search.html" rel="search" title="検索"/>
<link href="../copyright.html" rel="copyright" title="Copyright"/>
<link href="textwrap.html" rel="next" title="6.4. textwrap  テキストの折り返しと詰め込み"/>
<link href="re.html" rel="prev" title="6.2. re  正規表現操作"/>
<link href="../_static/py.png" rel="shortcut icon" type="image/png"/>
<link href="https://docs.python.jp/3/library/difflib.html" rel="canonical"/><script type="text/javascript">
    $(document).ready(function() {
      var base = 'https://docs.python.org/3.6/library/difflib.html';
      $('a.headerlink').each(function() {
        var html = '<a href="' + base + $(this).attr('href') +
                   '" title="原文へのリンク"><small>(原文)</small></a>';
        $(this).after(html);
      })
    });
    </script>
<script src="../_static/copybutton.js" type="text/javascript"></script>
<script src="../_static/version_switch.js" type="text/javascript"></script>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-34175846-1', 'python.jp');
        ga('send', 'pageview');

      </script>
<body>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a accesskey="I" href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a accesskey="N" href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a accesskey="P" href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a accesskey="U" href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body" role="main">
<div class="section" id="module-difflib">
<span id="difflib-helpers-for-computing-deltas"></span><h1>6.3. <a class="reference internal" href="#module-difflib" title="difflib: Helpers for computing differences between objects."><code class="xref py py-mod docutils literal"><span class="pre">difflib</span></code></a>  差分の計算を助ける<a class="headerlink" href="#module-difflib" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><strong>ソースコード:</strong> <a class="reference external" href="https://github.com/python/cpython/tree/3.6/Lib/difflib.py">Lib/difflib.py</a></p>
<hr class="docutils"/>
<p>このモジュールは、シーケンスを比較するためのクラスや関数を提供しています。例えば、ファイルの差分を計算して、それを HTML や context diff, unified diff などいろいろなフォーマットで出力するために、このモジュールを利用することができます。ディレクトリやファイル群を比較するためには、 <a class="reference internal" href="filecmp.html#module-filecmp" title="filecmp: Compare files efficiently."><code class="xref py py-mod docutils literal"><span class="pre">filecmp</span></code></a> モジュールも参照してください。</p>
<dl class="class">
<dt id="difflib.SequenceMatcher">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><a class="headerlink" href="#difflib.SequenceMatcher" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>柔軟性のあるクラスで、二つのシーケンスの要素がハッシュ化できる(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)型であれば、どの型の要素を含むシーケンスも比較可能です。基本的なアルゴリズムは、1980年代の後半に発表された Ratcliff と Obershelp による"ゲシュタルトパターンマッチング"と大げさに名づけられたアルゴリズム以前から知られている、やや凝ったアルゴリズムです。その考え方は、"junk" 要素を含まない最も長い互いに隣接したマッチ列を探すことです。ここで、  "junk" 要素とは、空行や空白などの、意味を持たない要素のことです。 (junk を処理するのは、Ratcliff と Obershelp のアルゴリズムに追加された拡張です。)この考え方は、マッチ列の左右に隣接するシーケンスの断片に対して再帰的にあてはめられます。この方法では編集を最小にするシーケンスは生まれませんが、人間の目からみて「正しい感じ」にマッチする傾向があります。</p>
<p><strong>実行時間:</strong> 基本的な Ratcliff-Obershelp アルゴリズムは、最悪の場合3乗、期待値で2乗となります。 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトでは、最悪のケースで2乗、期待値は比較されるシーケンス中に共通に現れる要素数に非常にややこしく依存しています。最良の場合は線形時間になります。</p>
<p><strong>自動 junk ヒューリスティック:</strong> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> は、シーケンスの特定の要素を自動的に junk として扱うヒューリスティックをサポートしています。このヒューリスティックは、各個要素がシーケンス内に何回現れるかを数えます。ある要素の重複数が (最初のものは除いて) 合計でシーケンスの 1% 以上になり、そのシーケンスが 200 要素以上なら、その要素は "popular" であるものとしてマークされ、シーケンスのマッチングの目的からは junk として扱われます。このヒューリスティックは、 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> の作成時に <code class="docutils literal"><span class="pre">autojunk</span></code> パラメタを <code class="docutils literal"><span class="pre">False</span></code> に設定することで無効化できます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
</dd></dl>
<dl class="class">
<dt id="difflib.Differ">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><a class="headerlink" href="#difflib.Differ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>テキスト行からなるシーケンスを比較するクラスです。人が読むことのできる差分を作成します。 Differ クラスは <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスを利用して、行からなるシーケンスを比較したり、(ほぼ)同一の行内の文字を比較したりします。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> クラスによる差分の各行は、2文字のコードで始まります:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%"/>
<col width="81%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">コード</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'-</span> <span class="pre">'</span></code></td>
<td>行はシーケンス1にのみ存在する</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'+</span> <span class="pre">'</span></code></td>
<td>行はシーケンス2にのみ存在する</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'</span> <span class="pre">'</span></code></td>
<td>行は両方のシーケンスで同一</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'?</span> <span class="pre">'</span></code></td>
<td>行は入力シーケンスのどちらにも存在しない</td>
</tr>
</tbody>
</table>
<p>'<code class="docutils literal"><span class="pre">?</span></code>' で始まる行は、行内のどこに差異が存在するかに注意を向けようとします。その行は、入力されたシーケンスのどちらにも存在しません。シーケンスがタブ文字を含むとき、これらの行は判別しづらいものになることがあります。</p>
</dd></dl>
<dl class="class">
<dt id="difflib.HtmlDiff">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">HtmlDiff</code><a class="headerlink" href="#difflib.HtmlDiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このクラスは、二つのテキストを左右に並べて比較表示し、行間あるいは行内の変更点を強調表示するような HTML テーブル (またはテーブルの入った完全な HTML ファイル) を生成するために使います。テーブルは完全差分モード、コンテキスト差分モードのいずれでも生成できます。</p>
<p>このクラスのコンストラクタは以下のようになっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>tabsize=8</em>, <em>wrapcolumn=None</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.__init__" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> のインスタンスを初期化します。</p>
<p><em>tabsize</em> はオプションのキーワード引数で、タブストップ幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">8</span></code> です。</p>
<p><em>wrapcolumn</em> はオプションのキーワード引数で、テキストを折り返すカラム幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> で折り返しを行いません。</p>
<p><em>linejunk</em> および <em>charjunk</em> はオプションのキーワード引数で、 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a>  (<a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> はこの関数を使って左右のテキストの差分を HTML で生成します) に渡されます。それぞれの引数のデフォルト値および説明は <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> のドキュメントを参照してください。</p>
</dd></dl>
<p>以下のメソッドが public になっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.make_file">
<code class="descname">make_file</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em>, <em>*</em>, <em>charset='utf-8'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_file" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った表を持つ完全な HTML ファイルを文字列で返します。</p>
<p><em>fromdesc</em> および <em>todesc</em> はオプションのキーワード引数で、差分表示テーブルにおけるそれぞれ差分元、差分先ファイルのカラムのヘッダになる文字列を指定します (いずれもデフォルト値は空文字列です)。</p>
<p><em>context</em> および <em>numlines</em> はともにオプションのキーワード引数です。<em>context</em> を <code class="docutils literal"><span class="pre">True</span></code> にするとコンテキスト差分を表示し、デフォルトの <code class="docutils literal"><span class="pre">False</span></code> にすると完全なファイル差分を表示します。<em>numlines</em> のデフォルト値は <code class="docutils literal"><span class="pre">5</span></code> で、<em>context</em> が <code class="docutils literal"><span class="pre">True</span></code> の場合、<em>numlines</em> は強調部分の前後にあるコンテキスト行の数を制御します。<em>context</em> が <code class="docutils literal"><span class="pre">False</span></code> の場合、<em>numlines</em> は "next" と書かれたハイパーリンクをたどった時に到達する場所が次の変更部分より何行前にあるかを制御します (値をゼロにした場合、"next" ハイパーリンクを辿ると変更部分の強調表示がブラウザの最上部に表示されるようになります)。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.5 で変更: </span><em>charset</em> キーワード専用引数が追加されました。HTML 文書のデフォルトの文字集合が <code class="docutils literal"><span class="pre">'ISO-8859-1'</span></code> から <code class="docutils literal"><span class="pre">'utf-8'</span></code> に変更されました。</p>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.HtmlDiff.make_table">
<code class="descname">make_table</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った完全な HTML テーブルを文字列で返します。</p>
<p>このメソッドの引数は、 <a class="reference internal" href="#difflib.HtmlDiff.make_file" title="difflib.HtmlDiff.make_file"><code class="xref py py-meth docutils literal"><span class="pre">make_file()</span></code></a> メソッドの引数と同じです。</p>
</dd></dl>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> はこのクラスへのコマンドラインフロントエンドで、使い方を学ぶ上で格好の例題が入っています。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.context_diff">
<code class="descclassname">difflib.</code><code class="descname">context_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.context_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 context diff のフォーマット(以下「コンテクスト形式」)で返します。</p>
<p>コンテクスト形式は、変更があった行に前後数行を加えてある、コンパクトな表現方法です。変更箇所は、変更前/変更後に分けて表します。コンテクスト (変更箇所前後の行) の行数は <em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">***</span></code> や <code class="docutils literal"><span class="pre">---</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">context_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">*** before.py</span>
<span class="go">--- after.py</span>
<span class="go">***************</span>
<span class="go">*** 1,4 ****</span>
<span class="go">! bacon</span>
<span class="go">! eggs</span>
<span class="go">! ham</span>
<span class="go">  guido</span>
<span class="go">--- 1,4 ----</span>
<span class="go">! python</span>
<span class="go">! eggy</span>
<span class="go">! hamster</span>
<span class="go">  guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.get_close_matches">
<code class="descclassname">difflib.</code><code class="descname">get_close_matches</code><span class="sig-paren">(</span><em>word</em>, <em>possibilities</em>, <em>n=3</em>, <em>cutoff=0.6</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.get_close_matches" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>「十分」なマッチの上位のリストを返します。<em>word</em> はマッチさせたいシーケンス (大概は文字列) です。<em>possibilities</em> は <em>word</em> にマッチさせるシーケンスのリスト (大概は文字列のリスト) です。</p>
<p>オプションの引数 <em>n</em> (デフォルトでは <code class="docutils literal"><span class="pre">3</span></code>)はメソッドの返すマッチの最大数です。<em>n</em> は <code class="docutils literal"><span class="pre">0</span></code> より大きくなければなりません。</p>
<p>オプションの引数 <em>cutoff</em> (デフォルトでは <code class="docutils literal"><span class="pre">0.6</span></code>)は、区間 [0, 1] に入る小数の値です。<em>word</em> との一致率がそれ未満の <em>possibilities</em> の要素は無視されます。</p>
<p><em>possibilities</em> の要素でマッチした上位(多くても <em>n</em> 個)は、類似度のスコアに応じて(一番似たものを先頭に)ソートされたリストとして返されます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'appel'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ape'</span><span class="p">,</span> <span class="s1">'apple'</span><span class="p">,</span> <span class="s1">'peach'</span><span class="p">,</span> <span class="s1">'puppy'</span><span class="p">])</span>
<span class="go">['apple', 'ape']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">keyword</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'wheel'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['while']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'pineapple'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'accept'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['except']</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.ndiff">
<code class="descclassname">difflib.</code><code class="descname">ndiff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.ndiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> のスタイルで返します。</p>
<p>オプションのキーワード引数 <em>linejunk</em> と <em>charjunk</em> には、フィルタ関数 (または <code class="docutils literal"><span class="pre">None</span></code>) を渡します。</p>
<p><em>linejunk</em>: 文字列型の引数 1 つを受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは <code class="docutils literal"><span class="pre">None</span></code> です。モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_LINE_JUNK" title="difflib.IS_LINE_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_LINE_JUNK()</span></code></a> は、高々 1 つのシャープ記号(<code class="docutils literal"><span class="pre">'#'</span></code>)を除いて可視の文字を含まない行をフィルタリングするものです。しかし、下層にある <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスが、どの行が雑音となるほど頻繁に登場するかを動的に分析します。このクラスによる分析は、この関数を使用するよりも通常うまく動作します。</p>
<p><em>charjunk</em>: 文字 (長さ1の文字列) を受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは、モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_CHARACTER_JUNK" title="difflib.IS_CHARACTER_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_CHARACTER_JUNK()</span></code></a> であり、これは空白文字類 (空白またはタブ、改行文字をこれに含めてはいけません) をフィルタして排除します。</p>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/ndiff.py</span></code> は、この関数のコマンドラインのフロントエンド（インターフェイス）です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">diff</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">- one</span>
<span class="go">?  ^</span>
<span class="go">+ ore</span>
<span class="go">?  ^</span>
<span class="go">- two</span>
<span class="go">- three</span>
<span class="go">?  -</span>
<span class="go">+ tree</span>
<span class="go">+ emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.restore">
<code class="descclassname">difflib.</code><code class="descname">restore</code><span class="sig-paren">(</span><em>sequence</em>, <em>which</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.restore" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>差分を生成した元の二つのシーケンスのうち一つを返します。</p>
<p><a class="reference internal" href="#difflib.Differ.compare" title="difflib.Differ.compare"><code class="xref py py-meth docutils literal"><span class="pre">Differ.compare()</span></code></a> または <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> によって生成された <em>sequence</em> を与えられると、行頭のプレフィクスを取りのぞいてファイル 1 または 2 (引数 <em>which</em> で指定される) に由来する行を復元します。</p>
<p>例:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="c1"># materialize the generated delta into a list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">one</span>
<span class="go">two</span>
<span class="go">three</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">ore</span>
<span class="go">tree</span>
<span class="go">emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.unified_diff">
<code class="descclassname">difflib.</code><code class="descname">unified_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.unified_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 unified diff フォーマット(以下「ユニファイド形式」)で返します。</p>
<p>ユニファイド形式は変更があった行にコンテキストとなる前後数行を加えた、コンパクトな表現方法です。変更箇所は (変更前/変更後を分離したブロックではなく) インラインスタイルで表されます。コンテクストの行数は、<em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">---</span></code>, <code class="docutils literal"><span class="pre">+++</span></code>, <code class="docutils literal"><span class="pre">@@</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">--- before.py</span>
<span class="go">+++ after.py</span>
<span class="go">@@ -1,4 +1,4 @@</span>
<span class="go">-bacon</span>
<span class="go">-eggs</span>
<span class="go">-ham</span>
<span class="go">+python</span>
<span class="go">+eggy</span>
<span class="go">+hamster</span>
<span class="go"> guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.diff_bytes">
<code class="descclassname">difflib.</code><code class="descname">diff_bytes</code><span class="sig-paren">(</span><em>dfunc</em>, <em>a</em>, <em>b</em>, <em>fromfile=b''</em>, <em>tofile=b''</em>, <em>fromfiledate=b''</em>, <em>tofiledate=b''</em>, <em>n=3</em>, <em>lineterm=b'\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.diff_bytes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>dfunc</em> を使用して <em>a</em> と <em>b</em> (bytes オブジェクトのリスト) を比較して、差分形式の行 (これも bytes オブジェクトです) を*dfunc* の戻り値の形式で返します。<em>dfunc</em> は、呼び出し可能である必要があります。一般に、これは <a class="reference internal" href="#difflib.unified_diff" title="difflib.unified_diff"><code class="xref py py-func docutils literal"><span class="pre">unified_diff()</span></code></a> または <a class="reference internal" href="#difflib.context_diff" title="difflib.context_diff"><code class="xref py py-func docutils literal"><span class="pre">context_diff()</span></code></a> です。</p>
<p>未知のエンコーディングまたは一貫性のないエンコーディングのデータ同士を比較できます。<em>n</em> 以外のすべての入力は、bytes オブジェクトである必要があります。<em>n</em> 以外のすべての入力を損失なく str に変換して、<code class="docutils literal"><span class="pre">dfunc(a,</span> <span class="pre">b,</span> <span class="pre">fromfile,</span> <span class="pre">tofile,</span> <span class="pre">fromfiledate,</span> <span class="pre">tofiledate,</span> <span class="pre">n,</span> <span class="pre">lineterm)</span></code> を呼び出すことにより動作します。<em>dfunc</em> の出力は、bytes 型に変換されます。これにより、受け取る差分形式の行のエンコーディングは、<em>a</em> と <em>b</em> の未知または一貫性のないエンコーディングと同一になります。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_LINE_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_LINE_JUNK</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_LINE_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる行のとき真を返します。行 <em>line</em> は空白、または  <code class="docutils literal"><span class="pre">'#'</span></code> ひとつのときに無視できます。それ以外のときには無視できません。古いバージョンでは <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>linejunk</em> にデフォルトで使用されました。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_CHARACTER_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_CHARACTER_JUNK</code><span class="sig-paren">(</span><em>ch</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_CHARACTER_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる文字のとき真を返します。文字 <em>ch</em> が空白、またはタブ文字のときには無視できます。それ以外の時には無視できません。 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>charjunk</em> としてデフォルトで使用されます。</p>
</dd></dl>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><a class="reference external" href="http://www.drdobbs.com/database/pattern-matching-the-gestalt-approach/184407970">Pattern Matching: The Gestalt Approach</a></dt>
<dd>John W. Ratcliff と D. E. Metzener による類似のアルゴリズムに関する議論。<a class="reference external" href="http://www.drdobbs.com/">Dr. Dobb’s Journal</a> 1988年7月号掲載。</dd>
</dl>
</div>
<div class="section" id="sequencematcher-objects">
<span id="sequence-matcher"></span><h2>6.3.1. SequenceMatcherオブジェクト<a class="headerlink" href="#sequencematcher-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスには、以下のようなコンストラクタがあります:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><span class="sig-paren">(</span><em>isjunk=None</em>, <em>a=''</em>, <em>b=''</em>, <em>autojunk=True</em><span class="sig-paren">)</span></dt>
<dd><p>オプションの引数 <em>isjunk</em> は、<code class="docutils literal"><span class="pre">None</span></code> (デフォルトの値です) にするか、単一の引数をとる関数でなければなりません。後者の場合、関数はシーケンスの要素を受け取り、要素が junk であり、無視すべきである場合に限り真を返すようにしなければなりません。<em>isjunk</em> に <code class="docutils literal"><span class="pre">None</span></code> を渡すと、<code class="docutils literal"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">0</span></code> を渡したのと同じになります; すなわち、いかなる要素も無視しなくなります。例えば以下のような引数を渡すと:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">" </span><span class="se">\t</span><span class="s2">"</span>
</pre></div>
</div>
<p>空白とタブ文字を無視して文字のシーケンスを比較します。</p>
<p>オプションの引数 <em>a</em> と <em>b</em> は、比較される文字列で、デフォルトでは空の文字列です。両方のシーケンスの要素は、ハッシュ化可能(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)である必要があります。</p>
<p>オプションの引数 <em>autojunk</em> は、自動 junk ヒューリスティックを無効にするために使えます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
<p>SequenceMatcher オブジェクトは3つのデータ属性を持っています: <em>bjunk</em> は、 <em>isjunk</em> が <code class="docutils literal"><span class="pre">True</span></code> であるような <em>b</em> の要素の集合です; <em>bpopular</em> は、 (無効でなければ) ヒューリスティックによって popular であると考えられる非ジャンク要素の集合です; <em>b2j</em> は、 <em>b</em> の残りの要素をそれらが生じる位置のリストに写像する dict です。この 3 つは <a class="reference internal" href="#difflib.SequenceMatcher.set_seqs" title="difflib.SequenceMatcher.set_seqs"><code class="xref py py-meth docutils literal"><span class="pre">set_seqs()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> で <em>b</em> がリセットされる場合は常にリセットされます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>bjunk</em> および <em>bpopular</em> 属性。</p>
</div>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは以下のメソッドを持ちます:</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seqs">
<code class="descname">set_seqs</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seqs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較される2つの文字列を設定します。</p>
</dd></dl>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは、2つ目のシーケンスについての詳細な情報を計算し、キャッシュします。 1つのシーケンスをいくつものシーケンスと比較する場合、まず <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> を使って文字列を設定しておき、別の文字列を1つずつ比較するために、繰り返し <a class="reference internal" href="#difflib.SequenceMatcher.set_seq1" title="difflib.SequenceMatcher.set_seq1"><code class="xref py py-meth docutils literal"><span class="pre">set_seq1()</span></code></a> を呼び出します。</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq1">
<code class="descname">set_seq1</code><span class="sig-paren">(</span><em>a</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq1" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う1つ目のシーケンスを設定します。比較される2つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq2">
<code class="descname">set_seq2</code><span class="sig-paren">(</span><em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq2" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う2つ目のシーケンスを設定します。比較される1つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.find_longest_match">
<code class="descname">find_longest_match</code><span class="sig-paren">(</span><em>alo</em>, <em>ahi</em>, <em>blo</em>, <em>bhi</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.find_longest_match" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">a[alo:ahi]</span></code> と <code class="docutils literal"><span class="pre">b[blo:bhi]</span></code> の中から、最長のマッチ列を探します。</p>
<p><em>isjunk</em> が省略されたか <code class="docutils literal"><span class="pre">None</span></code> の時、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> は <code class="docutils literal"><span class="pre">a[i:i+k]</span></code> が <code class="docutils literal"><span class="pre">b[j:j+k]</span></code> と等しいような <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">k)</span></code> を返します。その値は <code class="docutils literal"><span class="pre">alo</span> <span class="pre">&lt;=</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i+k</span> <span class="pre">&lt;=</span> <span class="pre">ahi</span></code> かつ <code class="docutils literal"><span class="pre">blo</span> <span class="pre">&lt;=</span> <span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j+k</span> <span class="pre">&lt;=</span> <span class="pre">bhi</span></code> となります。 <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">k')</span></code> でも、同じようになります。さらに <code class="docutils literal"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">k'</span></code>, <code class="docutils literal"><span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i'</span></code> が <code class="docutils literal"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">i'</span></code>, <code class="docutils literal"><span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j'</span></code> でも同様です。言い換えると、いくつものマッチ列すべてのうち、 <em>a</em> 内で最初に始まるものを返します。そしてその <em>a</em> 内で最初のマッチ列すべてのうち <em>b</em> 内で最初に始まるものを返します。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=0, b=4, size=5)</span>
</pre></div>
</div>
<p>引数 <em>isjunk</em> が与えられている場合、上記の通り、はじめに最長のマッチ列を判定します。ブロック内に junk 要素が見当たらないような追加条件の際はこれに該当しません。次にそのマッチ列を、その両側の junk 要素にマッチするよう、できる限り広げていきます。そのため結果となる列は、探している列のたまたま直前にあった同一の junk 以外の junk にはマッチしません。</p>
<p>以下は前と同じサンプルですが、空白を junk とみなしています。これは <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> が2つ目の列の末尾にある <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> にマッチしないようにしています。代わりに <code class="docutils literal"><span class="pre">'abcd'</span></code> にはマッチします。そして 2つ目の文字列中、一番左の <code class="docutils literal"><span class="pre">'abcd'</span></code> にマッチします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">==</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=1, b=0, size=4)</span>
</pre></div>
</div>
<p>どんな列にもマッチしない時は、<code class="docutils literal"><span class="pre">(alo,</span> <span class="pre">blo,</span> <span class="pre">0)</span></code> を返します。</p>
<p>このメソッドは <a class="reference internal" href="../glossary.html#term-named-tuple"><span class="xref std std-term">named tuple</span></a> <code class="docutils literal"><span class="pre">Match(a,</span> <span class="pre">b,</span> <span class="pre">size)</span></code> を返します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_matching_blocks">
<code class="descname">get_matching_blocks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_matching_blocks" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>マッチしたシーケンス中で個別にマッチしたシーケンスをあらわす、3つの値のリストを返します。それぞれの値は <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> という形式であらわされ、<code class="docutils literal"><span class="pre">a[i:i+n]</span> <span class="pre">==</span> <span class="pre">b[j:j+n]</span></code> という関係を意味します。3つの値は <em>i</em> と <em>j</em> の間で単調に増加します。</p>
<p>最後のタプルはダミーで、<code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> という値を持ちます。これは <code class="docutils literal"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">0</span></code> である唯一のタプルです。もし <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> と <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">n')</span></code> がリストで並んでいる3つ組で、2つ目が最後の3つ組でなければ、<code class="docutils literal"><span class="pre">i+n</span> <span class="pre">!=</span> <span class="pre">i'</span></code> または <code class="docutils literal"><span class="pre">j+n</span> <span class="pre">!=</span> <span class="pre">j'</span></code> です。言い換えると並んでいる3つ組は常に隣接していない同じブロックを表しています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abxcd"</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">()</span>
<span class="go">[Match(a=0, b=0, size=2), Match(a=3, b=2, size=2), Match(a=5, b=4, size=0)]</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_opcodes">
<code class="descname">get_opcodes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> を <em>b</em> にするための方法を記述する5つのタプルを返します。それぞれのタプルは <code class="docutils literal"><span class="pre">(tag,</span> <span class="pre">i1,</span> <span class="pre">i2,</span> <span class="pre">j1,</span> <span class="pre">j2)</span></code> という形式であらわされます。最初のタプルは <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">j1</span> <span class="pre">==</span> <span class="pre">0</span></code> であり、<em>i1</em> はその前にあるタプルの <em>i2</em> と同じ値です。同様に <em>j1</em> は前の <em>j2</em> と同じ値になります。</p>
<p><em>tag</em> の値は文字列であり、次のような意味です:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%"/>
<col width="75%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'replace'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は <code class="docutils literal"><span class="pre">b[j1:j2]</span></code> に置き換えられる。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'delete'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は削除される。この時、<code class="docutils literal"><span class="pre">j1</span> <span class="pre">==</span> <span class="pre">j2</span></code> である。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'insert'</span></code></td>
<td><code class="docutils literal"><span class="pre">b[j1:j2]</span></code> が <code class="docutils literal"><span class="pre">a[i1:i1]</span></code> に挿入される。この時 <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">i2</span></code> である。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'equal'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span> <span class="pre">==</span> <span class="pre">b[j1:j2]</span></code> (サブシーケンスは等しい).</td>
</tr>
</tbody>
</table>
<p>例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="s2">"qabxcd"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="s2">"abycdf"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{:7}</span><span class="s1">   a[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] --&gt; b[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] </span><span class="si">{!r:&gt;8}</span><span class="s1"> --&gt; </span><span class="si">{!r}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">]))</span>
<span class="go">delete    a[0:1] --&gt; b[0:0]      'q' --&gt; ''</span>
<span class="go">equal     a[1:3] --&gt; b[0:2]     'ab' --&gt; 'ab'</span>
<span class="go">replace   a[3:4] --&gt; b[2:3]      'x' --&gt; 'y'</span>
<span class="go">equal     a[4:6] --&gt; b[3:5]     'cd' --&gt; 'cd'</span>
<span class="go">insert    a[6:6] --&gt; b[5:6]       '' --&gt; 'f'</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_grouped_opcodes">
<code class="descname">get_grouped_opcodes</code><span class="sig-paren">(</span><em>n=3</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_grouped_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>最大 <em>n</em> 行までのコンテクストを含むグループを生成するような、ジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)を返します。</p>
<p>このメソッドは、 <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> で返されるグループの中から、似たような差異のかたまりに分け、間に挟まっている変更の無い部分を省きます。</p>
<p>グループは <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> と同じ書式で返されます。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.ratio">
<code class="descname">ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>[0, 1] の範囲の浮動小数点数で、シーケンスの類似度を測る値を返します。</p>
<p>T が2つのシーケンスの要素数の総計だと仮定し、M をマッチした数とすると、この値は 2.0*M / T であらわされます。もしシーケンスがまったく同じ場合、値は <code class="docutils literal"><span class="pre">1.0</span></code> となり、まったく異なる場合には <code class="docutils literal"><span class="pre">0.0</span></code> となります。</p>
<p>このメソッドは <a class="reference internal" href="#difflib.SequenceMatcher.get_matching_blocks" title="difflib.SequenceMatcher.get_matching_blocks"><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> がまだ呼び出されていない場合には非常にコストが高いです。この場合、上限を素早く計算するために、 <a class="reference internal" href="#difflib.SequenceMatcher.quick_ratio" title="difflib.SequenceMatcher.quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code></a> もしくは <a class="reference internal" href="#difflib.SequenceMatcher.real_quick_ratio" title="difflib.SequenceMatcher.real_quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code></a> を最初に試してみる方がいいかもしれません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.quick_ratio">
<code class="descname">quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、より高速に計算します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.real_quick_ratio">
<code class="descname">real_quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.real_quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、非常に高速に計算します。</p>
</dd></dl>
</dd></dl>
<p>この文字列全体のマッチ率を返す3つのメソッドは、精度の異なる近似値を返します。 <code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code> と <code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code> は、常に <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> 以上の値を返します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">,</span> <span class="s2">"bcde"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">quick_ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">real_quick_ratio</span><span class="p">()</span>
<span class="go">1.0</span>
</pre></div>
</div>
</div>
<div class="section" id="sequencematcher-examples">
<span id="id1"></span><h2>6.3.2. SequenceMatcher の例<a class="headerlink" href="#sequencematcher-examples" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は2つの文字列を比較します。空白を "junk" とします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">" "</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private Thread currentThread;"</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private volatile Thread currentThread;"</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> は、[0, 1] の範囲の値を返し、シーケンスの類似度を測ります。経験によると、 <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> の値が0.6を超えると、シーケンスがよく似ていることを示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="go">0.866</span>
</pre></div>
</div>
<p>シーケンスのどこがマッチしているかにだけ興味のある時には <code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が手軽でしょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"a[</span><span class="si">%d</span><span class="s2">] and b[</span><span class="si">%d</span><span class="s2">] match for </span><span class="si">%d</span><span class="s2"> elements"</span> <span class="o">%</span> <span class="n">block</span><span class="p">)</span>
<span class="go">a[0] and b[0] match for 8 elements</span>
<span class="go">a[8] and b[17] match for 21 elements</span>
<span class="go">a[29] and b[38] match for 0 elements</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が返す最後のタプルが常にダミーであることに注目してください。このダミーは <code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> であり、これはタプルの最後の要素（マッチする要素の数）が <code class="docutils literal"><span class="pre">0</span></code> となる唯一のケースです。</p>
<p>はじめのシーケンスがどのようにして2番目のものになるのかを知るには、 <code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code> を使います:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%6s</span><span class="s2"> a[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">] b[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">]"</span> <span class="o">%</span> <span class="n">opcode</span><span class="p">)</span>
<span class="go"> equal a[0:8] b[0:8]</span>
<span class="go">insert a[8:8] b[8:17]</span>
<span class="go"> equal a[8:29] b[17:38]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<ul class="last simple">
<li><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> を使った、シンプルで使えるコードを知るには、このモジュールの関数 <a class="reference internal" href="#difflib.get_close_matches" title="difflib.get_close_matches"><code class="xref py py-func docutils literal"><span class="pre">get_close_matches()</span></code></a> を参照してください。</li>
<li><a class="reference external" href="https://code.activestate.com/recipes/576729/">Simple version control recipe</a> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> で作った小規模アプリケーション。</li>
</ul>
</div>
</div>
<div class="section" id="differ-objects">
<span id="id2"></span><h2>6.3.3. Differ オブジェクト<a class="headerlink" href="#differ-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトによって生成された差分が <strong>最小</strong> であるなどとは言いません。むしろ、最小の差分はしばしば直観に反しています。その理由は、どこでもできるとなれば一致を見いだしてしまうからで、ときには思いがけなく100ページも離れたマッチになってしまうのです。一致点を互いに隣接したマッチに制限することで、場合によって長めの差分を出力するというコストを掛けることにはなっても、ある種の局所性を保つことができるのです。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> は、以下のようなコンストラクタを持ちます:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><span class="sig-paren">(</span><em>linejunk=None</em>, <em>charjunk=None</em><span class="sig-paren">)</span></dt>
<dd><p>オプションのキーワードパラメータ <em>linejunk</em> と <em>charjunk</em> は、フィルタ関数を渡します (使わないときは <code class="docutils literal"><span class="pre">None</span></code>):</p>
<p><em>linejunk</em>: ひとつの文字列引数を受け取る関数です。文字列が junk のときに真を返します。デフォルトでは、<code class="docutils literal"><span class="pre">None</span></code> であり、どんな行であっても junk とは見なされません。</p>
<p><em>charjunk</em>: この関数は文字(長さ1の文字列)を引数として受け取り、文字が junk であるときに真を返します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> であり、どんな文字も junk とは見なされません。</p>
<p>これらの junk フィルター関数により、差分を発見するマッチングが高速化し、差分の行や文字が無視されることがなくなります。説明については、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> メソッドの <em>isjunk</em> 引数の説明をご覧ください。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトは、以下の1つのメソッドを通して利用されます。（差分を生成します）:</p>
<dl class="method">
<dt id="difflib.Differ.compare">
<code class="descname">compare</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.Differ.compare" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>文字列からなる2つのシーケンスを比較し、差分（を表す文字列からなるシーケンス）を生成します。</p>
<p>各シーケンスの要素は、改行で終わる独立した単一行からなる文字列でなければなりません。そのようなシーケンスは、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code></a> メソッドによって得ることができます。（得られる）差分は改行文字で終了する文字列のシーケンスとして得られ、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-meth docutils literal"><span class="pre">writelines()</span></code></a> メソッドによって出力できる形になっています。</p>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="differ-example">
<span id="differ-examples"></span><h2>6.3.4. Differ の例<a class="headerlink" href="#differ-example" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下の例は2つのテキストを比較しています。最初に、テキストを行毎に改行で終わる文字列のシーケンスにセットアップします (そのようなシーケンスは、ファイル風オブジェクトの <code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code> メソッドからも得ることができます):</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  2. Explicit is better than implicit.</span>
<span class="gp">... </span><span class="s1">  3. Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complex is better than complicated.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">'\n'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text2</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  3.   Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complicated is better than complex.</span>
<span class="gp">... </span><span class="s1">  5. Flat is better than nested.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>次に Differ オブジェクトをインスタンス化します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Differ</span><span class="p">()</span>
</pre></div>
</div>
<p>注意:  <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトをインスタンス化するとき、行 junk と文字 junk をフィルタリングする関数を渡すことができます。詳細は <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-meth docutils literal"><span class="pre">Differ()</span></code></a> コンストラクタを参照してください。</p>
<p>最後に、2つを比較します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">result</span></code> は文字列のリストなので、pretty-printしてみましょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">['    1. Beautiful is better than ugly.\n',</span>
<span class="go"> '-   2. Explicit is better than implicit.\n',</span>
<span class="go"> '-   3. Simple is better than complex.\n',</span>
<span class="go"> '+   3.   Simple is better than complex.\n',</span>
<span class="go"> '?     ++\n',</span>
<span class="go"> '-   4. Complex is better than complicated.\n',</span>
<span class="go"> '?            ^                     ---- ^\n',</span>
<span class="go"> '+   4. Complicated is better than complex.\n',</span>
<span class="go"> '?           ++++ ^                      ^\n',</span>
<span class="go"> '+   5. Flat is better than nested.\n']</span>
</pre></div>
</div>
<p>これは、複数行の文字列として、次のように出力されます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">    1. Beautiful is better than ugly.</span>
<span class="go">-   2. Explicit is better than implicit.</span>
<span class="go">-   3. Simple is better than complex.</span>
<span class="go">+   3.   Simple is better than complex.</span>
<span class="go">?     ++</span>
<span class="go">-   4. Complex is better than complicated.</span>
<span class="go">?            ^                     ---- ^</span>
<span class="go">+   4. Complicated is better than complex.</span>
<span class="go">?           ++++ ^                      ^</span>
<span class="go">+   5. Flat is better than nested.</span>
</pre></div>
</div>
</div>
<div class="section" id="a-command-line-interface-to-difflib">
<span id="difflib-interface"></span><h2>6.3.5. difflib のコマンドラインインタフェース<a class="headerlink" href="#a-command-line-interface-to-difflib" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は、 difflib を使って <code class="docutils literal"><span class="pre">diff</span></code> に似たユーティリティーを作成する方法を示します。これは、 Python のソース配布物にも、 <code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> として含まれています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">""" Command line interface to difflib.py providing diffs in four formats:</span>

<span class="sd">* ndiff:    lists every line and highlights interline changes.</span>
<span class="sd">* context:  highlights clusters of changes in a before/after format.</span>
<span class="sd">* unified:  highlights clusters of changes in an inline format.</span>
<span class="sd">* html:     generates side by side comparison with change highlights.</span>

<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">difflib</span><span class="o">,</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="k">def</span> <span class="nf">file_mtime</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span>
                               <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a context format diff (default)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-u'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a unified format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-m'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce HTML side by side diff '</span>
                             <span class="s1">'(can use -c and -l in conjunction)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-n'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a ndiff format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-l'</span><span class="p">,</span> <span class="s1">'--lines'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Set number of context lines (default 3)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'fromfile'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'tofile'</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">lines</span>
    <span class="n">fromfile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">fromfile</span>
    <span class="n">tofile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">tofile</span>

    <span class="n">fromdate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span>
    <span class="n">todate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">fromlines</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
        <span class="n">tolines</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">u</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">m</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">HtmlDiff</span><span class="p">()</span><span class="o">.</span><span class="n">make_file</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span><span class="n">tolines</span><span class="p">,</span><span class="n">fromfile</span><span class="p">,</span><span class="n">tofile</span><span class="p">,</span><span class="n">context</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">numlines</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">context_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div aria-label="main navigation" class="sphinxsidebar" role="navigation">
<div class="sphinxsidebarwrapper">
<h3><a href="../contents.html">目次</a></h3>
<ul>
<li><a class="reference internal" href="#">6.3. <code class="docutils literal"><span class="pre">difflib</span></code>  差分の計算を助ける</a><ul>
<li><a class="reference internal" href="#sequencematcher-objects">6.3.1. SequenceMatcherオブジェクト</a></li>
<li><a class="reference internal" href="#sequencematcher-examples">6.3.2. SequenceMatcher の例</a></li>
<li><a class="reference internal" href="#differ-objects">6.3.3. Differ オブジェクト</a></li>
<li><a class="reference internal" href="#differ-example">6.3.4. Differ の例</a></li>
<li><a class="reference internal" href="#a-command-line-interface-to-difflib">6.3.5. difflib のコマンドラインインタフェース</a></li>
</ul>
</li>
</ul>
<h4>前のトピックへ</h4>
<p class="topless"><a href="re.html" title="前の章へ">6.2. <code class="docutils literal"><span class="pre">re</span></code>  正規表現操作</a></p>
<h4>次のトピックへ</h4>
<p class="topless"><a href="textwrap.html" title="次の章へ">6.4. <code class="docutils literal"><span class="pre">textwrap</span></code>  テキストの折り返しと詰め込み</a></p>
<div aria-label="source link" role="note">
<h3>このページ</h3>
<ul class="this-page-menu">
<li><a href="../bugs.html">バグ報告</a></li>
<li>
<a href="https://github.com/python/cpython/blob/3.6/Doc/library/difflib.rst" rel="nofollow">ソースの表示
        </a>
</li>
</ul>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="footer">
     <a href="../copyright.html">Copyright</a> 2001-2018, Python Software Foundation.
    <br/>
    Python Software Foundation は非営利団体です。
    <a href="https://www.python.org/psf/donations/">寄付</a>
<br/>
    最終更新日時: 7月 29, 2018
    <a href="../bugs.html">バグを見つけたら</a>?
    <br/>
    このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.5 を使って作成されました。
    </div>
</body>
</head></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="ja" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>6.3. difflib  差分の計算を助ける  Python 3.6.5 ドキュメント</title>
<link href="../_static/pydoctheme.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
<script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/underscore.js" type="text/javascript"></script>
<script src="../_static/doctools.js" type="text/javascript"></script>
<script src="../_static/translations.js" type="text/javascript"></script>
<script src="../_static/sidebar.js" type="text/javascript"></script>
<link href="../_static/opensearch.xml" rel="search" title="Python 3.6.5 ドキュメント 内を検索" type="application/opensearchdescription+xml"/>
<link href="../about.html" rel="author" title="このドキュメントについて"/>
<link href="../genindex.html" rel="index" title="索引"/>
<link href="../search.html" rel="search" title="検索"/>
<link href="../copyright.html" rel="copyright" title="Copyright"/>
<link href="textwrap.html" rel="next" title="6.4. textwrap  テキストの折り返しと詰め込み"/>
<link href="re.html" rel="prev" title="6.2. re  正規表現操作"/>
<link href="../_static/py.png" rel="shortcut icon" type="image/png"/>
<link href="https://docs.python.jp/3/library/difflib.html" rel="canonical"/><script type="text/javascript">
    $(document).ready(function() {
      var base = 'https://docs.python.org/3.6/library/difflib.html';
      $('a.headerlink').each(function() {
        var html = '<a href="' + base + $(this).attr('href') +
                   '" title="原文へのリンク"><small>(原文)</small></a>';
        $(this).after(html);
      })
    });
    </script>
<script src="../_static/copybutton.js" type="text/javascript"></script>
<script src="../_static/version_switch.js" type="text/javascript"></script>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-34175846-1', 'python.jp');
        ga('send', 'pageview');

      </script>
<body>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a accesskey="I" href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a accesskey="N" href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a accesskey="P" href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a accesskey="U" href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body" role="main">
<div class="section" id="module-difflib">
<span id="difflib-helpers-for-computing-deltas"></span><h1>6.3. <a class="reference internal" href="#module-difflib" title="difflib: Helpers for computing differences between objects."><code class="xref py py-mod docutils literal"><span class="pre">difflib</span></code></a>  差分の計算を助ける<a class="headerlink" href="#module-difflib" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><strong>ソースコード:</strong> <a class="reference external" href="https://github.com/python/cpython/tree/3.6/Lib/difflib.py">Lib/difflib.py</a></p>
<hr class="docutils"/>
<p>このモジュールは、シーケンスを比較するためのクラスや関数を提供しています。例えば、ファイルの差分を計算して、それを HTML や context diff, unified diff などいろいろなフォーマットで出力するために、このモジュールを利用することができます。ディレクトリやファイル群を比較するためには、 <a class="reference internal" href="filecmp.html#module-filecmp" title="filecmp: Compare files efficiently."><code class="xref py py-mod docutils literal"><span class="pre">filecmp</span></code></a> モジュールも参照してください。</p>
<dl class="class">
<dt id="difflib.SequenceMatcher">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><a class="headerlink" href="#difflib.SequenceMatcher" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>柔軟性のあるクラスで、二つのシーケンスの要素がハッシュ化できる(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)型であれば、どの型の要素を含むシーケンスも比較可能です。基本的なアルゴリズムは、1980年代の後半に発表された Ratcliff と Obershelp による"ゲシュタルトパターンマッチング"と大げさに名づけられたアルゴリズム以前から知られている、やや凝ったアルゴリズムです。その考え方は、"junk" 要素を含まない最も長い互いに隣接したマッチ列を探すことです。ここで、  "junk" 要素とは、空行や空白などの、意味を持たない要素のことです。 (junk を処理するのは、Ratcliff と Obershelp のアルゴリズムに追加された拡張です。)この考え方は、マッチ列の左右に隣接するシーケンスの断片に対して再帰的にあてはめられます。この方法では編集を最小にするシーケンスは生まれませんが、人間の目からみて「正しい感じ」にマッチする傾向があります。</p>
<p><strong>実行時間:</strong> 基本的な Ratcliff-Obershelp アルゴリズムは、最悪の場合3乗、期待値で2乗となります。 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトでは、最悪のケースで2乗、期待値は比較されるシーケンス中に共通に現れる要素数に非常にややこしく依存しています。最良の場合は線形時間になります。</p>
<p><strong>自動 junk ヒューリスティック:</strong> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> は、シーケンスの特定の要素を自動的に junk として扱うヒューリスティックをサポートしています。このヒューリスティックは、各個要素がシーケンス内に何回現れるかを数えます。ある要素の重複数が (最初のものは除いて) 合計でシーケンスの 1% 以上になり、そのシーケンスが 200 要素以上なら、その要素は "popular" であるものとしてマークされ、シーケンスのマッチングの目的からは junk として扱われます。このヒューリスティックは、 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> の作成時に <code class="docutils literal"><span class="pre">autojunk</span></code> パラメタを <code class="docutils literal"><span class="pre">False</span></code> に設定することで無効化できます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
</dd></dl>
<dl class="class">
<dt id="difflib.Differ">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><a class="headerlink" href="#difflib.Differ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>テキスト行からなるシーケンスを比較するクラスです。人が読むことのできる差分を作成します。 Differ クラスは <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスを利用して、行からなるシーケンスを比較したり、(ほぼ)同一の行内の文字を比較したりします。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> クラスによる差分の各行は、2文字のコードで始まります:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%"/>
<col width="81%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">コード</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'-</span> <span class="pre">'</span></code></td>
<td>行はシーケンス1にのみ存在する</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'+</span> <span class="pre">'</span></code></td>
<td>行はシーケンス2にのみ存在する</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'</span> <span class="pre">'</span></code></td>
<td>行は両方のシーケンスで同一</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'?</span> <span class="pre">'</span></code></td>
<td>行は入力シーケンスのどちらにも存在しない</td>
</tr>
</tbody>
</table>
<p>'<code class="docutils literal"><span class="pre">?</span></code>' で始まる行は、行内のどこに差異が存在するかに注意を向けようとします。その行は、入力されたシーケンスのどちらにも存在しません。シーケンスがタブ文字を含むとき、これらの行は判別しづらいものになることがあります。</p>
</dd></dl>
<dl class="class">
<dt id="difflib.HtmlDiff">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">HtmlDiff</code><a class="headerlink" href="#difflib.HtmlDiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このクラスは、二つのテキストを左右に並べて比較表示し、行間あるいは行内の変更点を強調表示するような HTML テーブル (またはテーブルの入った完全な HTML ファイル) を生成するために使います。テーブルは完全差分モード、コンテキスト差分モードのいずれでも生成できます。</p>
<p>このクラスのコンストラクタは以下のようになっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>tabsize=8</em>, <em>wrapcolumn=None</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.__init__" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> のインスタンスを初期化します。</p>
<p><em>tabsize</em> はオプションのキーワード引数で、タブストップ幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">8</span></code> です。</p>
<p><em>wrapcolumn</em> はオプションのキーワード引数で、テキストを折り返すカラム幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> で折り返しを行いません。</p>
<p><em>linejunk</em> および <em>charjunk</em> はオプションのキーワード引数で、 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a>  (<a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> はこの関数を使って左右のテキストの差分を HTML で生成します) に渡されます。それぞれの引数のデフォルト値および説明は <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> のドキュメントを参照してください。</p>
</dd></dl>
<p>以下のメソッドが public になっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.make_file">
<code class="descname">make_file</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em>, <em>*</em>, <em>charset='utf-8'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_file" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った表を持つ完全な HTML ファイルを文字列で返します。</p>
<p><em>fromdesc</em> および <em>todesc</em> はオプションのキーワード引数で、差分表示テーブルにおけるそれぞれ差分元、差分先ファイルのカラムのヘッダになる文字列を指定します (いずれもデフォルト値は空文字列です)。</p>
<p><em>context</em> および <em>numlines</em> はともにオプションのキーワード引数です。<em>context</em> を <code class="docutils literal"><span class="pre">True</span></code> にするとコンテキスト差分を表示し、デフォルトの <code class="docutils literal"><span class="pre">False</span></code> にすると完全なファイル差分を表示します。<em>numlines</em> のデフォルト値は <code class="docutils literal"><span class="pre">5</span></code> で、<em>context</em> が <code class="docutils literal"><span class="pre">True</span></code> の場合、<em>numlines</em> は強調部分の前後にあるコンテキスト行の数を制御します。<em>context</em> が <code class="docutils literal"><span class="pre">False</span></code> の場合、<em>numlines</em> は "next" と書かれたハイパーリンクをたどった時に到達する場所が次の変更部分より何行前にあるかを制御します (値をゼロにした場合、"next" ハイパーリンクを辿ると変更部分の強調表示がブラウザの最上部に表示されるようになります)。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.5 で変更: </span><em>charset</em> キーワード専用引数が追加されました。HTML 文書のデフォルトの文字集合が <code class="docutils literal"><span class="pre">'ISO-8859-1'</span></code> から <code class="docutils literal"><span class="pre">'utf-8'</span></code> に変更されました。</p>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.HtmlDiff.make_table">
<code class="descname">make_table</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った完全な HTML テーブルを文字列で返します。</p>
<p>このメソッドの引数は、 <a class="reference internal" href="#difflib.HtmlDiff.make_file" title="difflib.HtmlDiff.make_file"><code class="xref py py-meth docutils literal"><span class="pre">make_file()</span></code></a> メソッドの引数と同じです。</p>
</dd></dl>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> はこのクラスへのコマンドラインフロントエンドで、使い方を学ぶ上で格好の例題が入っています。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.context_diff">
<code class="descclassname">difflib.</code><code class="descname">context_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.context_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 context diff のフォーマット(以下「コンテクスト形式」)で返します。</p>
<p>コンテクスト形式は、変更があった行に前後数行を加えてある、コンパクトな表現方法です。変更箇所は、変更前/変更後に分けて表します。コンテクスト (変更箇所前後の行) の行数は <em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">***</span></code> や <code class="docutils literal"><span class="pre">---</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">context_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">*** before.py</span>
<span class="go">--- after.py</span>
<span class="go">***************</span>
<span class="go">*** 1,4 ****</span>
<span class="go">! bacon</span>
<span class="go">! eggs</span>
<span class="go">! ham</span>
<span class="go">  guido</span>
<span class="go">--- 1,4 ----</span>
<span class="go">! python</span>
<span class="go">! eggy</span>
<span class="go">! hamster</span>
<span class="go">  guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.get_close_matches">
<code class="descclassname">difflib.</code><code class="descname">get_close_matches</code><span class="sig-paren">(</span><em>word</em>, <em>possibilities</em>, <em>n=3</em>, <em>cutoff=0.6</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.get_close_matches" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>「十分」なマッチの上位のリストを返します。<em>word</em> はマッチさせたいシーケンス (大概は文字列) です。<em>possibilities</em> は <em>word</em> にマッチさせるシーケンスのリスト (大概は文字列のリスト) です。</p>
<p>オプションの引数 <em>n</em> (デフォルトでは <code class="docutils literal"><span class="pre">3</span></code>)はメソッドの返すマッチの最大数です。<em>n</em> は <code class="docutils literal"><span class="pre">0</span></code> より大きくなければなりません。</p>
<p>オプションの引数 <em>cutoff</em> (デフォルトでは <code class="docutils literal"><span class="pre">0.6</span></code>)は、区間 [0, 1] に入る小数の値です。<em>word</em> との一致率がそれ未満の <em>possibilities</em> の要素は無視されます。</p>
<p><em>possibilities</em> の要素でマッチした上位(多くても <em>n</em> 個)は、類似度のスコアに応じて(一番似たものを先頭に)ソートされたリストとして返されます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'appel'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ape'</span><span class="p">,</span> <span class="s1">'apple'</span><span class="p">,</span> <span class="s1">'peach'</span><span class="p">,</span> <span class="s1">'puppy'</span><span class="p">])</span>
<span class="go">['apple', 'ape']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">keyword</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'wheel'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['while']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'pineapple'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'accept'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['except']</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.ndiff">
<code class="descclassname">difflib.</code><code class="descname">ndiff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.ndiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> のスタイルで返します。</p>
<p>オプションのキーワード引数 <em>linejunk</em> と <em>charjunk</em> には、フィルタ関数 (または <code class="docutils literal"><span class="pre">None</span></code>) を渡します。</p>
<p><em>linejunk</em>: 文字列型の引数 1 つを受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは <code class="docutils literal"><span class="pre">None</span></code> です。モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_LINE_JUNK" title="difflib.IS_LINE_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_LINE_JUNK()</span></code></a> は、高々 1 つのシャープ記号(<code class="docutils literal"><span class="pre">'#'</span></code>)を除いて可視の文字を含まない行をフィルタリングするものです。しかし、下層にある <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスが、どの行が雑音となるほど頻繁に登場するかを動的に分析します。このクラスによる分析は、この関数を使用するよりも通常うまく動作します。</p>
<p><em>charjunk</em>: 文字 (長さ1の文字列) を受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは、モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_CHARACTER_JUNK" title="difflib.IS_CHARACTER_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_CHARACTER_JUNK()</span></code></a> であり、これは空白文字類 (空白またはタブ、改行文字をこれに含めてはいけません) をフィルタして排除します。</p>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/ndiff.py</span></code> は、この関数のコマンドラインのフロントエンド（インターフェイス）です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">diff</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">- one</span>
<span class="go">?  ^</span>
<span class="go">+ ore</span>
<span class="go">?  ^</span>
<span class="go">- two</span>
<span class="go">- three</span>
<span class="go">?  -</span>
<span class="go">+ tree</span>
<span class="go">+ emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.restore">
<code class="descclassname">difflib.</code><code class="descname">restore</code><span class="sig-paren">(</span><em>sequence</em>, <em>which</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.restore" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>差分を生成した元の二つのシーケンスのうち一つを返します。</p>
<p><a class="reference internal" href="#difflib.Differ.compare" title="difflib.Differ.compare"><code class="xref py py-meth docutils literal"><span class="pre">Differ.compare()</span></code></a> または <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> によって生成された <em>sequence</em> を与えられると、行頭のプレフィクスを取りのぞいてファイル 1 または 2 (引数 <em>which</em> で指定される) に由来する行を復元します。</p>
<p>例:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="c1"># materialize the generated delta into a list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">one</span>
<span class="go">two</span>
<span class="go">three</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">ore</span>
<span class="go">tree</span>
<span class="go">emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.unified_diff">
<code class="descclassname">difflib.</code><code class="descname">unified_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.unified_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 unified diff フォーマット(以下「ユニファイド形式」)で返します。</p>
<p>ユニファイド形式は変更があった行にコンテキストとなる前後数行を加えた、コンパクトな表現方法です。変更箇所は (変更前/変更後を分離したブロックではなく) インラインスタイルで表されます。コンテクストの行数は、<em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">---</span></code>, <code class="docutils literal"><span class="pre">+++</span></code>, <code class="docutils literal"><span class="pre">@@</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">--- before.py</span>
<span class="go">+++ after.py</span>
<span class="go">@@ -1,4 +1,4 @@</span>
<span class="go">-bacon</span>
<span class="go">-eggs</span>
<span class="go">-ham</span>
<span class="go">+python</span>
<span class="go">+eggy</span>
<span class="go">+hamster</span>
<span class="go"> guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.diff_bytes">
<code class="descclassname">difflib.</code><code class="descname">diff_bytes</code><span class="sig-paren">(</span><em>dfunc</em>, <em>a</em>, <em>b</em>, <em>fromfile=b''</em>, <em>tofile=b''</em>, <em>fromfiledate=b''</em>, <em>tofiledate=b''</em>, <em>n=3</em>, <em>lineterm=b'\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.diff_bytes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>dfunc</em> を使用して <em>a</em> と <em>b</em> (bytes オブジェクトのリスト) を比較して、差分形式の行 (これも bytes オブジェクトです) を*dfunc* の戻り値の形式で返します。<em>dfunc</em> は、呼び出し可能である必要があります。一般に、これは <a class="reference internal" href="#difflib.unified_diff" title="difflib.unified_diff"><code class="xref py py-func docutils literal"><span class="pre">unified_diff()</span></code></a> または <a class="reference internal" href="#difflib.context_diff" title="difflib.context_diff"><code class="xref py py-func docutils literal"><span class="pre">context_diff()</span></code></a> です。</p>
<p>未知のエンコーディングまたは一貫性のないエンコーディングのデータ同士を比較できます。<em>n</em> 以外のすべての入力は、bytes オブジェクトである必要があります。<em>n</em> 以外のすべての入力を損失なく str に変換して、<code class="docutils literal"><span class="pre">dfunc(a,</span> <span class="pre">b,</span> <span class="pre">fromfile,</span> <span class="pre">tofile,</span> <span class="pre">fromfiledate,</span> <span class="pre">tofiledate,</span> <span class="pre">n,</span> <span class="pre">lineterm)</span></code> を呼び出すことにより動作します。<em>dfunc</em> の出力は、bytes 型に変換されます。これにより、受け取る差分形式の行のエンコーディングは、<em>a</em> と <em>b</em> の未知または一貫性のないエンコーディングと同一になります。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_LINE_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_LINE_JUNK</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_LINE_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる行のとき真を返します。行 <em>line</em> は空白、または  <code class="docutils literal"><span class="pre">'#'</span></code> ひとつのときに無視できます。それ以外のときには無視できません。古いバージョンでは <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>linejunk</em> にデフォルトで使用されました。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_CHARACTER_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_CHARACTER_JUNK</code><span class="sig-paren">(</span><em>ch</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_CHARACTER_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる文字のとき真を返します。文字 <em>ch</em> が空白、またはタブ文字のときには無視できます。それ以外の時には無視できません。 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>charjunk</em> としてデフォルトで使用されます。</p>
</dd></dl>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><a class="reference external" href="http://www.drdobbs.com/database/pattern-matching-the-gestalt-approach/184407970">Pattern Matching: The Gestalt Approach</a></dt>
<dd>John W. Ratcliff と D. E. Metzener による類似のアルゴリズムに関する議論。<a class="reference external" href="http://www.drdobbs.com/">Dr. Dobb’s Journal</a> 1988年7月号掲載。</dd>
</dl>
</div>
<div class="section" id="sequencematcher-objects">
<span id="sequence-matcher"></span><h2>6.3.1. SequenceMatcherオブジェクト<a class="headerlink" href="#sequencematcher-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスには、以下のようなコンストラクタがあります:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><span class="sig-paren">(</span><em>isjunk=None</em>, <em>a=''</em>, <em>b=''</em>, <em>autojunk=True</em><span class="sig-paren">)</span></dt>
<dd><p>オプションの引数 <em>isjunk</em> は、<code class="docutils literal"><span class="pre">None</span></code> (デフォルトの値です) にするか、単一の引数をとる関数でなければなりません。後者の場合、関数はシーケンスの要素を受け取り、要素が junk であり、無視すべきである場合に限り真を返すようにしなければなりません。<em>isjunk</em> に <code class="docutils literal"><span class="pre">None</span></code> を渡すと、<code class="docutils literal"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">0</span></code> を渡したのと同じになります; すなわち、いかなる要素も無視しなくなります。例えば以下のような引数を渡すと:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">" </span><span class="se">\t</span><span class="s2">"</span>
</pre></div>
</div>
<p>空白とタブ文字を無視して文字のシーケンスを比較します。</p>
<p>オプションの引数 <em>a</em> と <em>b</em> は、比較される文字列で、デフォルトでは空の文字列です。両方のシーケンスの要素は、ハッシュ化可能(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)である必要があります。</p>
<p>オプションの引数 <em>autojunk</em> は、自動 junk ヒューリスティックを無効にするために使えます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
<p>SequenceMatcher オブジェクトは3つのデータ属性を持っています: <em>bjunk</em> は、 <em>isjunk</em> が <code class="docutils literal"><span class="pre">True</span></code> であるような <em>b</em> の要素の集合です; <em>bpopular</em> は、 (無効でなければ) ヒューリスティックによって popular であると考えられる非ジャンク要素の集合です; <em>b2j</em> は、 <em>b</em> の残りの要素をそれらが生じる位置のリストに写像する dict です。この 3 つは <a class="reference internal" href="#difflib.SequenceMatcher.set_seqs" title="difflib.SequenceMatcher.set_seqs"><code class="xref py py-meth docutils literal"><span class="pre">set_seqs()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> で <em>b</em> がリセットされる場合は常にリセットされます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>bjunk</em> および <em>bpopular</em> 属性。</p>
</div>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは以下のメソッドを持ちます:</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seqs">
<code class="descname">set_seqs</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seqs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較される2つの文字列を設定します。</p>
</dd></dl>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは、2つ目のシーケンスについての詳細な情報を計算し、キャッシュします。 1つのシーケンスをいくつものシーケンスと比較する場合、まず <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> を使って文字列を設定しておき、別の文字列を1つずつ比較するために、繰り返し <a class="reference internal" href="#difflib.SequenceMatcher.set_seq1" title="difflib.SequenceMatcher.set_seq1"><code class="xref py py-meth docutils literal"><span class="pre">set_seq1()</span></code></a> を呼び出します。</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq1">
<code class="descname">set_seq1</code><span class="sig-paren">(</span><em>a</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq1" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う1つ目のシーケンスを設定します。比較される2つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq2">
<code class="descname">set_seq2</code><span class="sig-paren">(</span><em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq2" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う2つ目のシーケンスを設定します。比較される1つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.find_longest_match">
<code class="descname">find_longest_match</code><span class="sig-paren">(</span><em>alo</em>, <em>ahi</em>, <em>blo</em>, <em>bhi</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.find_longest_match" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">a[alo:ahi]</span></code> と <code class="docutils literal"><span class="pre">b[blo:bhi]</span></code> の中から、最長のマッチ列を探します。</p>
<p><em>isjunk</em> が省略されたか <code class="docutils literal"><span class="pre">None</span></code> の時、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> は <code class="docutils literal"><span class="pre">a[i:i+k]</span></code> が <code class="docutils literal"><span class="pre">b[j:j+k]</span></code> と等しいような <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">k)</span></code> を返します。その値は <code class="docutils literal"><span class="pre">alo</span> <span class="pre">&lt;=</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i+k</span> <span class="pre">&lt;=</span> <span class="pre">ahi</span></code> かつ <code class="docutils literal"><span class="pre">blo</span> <span class="pre">&lt;=</span> <span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j+k</span> <span class="pre">&lt;=</span> <span class="pre">bhi</span></code> となります。 <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">k')</span></code> でも、同じようになります。さらに <code class="docutils literal"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">k'</span></code>, <code class="docutils literal"><span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i'</span></code> が <code class="docutils literal"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">i'</span></code>, <code class="docutils literal"><span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j'</span></code> でも同様です。言い換えると、いくつものマッチ列すべてのうち、 <em>a</em> 内で最初に始まるものを返します。そしてその <em>a</em> 内で最初のマッチ列すべてのうち <em>b</em> 内で最初に始まるものを返します。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=0, b=4, size=5)</span>
</pre></div>
</div>
<p>引数 <em>isjunk</em> が与えられている場合、上記の通り、はじめに最長のマッチ列を判定します。ブロック内に junk 要素が見当たらないような追加条件の際はこれに該当しません。次にそのマッチ列を、その両側の junk 要素にマッチするよう、できる限り広げていきます。そのため結果となる列は、探している列のたまたま直前にあった同一の junk 以外の junk にはマッチしません。</p>
<p>以下は前と同じサンプルですが、空白を junk とみなしています。これは <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> が2つ目の列の末尾にある <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> にマッチしないようにしています。代わりに <code class="docutils literal"><span class="pre">'abcd'</span></code> にはマッチします。そして 2つ目の文字列中、一番左の <code class="docutils literal"><span class="pre">'abcd'</span></code> にマッチします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">==</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=1, b=0, size=4)</span>
</pre></div>
</div>
<p>どんな列にもマッチしない時は、<code class="docutils literal"><span class="pre">(alo,</span> <span class="pre">blo,</span> <span class="pre">0)</span></code> を返します。</p>
<p>このメソッドは <a class="reference internal" href="../glossary.html#term-named-tuple"><span class="xref std std-term">named tuple</span></a> <code class="docutils literal"><span class="pre">Match(a,</span> <span class="pre">b,</span> <span class="pre">size)</span></code> を返します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_matching_blocks">
<code class="descname">get_matching_blocks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_matching_blocks" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>マッチしたシーケンス中で個別にマッチしたシーケンスをあらわす、3つの値のリストを返します。それぞれの値は <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> という形式であらわされ、<code class="docutils literal"><span class="pre">a[i:i+n]</span> <span class="pre">==</span> <span class="pre">b[j:j+n]</span></code> という関係を意味します。3つの値は <em>i</em> と <em>j</em> の間で単調に増加します。</p>
<p>最後のタプルはダミーで、<code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> という値を持ちます。これは <code class="docutils literal"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">0</span></code> である唯一のタプルです。もし <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> と <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">n')</span></code> がリストで並んでいる3つ組で、2つ目が最後の3つ組でなければ、<code class="docutils literal"><span class="pre">i+n</span> <span class="pre">!=</span> <span class="pre">i'</span></code> または <code class="docutils literal"><span class="pre">j+n</span> <span class="pre">!=</span> <span class="pre">j'</span></code> です。言い換えると並んでいる3つ組は常に隣接していない同じブロックを表しています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abxcd"</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">()</span>
<span class="go">[Match(a=0, b=0, size=2), Match(a=3, b=2, size=2), Match(a=5, b=4, size=0)]</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_opcodes">
<code class="descname">get_opcodes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> を <em>b</em> にするための方法を記述する5つのタプルを返します。それぞれのタプルは <code class="docutils literal"><span class="pre">(tag,</span> <span class="pre">i1,</span> <span class="pre">i2,</span> <span class="pre">j1,</span> <span class="pre">j2)</span></code> という形式であらわされます。最初のタプルは <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">j1</span> <span class="pre">==</span> <span class="pre">0</span></code> であり、<em>i1</em> はその前にあるタプルの <em>i2</em> と同じ値です。同様に <em>j1</em> は前の <em>j2</em> と同じ値になります。</p>
<p><em>tag</em> の値は文字列であり、次のような意味です:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%"/>
<col width="75%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'replace'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は <code class="docutils literal"><span class="pre">b[j1:j2]</span></code> に置き換えられる。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'delete'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は削除される。この時、<code class="docutils literal"><span class="pre">j1</span> <span class="pre">==</span> <span class="pre">j2</span></code> である。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'insert'</span></code></td>
<td><code class="docutils literal"><span class="pre">b[j1:j2]</span></code> が <code class="docutils literal"><span class="pre">a[i1:i1]</span></code> に挿入される。この時 <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">i2</span></code> である。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'equal'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span> <span class="pre">==</span> <span class="pre">b[j1:j2]</span></code> (サブシーケンスは等しい).</td>
</tr>
</tbody>
</table>
<p>例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="s2">"qabxcd"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="s2">"abycdf"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{:7}</span><span class="s1">   a[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] --&gt; b[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] </span><span class="si">{!r:&gt;8}</span><span class="s1"> --&gt; </span><span class="si">{!r}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">]))</span>
<span class="go">delete    a[0:1] --&gt; b[0:0]      'q' --&gt; ''</span>
<span class="go">equal     a[1:3] --&gt; b[0:2]     'ab' --&gt; 'ab'</span>
<span class="go">replace   a[3:4] --&gt; b[2:3]      'x' --&gt; 'y'</span>
<span class="go">equal     a[4:6] --&gt; b[3:5]     'cd' --&gt; 'cd'</span>
<span class="go">insert    a[6:6] --&gt; b[5:6]       '' --&gt; 'f'</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_grouped_opcodes">
<code class="descname">get_grouped_opcodes</code><span class="sig-paren">(</span><em>n=3</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_grouped_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>最大 <em>n</em> 行までのコンテクストを含むグループを生成するような、ジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)を返します。</p>
<p>このメソッドは、 <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> で返されるグループの中から、似たような差異のかたまりに分け、間に挟まっている変更の無い部分を省きます。</p>
<p>グループは <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> と同じ書式で返されます。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.ratio">
<code class="descname">ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>[0, 1] の範囲の浮動小数点数で、シーケンスの類似度を測る値を返します。</p>
<p>T が2つのシーケンスの要素数の総計だと仮定し、M をマッチした数とすると、この値は 2.0*M / T であらわされます。もしシーケンスがまったく同じ場合、値は <code class="docutils literal"><span class="pre">1.0</span></code> となり、まったく異なる場合には <code class="docutils literal"><span class="pre">0.0</span></code> となります。</p>
<p>このメソッドは <a class="reference internal" href="#difflib.SequenceMatcher.get_matching_blocks" title="difflib.SequenceMatcher.get_matching_blocks"><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> がまだ呼び出されていない場合には非常にコストが高いです。この場合、上限を素早く計算するために、 <a class="reference internal" href="#difflib.SequenceMatcher.quick_ratio" title="difflib.SequenceMatcher.quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code></a> もしくは <a class="reference internal" href="#difflib.SequenceMatcher.real_quick_ratio" title="difflib.SequenceMatcher.real_quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code></a> を最初に試してみる方がいいかもしれません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.quick_ratio">
<code class="descname">quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、より高速に計算します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.real_quick_ratio">
<code class="descname">real_quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.real_quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、非常に高速に計算します。</p>
</dd></dl>
</dd></dl>
<p>この文字列全体のマッチ率を返す3つのメソッドは、精度の異なる近似値を返します。 <code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code> と <code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code> は、常に <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> 以上の値を返します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">,</span> <span class="s2">"bcde"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">quick_ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">real_quick_ratio</span><span class="p">()</span>
<span class="go">1.0</span>
</pre></div>
</div>
</div>
<div class="section" id="sequencematcher-examples">
<span id="id1"></span><h2>6.3.2. SequenceMatcher の例<a class="headerlink" href="#sequencematcher-examples" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は2つの文字列を比較します。空白を "junk" とします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">" "</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private Thread currentThread;"</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private volatile Thread currentThread;"</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> は、[0, 1] の範囲の値を返し、シーケンスの類似度を測ります。経験によると、 <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> の値が0.6を超えると、シーケンスがよく似ていることを示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="go">0.866</span>
</pre></div>
</div>
<p>シーケンスのどこがマッチしているかにだけ興味のある時には <code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が手軽でしょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"a[</span><span class="si">%d</span><span class="s2">] and b[</span><span class="si">%d</span><span class="s2">] match for </span><span class="si">%d</span><span class="s2"> elements"</span> <span class="o">%</span> <span class="n">block</span><span class="p">)</span>
<span class="go">a[0] and b[0] match for 8 elements</span>
<span class="go">a[8] and b[17] match for 21 elements</span>
<span class="go">a[29] and b[38] match for 0 elements</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が返す最後のタプルが常にダミーであることに注目してください。このダミーは <code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> であり、これはタプルの最後の要素（マッチする要素の数）が <code class="docutils literal"><span class="pre">0</span></code> となる唯一のケースです。</p>
<p>はじめのシーケンスがどのようにして2番目のものになるのかを知るには、 <code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code> を使います:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%6s</span><span class="s2"> a[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">] b[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">]"</span> <span class="o">%</span> <span class="n">opcode</span><span class="p">)</span>
<span class="go"> equal a[0:8] b[0:8]</span>
<span class="go">insert a[8:8] b[8:17]</span>
<span class="go"> equal a[8:29] b[17:38]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<ul class="last simple">
<li><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> を使った、シンプルで使えるコードを知るには、このモジュールの関数 <a class="reference internal" href="#difflib.get_close_matches" title="difflib.get_close_matches"><code class="xref py py-func docutils literal"><span class="pre">get_close_matches()</span></code></a> を参照してください。</li>
<li><a class="reference external" href="https://code.activestate.com/recipes/576729/">Simple version control recipe</a> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> で作った小規模アプリケーション。</li>
</ul>
</div>
</div>
<div class="section" id="differ-objects">
<span id="id2"></span><h2>6.3.3. Differ オブジェクト<a class="headerlink" href="#differ-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトによって生成された差分が <strong>最小</strong> であるなどとは言いません。むしろ、最小の差分はしばしば直観に反しています。その理由は、どこでもできるとなれば一致を見いだしてしまうからで、ときには思いがけなく100ページも離れたマッチになってしまうのです。一致点を互いに隣接したマッチに制限することで、場合によって長めの差分を出力するというコストを掛けることにはなっても、ある種の局所性を保つことができるのです。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> は、以下のようなコンストラクタを持ちます:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><span class="sig-paren">(</span><em>linejunk=None</em>, <em>charjunk=None</em><span class="sig-paren">)</span></dt>
<dd><p>オプションのキーワードパラメータ <em>linejunk</em> と <em>charjunk</em> は、フィルタ関数を渡します (使わないときは <code class="docutils literal"><span class="pre">None</span></code>):</p>
<p><em>linejunk</em>: ひとつの文字列引数を受け取る関数です。文字列が junk のときに真を返します。デフォルトでは、<code class="docutils literal"><span class="pre">None</span></code> であり、どんな行であっても junk とは見なされません。</p>
<p><em>charjunk</em>: この関数は文字(長さ1の文字列)を引数として受け取り、文字が junk であるときに真を返します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> であり、どんな文字も junk とは見なされません。</p>
<p>これらの junk フィルター関数により、差分を発見するマッチングが高速化し、差分の行や文字が無視されることがなくなります。説明については、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> メソッドの <em>isjunk</em> 引数の説明をご覧ください。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトは、以下の1つのメソッドを通して利用されます。（差分を生成します）:</p>
<dl class="method">
<dt id="difflib.Differ.compare">
<code class="descname">compare</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.Differ.compare" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>文字列からなる2つのシーケンスを比較し、差分（を表す文字列からなるシーケンス）を生成します。</p>
<p>各シーケンスの要素は、改行で終わる独立した単一行からなる文字列でなければなりません。そのようなシーケンスは、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code></a> メソッドによって得ることができます。（得られる）差分は改行文字で終了する文字列のシーケンスとして得られ、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-meth docutils literal"><span class="pre">writelines()</span></code></a> メソッドによって出力できる形になっています。</p>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="differ-example">
<span id="differ-examples"></span><h2>6.3.4. Differ の例<a class="headerlink" href="#differ-example" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下の例は2つのテキストを比較しています。最初に、テキストを行毎に改行で終わる文字列のシーケンスにセットアップします (そのようなシーケンスは、ファイル風オブジェクトの <code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code> メソッドからも得ることができます):</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  2. Explicit is better than implicit.</span>
<span class="gp">... </span><span class="s1">  3. Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complex is better than complicated.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">'\n'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text2</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  3.   Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complicated is better than complex.</span>
<span class="gp">... </span><span class="s1">  5. Flat is better than nested.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>次に Differ オブジェクトをインスタンス化します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Differ</span><span class="p">()</span>
</pre></div>
</div>
<p>注意:  <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトをインスタンス化するとき、行 junk と文字 junk をフィルタリングする関数を渡すことができます。詳細は <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-meth docutils literal"><span class="pre">Differ()</span></code></a> コンストラクタを参照してください。</p>
<p>最後に、2つを比較します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">result</span></code> は文字列のリストなので、pretty-printしてみましょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">['    1. Beautiful is better than ugly.\n',</span>
<span class="go"> '-   2. Explicit is better than implicit.\n',</span>
<span class="go"> '-   3. Simple is better than complex.\n',</span>
<span class="go"> '+   3.   Simple is better than complex.\n',</span>
<span class="go"> '?     ++\n',</span>
<span class="go"> '-   4. Complex is better than complicated.\n',</span>
<span class="go"> '?            ^                     ---- ^\n',</span>
<span class="go"> '+   4. Complicated is better than complex.\n',</span>
<span class="go"> '?           ++++ ^                      ^\n',</span>
<span class="go"> '+   5. Flat is better than nested.\n']</span>
</pre></div>
</div>
<p>これは、複数行の文字列として、次のように出力されます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">    1. Beautiful is better than ugly.</span>
<span class="go">-   2. Explicit is better than implicit.</span>
<span class="go">-   3. Simple is better than complex.</span>
<span class="go">+   3.   Simple is better than complex.</span>
<span class="go">?     ++</span>
<span class="go">-   4. Complex is better than complicated.</span>
<span class="go">?            ^                     ---- ^</span>
<span class="go">+   4. Complicated is better than complex.</span>
<span class="go">?           ++++ ^                      ^</span>
<span class="go">+   5. Flat is better than nested.</span>
</pre></div>
</div>
</div>
<div class="section" id="a-command-line-interface-to-difflib">
<span id="difflib-interface"></span><h2>6.3.5. difflib のコマンドラインインタフェース<a class="headerlink" href="#a-command-line-interface-to-difflib" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は、 difflib を使って <code class="docutils literal"><span class="pre">diff</span></code> に似たユーティリティーを作成する方法を示します。これは、 Python のソース配布物にも、 <code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> として含まれています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">""" Command line interface to difflib.py providing diffs in four formats:</span>

<span class="sd">* ndiff:    lists every line and highlights interline changes.</span>
<span class="sd">* context:  highlights clusters of changes in a before/after format.</span>
<span class="sd">* unified:  highlights clusters of changes in an inline format.</span>
<span class="sd">* html:     generates side by side comparison with change highlights.</span>

<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">difflib</span><span class="o">,</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="k">def</span> <span class="nf">file_mtime</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span>
                               <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a context format diff (default)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-u'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a unified format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-m'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce HTML side by side diff '</span>
                             <span class="s1">'(can use -c and -l in conjunction)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-n'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a ndiff format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-l'</span><span class="p">,</span> <span class="s1">'--lines'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Set number of context lines (default 3)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'fromfile'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'tofile'</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">lines</span>
    <span class="n">fromfile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">fromfile</span>
    <span class="n">tofile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">tofile</span>

    <span class="n">fromdate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span>
    <span class="n">todate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">fromlines</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
        <span class="n">tolines</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">u</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">m</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">HtmlDiff</span><span class="p">()</span><span class="o">.</span><span class="n">make_file</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span><span class="n">tolines</span><span class="p">,</span><span class="n">fromfile</span><span class="p">,</span><span class="n">tofile</span><span class="p">,</span><span class="n">context</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">numlines</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">context_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div aria-label="main navigation" class="sphinxsidebar" role="navigation">
<div class="sphinxsidebarwrapper">
<h3><a href="../contents.html">目次</a></h3>
<ul>
<li><a class="reference internal" href="#">6.3. <code class="docutils literal"><span class="pre">difflib</span></code>  差分の計算を助ける</a><ul>
<li><a class="reference internal" href="#sequencematcher-objects">6.3.1. SequenceMatcherオブジェクト</a></li>
<li><a class="reference internal" href="#sequencematcher-examples">6.3.2. SequenceMatcher の例</a></li>
<li><a class="reference internal" href="#differ-objects">6.3.3. Differ オブジェクト</a></li>
<li><a class="reference internal" href="#differ-example">6.3.4. Differ の例</a></li>
<li><a class="reference internal" href="#a-command-line-interface-to-difflib">6.3.5. difflib のコマンドラインインタフェース</a></li>
</ul>
</li>
</ul>
<h4>前のトピックへ</h4>
<p class="topless"><a href="re.html" title="前の章へ">6.2. <code class="docutils literal"><span class="pre">re</span></code>  正規表現操作</a></p>
<h4>次のトピックへ</h4>
<p class="topless"><a href="textwrap.html" title="次の章へ">6.4. <code class="docutils literal"><span class="pre">textwrap</span></code>  テキストの折り返しと詰め込み</a></p>
<div aria-label="source link" role="note">
<h3>このページ</h3>
<ul class="this-page-menu">
<li><a href="../bugs.html">バグ報告</a></li>
<li>
<a href="https://github.com/python/cpython/blob/3.6/Doc/library/difflib.rst" rel="nofollow">ソースの表示
        </a>
</li>
</ul>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="footer">
     <a href="../copyright.html">Copyright</a> 2001-2018, Python Software Foundation.
    <br/>
    Python Software Foundation は非営利団体です。
    <a href="https://www.python.org/psf/donations/">寄付</a>
<br/>
    最終更新日時: 7月 29, 2018
    <a href="../bugs.html">バグを見つけたら</a>?
    <br/>
    このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.5 を使って作成されました。
    </div>
</body>
</head></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="ja" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>6.3. difflib  差分の計算を助ける  Python 3.6.5 ドキュメント</title>
<link href="../_static/pydoctheme.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
<script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/underscore.js" type="text/javascript"></script>
<script src="../_static/doctools.js" type="text/javascript"></script>
<script src="../_static/translations.js" type="text/javascript"></script>
<script src="../_static/sidebar.js" type="text/javascript"></script>
<link href="../_static/opensearch.xml" rel="search" title="Python 3.6.5 ドキュメント 内を検索" type="application/opensearchdescription+xml"/>
<link href="../about.html" rel="author" title="このドキュメントについて"/>
<link href="../genindex.html" rel="index" title="索引"/>
<link href="../search.html" rel="search" title="検索"/>
<link href="../copyright.html" rel="copyright" title="Copyright"/>
<link href="textwrap.html" rel="next" title="6.4. textwrap  テキストの折り返しと詰め込み"/>
<link href="re.html" rel="prev" title="6.2. re  正規表現操作"/>
<link href="../_static/py.png" rel="shortcut icon" type="image/png"/>
<link href="https://docs.python.jp/3/library/difflib.html" rel="canonical"/><script type="text/javascript">
    $(document).ready(function() {
      var base = 'https://docs.python.org/3.6/library/difflib.html';
      $('a.headerlink').each(function() {
        var html = '<a href="' + base + $(this).attr('href') +
                   '" title="原文へのリンク"><small>(原文)</small></a>';
        $(this).after(html);
      })
    });
    </script>
<script src="../_static/copybutton.js" type="text/javascript"></script>
<script src="../_static/version_switch.js" type="text/javascript"></script>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-34175846-1', 'python.jp');
        ga('send', 'pageview');

      </script>
<body>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a accesskey="I" href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a accesskey="N" href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a accesskey="P" href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a accesskey="U" href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body" role="main">
<div class="section" id="module-difflib">
<span id="difflib-helpers-for-computing-deltas"></span><h1>6.3. <a class="reference internal" href="#module-difflib" title="difflib: Helpers for computing differences between objects."><code class="xref py py-mod docutils literal"><span class="pre">difflib</span></code></a>  差分の計算を助ける<a class="headerlink" href="#module-difflib" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><strong>ソースコード:</strong> <a class="reference external" href="https://github.com/python/cpython/tree/3.6/Lib/difflib.py">Lib/difflib.py</a></p>
<hr class="docutils"/>
<p>このモジュールは、シーケンスを比較するためのクラスや関数を提供しています。例えば、ファイルの差分を計算して、それを HTML や context diff, unified diff などいろいろなフォーマットで出力するために、このモジュールを利用することができます。ディレクトリやファイル群を比較するためには、 <a class="reference internal" href="filecmp.html#module-filecmp" title="filecmp: Compare files efficiently."><code class="xref py py-mod docutils literal"><span class="pre">filecmp</span></code></a> モジュールも参照してください。</p>
<dl class="class">
<dt id="difflib.SequenceMatcher">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><a class="headerlink" href="#difflib.SequenceMatcher" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>柔軟性のあるクラスで、二つのシーケンスの要素がハッシュ化できる(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)型であれば、どの型の要素を含むシーケンスも比較可能です。基本的なアルゴリズムは、1980年代の後半に発表された Ratcliff と Obershelp による"ゲシュタルトパターンマッチング"と大げさに名づけられたアルゴリズム以前から知られている、やや凝ったアルゴリズムです。その考え方は、"junk" 要素を含まない最も長い互いに隣接したマッチ列を探すことです。ここで、  "junk" 要素とは、空行や空白などの、意味を持たない要素のことです。 (junk を処理するのは、Ratcliff と Obershelp のアルゴリズムに追加された拡張です。)この考え方は、マッチ列の左右に隣接するシーケンスの断片に対して再帰的にあてはめられます。この方法では編集を最小にするシーケンスは生まれませんが、人間の目からみて「正しい感じ」にマッチする傾向があります。</p>
<p><strong>実行時間:</strong> 基本的な Ratcliff-Obershelp アルゴリズムは、最悪の場合3乗、期待値で2乗となります。 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトでは、最悪のケースで2乗、期待値は比較されるシーケンス中に共通に現れる要素数に非常にややこしく依存しています。最良の場合は線形時間になります。</p>
<p><strong>自動 junk ヒューリスティック:</strong> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> は、シーケンスの特定の要素を自動的に junk として扱うヒューリスティックをサポートしています。このヒューリスティックは、各個要素がシーケンス内に何回現れるかを数えます。ある要素の重複数が (最初のものは除いて) 合計でシーケンスの 1% 以上になり、そのシーケンスが 200 要素以上なら、その要素は "popular" であるものとしてマークされ、シーケンスのマッチングの目的からは junk として扱われます。このヒューリスティックは、 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> の作成時に <code class="docutils literal"><span class="pre">autojunk</span></code> パラメタを <code class="docutils literal"><span class="pre">False</span></code> に設定することで無効化できます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
</dd></dl>
<dl class="class">
<dt id="difflib.Differ">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><a class="headerlink" href="#difflib.Differ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>テキスト行からなるシーケンスを比較するクラスです。人が読むことのできる差分を作成します。 Differ クラスは <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスを利用して、行からなるシーケンスを比較したり、(ほぼ)同一の行内の文字を比較したりします。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> クラスによる差分の各行は、2文字のコードで始まります:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%"/>
<col width="81%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">コード</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'-</span> <span class="pre">'</span></code></td>
<td>行はシーケンス1にのみ存在する</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'+</span> <span class="pre">'</span></code></td>
<td>行はシーケンス2にのみ存在する</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'</span> <span class="pre">'</span></code></td>
<td>行は両方のシーケンスで同一</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'?</span> <span class="pre">'</span></code></td>
<td>行は入力シーケンスのどちらにも存在しない</td>
</tr>
</tbody>
</table>
<p>'<code class="docutils literal"><span class="pre">?</span></code>' で始まる行は、行内のどこに差異が存在するかに注意を向けようとします。その行は、入力されたシーケンスのどちらにも存在しません。シーケンスがタブ文字を含むとき、これらの行は判別しづらいものになることがあります。</p>
</dd></dl>
<dl class="class">
<dt id="difflib.HtmlDiff">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">HtmlDiff</code><a class="headerlink" href="#difflib.HtmlDiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このクラスは、二つのテキストを左右に並べて比較表示し、行間あるいは行内の変更点を強調表示するような HTML テーブル (またはテーブルの入った完全な HTML ファイル) を生成するために使います。テーブルは完全差分モード、コンテキスト差分モードのいずれでも生成できます。</p>
<p>このクラスのコンストラクタは以下のようになっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>tabsize=8</em>, <em>wrapcolumn=None</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.__init__" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> のインスタンスを初期化します。</p>
<p><em>tabsize</em> はオプションのキーワード引数で、タブストップ幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">8</span></code> です。</p>
<p><em>wrapcolumn</em> はオプションのキーワード引数で、テキストを折り返すカラム幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> で折り返しを行いません。</p>
<p><em>linejunk</em> および <em>charjunk</em> はオプションのキーワード引数で、 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a>  (<a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> はこの関数を使って左右のテキストの差分を HTML で生成します) に渡されます。それぞれの引数のデフォルト値および説明は <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> のドキュメントを参照してください。</p>
</dd></dl>
<p>以下のメソッドが public になっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.make_file">
<code class="descname">make_file</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em>, <em>*</em>, <em>charset='utf-8'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_file" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った表を持つ完全な HTML ファイルを文字列で返します。</p>
<p><em>fromdesc</em> および <em>todesc</em> はオプションのキーワード引数で、差分表示テーブルにおけるそれぞれ差分元、差分先ファイルのカラムのヘッダになる文字列を指定します (いずれもデフォルト値は空文字列です)。</p>
<p><em>context</em> および <em>numlines</em> はともにオプションのキーワード引数です。<em>context</em> を <code class="docutils literal"><span class="pre">True</span></code> にするとコンテキスト差分を表示し、デフォルトの <code class="docutils literal"><span class="pre">False</span></code> にすると完全なファイル差分を表示します。<em>numlines</em> のデフォルト値は <code class="docutils literal"><span class="pre">5</span></code> で、<em>context</em> が <code class="docutils literal"><span class="pre">True</span></code> の場合、<em>numlines</em> は強調部分の前後にあるコンテキスト行の数を制御します。<em>context</em> が <code class="docutils literal"><span class="pre">False</span></code> の場合、<em>numlines</em> は "next" と書かれたハイパーリンクをたどった時に到達する場所が次の変更部分より何行前にあるかを制御します (値をゼロにした場合、"next" ハイパーリンクを辿ると変更部分の強調表示がブラウザの最上部に表示されるようになります)。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.5 で変更: </span><em>charset</em> キーワード専用引数が追加されました。HTML 文書のデフォルトの文字集合が <code class="docutils literal"><span class="pre">'ISO-8859-1'</span></code> から <code class="docutils literal"><span class="pre">'utf-8'</span></code> に変更されました。</p>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.HtmlDiff.make_table">
<code class="descname">make_table</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った完全な HTML テーブルを文字列で返します。</p>
<p>このメソッドの引数は、 <a class="reference internal" href="#difflib.HtmlDiff.make_file" title="difflib.HtmlDiff.make_file"><code class="xref py py-meth docutils literal"><span class="pre">make_file()</span></code></a> メソッドの引数と同じです。</p>
</dd></dl>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> はこのクラスへのコマンドラインフロントエンドで、使い方を学ぶ上で格好の例題が入っています。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.context_diff">
<code class="descclassname">difflib.</code><code class="descname">context_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.context_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 context diff のフォーマット(以下「コンテクスト形式」)で返します。</p>
<p>コンテクスト形式は、変更があった行に前後数行を加えてある、コンパクトな表現方法です。変更箇所は、変更前/変更後に分けて表します。コンテクスト (変更箇所前後の行) の行数は <em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">***</span></code> や <code class="docutils literal"><span class="pre">---</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">context_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">*** before.py</span>
<span class="go">--- after.py</span>
<span class="go">***************</span>
<span class="go">*** 1,4 ****</span>
<span class="go">! bacon</span>
<span class="go">! eggs</span>
<span class="go">! ham</span>
<span class="go">  guido</span>
<span class="go">--- 1,4 ----</span>
<span class="go">! python</span>
<span class="go">! eggy</span>
<span class="go">! hamster</span>
<span class="go">  guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.get_close_matches">
<code class="descclassname">difflib.</code><code class="descname">get_close_matches</code><span class="sig-paren">(</span><em>word</em>, <em>possibilities</em>, <em>n=3</em>, <em>cutoff=0.6</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.get_close_matches" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>「十分」なマッチの上位のリストを返します。<em>word</em> はマッチさせたいシーケンス (大概は文字列) です。<em>possibilities</em> は <em>word</em> にマッチさせるシーケンスのリスト (大概は文字列のリスト) です。</p>
<p>オプションの引数 <em>n</em> (デフォルトでは <code class="docutils literal"><span class="pre">3</span></code>)はメソッドの返すマッチの最大数です。<em>n</em> は <code class="docutils literal"><span class="pre">0</span></code> より大きくなければなりません。</p>
<p>オプションの引数 <em>cutoff</em> (デフォルトでは <code class="docutils literal"><span class="pre">0.6</span></code>)は、区間 [0, 1] に入る小数の値です。<em>word</em> との一致率がそれ未満の <em>possibilities</em> の要素は無視されます。</p>
<p><em>possibilities</em> の要素でマッチした上位(多くても <em>n</em> 個)は、類似度のスコアに応じて(一番似たものを先頭に)ソートされたリストとして返されます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'appel'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ape'</span><span class="p">,</span> <span class="s1">'apple'</span><span class="p">,</span> <span class="s1">'peach'</span><span class="p">,</span> <span class="s1">'puppy'</span><span class="p">])</span>
<span class="go">['apple', 'ape']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">keyword</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'wheel'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['while']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'pineapple'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'accept'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['except']</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.ndiff">
<code class="descclassname">difflib.</code><code class="descname">ndiff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.ndiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> のスタイルで返します。</p>
<p>オプションのキーワード引数 <em>linejunk</em> と <em>charjunk</em> には、フィルタ関数 (または <code class="docutils literal"><span class="pre">None</span></code>) を渡します。</p>
<p><em>linejunk</em>: 文字列型の引数 1 つを受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは <code class="docutils literal"><span class="pre">None</span></code> です。モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_LINE_JUNK" title="difflib.IS_LINE_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_LINE_JUNK()</span></code></a> は、高々 1 つのシャープ記号(<code class="docutils literal"><span class="pre">'#'</span></code>)を除いて可視の文字を含まない行をフィルタリングするものです。しかし、下層にある <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスが、どの行が雑音となるほど頻繁に登場するかを動的に分析します。このクラスによる分析は、この関数を使用するよりも通常うまく動作します。</p>
<p><em>charjunk</em>: 文字 (長さ1の文字列) を受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは、モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_CHARACTER_JUNK" title="difflib.IS_CHARACTER_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_CHARACTER_JUNK()</span></code></a> であり、これは空白文字類 (空白またはタブ、改行文字をこれに含めてはいけません) をフィルタして排除します。</p>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/ndiff.py</span></code> は、この関数のコマンドラインのフロントエンド（インターフェイス）です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">diff</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">- one</span>
<span class="go">?  ^</span>
<span class="go">+ ore</span>
<span class="go">?  ^</span>
<span class="go">- two</span>
<span class="go">- three</span>
<span class="go">?  -</span>
<span class="go">+ tree</span>
<span class="go">+ emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.restore">
<code class="descclassname">difflib.</code><code class="descname">restore</code><span class="sig-paren">(</span><em>sequence</em>, <em>which</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.restore" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>差分を生成した元の二つのシーケンスのうち一つを返します。</p>
<p><a class="reference internal" href="#difflib.Differ.compare" title="difflib.Differ.compare"><code class="xref py py-meth docutils literal"><span class="pre">Differ.compare()</span></code></a> または <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> によって生成された <em>sequence</em> を与えられると、行頭のプレフィクスを取りのぞいてファイル 1 または 2 (引数 <em>which</em> で指定される) に由来する行を復元します。</p>
<p>例:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="c1"># materialize the generated delta into a list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">one</span>
<span class="go">two</span>
<span class="go">three</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">ore</span>
<span class="go">tree</span>
<span class="go">emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.unified_diff">
<code class="descclassname">difflib.</code><code class="descname">unified_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.unified_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 unified diff フォーマット(以下「ユニファイド形式」)で返します。</p>
<p>ユニファイド形式は変更があった行にコンテキストとなる前後数行を加えた、コンパクトな表現方法です。変更箇所は (変更前/変更後を分離したブロックではなく) インラインスタイルで表されます。コンテクストの行数は、<em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">---</span></code>, <code class="docutils literal"><span class="pre">+++</span></code>, <code class="docutils literal"><span class="pre">@@</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">--- before.py</span>
<span class="go">+++ after.py</span>
<span class="go">@@ -1,4 +1,4 @@</span>
<span class="go">-bacon</span>
<span class="go">-eggs</span>
<span class="go">-ham</span>
<span class="go">+python</span>
<span class="go">+eggy</span>
<span class="go">+hamster</span>
<span class="go"> guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.diff_bytes">
<code class="descclassname">difflib.</code><code class="descname">diff_bytes</code><span class="sig-paren">(</span><em>dfunc</em>, <em>a</em>, <em>b</em>, <em>fromfile=b''</em>, <em>tofile=b''</em>, <em>fromfiledate=b''</em>, <em>tofiledate=b''</em>, <em>n=3</em>, <em>lineterm=b'\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.diff_bytes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>dfunc</em> を使用して <em>a</em> と <em>b</em> (bytes オブジェクトのリスト) を比較して、差分形式の行 (これも bytes オブジェクトです) を*dfunc* の戻り値の形式で返します。<em>dfunc</em> は、呼び出し可能である必要があります。一般に、これは <a class="reference internal" href="#difflib.unified_diff" title="difflib.unified_diff"><code class="xref py py-func docutils literal"><span class="pre">unified_diff()</span></code></a> または <a class="reference internal" href="#difflib.context_diff" title="difflib.context_diff"><code class="xref py py-func docutils literal"><span class="pre">context_diff()</span></code></a> です。</p>
<p>未知のエンコーディングまたは一貫性のないエンコーディングのデータ同士を比較できます。<em>n</em> 以外のすべての入力は、bytes オブジェクトである必要があります。<em>n</em> 以外のすべての入力を損失なく str に変換して、<code class="docutils literal"><span class="pre">dfunc(a,</span> <span class="pre">b,</span> <span class="pre">fromfile,</span> <span class="pre">tofile,</span> <span class="pre">fromfiledate,</span> <span class="pre">tofiledate,</span> <span class="pre">n,</span> <span class="pre">lineterm)</span></code> を呼び出すことにより動作します。<em>dfunc</em> の出力は、bytes 型に変換されます。これにより、受け取る差分形式の行のエンコーディングは、<em>a</em> と <em>b</em> の未知または一貫性のないエンコーディングと同一になります。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_LINE_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_LINE_JUNK</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_LINE_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる行のとき真を返します。行 <em>line</em> は空白、または  <code class="docutils literal"><span class="pre">'#'</span></code> ひとつのときに無視できます。それ以外のときには無視できません。古いバージョンでは <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>linejunk</em> にデフォルトで使用されました。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_CHARACTER_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_CHARACTER_JUNK</code><span class="sig-paren">(</span><em>ch</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_CHARACTER_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる文字のとき真を返します。文字 <em>ch</em> が空白、またはタブ文字のときには無視できます。それ以外の時には無視できません。 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>charjunk</em> としてデフォルトで使用されます。</p>
</dd></dl>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><a class="reference external" href="http://www.drdobbs.com/database/pattern-matching-the-gestalt-approach/184407970">Pattern Matching: The Gestalt Approach</a></dt>
<dd>John W. Ratcliff と D. E. Metzener による類似のアルゴリズムに関する議論。<a class="reference external" href="http://www.drdobbs.com/">Dr. Dobb’s Journal</a> 1988年7月号掲載。</dd>
</dl>
</div>
<div class="section" id="sequencematcher-objects">
<span id="sequence-matcher"></span><h2>6.3.1. SequenceMatcherオブジェクト<a class="headerlink" href="#sequencematcher-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスには、以下のようなコンストラクタがあります:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><span class="sig-paren">(</span><em>isjunk=None</em>, <em>a=''</em>, <em>b=''</em>, <em>autojunk=True</em><span class="sig-paren">)</span></dt>
<dd><p>オプションの引数 <em>isjunk</em> は、<code class="docutils literal"><span class="pre">None</span></code> (デフォルトの値です) にするか、単一の引数をとる関数でなければなりません。後者の場合、関数はシーケンスの要素を受け取り、要素が junk であり、無視すべきである場合に限り真を返すようにしなければなりません。<em>isjunk</em> に <code class="docutils literal"><span class="pre">None</span></code> を渡すと、<code class="docutils literal"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">0</span></code> を渡したのと同じになります; すなわち、いかなる要素も無視しなくなります。例えば以下のような引数を渡すと:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">" </span><span class="se">\t</span><span class="s2">"</span>
</pre></div>
</div>
<p>空白とタブ文字を無視して文字のシーケンスを比較します。</p>
<p>オプションの引数 <em>a</em> と <em>b</em> は、比較される文字列で、デフォルトでは空の文字列です。両方のシーケンスの要素は、ハッシュ化可能(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)である必要があります。</p>
<p>オプションの引数 <em>autojunk</em> は、自動 junk ヒューリスティックを無効にするために使えます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
<p>SequenceMatcher オブジェクトは3つのデータ属性を持っています: <em>bjunk</em> は、 <em>isjunk</em> が <code class="docutils literal"><span class="pre">True</span></code> であるような <em>b</em> の要素の集合です; <em>bpopular</em> は、 (無効でなければ) ヒューリスティックによって popular であると考えられる非ジャンク要素の集合です; <em>b2j</em> は、 <em>b</em> の残りの要素をそれらが生じる位置のリストに写像する dict です。この 3 つは <a class="reference internal" href="#difflib.SequenceMatcher.set_seqs" title="difflib.SequenceMatcher.set_seqs"><code class="xref py py-meth docutils literal"><span class="pre">set_seqs()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> で <em>b</em> がリセットされる場合は常にリセットされます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>bjunk</em> および <em>bpopular</em> 属性。</p>
</div>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは以下のメソッドを持ちます:</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seqs">
<code class="descname">set_seqs</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seqs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較される2つの文字列を設定します。</p>
</dd></dl>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは、2つ目のシーケンスについての詳細な情報を計算し、キャッシュします。 1つのシーケンスをいくつものシーケンスと比較する場合、まず <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> を使って文字列を設定しておき、別の文字列を1つずつ比較するために、繰り返し <a class="reference internal" href="#difflib.SequenceMatcher.set_seq1" title="difflib.SequenceMatcher.set_seq1"><code class="xref py py-meth docutils literal"><span class="pre">set_seq1()</span></code></a> を呼び出します。</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq1">
<code class="descname">set_seq1</code><span class="sig-paren">(</span><em>a</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq1" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う1つ目のシーケンスを設定します。比較される2つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq2">
<code class="descname">set_seq2</code><span class="sig-paren">(</span><em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq2" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う2つ目のシーケンスを設定します。比較される1つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.find_longest_match">
<code class="descname">find_longest_match</code><span class="sig-paren">(</span><em>alo</em>, <em>ahi</em>, <em>blo</em>, <em>bhi</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.find_longest_match" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">a[alo:ahi]</span></code> と <code class="docutils literal"><span class="pre">b[blo:bhi]</span></code> の中から、最長のマッチ列を探します。</p>
<p><em>isjunk</em> が省略されたか <code class="docutils literal"><span class="pre">None</span></code> の時、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> は <code class="docutils literal"><span class="pre">a[i:i+k]</span></code> が <code class="docutils literal"><span class="pre">b[j:j+k]</span></code> と等しいような <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">k)</span></code> を返します。その値は <code class="docutils literal"><span class="pre">alo</span> <span class="pre">&lt;=</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i+k</span> <span class="pre">&lt;=</span> <span class="pre">ahi</span></code> かつ <code class="docutils literal"><span class="pre">blo</span> <span class="pre">&lt;=</span> <span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j+k</span> <span class="pre">&lt;=</span> <span class="pre">bhi</span></code> となります。 <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">k')</span></code> でも、同じようになります。さらに <code class="docutils literal"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">k'</span></code>, <code class="docutils literal"><span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i'</span></code> が <code class="docutils literal"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">i'</span></code>, <code class="docutils literal"><span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j'</span></code> でも同様です。言い換えると、いくつものマッチ列すべてのうち、 <em>a</em> 内で最初に始まるものを返します。そしてその <em>a</em> 内で最初のマッチ列すべてのうち <em>b</em> 内で最初に始まるものを返します。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=0, b=4, size=5)</span>
</pre></div>
</div>
<p>引数 <em>isjunk</em> が与えられている場合、上記の通り、はじめに最長のマッチ列を判定します。ブロック内に junk 要素が見当たらないような追加条件の際はこれに該当しません。次にそのマッチ列を、その両側の junk 要素にマッチするよう、できる限り広げていきます。そのため結果となる列は、探している列のたまたま直前にあった同一の junk 以外の junk にはマッチしません。</p>
<p>以下は前と同じサンプルですが、空白を junk とみなしています。これは <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> が2つ目の列の末尾にある <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> にマッチしないようにしています。代わりに <code class="docutils literal"><span class="pre">'abcd'</span></code> にはマッチします。そして 2つ目の文字列中、一番左の <code class="docutils literal"><span class="pre">'abcd'</span></code> にマッチします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">==</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=1, b=0, size=4)</span>
</pre></div>
</div>
<p>どんな列にもマッチしない時は、<code class="docutils literal"><span class="pre">(alo,</span> <span class="pre">blo,</span> <span class="pre">0)</span></code> を返します。</p>
<p>このメソッドは <a class="reference internal" href="../glossary.html#term-named-tuple"><span class="xref std std-term">named tuple</span></a> <code class="docutils literal"><span class="pre">Match(a,</span> <span class="pre">b,</span> <span class="pre">size)</span></code> を返します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_matching_blocks">
<code class="descname">get_matching_blocks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_matching_blocks" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>マッチしたシーケンス中で個別にマッチしたシーケンスをあらわす、3つの値のリストを返します。それぞれの値は <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> という形式であらわされ、<code class="docutils literal"><span class="pre">a[i:i+n]</span> <span class="pre">==</span> <span class="pre">b[j:j+n]</span></code> という関係を意味します。3つの値は <em>i</em> と <em>j</em> の間で単調に増加します。</p>
<p>最後のタプルはダミーで、<code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> という値を持ちます。これは <code class="docutils literal"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">0</span></code> である唯一のタプルです。もし <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> と <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">n')</span></code> がリストで並んでいる3つ組で、2つ目が最後の3つ組でなければ、<code class="docutils literal"><span class="pre">i+n</span> <span class="pre">!=</span> <span class="pre">i'</span></code> または <code class="docutils literal"><span class="pre">j+n</span> <span class="pre">!=</span> <span class="pre">j'</span></code> です。言い換えると並んでいる3つ組は常に隣接していない同じブロックを表しています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abxcd"</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">()</span>
<span class="go">[Match(a=0, b=0, size=2), Match(a=3, b=2, size=2), Match(a=5, b=4, size=0)]</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_opcodes">
<code class="descname">get_opcodes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> を <em>b</em> にするための方法を記述する5つのタプルを返します。それぞれのタプルは <code class="docutils literal"><span class="pre">(tag,</span> <span class="pre">i1,</span> <span class="pre">i2,</span> <span class="pre">j1,</span> <span class="pre">j2)</span></code> という形式であらわされます。最初のタプルは <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">j1</span> <span class="pre">==</span> <span class="pre">0</span></code> であり、<em>i1</em> はその前にあるタプルの <em>i2</em> と同じ値です。同様に <em>j1</em> は前の <em>j2</em> と同じ値になります。</p>
<p><em>tag</em> の値は文字列であり、次のような意味です:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%"/>
<col width="75%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'replace'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は <code class="docutils literal"><span class="pre">b[j1:j2]</span></code> に置き換えられる。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'delete'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は削除される。この時、<code class="docutils literal"><span class="pre">j1</span> <span class="pre">==</span> <span class="pre">j2</span></code> である。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'insert'</span></code></td>
<td><code class="docutils literal"><span class="pre">b[j1:j2]</span></code> が <code class="docutils literal"><span class="pre">a[i1:i1]</span></code> に挿入される。この時 <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">i2</span></code> である。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'equal'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span> <span class="pre">==</span> <span class="pre">b[j1:j2]</span></code> (サブシーケンスは等しい).</td>
</tr>
</tbody>
</table>
<p>例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="s2">"qabxcd"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="s2">"abycdf"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{:7}</span><span class="s1">   a[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] --&gt; b[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] </span><span class="si">{!r:&gt;8}</span><span class="s1"> --&gt; </span><span class="si">{!r}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">]))</span>
<span class="go">delete    a[0:1] --&gt; b[0:0]      'q' --&gt; ''</span>
<span class="go">equal     a[1:3] --&gt; b[0:2]     'ab' --&gt; 'ab'</span>
<span class="go">replace   a[3:4] --&gt; b[2:3]      'x' --&gt; 'y'</span>
<span class="go">equal     a[4:6] --&gt; b[3:5]     'cd' --&gt; 'cd'</span>
<span class="go">insert    a[6:6] --&gt; b[5:6]       '' --&gt; 'f'</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_grouped_opcodes">
<code class="descname">get_grouped_opcodes</code><span class="sig-paren">(</span><em>n=3</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_grouped_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>最大 <em>n</em> 行までのコンテクストを含むグループを生成するような、ジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)を返します。</p>
<p>このメソッドは、 <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> で返されるグループの中から、似たような差異のかたまりに分け、間に挟まっている変更の無い部分を省きます。</p>
<p>グループは <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> と同じ書式で返されます。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.ratio">
<code class="descname">ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>[0, 1] の範囲の浮動小数点数で、シーケンスの類似度を測る値を返します。</p>
<p>T が2つのシーケンスの要素数の総計だと仮定し、M をマッチした数とすると、この値は 2.0*M / T であらわされます。もしシーケンスがまったく同じ場合、値は <code class="docutils literal"><span class="pre">1.0</span></code> となり、まったく異なる場合には <code class="docutils literal"><span class="pre">0.0</span></code> となります。</p>
<p>このメソッドは <a class="reference internal" href="#difflib.SequenceMatcher.get_matching_blocks" title="difflib.SequenceMatcher.get_matching_blocks"><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> がまだ呼び出されていない場合には非常にコストが高いです。この場合、上限を素早く計算するために、 <a class="reference internal" href="#difflib.SequenceMatcher.quick_ratio" title="difflib.SequenceMatcher.quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code></a> もしくは <a class="reference internal" href="#difflib.SequenceMatcher.real_quick_ratio" title="difflib.SequenceMatcher.real_quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code></a> を最初に試してみる方がいいかもしれません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.quick_ratio">
<code class="descname">quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、より高速に計算します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.real_quick_ratio">
<code class="descname">real_quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.real_quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、非常に高速に計算します。</p>
</dd></dl>
</dd></dl>
<p>この文字列全体のマッチ率を返す3つのメソッドは、精度の異なる近似値を返します。 <code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code> と <code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code> は、常に <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> 以上の値を返します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">,</span> <span class="s2">"bcde"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">quick_ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">real_quick_ratio</span><span class="p">()</span>
<span class="go">1.0</span>
</pre></div>
</div>
</div>
<div class="section" id="sequencematcher-examples">
<span id="id1"></span><h2>6.3.2. SequenceMatcher の例<a class="headerlink" href="#sequencematcher-examples" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は2つの文字列を比較します。空白を "junk" とします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">" "</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private Thread currentThread;"</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private volatile Thread currentThread;"</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> は、[0, 1] の範囲の値を返し、シーケンスの類似度を測ります。経験によると、 <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> の値が0.6を超えると、シーケンスがよく似ていることを示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="go">0.866</span>
</pre></div>
</div>
<p>シーケンスのどこがマッチしているかにだけ興味のある時には <code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が手軽でしょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"a[</span><span class="si">%d</span><span class="s2">] and b[</span><span class="si">%d</span><span class="s2">] match for </span><span class="si">%d</span><span class="s2"> elements"</span> <span class="o">%</span> <span class="n">block</span><span class="p">)</span>
<span class="go">a[0] and b[0] match for 8 elements</span>
<span class="go">a[8] and b[17] match for 21 elements</span>
<span class="go">a[29] and b[38] match for 0 elements</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が返す最後のタプルが常にダミーであることに注目してください。このダミーは <code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> であり、これはタプルの最後の要素（マッチする要素の数）が <code class="docutils literal"><span class="pre">0</span></code> となる唯一のケースです。</p>
<p>はじめのシーケンスがどのようにして2番目のものになるのかを知るには、 <code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code> を使います:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%6s</span><span class="s2"> a[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">] b[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">]"</span> <span class="o">%</span> <span class="n">opcode</span><span class="p">)</span>
<span class="go"> equal a[0:8] b[0:8]</span>
<span class="go">insert a[8:8] b[8:17]</span>
<span class="go"> equal a[8:29] b[17:38]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<ul class="last simple">
<li><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> を使った、シンプルで使えるコードを知るには、このモジュールの関数 <a class="reference internal" href="#difflib.get_close_matches" title="difflib.get_close_matches"><code class="xref py py-func docutils literal"><span class="pre">get_close_matches()</span></code></a> を参照してください。</li>
<li><a class="reference external" href="https://code.activestate.com/recipes/576729/">Simple version control recipe</a> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> で作った小規模アプリケーション。</li>
</ul>
</div>
</div>
<div class="section" id="differ-objects">
<span id="id2"></span><h2>6.3.3. Differ オブジェクト<a class="headerlink" href="#differ-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトによって生成された差分が <strong>最小</strong> であるなどとは言いません。むしろ、最小の差分はしばしば直観に反しています。その理由は、どこでもできるとなれば一致を見いだしてしまうからで、ときには思いがけなく100ページも離れたマッチになってしまうのです。一致点を互いに隣接したマッチに制限することで、場合によって長めの差分を出力するというコストを掛けることにはなっても、ある種の局所性を保つことができるのです。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> は、以下のようなコンストラクタを持ちます:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><span class="sig-paren">(</span><em>linejunk=None</em>, <em>charjunk=None</em><span class="sig-paren">)</span></dt>
<dd><p>オプションのキーワードパラメータ <em>linejunk</em> と <em>charjunk</em> は、フィルタ関数を渡します (使わないときは <code class="docutils literal"><span class="pre">None</span></code>):</p>
<p><em>linejunk</em>: ひとつの文字列引数を受け取る関数です。文字列が junk のときに真を返します。デフォルトでは、<code class="docutils literal"><span class="pre">None</span></code> であり、どんな行であっても junk とは見なされません。</p>
<p><em>charjunk</em>: この関数は文字(長さ1の文字列)を引数として受け取り、文字が junk であるときに真を返します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> であり、どんな文字も junk とは見なされません。</p>
<p>これらの junk フィルター関数により、差分を発見するマッチングが高速化し、差分の行や文字が無視されることがなくなります。説明については、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> メソッドの <em>isjunk</em> 引数の説明をご覧ください。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトは、以下の1つのメソッドを通して利用されます。（差分を生成します）:</p>
<dl class="method">
<dt id="difflib.Differ.compare">
<code class="descname">compare</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.Differ.compare" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>文字列からなる2つのシーケンスを比較し、差分（を表す文字列からなるシーケンス）を生成します。</p>
<p>各シーケンスの要素は、改行で終わる独立した単一行からなる文字列でなければなりません。そのようなシーケンスは、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code></a> メソッドによって得ることができます。（得られる）差分は改行文字で終了する文字列のシーケンスとして得られ、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-meth docutils literal"><span class="pre">writelines()</span></code></a> メソッドによって出力できる形になっています。</p>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="differ-example">
<span id="differ-examples"></span><h2>6.3.4. Differ の例<a class="headerlink" href="#differ-example" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下の例は2つのテキストを比較しています。最初に、テキストを行毎に改行で終わる文字列のシーケンスにセットアップします (そのようなシーケンスは、ファイル風オブジェクトの <code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code> メソッドからも得ることができます):</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  2. Explicit is better than implicit.</span>
<span class="gp">... </span><span class="s1">  3. Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complex is better than complicated.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">'\n'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text2</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  3.   Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complicated is better than complex.</span>
<span class="gp">... </span><span class="s1">  5. Flat is better than nested.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>次に Differ オブジェクトをインスタンス化します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Differ</span><span class="p">()</span>
</pre></div>
</div>
<p>注意:  <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトをインスタンス化するとき、行 junk と文字 junk をフィルタリングする関数を渡すことができます。詳細は <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-meth docutils literal"><span class="pre">Differ()</span></code></a> コンストラクタを参照してください。</p>
<p>最後に、2つを比較します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">result</span></code> は文字列のリストなので、pretty-printしてみましょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">['    1. Beautiful is better than ugly.\n',</span>
<span class="go"> '-   2. Explicit is better than implicit.\n',</span>
<span class="go"> '-   3. Simple is better than complex.\n',</span>
<span class="go"> '+   3.   Simple is better than complex.\n',</span>
<span class="go"> '?     ++\n',</span>
<span class="go"> '-   4. Complex is better than complicated.\n',</span>
<span class="go"> '?            ^                     ---- ^\n',</span>
<span class="go"> '+   4. Complicated is better than complex.\n',</span>
<span class="go"> '?           ++++ ^                      ^\n',</span>
<span class="go"> '+   5. Flat is better than nested.\n']</span>
</pre></div>
</div>
<p>これは、複数行の文字列として、次のように出力されます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">    1. Beautiful is better than ugly.</span>
<span class="go">-   2. Explicit is better than implicit.</span>
<span class="go">-   3. Simple is better than complex.</span>
<span class="go">+   3.   Simple is better than complex.</span>
<span class="go">?     ++</span>
<span class="go">-   4. Complex is better than complicated.</span>
<span class="go">?            ^                     ---- ^</span>
<span class="go">+   4. Complicated is better than complex.</span>
<span class="go">?           ++++ ^                      ^</span>
<span class="go">+   5. Flat is better than nested.</span>
</pre></div>
</div>
</div>
<div class="section" id="a-command-line-interface-to-difflib">
<span id="difflib-interface"></span><h2>6.3.5. difflib のコマンドラインインタフェース<a class="headerlink" href="#a-command-line-interface-to-difflib" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は、 difflib を使って <code class="docutils literal"><span class="pre">diff</span></code> に似たユーティリティーを作成する方法を示します。これは、 Python のソース配布物にも、 <code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> として含まれています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">""" Command line interface to difflib.py providing diffs in four formats:</span>

<span class="sd">* ndiff:    lists every line and highlights interline changes.</span>
<span class="sd">* context:  highlights clusters of changes in a before/after format.</span>
<span class="sd">* unified:  highlights clusters of changes in an inline format.</span>
<span class="sd">* html:     generates side by side comparison with change highlights.</span>

<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">difflib</span><span class="o">,</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="k">def</span> <span class="nf">file_mtime</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span>
                               <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a context format diff (default)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-u'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a unified format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-m'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce HTML side by side diff '</span>
                             <span class="s1">'(can use -c and -l in conjunction)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-n'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a ndiff format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-l'</span><span class="p">,</span> <span class="s1">'--lines'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Set number of context lines (default 3)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'fromfile'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'tofile'</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">lines</span>
    <span class="n">fromfile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">fromfile</span>
    <span class="n">tofile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">tofile</span>

    <span class="n">fromdate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span>
    <span class="n">todate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">fromlines</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
        <span class="n">tolines</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">u</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">m</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">HtmlDiff</span><span class="p">()</span><span class="o">.</span><span class="n">make_file</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span><span class="n">tolines</span><span class="p">,</span><span class="n">fromfile</span><span class="p">,</span><span class="n">tofile</span><span class="p">,</span><span class="n">context</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">numlines</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">context_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div aria-label="main navigation" class="sphinxsidebar" role="navigation">
<div class="sphinxsidebarwrapper">
<h3><a href="../contents.html">目次</a></h3>
<ul>
<li><a class="reference internal" href="#">6.3. <code class="docutils literal"><span class="pre">difflib</span></code>  差分の計算を助ける</a><ul>
<li><a class="reference internal" href="#sequencematcher-objects">6.3.1. SequenceMatcherオブジェクト</a></li>
<li><a class="reference internal" href="#sequencematcher-examples">6.3.2. SequenceMatcher の例</a></li>
<li><a class="reference internal" href="#differ-objects">6.3.3. Differ オブジェクト</a></li>
<li><a class="reference internal" href="#differ-example">6.3.4. Differ の例</a></li>
<li><a class="reference internal" href="#a-command-line-interface-to-difflib">6.3.5. difflib のコマンドラインインタフェース</a></li>
</ul>
</li>
</ul>
<h4>前のトピックへ</h4>
<p class="topless"><a href="re.html" title="前の章へ">6.2. <code class="docutils literal"><span class="pre">re</span></code>  正規表現操作</a></p>
<h4>次のトピックへ</h4>
<p class="topless"><a href="textwrap.html" title="次の章へ">6.4. <code class="docutils literal"><span class="pre">textwrap</span></code>  テキストの折り返しと詰め込み</a></p>
<div aria-label="source link" role="note">
<h3>このページ</h3>
<ul class="this-page-menu">
<li><a href="../bugs.html">バグ報告</a></li>
<li>
<a href="https://github.com/python/cpython/blob/3.6/Doc/library/difflib.rst" rel="nofollow">ソースの表示
        </a>
</li>
</ul>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="footer">
     <a href="../copyright.html">Copyright</a> 2001-2018, Python Software Foundation.
    <br/>
    Python Software Foundation は非営利団体です。
    <a href="https://www.python.org/psf/donations/">寄付</a>
<br/>
    最終更新日時: 7月 29, 2018
    <a href="../bugs.html">バグを見つけたら</a>?
    <br/>
    このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.5 を使って作成されました。
    </div>
</body>
</head></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="ja" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>6.3. difflib  差分の計算を助ける  Python 3.6.5 ドキュメント</title>
<link href="../_static/pydoctheme.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
<script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/underscore.js" type="text/javascript"></script>
<script src="../_static/doctools.js" type="text/javascript"></script>
<script src="../_static/translations.js" type="text/javascript"></script>
<script src="../_static/sidebar.js" type="text/javascript"></script>
<link href="../_static/opensearch.xml" rel="search" title="Python 3.6.5 ドキュメント 内を検索" type="application/opensearchdescription+xml"/>
<link href="../about.html" rel="author" title="このドキュメントについて"/>
<link href="../genindex.html" rel="index" title="索引"/>
<link href="../search.html" rel="search" title="検索"/>
<link href="../copyright.html" rel="copyright" title="Copyright"/>
<link href="textwrap.html" rel="next" title="6.4. textwrap  テキストの折り返しと詰め込み"/>
<link href="re.html" rel="prev" title="6.2. re  正規表現操作"/>
<link href="../_static/py.png" rel="shortcut icon" type="image/png"/>
<link href="https://docs.python.jp/3/library/difflib.html" rel="canonical"/><script type="text/javascript">
    $(document).ready(function() {
      var base = 'https://docs.python.org/3.6/library/difflib.html';
      $('a.headerlink').each(function() {
        var html = '<a href="' + base + $(this).attr('href') +
                   '" title="原文へのリンク"><small>(原文)</small></a>';
        $(this).after(html);
      })
    });
    </script>
<script src="../_static/copybutton.js" type="text/javascript"></script>
<script src="../_static/version_switch.js" type="text/javascript"></script>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-34175846-1', 'python.jp');
        ga('send', 'pageview');

      </script>
<body>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a accesskey="I" href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a accesskey="N" href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a accesskey="P" href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a accesskey="U" href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body" role="main">
<div class="section" id="module-difflib">
<span id="difflib-helpers-for-computing-deltas"></span><h1>6.3. <a class="reference internal" href="#module-difflib" title="difflib: Helpers for computing differences between objects."><code class="xref py py-mod docutils literal"><span class="pre">difflib</span></code></a>  差分の計算を助ける<a class="headerlink" href="#module-difflib" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><strong>ソースコード:</strong> <a class="reference external" href="https://github.com/python/cpython/tree/3.6/Lib/difflib.py">Lib/difflib.py</a></p>
<hr class="docutils"/>
<p>このモジュールは、シーケンスを比較するためのクラスや関数を提供しています。例えば、ファイルの差分を計算して、それを HTML や context diff, unified diff などいろいろなフォーマットで出力するために、このモジュールを利用することができます。ディレクトリやファイル群を比較するためには、 <a class="reference internal" href="filecmp.html#module-filecmp" title="filecmp: Compare files efficiently."><code class="xref py py-mod docutils literal"><span class="pre">filecmp</span></code></a> モジュールも参照してください。</p>
<dl class="class">
<dt id="difflib.SequenceMatcher">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><a class="headerlink" href="#difflib.SequenceMatcher" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>柔軟性のあるクラスで、二つのシーケンスの要素がハッシュ化できる(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)型であれば、どの型の要素を含むシーケンスも比較可能です。基本的なアルゴリズムは、1980年代の後半に発表された Ratcliff と Obershelp による"ゲシュタルトパターンマッチング"と大げさに名づけられたアルゴリズム以前から知られている、やや凝ったアルゴリズムです。その考え方は、"junk" 要素を含まない最も長い互いに隣接したマッチ列を探すことです。ここで、  "junk" 要素とは、空行や空白などの、意味を持たない要素のことです。 (junk を処理するのは、Ratcliff と Obershelp のアルゴリズムに追加された拡張です。)この考え方は、マッチ列の左右に隣接するシーケンスの断片に対して再帰的にあてはめられます。この方法では編集を最小にするシーケンスは生まれませんが、人間の目からみて「正しい感じ」にマッチする傾向があります。</p>
<p><strong>実行時間:</strong> 基本的な Ratcliff-Obershelp アルゴリズムは、最悪の場合3乗、期待値で2乗となります。 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトでは、最悪のケースで2乗、期待値は比較されるシーケンス中に共通に現れる要素数に非常にややこしく依存しています。最良の場合は線形時間になります。</p>
<p><strong>自動 junk ヒューリスティック:</strong> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> は、シーケンスの特定の要素を自動的に junk として扱うヒューリスティックをサポートしています。このヒューリスティックは、各個要素がシーケンス内に何回現れるかを数えます。ある要素の重複数が (最初のものは除いて) 合計でシーケンスの 1% 以上になり、そのシーケンスが 200 要素以上なら、その要素は "popular" であるものとしてマークされ、シーケンスのマッチングの目的からは junk として扱われます。このヒューリスティックは、 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> の作成時に <code class="docutils literal"><span class="pre">autojunk</span></code> パラメタを <code class="docutils literal"><span class="pre">False</span></code> に設定することで無効化できます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
</dd></dl>
<dl class="class">
<dt id="difflib.Differ">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><a class="headerlink" href="#difflib.Differ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>テキスト行からなるシーケンスを比較するクラスです。人が読むことのできる差分を作成します。 Differ クラスは <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスを利用して、行からなるシーケンスを比較したり、(ほぼ)同一の行内の文字を比較したりします。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> クラスによる差分の各行は、2文字のコードで始まります:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%"/>
<col width="81%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">コード</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'-</span> <span class="pre">'</span></code></td>
<td>行はシーケンス1にのみ存在する</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'+</span> <span class="pre">'</span></code></td>
<td>行はシーケンス2にのみ存在する</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'</span> <span class="pre">'</span></code></td>
<td>行は両方のシーケンスで同一</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'?</span> <span class="pre">'</span></code></td>
<td>行は入力シーケンスのどちらにも存在しない</td>
</tr>
</tbody>
</table>
<p>'<code class="docutils literal"><span class="pre">?</span></code>' で始まる行は、行内のどこに差異が存在するかに注意を向けようとします。その行は、入力されたシーケンスのどちらにも存在しません。シーケンスがタブ文字を含むとき、これらの行は判別しづらいものになることがあります。</p>
</dd></dl>
<dl class="class">
<dt id="difflib.HtmlDiff">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">HtmlDiff</code><a class="headerlink" href="#difflib.HtmlDiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このクラスは、二つのテキストを左右に並べて比較表示し、行間あるいは行内の変更点を強調表示するような HTML テーブル (またはテーブルの入った完全な HTML ファイル) を生成するために使います。テーブルは完全差分モード、コンテキスト差分モードのいずれでも生成できます。</p>
<p>このクラスのコンストラクタは以下のようになっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>tabsize=8</em>, <em>wrapcolumn=None</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.__init__" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> のインスタンスを初期化します。</p>
<p><em>tabsize</em> はオプションのキーワード引数で、タブストップ幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">8</span></code> です。</p>
<p><em>wrapcolumn</em> はオプションのキーワード引数で、テキストを折り返すカラム幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> で折り返しを行いません。</p>
<p><em>linejunk</em> および <em>charjunk</em> はオプションのキーワード引数で、 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a>  (<a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> はこの関数を使って左右のテキストの差分を HTML で生成します) に渡されます。それぞれの引数のデフォルト値および説明は <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> のドキュメントを参照してください。</p>
</dd></dl>
<p>以下のメソッドが public になっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.make_file">
<code class="descname">make_file</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em>, <em>*</em>, <em>charset='utf-8'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_file" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った表を持つ完全な HTML ファイルを文字列で返します。</p>
<p><em>fromdesc</em> および <em>todesc</em> はオプションのキーワード引数で、差分表示テーブルにおけるそれぞれ差分元、差分先ファイルのカラムのヘッダになる文字列を指定します (いずれもデフォルト値は空文字列です)。</p>
<p><em>context</em> および <em>numlines</em> はともにオプションのキーワード引数です。<em>context</em> を <code class="docutils literal"><span class="pre">True</span></code> にするとコンテキスト差分を表示し、デフォルトの <code class="docutils literal"><span class="pre">False</span></code> にすると完全なファイル差分を表示します。<em>numlines</em> のデフォルト値は <code class="docutils literal"><span class="pre">5</span></code> で、<em>context</em> が <code class="docutils literal"><span class="pre">True</span></code> の場合、<em>numlines</em> は強調部分の前後にあるコンテキスト行の数を制御します。<em>context</em> が <code class="docutils literal"><span class="pre">False</span></code> の場合、<em>numlines</em> は "next" と書かれたハイパーリンクをたどった時に到達する場所が次の変更部分より何行前にあるかを制御します (値をゼロにした場合、"next" ハイパーリンクを辿ると変更部分の強調表示がブラウザの最上部に表示されるようになります)。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.5 で変更: </span><em>charset</em> キーワード専用引数が追加されました。HTML 文書のデフォルトの文字集合が <code class="docutils literal"><span class="pre">'ISO-8859-1'</span></code> から <code class="docutils literal"><span class="pre">'utf-8'</span></code> に変更されました。</p>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.HtmlDiff.make_table">
<code class="descname">make_table</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った完全な HTML テーブルを文字列で返します。</p>
<p>このメソッドの引数は、 <a class="reference internal" href="#difflib.HtmlDiff.make_file" title="difflib.HtmlDiff.make_file"><code class="xref py py-meth docutils literal"><span class="pre">make_file()</span></code></a> メソッドの引数と同じです。</p>
</dd></dl>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> はこのクラスへのコマンドラインフロントエンドで、使い方を学ぶ上で格好の例題が入っています。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.context_diff">
<code class="descclassname">difflib.</code><code class="descname">context_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.context_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 context diff のフォーマット(以下「コンテクスト形式」)で返します。</p>
<p>コンテクスト形式は、変更があった行に前後数行を加えてある、コンパクトな表現方法です。変更箇所は、変更前/変更後に分けて表します。コンテクスト (変更箇所前後の行) の行数は <em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">***</span></code> や <code class="docutils literal"><span class="pre">---</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">context_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">*** before.py</span>
<span class="go">--- after.py</span>
<span class="go">***************</span>
<span class="go">*** 1,4 ****</span>
<span class="go">! bacon</span>
<span class="go">! eggs</span>
<span class="go">! ham</span>
<span class="go">  guido</span>
<span class="go">--- 1,4 ----</span>
<span class="go">! python</span>
<span class="go">! eggy</span>
<span class="go">! hamster</span>
<span class="go">  guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.get_close_matches">
<code class="descclassname">difflib.</code><code class="descname">get_close_matches</code><span class="sig-paren">(</span><em>word</em>, <em>possibilities</em>, <em>n=3</em>, <em>cutoff=0.6</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.get_close_matches" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>「十分」なマッチの上位のリストを返します。<em>word</em> はマッチさせたいシーケンス (大概は文字列) です。<em>possibilities</em> は <em>word</em> にマッチさせるシーケンスのリスト (大概は文字列のリスト) です。</p>
<p>オプションの引数 <em>n</em> (デフォルトでは <code class="docutils literal"><span class="pre">3</span></code>)はメソッドの返すマッチの最大数です。<em>n</em> は <code class="docutils literal"><span class="pre">0</span></code> より大きくなければなりません。</p>
<p>オプションの引数 <em>cutoff</em> (デフォルトでは <code class="docutils literal"><span class="pre">0.6</span></code>)は、区間 [0, 1] に入る小数の値です。<em>word</em> との一致率がそれ未満の <em>possibilities</em> の要素は無視されます。</p>
<p><em>possibilities</em> の要素でマッチした上位(多くても <em>n</em> 個)は、類似度のスコアに応じて(一番似たものを先頭に)ソートされたリストとして返されます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'appel'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ape'</span><span class="p">,</span> <span class="s1">'apple'</span><span class="p">,</span> <span class="s1">'peach'</span><span class="p">,</span> <span class="s1">'puppy'</span><span class="p">])</span>
<span class="go">['apple', 'ape']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">keyword</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'wheel'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['while']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'pineapple'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'accept'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['except']</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.ndiff">
<code class="descclassname">difflib.</code><code class="descname">ndiff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.ndiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> のスタイルで返します。</p>
<p>オプションのキーワード引数 <em>linejunk</em> と <em>charjunk</em> には、フィルタ関数 (または <code class="docutils literal"><span class="pre">None</span></code>) を渡します。</p>
<p><em>linejunk</em>: 文字列型の引数 1 つを受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは <code class="docutils literal"><span class="pre">None</span></code> です。モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_LINE_JUNK" title="difflib.IS_LINE_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_LINE_JUNK()</span></code></a> は、高々 1 つのシャープ記号(<code class="docutils literal"><span class="pre">'#'</span></code>)を除いて可視の文字を含まない行をフィルタリングするものです。しかし、下層にある <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスが、どの行が雑音となるほど頻繁に登場するかを動的に分析します。このクラスによる分析は、この関数を使用するよりも通常うまく動作します。</p>
<p><em>charjunk</em>: 文字 (長さ1の文字列) を受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは、モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_CHARACTER_JUNK" title="difflib.IS_CHARACTER_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_CHARACTER_JUNK()</span></code></a> であり、これは空白文字類 (空白またはタブ、改行文字をこれに含めてはいけません) をフィルタして排除します。</p>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/ndiff.py</span></code> は、この関数のコマンドラインのフロントエンド（インターフェイス）です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">diff</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">- one</span>
<span class="go">?  ^</span>
<span class="go">+ ore</span>
<span class="go">?  ^</span>
<span class="go">- two</span>
<span class="go">- three</span>
<span class="go">?  -</span>
<span class="go">+ tree</span>
<span class="go">+ emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.restore">
<code class="descclassname">difflib.</code><code class="descname">restore</code><span class="sig-paren">(</span><em>sequence</em>, <em>which</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.restore" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>差分を生成した元の二つのシーケンスのうち一つを返します。</p>
<p><a class="reference internal" href="#difflib.Differ.compare" title="difflib.Differ.compare"><code class="xref py py-meth docutils literal"><span class="pre">Differ.compare()</span></code></a> または <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> によって生成された <em>sequence</em> を与えられると、行頭のプレフィクスを取りのぞいてファイル 1 または 2 (引数 <em>which</em> で指定される) に由来する行を復元します。</p>
<p>例:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="c1"># materialize the generated delta into a list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">one</span>
<span class="go">two</span>
<span class="go">three</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">ore</span>
<span class="go">tree</span>
<span class="go">emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.unified_diff">
<code class="descclassname">difflib.</code><code class="descname">unified_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.unified_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 unified diff フォーマット(以下「ユニファイド形式」)で返します。</p>
<p>ユニファイド形式は変更があった行にコンテキストとなる前後数行を加えた、コンパクトな表現方法です。変更箇所は (変更前/変更後を分離したブロックではなく) インラインスタイルで表されます。コンテクストの行数は、<em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">---</span></code>, <code class="docutils literal"><span class="pre">+++</span></code>, <code class="docutils literal"><span class="pre">@@</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">--- before.py</span>
<span class="go">+++ after.py</span>
<span class="go">@@ -1,4 +1,4 @@</span>
<span class="go">-bacon</span>
<span class="go">-eggs</span>
<span class="go">-ham</span>
<span class="go">+python</span>
<span class="go">+eggy</span>
<span class="go">+hamster</span>
<span class="go"> guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.diff_bytes">
<code class="descclassname">difflib.</code><code class="descname">diff_bytes</code><span class="sig-paren">(</span><em>dfunc</em>, <em>a</em>, <em>b</em>, <em>fromfile=b''</em>, <em>tofile=b''</em>, <em>fromfiledate=b''</em>, <em>tofiledate=b''</em>, <em>n=3</em>, <em>lineterm=b'\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.diff_bytes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>dfunc</em> を使用して <em>a</em> と <em>b</em> (bytes オブジェクトのリスト) を比較して、差分形式の行 (これも bytes オブジェクトです) を*dfunc* の戻り値の形式で返します。<em>dfunc</em> は、呼び出し可能である必要があります。一般に、これは <a class="reference internal" href="#difflib.unified_diff" title="difflib.unified_diff"><code class="xref py py-func docutils literal"><span class="pre">unified_diff()</span></code></a> または <a class="reference internal" href="#difflib.context_diff" title="difflib.context_diff"><code class="xref py py-func docutils literal"><span class="pre">context_diff()</span></code></a> です。</p>
<p>未知のエンコーディングまたは一貫性のないエンコーディングのデータ同士を比較できます。<em>n</em> 以外のすべての入力は、bytes オブジェクトである必要があります。<em>n</em> 以外のすべての入力を損失なく str に変換して、<code class="docutils literal"><span class="pre">dfunc(a,</span> <span class="pre">b,</span> <span class="pre">fromfile,</span> <span class="pre">tofile,</span> <span class="pre">fromfiledate,</span> <span class="pre">tofiledate,</span> <span class="pre">n,</span> <span class="pre">lineterm)</span></code> を呼び出すことにより動作します。<em>dfunc</em> の出力は、bytes 型に変換されます。これにより、受け取る差分形式の行のエンコーディングは、<em>a</em> と <em>b</em> の未知または一貫性のないエンコーディングと同一になります。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_LINE_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_LINE_JUNK</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_LINE_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる行のとき真を返します。行 <em>line</em> は空白、または  <code class="docutils literal"><span class="pre">'#'</span></code> ひとつのときに無視できます。それ以外のときには無視できません。古いバージョンでは <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>linejunk</em> にデフォルトで使用されました。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_CHARACTER_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_CHARACTER_JUNK</code><span class="sig-paren">(</span><em>ch</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_CHARACTER_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる文字のとき真を返します。文字 <em>ch</em> が空白、またはタブ文字のときには無視できます。それ以外の時には無視できません。 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>charjunk</em> としてデフォルトで使用されます。</p>
</dd></dl>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><a class="reference external" href="http://www.drdobbs.com/database/pattern-matching-the-gestalt-approach/184407970">Pattern Matching: The Gestalt Approach</a></dt>
<dd>John W. Ratcliff と D. E. Metzener による類似のアルゴリズムに関する議論。<a class="reference external" href="http://www.drdobbs.com/">Dr. Dobb’s Journal</a> 1988年7月号掲載。</dd>
</dl>
</div>
<div class="section" id="sequencematcher-objects">
<span id="sequence-matcher"></span><h2>6.3.1. SequenceMatcherオブジェクト<a class="headerlink" href="#sequencematcher-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスには、以下のようなコンストラクタがあります:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><span class="sig-paren">(</span><em>isjunk=None</em>, <em>a=''</em>, <em>b=''</em>, <em>autojunk=True</em><span class="sig-paren">)</span></dt>
<dd><p>オプションの引数 <em>isjunk</em> は、<code class="docutils literal"><span class="pre">None</span></code> (デフォルトの値です) にするか、単一の引数をとる関数でなければなりません。後者の場合、関数はシーケンスの要素を受け取り、要素が junk であり、無視すべきである場合に限り真を返すようにしなければなりません。<em>isjunk</em> に <code class="docutils literal"><span class="pre">None</span></code> を渡すと、<code class="docutils literal"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">0</span></code> を渡したのと同じになります; すなわち、いかなる要素も無視しなくなります。例えば以下のような引数を渡すと:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">" </span><span class="se">\t</span><span class="s2">"</span>
</pre></div>
</div>
<p>空白とタブ文字を無視して文字のシーケンスを比較します。</p>
<p>オプションの引数 <em>a</em> と <em>b</em> は、比較される文字列で、デフォルトでは空の文字列です。両方のシーケンスの要素は、ハッシュ化可能(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)である必要があります。</p>
<p>オプションの引数 <em>autojunk</em> は、自動 junk ヒューリスティックを無効にするために使えます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
<p>SequenceMatcher オブジェクトは3つのデータ属性を持っています: <em>bjunk</em> は、 <em>isjunk</em> が <code class="docutils literal"><span class="pre">True</span></code> であるような <em>b</em> の要素の集合です; <em>bpopular</em> は、 (無効でなければ) ヒューリスティックによって popular であると考えられる非ジャンク要素の集合です; <em>b2j</em> は、 <em>b</em> の残りの要素をそれらが生じる位置のリストに写像する dict です。この 3 つは <a class="reference internal" href="#difflib.SequenceMatcher.set_seqs" title="difflib.SequenceMatcher.set_seqs"><code class="xref py py-meth docutils literal"><span class="pre">set_seqs()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> で <em>b</em> がリセットされる場合は常にリセットされます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>bjunk</em> および <em>bpopular</em> 属性。</p>
</div>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは以下のメソッドを持ちます:</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seqs">
<code class="descname">set_seqs</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seqs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較される2つの文字列を設定します。</p>
</dd></dl>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは、2つ目のシーケンスについての詳細な情報を計算し、キャッシュします。 1つのシーケンスをいくつものシーケンスと比較する場合、まず <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> を使って文字列を設定しておき、別の文字列を1つずつ比較するために、繰り返し <a class="reference internal" href="#difflib.SequenceMatcher.set_seq1" title="difflib.SequenceMatcher.set_seq1"><code class="xref py py-meth docutils literal"><span class="pre">set_seq1()</span></code></a> を呼び出します。</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq1">
<code class="descname">set_seq1</code><span class="sig-paren">(</span><em>a</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq1" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う1つ目のシーケンスを設定します。比較される2つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq2">
<code class="descname">set_seq2</code><span class="sig-paren">(</span><em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq2" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う2つ目のシーケンスを設定します。比較される1つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.find_longest_match">
<code class="descname">find_longest_match</code><span class="sig-paren">(</span><em>alo</em>, <em>ahi</em>, <em>blo</em>, <em>bhi</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.find_longest_match" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">a[alo:ahi]</span></code> と <code class="docutils literal"><span class="pre">b[blo:bhi]</span></code> の中から、最長のマッチ列を探します。</p>
<p><em>isjunk</em> が省略されたか <code class="docutils literal"><span class="pre">None</span></code> の時、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> は <code class="docutils literal"><span class="pre">a[i:i+k]</span></code> が <code class="docutils literal"><span class="pre">b[j:j+k]</span></code> と等しいような <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">k)</span></code> を返します。その値は <code class="docutils literal"><span class="pre">alo</span> <span class="pre">&lt;=</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i+k</span> <span class="pre">&lt;=</span> <span class="pre">ahi</span></code> かつ <code class="docutils literal"><span class="pre">blo</span> <span class="pre">&lt;=</span> <span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j+k</span> <span class="pre">&lt;=</span> <span class="pre">bhi</span></code> となります。 <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">k')</span></code> でも、同じようになります。さらに <code class="docutils literal"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">k'</span></code>, <code class="docutils literal"><span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i'</span></code> が <code class="docutils literal"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">i'</span></code>, <code class="docutils literal"><span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j'</span></code> でも同様です。言い換えると、いくつものマッチ列すべてのうち、 <em>a</em> 内で最初に始まるものを返します。そしてその <em>a</em> 内で最初のマッチ列すべてのうち <em>b</em> 内で最初に始まるものを返します。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=0, b=4, size=5)</span>
</pre></div>
</div>
<p>引数 <em>isjunk</em> が与えられている場合、上記の通り、はじめに最長のマッチ列を判定します。ブロック内に junk 要素が見当たらないような追加条件の際はこれに該当しません。次にそのマッチ列を、その両側の junk 要素にマッチするよう、できる限り広げていきます。そのため結果となる列は、探している列のたまたま直前にあった同一の junk 以外の junk にはマッチしません。</p>
<p>以下は前と同じサンプルですが、空白を junk とみなしています。これは <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> が2つ目の列の末尾にある <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> にマッチしないようにしています。代わりに <code class="docutils literal"><span class="pre">'abcd'</span></code> にはマッチします。そして 2つ目の文字列中、一番左の <code class="docutils literal"><span class="pre">'abcd'</span></code> にマッチします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">==</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=1, b=0, size=4)</span>
</pre></div>
</div>
<p>どんな列にもマッチしない時は、<code class="docutils literal"><span class="pre">(alo,</span> <span class="pre">blo,</span> <span class="pre">0)</span></code> を返します。</p>
<p>このメソッドは <a class="reference internal" href="../glossary.html#term-named-tuple"><span class="xref std std-term">named tuple</span></a> <code class="docutils literal"><span class="pre">Match(a,</span> <span class="pre">b,</span> <span class="pre">size)</span></code> を返します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_matching_blocks">
<code class="descname">get_matching_blocks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_matching_blocks" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>マッチしたシーケンス中で個別にマッチしたシーケンスをあらわす、3つの値のリストを返します。それぞれの値は <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> という形式であらわされ、<code class="docutils literal"><span class="pre">a[i:i+n]</span> <span class="pre">==</span> <span class="pre">b[j:j+n]</span></code> という関係を意味します。3つの値は <em>i</em> と <em>j</em> の間で単調に増加します。</p>
<p>最後のタプルはダミーで、<code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> という値を持ちます。これは <code class="docutils literal"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">0</span></code> である唯一のタプルです。もし <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> と <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">n')</span></code> がリストで並んでいる3つ組で、2つ目が最後の3つ組でなければ、<code class="docutils literal"><span class="pre">i+n</span> <span class="pre">!=</span> <span class="pre">i'</span></code> または <code class="docutils literal"><span class="pre">j+n</span> <span class="pre">!=</span> <span class="pre">j'</span></code> です。言い換えると並んでいる3つ組は常に隣接していない同じブロックを表しています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abxcd"</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">()</span>
<span class="go">[Match(a=0, b=0, size=2), Match(a=3, b=2, size=2), Match(a=5, b=4, size=0)]</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_opcodes">
<code class="descname">get_opcodes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> を <em>b</em> にするための方法を記述する5つのタプルを返します。それぞれのタプルは <code class="docutils literal"><span class="pre">(tag,</span> <span class="pre">i1,</span> <span class="pre">i2,</span> <span class="pre">j1,</span> <span class="pre">j2)</span></code> という形式であらわされます。最初のタプルは <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">j1</span> <span class="pre">==</span> <span class="pre">0</span></code> であり、<em>i1</em> はその前にあるタプルの <em>i2</em> と同じ値です。同様に <em>j1</em> は前の <em>j2</em> と同じ値になります。</p>
<p><em>tag</em> の値は文字列であり、次のような意味です:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%"/>
<col width="75%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'replace'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は <code class="docutils literal"><span class="pre">b[j1:j2]</span></code> に置き換えられる。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'delete'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は削除される。この時、<code class="docutils literal"><span class="pre">j1</span> <span class="pre">==</span> <span class="pre">j2</span></code> である。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'insert'</span></code></td>
<td><code class="docutils literal"><span class="pre">b[j1:j2]</span></code> が <code class="docutils literal"><span class="pre">a[i1:i1]</span></code> に挿入される。この時 <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">i2</span></code> である。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'equal'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span> <span class="pre">==</span> <span class="pre">b[j1:j2]</span></code> (サブシーケンスは等しい).</td>
</tr>
</tbody>
</table>
<p>例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="s2">"qabxcd"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="s2">"abycdf"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{:7}</span><span class="s1">   a[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] --&gt; b[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] </span><span class="si">{!r:&gt;8}</span><span class="s1"> --&gt; </span><span class="si">{!r}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">]))</span>
<span class="go">delete    a[0:1] --&gt; b[0:0]      'q' --&gt; ''</span>
<span class="go">equal     a[1:3] --&gt; b[0:2]     'ab' --&gt; 'ab'</span>
<span class="go">replace   a[3:4] --&gt; b[2:3]      'x' --&gt; 'y'</span>
<span class="go">equal     a[4:6] --&gt; b[3:5]     'cd' --&gt; 'cd'</span>
<span class="go">insert    a[6:6] --&gt; b[5:6]       '' --&gt; 'f'</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_grouped_opcodes">
<code class="descname">get_grouped_opcodes</code><span class="sig-paren">(</span><em>n=3</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_grouped_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>最大 <em>n</em> 行までのコンテクストを含むグループを生成するような、ジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)を返します。</p>
<p>このメソッドは、 <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> で返されるグループの中から、似たような差異のかたまりに分け、間に挟まっている変更の無い部分を省きます。</p>
<p>グループは <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> と同じ書式で返されます。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.ratio">
<code class="descname">ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>[0, 1] の範囲の浮動小数点数で、シーケンスの類似度を測る値を返します。</p>
<p>T が2つのシーケンスの要素数の総計だと仮定し、M をマッチした数とすると、この値は 2.0*M / T であらわされます。もしシーケンスがまったく同じ場合、値は <code class="docutils literal"><span class="pre">1.0</span></code> となり、まったく異なる場合には <code class="docutils literal"><span class="pre">0.0</span></code> となります。</p>
<p>このメソッドは <a class="reference internal" href="#difflib.SequenceMatcher.get_matching_blocks" title="difflib.SequenceMatcher.get_matching_blocks"><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> がまだ呼び出されていない場合には非常にコストが高いです。この場合、上限を素早く計算するために、 <a class="reference internal" href="#difflib.SequenceMatcher.quick_ratio" title="difflib.SequenceMatcher.quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code></a> もしくは <a class="reference internal" href="#difflib.SequenceMatcher.real_quick_ratio" title="difflib.SequenceMatcher.real_quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code></a> を最初に試してみる方がいいかもしれません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.quick_ratio">
<code class="descname">quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、より高速に計算します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.real_quick_ratio">
<code class="descname">real_quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.real_quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、非常に高速に計算します。</p>
</dd></dl>
</dd></dl>
<p>この文字列全体のマッチ率を返す3つのメソッドは、精度の異なる近似値を返します。 <code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code> と <code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code> は、常に <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> 以上の値を返します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">,</span> <span class="s2">"bcde"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">quick_ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">real_quick_ratio</span><span class="p">()</span>
<span class="go">1.0</span>
</pre></div>
</div>
</div>
<div class="section" id="sequencematcher-examples">
<span id="id1"></span><h2>6.3.2. SequenceMatcher の例<a class="headerlink" href="#sequencematcher-examples" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は2つの文字列を比較します。空白を "junk" とします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">" "</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private Thread currentThread;"</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private volatile Thread currentThread;"</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> は、[0, 1] の範囲の値を返し、シーケンスの類似度を測ります。経験によると、 <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> の値が0.6を超えると、シーケンスがよく似ていることを示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="go">0.866</span>
</pre></div>
</div>
<p>シーケンスのどこがマッチしているかにだけ興味のある時には <code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が手軽でしょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"a[</span><span class="si">%d</span><span class="s2">] and b[</span><span class="si">%d</span><span class="s2">] match for </span><span class="si">%d</span><span class="s2"> elements"</span> <span class="o">%</span> <span class="n">block</span><span class="p">)</span>
<span class="go">a[0] and b[0] match for 8 elements</span>
<span class="go">a[8] and b[17] match for 21 elements</span>
<span class="go">a[29] and b[38] match for 0 elements</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が返す最後のタプルが常にダミーであることに注目してください。このダミーは <code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> であり、これはタプルの最後の要素（マッチする要素の数）が <code class="docutils literal"><span class="pre">0</span></code> となる唯一のケースです。</p>
<p>はじめのシーケンスがどのようにして2番目のものになるのかを知るには、 <code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code> を使います:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%6s</span><span class="s2"> a[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">] b[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">]"</span> <span class="o">%</span> <span class="n">opcode</span><span class="p">)</span>
<span class="go"> equal a[0:8] b[0:8]</span>
<span class="go">insert a[8:8] b[8:17]</span>
<span class="go"> equal a[8:29] b[17:38]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<ul class="last simple">
<li><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> を使った、シンプルで使えるコードを知るには、このモジュールの関数 <a class="reference internal" href="#difflib.get_close_matches" title="difflib.get_close_matches"><code class="xref py py-func docutils literal"><span class="pre">get_close_matches()</span></code></a> を参照してください。</li>
<li><a class="reference external" href="https://code.activestate.com/recipes/576729/">Simple version control recipe</a> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> で作った小規模アプリケーション。</li>
</ul>
</div>
</div>
<div class="section" id="differ-objects">
<span id="id2"></span><h2>6.3.3. Differ オブジェクト<a class="headerlink" href="#differ-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトによって生成された差分が <strong>最小</strong> であるなどとは言いません。むしろ、最小の差分はしばしば直観に反しています。その理由は、どこでもできるとなれば一致を見いだしてしまうからで、ときには思いがけなく100ページも離れたマッチになってしまうのです。一致点を互いに隣接したマッチに制限することで、場合によって長めの差分を出力するというコストを掛けることにはなっても、ある種の局所性を保つことができるのです。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> は、以下のようなコンストラクタを持ちます:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><span class="sig-paren">(</span><em>linejunk=None</em>, <em>charjunk=None</em><span class="sig-paren">)</span></dt>
<dd><p>オプションのキーワードパラメータ <em>linejunk</em> と <em>charjunk</em> は、フィルタ関数を渡します (使わないときは <code class="docutils literal"><span class="pre">None</span></code>):</p>
<p><em>linejunk</em>: ひとつの文字列引数を受け取る関数です。文字列が junk のときに真を返します。デフォルトでは、<code class="docutils literal"><span class="pre">None</span></code> であり、どんな行であっても junk とは見なされません。</p>
<p><em>charjunk</em>: この関数は文字(長さ1の文字列)を引数として受け取り、文字が junk であるときに真を返します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> であり、どんな文字も junk とは見なされません。</p>
<p>これらの junk フィルター関数により、差分を発見するマッチングが高速化し、差分の行や文字が無視されることがなくなります。説明については、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> メソッドの <em>isjunk</em> 引数の説明をご覧ください。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトは、以下の1つのメソッドを通して利用されます。（差分を生成します）:</p>
<dl class="method">
<dt id="difflib.Differ.compare">
<code class="descname">compare</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.Differ.compare" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>文字列からなる2つのシーケンスを比較し、差分（を表す文字列からなるシーケンス）を生成します。</p>
<p>各シーケンスの要素は、改行で終わる独立した単一行からなる文字列でなければなりません。そのようなシーケンスは、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code></a> メソッドによって得ることができます。（得られる）差分は改行文字で終了する文字列のシーケンスとして得られ、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-meth docutils literal"><span class="pre">writelines()</span></code></a> メソッドによって出力できる形になっています。</p>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="differ-example">
<span id="differ-examples"></span><h2>6.3.4. Differ の例<a class="headerlink" href="#differ-example" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下の例は2つのテキストを比較しています。最初に、テキストを行毎に改行で終わる文字列のシーケンスにセットアップします (そのようなシーケンスは、ファイル風オブジェクトの <code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code> メソッドからも得ることができます):</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  2. Explicit is better than implicit.</span>
<span class="gp">... </span><span class="s1">  3. Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complex is better than complicated.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">'\n'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text2</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  3.   Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complicated is better than complex.</span>
<span class="gp">... </span><span class="s1">  5. Flat is better than nested.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>次に Differ オブジェクトをインスタンス化します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Differ</span><span class="p">()</span>
</pre></div>
</div>
<p>注意:  <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトをインスタンス化するとき、行 junk と文字 junk をフィルタリングする関数を渡すことができます。詳細は <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-meth docutils literal"><span class="pre">Differ()</span></code></a> コンストラクタを参照してください。</p>
<p>最後に、2つを比較します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">result</span></code> は文字列のリストなので、pretty-printしてみましょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">['    1. Beautiful is better than ugly.\n',</span>
<span class="go"> '-   2. Explicit is better than implicit.\n',</span>
<span class="go"> '-   3. Simple is better than complex.\n',</span>
<span class="go"> '+   3.   Simple is better than complex.\n',</span>
<span class="go"> '?     ++\n',</span>
<span class="go"> '-   4. Complex is better than complicated.\n',</span>
<span class="go"> '?            ^                     ---- ^\n',</span>
<span class="go"> '+   4. Complicated is better than complex.\n',</span>
<span class="go"> '?           ++++ ^                      ^\n',</span>
<span class="go"> '+   5. Flat is better than nested.\n']</span>
</pre></div>
</div>
<p>これは、複数行の文字列として、次のように出力されます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">    1. Beautiful is better than ugly.</span>
<span class="go">-   2. Explicit is better than implicit.</span>
<span class="go">-   3. Simple is better than complex.</span>
<span class="go">+   3.   Simple is better than complex.</span>
<span class="go">?     ++</span>
<span class="go">-   4. Complex is better than complicated.</span>
<span class="go">?            ^                     ---- ^</span>
<span class="go">+   4. Complicated is better than complex.</span>
<span class="go">?           ++++ ^                      ^</span>
<span class="go">+   5. Flat is better than nested.</span>
</pre></div>
</div>
</div>
<div class="section" id="a-command-line-interface-to-difflib">
<span id="difflib-interface"></span><h2>6.3.5. difflib のコマンドラインインタフェース<a class="headerlink" href="#a-command-line-interface-to-difflib" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は、 difflib を使って <code class="docutils literal"><span class="pre">diff</span></code> に似たユーティリティーを作成する方法を示します。これは、 Python のソース配布物にも、 <code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> として含まれています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">""" Command line interface to difflib.py providing diffs in four formats:</span>

<span class="sd">* ndiff:    lists every line and highlights interline changes.</span>
<span class="sd">* context:  highlights clusters of changes in a before/after format.</span>
<span class="sd">* unified:  highlights clusters of changes in an inline format.</span>
<span class="sd">* html:     generates side by side comparison with change highlights.</span>

<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">difflib</span><span class="o">,</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="k">def</span> <span class="nf">file_mtime</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span>
                               <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a context format diff (default)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-u'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a unified format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-m'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce HTML side by side diff '</span>
                             <span class="s1">'(can use -c and -l in conjunction)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-n'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a ndiff format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-l'</span><span class="p">,</span> <span class="s1">'--lines'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Set number of context lines (default 3)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'fromfile'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'tofile'</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">lines</span>
    <span class="n">fromfile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">fromfile</span>
    <span class="n">tofile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">tofile</span>

    <span class="n">fromdate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span>
    <span class="n">todate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">fromlines</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
        <span class="n">tolines</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">u</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">m</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">HtmlDiff</span><span class="p">()</span><span class="o">.</span><span class="n">make_file</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span><span class="n">tolines</span><span class="p">,</span><span class="n">fromfile</span><span class="p">,</span><span class="n">tofile</span><span class="p">,</span><span class="n">context</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">numlines</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">context_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div aria-label="main navigation" class="sphinxsidebar" role="navigation">
<div class="sphinxsidebarwrapper">
<h3><a href="../contents.html">目次</a></h3>
<ul>
<li><a class="reference internal" href="#">6.3. <code class="docutils literal"><span class="pre">difflib</span></code>  差分の計算を助ける</a><ul>
<li><a class="reference internal" href="#sequencematcher-objects">6.3.1. SequenceMatcherオブジェクト</a></li>
<li><a class="reference internal" href="#sequencematcher-examples">6.3.2. SequenceMatcher の例</a></li>
<li><a class="reference internal" href="#differ-objects">6.3.3. Differ オブジェクト</a></li>
<li><a class="reference internal" href="#differ-example">6.3.4. Differ の例</a></li>
<li><a class="reference internal" href="#a-command-line-interface-to-difflib">6.3.5. difflib のコマンドラインインタフェース</a></li>
</ul>
</li>
</ul>
<h4>前のトピックへ</h4>
<p class="topless"><a href="re.html" title="前の章へ">6.2. <code class="docutils literal"><span class="pre">re</span></code>  正規表現操作</a></p>
<h4>次のトピックへ</h4>
<p class="topless"><a href="textwrap.html" title="次の章へ">6.4. <code class="docutils literal"><span class="pre">textwrap</span></code>  テキストの折り返しと詰め込み</a></p>
<div aria-label="source link" role="note">
<h3>このページ</h3>
<ul class="this-page-menu">
<li><a href="../bugs.html">バグ報告</a></li>
<li>
<a href="https://github.com/python/cpython/blob/3.6/Doc/library/difflib.rst" rel="nofollow">ソースの表示
        </a>
</li>
</ul>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="footer">
     <a href="../copyright.html">Copyright</a> 2001-2018, Python Software Foundation.
    <br/>
    Python Software Foundation は非営利団体です。
    <a href="https://www.python.org/psf/donations/">寄付</a>
<br/>
    最終更新日時: 7月 29, 2018
    <a href="../bugs.html">バグを見つけたら</a>?
    <br/>
    このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.5 を使って作成されました。
    </div>
</body>
</head></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="ja" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>6.3. difflib  差分の計算を助ける  Python 3.6.5 ドキュメント</title>
<link href="../_static/pydoctheme.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
<script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/underscore.js" type="text/javascript"></script>
<script src="../_static/doctools.js" type="text/javascript"></script>
<script src="../_static/translations.js" type="text/javascript"></script>
<script src="../_static/sidebar.js" type="text/javascript"></script>
<link href="../_static/opensearch.xml" rel="search" title="Python 3.6.5 ドキュメント 内を検索" type="application/opensearchdescription+xml"/>
<link href="../about.html" rel="author" title="このドキュメントについて"/>
<link href="../genindex.html" rel="index" title="索引"/>
<link href="../search.html" rel="search" title="検索"/>
<link href="../copyright.html" rel="copyright" title="Copyright"/>
<link href="textwrap.html" rel="next" title="6.4. textwrap  テキストの折り返しと詰め込み"/>
<link href="re.html" rel="prev" title="6.2. re  正規表現操作"/>
<link href="../_static/py.png" rel="shortcut icon" type="image/png"/>
<link href="https://docs.python.jp/3/library/difflib.html" rel="canonical"/><script type="text/javascript">
    $(document).ready(function() {
      var base = 'https://docs.python.org/3.6/library/difflib.html';
      $('a.headerlink').each(function() {
        var html = '<a href="' + base + $(this).attr('href') +
                   '" title="原文へのリンク"><small>(原文)</small></a>';
        $(this).after(html);
      })
    });
    </script>
<script src="../_static/copybutton.js" type="text/javascript"></script>
<script src="../_static/version_switch.js" type="text/javascript"></script>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-34175846-1', 'python.jp');
        ga('send', 'pageview');

      </script>
<body>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a accesskey="I" href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a accesskey="N" href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a accesskey="P" href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a accesskey="U" href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body" role="main">
<div class="section" id="module-difflib">
<span id="difflib-helpers-for-computing-deltas"></span><h1>6.3. <a class="reference internal" href="#module-difflib" title="difflib: Helpers for computing differences between objects."><code class="xref py py-mod docutils literal"><span class="pre">difflib</span></code></a>  差分の計算を助ける<a class="headerlink" href="#module-difflib" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><strong>ソースコード:</strong> <a class="reference external" href="https://github.com/python/cpython/tree/3.6/Lib/difflib.py">Lib/difflib.py</a></p>
<hr class="docutils"/>
<p>このモジュールは、シーケンスを比較するためのクラスや関数を提供しています。例えば、ファイルの差分を計算して、それを HTML や context diff, unified diff などいろいろなフォーマットで出力するために、このモジュールを利用することができます。ディレクトリやファイル群を比較するためには、 <a class="reference internal" href="filecmp.html#module-filecmp" title="filecmp: Compare files efficiently."><code class="xref py py-mod docutils literal"><span class="pre">filecmp</span></code></a> モジュールも参照してください。</p>
<dl class="class">
<dt id="difflib.SequenceMatcher">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><a class="headerlink" href="#difflib.SequenceMatcher" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>柔軟性のあるクラスで、二つのシーケンスの要素がハッシュ化できる(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)型であれば、どの型の要素を含むシーケンスも比較可能です。基本的なアルゴリズムは、1980年代の後半に発表された Ratcliff と Obershelp による"ゲシュタルトパターンマッチング"と大げさに名づけられたアルゴリズム以前から知られている、やや凝ったアルゴリズムです。その考え方は、"junk" 要素を含まない最も長い互いに隣接したマッチ列を探すことです。ここで、  "junk" 要素とは、空行や空白などの、意味を持たない要素のことです。 (junk を処理するのは、Ratcliff と Obershelp のアルゴリズムに追加された拡張です。)この考え方は、マッチ列の左右に隣接するシーケンスの断片に対して再帰的にあてはめられます。この方法では編集を最小にするシーケンスは生まれませんが、人間の目からみて「正しい感じ」にマッチする傾向があります。</p>
<p><strong>実行時間:</strong> 基本的な Ratcliff-Obershelp アルゴリズムは、最悪の場合3乗、期待値で2乗となります。 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトでは、最悪のケースで2乗、期待値は比較されるシーケンス中に共通に現れる要素数に非常にややこしく依存しています。最良の場合は線形時間になります。</p>
<p><strong>自動 junk ヒューリスティック:</strong> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> は、シーケンスの特定の要素を自動的に junk として扱うヒューリスティックをサポートしています。このヒューリスティックは、各個要素がシーケンス内に何回現れるかを数えます。ある要素の重複数が (最初のものは除いて) 合計でシーケンスの 1% 以上になり、そのシーケンスが 200 要素以上なら、その要素は "popular" であるものとしてマークされ、シーケンスのマッチングの目的からは junk として扱われます。このヒューリスティックは、 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> の作成時に <code class="docutils literal"><span class="pre">autojunk</span></code> パラメタを <code class="docutils literal"><span class="pre">False</span></code> に設定することで無効化できます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
</dd></dl>
<dl class="class">
<dt id="difflib.Differ">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><a class="headerlink" href="#difflib.Differ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>テキスト行からなるシーケンスを比較するクラスです。人が読むことのできる差分を作成します。 Differ クラスは <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスを利用して、行からなるシーケンスを比較したり、(ほぼ)同一の行内の文字を比較したりします。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> クラスによる差分の各行は、2文字のコードで始まります:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%"/>
<col width="81%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">コード</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'-</span> <span class="pre">'</span></code></td>
<td>行はシーケンス1にのみ存在する</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'+</span> <span class="pre">'</span></code></td>
<td>行はシーケンス2にのみ存在する</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'</span> <span class="pre">'</span></code></td>
<td>行は両方のシーケンスで同一</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'?</span> <span class="pre">'</span></code></td>
<td>行は入力シーケンスのどちらにも存在しない</td>
</tr>
</tbody>
</table>
<p>'<code class="docutils literal"><span class="pre">?</span></code>' で始まる行は、行内のどこに差異が存在するかに注意を向けようとします。その行は、入力されたシーケンスのどちらにも存在しません。シーケンスがタブ文字を含むとき、これらの行は判別しづらいものになることがあります。</p>
</dd></dl>
<dl class="class">
<dt id="difflib.HtmlDiff">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">HtmlDiff</code><a class="headerlink" href="#difflib.HtmlDiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このクラスは、二つのテキストを左右に並べて比較表示し、行間あるいは行内の変更点を強調表示するような HTML テーブル (またはテーブルの入った完全な HTML ファイル) を生成するために使います。テーブルは完全差分モード、コンテキスト差分モードのいずれでも生成できます。</p>
<p>このクラスのコンストラクタは以下のようになっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>tabsize=8</em>, <em>wrapcolumn=None</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.__init__" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> のインスタンスを初期化します。</p>
<p><em>tabsize</em> はオプションのキーワード引数で、タブストップ幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">8</span></code> です。</p>
<p><em>wrapcolumn</em> はオプションのキーワード引数で、テキストを折り返すカラム幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> で折り返しを行いません。</p>
<p><em>linejunk</em> および <em>charjunk</em> はオプションのキーワード引数で、 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a>  (<a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> はこの関数を使って左右のテキストの差分を HTML で生成します) に渡されます。それぞれの引数のデフォルト値および説明は <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> のドキュメントを参照してください。</p>
</dd></dl>
<p>以下のメソッドが public になっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.make_file">
<code class="descname">make_file</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em>, <em>*</em>, <em>charset='utf-8'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_file" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った表を持つ完全な HTML ファイルを文字列で返します。</p>
<p><em>fromdesc</em> および <em>todesc</em> はオプションのキーワード引数で、差分表示テーブルにおけるそれぞれ差分元、差分先ファイルのカラムのヘッダになる文字列を指定します (いずれもデフォルト値は空文字列です)。</p>
<p><em>context</em> および <em>numlines</em> はともにオプションのキーワード引数です。<em>context</em> を <code class="docutils literal"><span class="pre">True</span></code> にするとコンテキスト差分を表示し、デフォルトの <code class="docutils literal"><span class="pre">False</span></code> にすると完全なファイル差分を表示します。<em>numlines</em> のデフォルト値は <code class="docutils literal"><span class="pre">5</span></code> で、<em>context</em> が <code class="docutils literal"><span class="pre">True</span></code> の場合、<em>numlines</em> は強調部分の前後にあるコンテキスト行の数を制御します。<em>context</em> が <code class="docutils literal"><span class="pre">False</span></code> の場合、<em>numlines</em> は "next" と書かれたハイパーリンクをたどった時に到達する場所が次の変更部分より何行前にあるかを制御します (値をゼロにした場合、"next" ハイパーリンクを辿ると変更部分の強調表示がブラウザの最上部に表示されるようになります)。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.5 で変更: </span><em>charset</em> キーワード専用引数が追加されました。HTML 文書のデフォルトの文字集合が <code class="docutils literal"><span class="pre">'ISO-8859-1'</span></code> から <code class="docutils literal"><span class="pre">'utf-8'</span></code> に変更されました。</p>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.HtmlDiff.make_table">
<code class="descname">make_table</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った完全な HTML テーブルを文字列で返します。</p>
<p>このメソッドの引数は、 <a class="reference internal" href="#difflib.HtmlDiff.make_file" title="difflib.HtmlDiff.make_file"><code class="xref py py-meth docutils literal"><span class="pre">make_file()</span></code></a> メソッドの引数と同じです。</p>
</dd></dl>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> はこのクラスへのコマンドラインフロントエンドで、使い方を学ぶ上で格好の例題が入っています。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.context_diff">
<code class="descclassname">difflib.</code><code class="descname">context_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.context_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 context diff のフォーマット(以下「コンテクスト形式」)で返します。</p>
<p>コンテクスト形式は、変更があった行に前後数行を加えてある、コンパクトな表現方法です。変更箇所は、変更前/変更後に分けて表します。コンテクスト (変更箇所前後の行) の行数は <em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">***</span></code> や <code class="docutils literal"><span class="pre">---</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">context_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">*** before.py</span>
<span class="go">--- after.py</span>
<span class="go">***************</span>
<span class="go">*** 1,4 ****</span>
<span class="go">! bacon</span>
<span class="go">! eggs</span>
<span class="go">! ham</span>
<span class="go">  guido</span>
<span class="go">--- 1,4 ----</span>
<span class="go">! python</span>
<span class="go">! eggy</span>
<span class="go">! hamster</span>
<span class="go">  guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.get_close_matches">
<code class="descclassname">difflib.</code><code class="descname">get_close_matches</code><span class="sig-paren">(</span><em>word</em>, <em>possibilities</em>, <em>n=3</em>, <em>cutoff=0.6</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.get_close_matches" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>「十分」なマッチの上位のリストを返します。<em>word</em> はマッチさせたいシーケンス (大概は文字列) です。<em>possibilities</em> は <em>word</em> にマッチさせるシーケンスのリスト (大概は文字列のリスト) です。</p>
<p>オプションの引数 <em>n</em> (デフォルトでは <code class="docutils literal"><span class="pre">3</span></code>)はメソッドの返すマッチの最大数です。<em>n</em> は <code class="docutils literal"><span class="pre">0</span></code> より大きくなければなりません。</p>
<p>オプションの引数 <em>cutoff</em> (デフォルトでは <code class="docutils literal"><span class="pre">0.6</span></code>)は、区間 [0, 1] に入る小数の値です。<em>word</em> との一致率がそれ未満の <em>possibilities</em> の要素は無視されます。</p>
<p><em>possibilities</em> の要素でマッチした上位(多くても <em>n</em> 個)は、類似度のスコアに応じて(一番似たものを先頭に)ソートされたリストとして返されます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'appel'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ape'</span><span class="p">,</span> <span class="s1">'apple'</span><span class="p">,</span> <span class="s1">'peach'</span><span class="p">,</span> <span class="s1">'puppy'</span><span class="p">])</span>
<span class="go">['apple', 'ape']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">keyword</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'wheel'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['while']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'pineapple'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'accept'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['except']</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.ndiff">
<code class="descclassname">difflib.</code><code class="descname">ndiff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.ndiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> のスタイルで返します。</p>
<p>オプションのキーワード引数 <em>linejunk</em> と <em>charjunk</em> には、フィルタ関数 (または <code class="docutils literal"><span class="pre">None</span></code>) を渡します。</p>
<p><em>linejunk</em>: 文字列型の引数 1 つを受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは <code class="docutils literal"><span class="pre">None</span></code> です。モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_LINE_JUNK" title="difflib.IS_LINE_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_LINE_JUNK()</span></code></a> は、高々 1 つのシャープ記号(<code class="docutils literal"><span class="pre">'#'</span></code>)を除いて可視の文字を含まない行をフィルタリングするものです。しかし、下層にある <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスが、どの行が雑音となるほど頻繁に登場するかを動的に分析します。このクラスによる分析は、この関数を使用するよりも通常うまく動作します。</p>
<p><em>charjunk</em>: 文字 (長さ1の文字列) を受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは、モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_CHARACTER_JUNK" title="difflib.IS_CHARACTER_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_CHARACTER_JUNK()</span></code></a> であり、これは空白文字類 (空白またはタブ、改行文字をこれに含めてはいけません) をフィルタして排除します。</p>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/ndiff.py</span></code> は、この関数のコマンドラインのフロントエンド（インターフェイス）です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">diff</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">- one</span>
<span class="go">?  ^</span>
<span class="go">+ ore</span>
<span class="go">?  ^</span>
<span class="go">- two</span>
<span class="go">- three</span>
<span class="go">?  -</span>
<span class="go">+ tree</span>
<span class="go">+ emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.restore">
<code class="descclassname">difflib.</code><code class="descname">restore</code><span class="sig-paren">(</span><em>sequence</em>, <em>which</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.restore" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>差分を生成した元の二つのシーケンスのうち一つを返します。</p>
<p><a class="reference internal" href="#difflib.Differ.compare" title="difflib.Differ.compare"><code class="xref py py-meth docutils literal"><span class="pre">Differ.compare()</span></code></a> または <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> によって生成された <em>sequence</em> を与えられると、行頭のプレフィクスを取りのぞいてファイル 1 または 2 (引数 <em>which</em> で指定される) に由来する行を復元します。</p>
<p>例:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="c1"># materialize the generated delta into a list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">one</span>
<span class="go">two</span>
<span class="go">three</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">ore</span>
<span class="go">tree</span>
<span class="go">emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.unified_diff">
<code class="descclassname">difflib.</code><code class="descname">unified_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.unified_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 unified diff フォーマット(以下「ユニファイド形式」)で返します。</p>
<p>ユニファイド形式は変更があった行にコンテキストとなる前後数行を加えた、コンパクトな表現方法です。変更箇所は (変更前/変更後を分離したブロックではなく) インラインスタイルで表されます。コンテクストの行数は、<em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">---</span></code>, <code class="docutils literal"><span class="pre">+++</span></code>, <code class="docutils literal"><span class="pre">@@</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">--- before.py</span>
<span class="go">+++ after.py</span>
<span class="go">@@ -1,4 +1,4 @@</span>
<span class="go">-bacon</span>
<span class="go">-eggs</span>
<span class="go">-ham</span>
<span class="go">+python</span>
<span class="go">+eggy</span>
<span class="go">+hamster</span>
<span class="go"> guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.diff_bytes">
<code class="descclassname">difflib.</code><code class="descname">diff_bytes</code><span class="sig-paren">(</span><em>dfunc</em>, <em>a</em>, <em>b</em>, <em>fromfile=b''</em>, <em>tofile=b''</em>, <em>fromfiledate=b''</em>, <em>tofiledate=b''</em>, <em>n=3</em>, <em>lineterm=b'\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.diff_bytes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>dfunc</em> を使用して <em>a</em> と <em>b</em> (bytes オブジェクトのリスト) を比較して、差分形式の行 (これも bytes オブジェクトです) を*dfunc* の戻り値の形式で返します。<em>dfunc</em> は、呼び出し可能である必要があります。一般に、これは <a class="reference internal" href="#difflib.unified_diff" title="difflib.unified_diff"><code class="xref py py-func docutils literal"><span class="pre">unified_diff()</span></code></a> または <a class="reference internal" href="#difflib.context_diff" title="difflib.context_diff"><code class="xref py py-func docutils literal"><span class="pre">context_diff()</span></code></a> です。</p>
<p>未知のエンコーディングまたは一貫性のないエンコーディングのデータ同士を比較できます。<em>n</em> 以外のすべての入力は、bytes オブジェクトである必要があります。<em>n</em> 以外のすべての入力を損失なく str に変換して、<code class="docutils literal"><span class="pre">dfunc(a,</span> <span class="pre">b,</span> <span class="pre">fromfile,</span> <span class="pre">tofile,</span> <span class="pre">fromfiledate,</span> <span class="pre">tofiledate,</span> <span class="pre">n,</span> <span class="pre">lineterm)</span></code> を呼び出すことにより動作します。<em>dfunc</em> の出力は、bytes 型に変換されます。これにより、受け取る差分形式の行のエンコーディングは、<em>a</em> と <em>b</em> の未知または一貫性のないエンコーディングと同一になります。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_LINE_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_LINE_JUNK</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_LINE_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる行のとき真を返します。行 <em>line</em> は空白、または  <code class="docutils literal"><span class="pre">'#'</span></code> ひとつのときに無視できます。それ以外のときには無視できません。古いバージョンでは <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>linejunk</em> にデフォルトで使用されました。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_CHARACTER_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_CHARACTER_JUNK</code><span class="sig-paren">(</span><em>ch</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_CHARACTER_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる文字のとき真を返します。文字 <em>ch</em> が空白、またはタブ文字のときには無視できます。それ以外の時には無視できません。 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>charjunk</em> としてデフォルトで使用されます。</p>
</dd></dl>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><a class="reference external" href="http://www.drdobbs.com/database/pattern-matching-the-gestalt-approach/184407970">Pattern Matching: The Gestalt Approach</a></dt>
<dd>John W. Ratcliff と D. E. Metzener による類似のアルゴリズムに関する議論。<a class="reference external" href="http://www.drdobbs.com/">Dr. Dobb’s Journal</a> 1988年7月号掲載。</dd>
</dl>
</div>
<div class="section" id="sequencematcher-objects">
<span id="sequence-matcher"></span><h2>6.3.1. SequenceMatcherオブジェクト<a class="headerlink" href="#sequencematcher-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスには、以下のようなコンストラクタがあります:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><span class="sig-paren">(</span><em>isjunk=None</em>, <em>a=''</em>, <em>b=''</em>, <em>autojunk=True</em><span class="sig-paren">)</span></dt>
<dd><p>オプションの引数 <em>isjunk</em> は、<code class="docutils literal"><span class="pre">None</span></code> (デフォルトの値です) にするか、単一の引数をとる関数でなければなりません。後者の場合、関数はシーケンスの要素を受け取り、要素が junk であり、無視すべきである場合に限り真を返すようにしなければなりません。<em>isjunk</em> に <code class="docutils literal"><span class="pre">None</span></code> を渡すと、<code class="docutils literal"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">0</span></code> を渡したのと同じになります; すなわち、いかなる要素も無視しなくなります。例えば以下のような引数を渡すと:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">" </span><span class="se">\t</span><span class="s2">"</span>
</pre></div>
</div>
<p>空白とタブ文字を無視して文字のシーケンスを比較します。</p>
<p>オプションの引数 <em>a</em> と <em>b</em> は、比較される文字列で、デフォルトでは空の文字列です。両方のシーケンスの要素は、ハッシュ化可能(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)である必要があります。</p>
<p>オプションの引数 <em>autojunk</em> は、自動 junk ヒューリスティックを無効にするために使えます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
<p>SequenceMatcher オブジェクトは3つのデータ属性を持っています: <em>bjunk</em> は、 <em>isjunk</em> が <code class="docutils literal"><span class="pre">True</span></code> であるような <em>b</em> の要素の集合です; <em>bpopular</em> は、 (無効でなければ) ヒューリスティックによって popular であると考えられる非ジャンク要素の集合です; <em>b2j</em> は、 <em>b</em> の残りの要素をそれらが生じる位置のリストに写像する dict です。この 3 つは <a class="reference internal" href="#difflib.SequenceMatcher.set_seqs" title="difflib.SequenceMatcher.set_seqs"><code class="xref py py-meth docutils literal"><span class="pre">set_seqs()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> で <em>b</em> がリセットされる場合は常にリセットされます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>bjunk</em> および <em>bpopular</em> 属性。</p>
</div>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは以下のメソッドを持ちます:</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seqs">
<code class="descname">set_seqs</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seqs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較される2つの文字列を設定します。</p>
</dd></dl>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは、2つ目のシーケンスについての詳細な情報を計算し、キャッシュします。 1つのシーケンスをいくつものシーケンスと比較する場合、まず <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> を使って文字列を設定しておき、別の文字列を1つずつ比較するために、繰り返し <a class="reference internal" href="#difflib.SequenceMatcher.set_seq1" title="difflib.SequenceMatcher.set_seq1"><code class="xref py py-meth docutils literal"><span class="pre">set_seq1()</span></code></a> を呼び出します。</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq1">
<code class="descname">set_seq1</code><span class="sig-paren">(</span><em>a</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq1" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う1つ目のシーケンスを設定します。比較される2つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq2">
<code class="descname">set_seq2</code><span class="sig-paren">(</span><em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq2" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う2つ目のシーケンスを設定します。比較される1つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.find_longest_match">
<code class="descname">find_longest_match</code><span class="sig-paren">(</span><em>alo</em>, <em>ahi</em>, <em>blo</em>, <em>bhi</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.find_longest_match" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">a[alo:ahi]</span></code> と <code class="docutils literal"><span class="pre">b[blo:bhi]</span></code> の中から、最長のマッチ列を探します。</p>
<p><em>isjunk</em> が省略されたか <code class="docutils literal"><span class="pre">None</span></code> の時、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> は <code class="docutils literal"><span class="pre">a[i:i+k]</span></code> が <code class="docutils literal"><span class="pre">b[j:j+k]</span></code> と等しいような <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">k)</span></code> を返します。その値は <code class="docutils literal"><span class="pre">alo</span> <span class="pre">&lt;=</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i+k</span> <span class="pre">&lt;=</span> <span class="pre">ahi</span></code> かつ <code class="docutils literal"><span class="pre">blo</span> <span class="pre">&lt;=</span> <span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j+k</span> <span class="pre">&lt;=</span> <span class="pre">bhi</span></code> となります。 <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">k')</span></code> でも、同じようになります。さらに <code class="docutils literal"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">k'</span></code>, <code class="docutils literal"><span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i'</span></code> が <code class="docutils literal"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">i'</span></code>, <code class="docutils literal"><span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j'</span></code> でも同様です。言い換えると、いくつものマッチ列すべてのうち、 <em>a</em> 内で最初に始まるものを返します。そしてその <em>a</em> 内で最初のマッチ列すべてのうち <em>b</em> 内で最初に始まるものを返します。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=0, b=4, size=5)</span>
</pre></div>
</div>
<p>引数 <em>isjunk</em> が与えられている場合、上記の通り、はじめに最長のマッチ列を判定します。ブロック内に junk 要素が見当たらないような追加条件の際はこれに該当しません。次にそのマッチ列を、その両側の junk 要素にマッチするよう、できる限り広げていきます。そのため結果となる列は、探している列のたまたま直前にあった同一の junk 以外の junk にはマッチしません。</p>
<p>以下は前と同じサンプルですが、空白を junk とみなしています。これは <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> が2つ目の列の末尾にある <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> にマッチしないようにしています。代わりに <code class="docutils literal"><span class="pre">'abcd'</span></code> にはマッチします。そして 2つ目の文字列中、一番左の <code class="docutils literal"><span class="pre">'abcd'</span></code> にマッチします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">==</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=1, b=0, size=4)</span>
</pre></div>
</div>
<p>どんな列にもマッチしない時は、<code class="docutils literal"><span class="pre">(alo,</span> <span class="pre">blo,</span> <span class="pre">0)</span></code> を返します。</p>
<p>このメソッドは <a class="reference internal" href="../glossary.html#term-named-tuple"><span class="xref std std-term">named tuple</span></a> <code class="docutils literal"><span class="pre">Match(a,</span> <span class="pre">b,</span> <span class="pre">size)</span></code> を返します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_matching_blocks">
<code class="descname">get_matching_blocks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_matching_blocks" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>マッチしたシーケンス中で個別にマッチしたシーケンスをあらわす、3つの値のリストを返します。それぞれの値は <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> という形式であらわされ、<code class="docutils literal"><span class="pre">a[i:i+n]</span> <span class="pre">==</span> <span class="pre">b[j:j+n]</span></code> という関係を意味します。3つの値は <em>i</em> と <em>j</em> の間で単調に増加します。</p>
<p>最後のタプルはダミーで、<code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> という値を持ちます。これは <code class="docutils literal"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">0</span></code> である唯一のタプルです。もし <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> と <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">n')</span></code> がリストで並んでいる3つ組で、2つ目が最後の3つ組でなければ、<code class="docutils literal"><span class="pre">i+n</span> <span class="pre">!=</span> <span class="pre">i'</span></code> または <code class="docutils literal"><span class="pre">j+n</span> <span class="pre">!=</span> <span class="pre">j'</span></code> です。言い換えると並んでいる3つ組は常に隣接していない同じブロックを表しています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abxcd"</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">()</span>
<span class="go">[Match(a=0, b=0, size=2), Match(a=3, b=2, size=2), Match(a=5, b=4, size=0)]</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_opcodes">
<code class="descname">get_opcodes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> を <em>b</em> にするための方法を記述する5つのタプルを返します。それぞれのタプルは <code class="docutils literal"><span class="pre">(tag,</span> <span class="pre">i1,</span> <span class="pre">i2,</span> <span class="pre">j1,</span> <span class="pre">j2)</span></code> という形式であらわされます。最初のタプルは <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">j1</span> <span class="pre">==</span> <span class="pre">0</span></code> であり、<em>i1</em> はその前にあるタプルの <em>i2</em> と同じ値です。同様に <em>j1</em> は前の <em>j2</em> と同じ値になります。</p>
<p><em>tag</em> の値は文字列であり、次のような意味です:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%"/>
<col width="75%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'replace'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は <code class="docutils literal"><span class="pre">b[j1:j2]</span></code> に置き換えられる。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'delete'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は削除される。この時、<code class="docutils literal"><span class="pre">j1</span> <span class="pre">==</span> <span class="pre">j2</span></code> である。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'insert'</span></code></td>
<td><code class="docutils literal"><span class="pre">b[j1:j2]</span></code> が <code class="docutils literal"><span class="pre">a[i1:i1]</span></code> に挿入される。この時 <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">i2</span></code> である。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'equal'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span> <span class="pre">==</span> <span class="pre">b[j1:j2]</span></code> (サブシーケンスは等しい).</td>
</tr>
</tbody>
</table>
<p>例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="s2">"qabxcd"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="s2">"abycdf"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{:7}</span><span class="s1">   a[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] --&gt; b[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] </span><span class="si">{!r:&gt;8}</span><span class="s1"> --&gt; </span><span class="si">{!r}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">]))</span>
<span class="go">delete    a[0:1] --&gt; b[0:0]      'q' --&gt; ''</span>
<span class="go">equal     a[1:3] --&gt; b[0:2]     'ab' --&gt; 'ab'</span>
<span class="go">replace   a[3:4] --&gt; b[2:3]      'x' --&gt; 'y'</span>
<span class="go">equal     a[4:6] --&gt; b[3:5]     'cd' --&gt; 'cd'</span>
<span class="go">insert    a[6:6] --&gt; b[5:6]       '' --&gt; 'f'</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_grouped_opcodes">
<code class="descname">get_grouped_opcodes</code><span class="sig-paren">(</span><em>n=3</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_grouped_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>最大 <em>n</em> 行までのコンテクストを含むグループを生成するような、ジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)を返します。</p>
<p>このメソッドは、 <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> で返されるグループの中から、似たような差異のかたまりに分け、間に挟まっている変更の無い部分を省きます。</p>
<p>グループは <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> と同じ書式で返されます。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.ratio">
<code class="descname">ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>[0, 1] の範囲の浮動小数点数で、シーケンスの類似度を測る値を返します。</p>
<p>T が2つのシーケンスの要素数の総計だと仮定し、M をマッチした数とすると、この値は 2.0*M / T であらわされます。もしシーケンスがまったく同じ場合、値は <code class="docutils literal"><span class="pre">1.0</span></code> となり、まったく異なる場合には <code class="docutils literal"><span class="pre">0.0</span></code> となります。</p>
<p>このメソッドは <a class="reference internal" href="#difflib.SequenceMatcher.get_matching_blocks" title="difflib.SequenceMatcher.get_matching_blocks"><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> がまだ呼び出されていない場合には非常にコストが高いです。この場合、上限を素早く計算するために、 <a class="reference internal" href="#difflib.SequenceMatcher.quick_ratio" title="difflib.SequenceMatcher.quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code></a> もしくは <a class="reference internal" href="#difflib.SequenceMatcher.real_quick_ratio" title="difflib.SequenceMatcher.real_quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code></a> を最初に試してみる方がいいかもしれません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.quick_ratio">
<code class="descname">quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、より高速に計算します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.real_quick_ratio">
<code class="descname">real_quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.real_quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、非常に高速に計算します。</p>
</dd></dl>
</dd></dl>
<p>この文字列全体のマッチ率を返す3つのメソッドは、精度の異なる近似値を返します。 <code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code> と <code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code> は、常に <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> 以上の値を返します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">,</span> <span class="s2">"bcde"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">quick_ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">real_quick_ratio</span><span class="p">()</span>
<span class="go">1.0</span>
</pre></div>
</div>
</div>
<div class="section" id="sequencematcher-examples">
<span id="id1"></span><h2>6.3.2. SequenceMatcher の例<a class="headerlink" href="#sequencematcher-examples" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は2つの文字列を比較します。空白を "junk" とします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">" "</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private Thread currentThread;"</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private volatile Thread currentThread;"</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> は、[0, 1] の範囲の値を返し、シーケンスの類似度を測ります。経験によると、 <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> の値が0.6を超えると、シーケンスがよく似ていることを示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="go">0.866</span>
</pre></div>
</div>
<p>シーケンスのどこがマッチしているかにだけ興味のある時には <code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が手軽でしょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"a[</span><span class="si">%d</span><span class="s2">] and b[</span><span class="si">%d</span><span class="s2">] match for </span><span class="si">%d</span><span class="s2"> elements"</span> <span class="o">%</span> <span class="n">block</span><span class="p">)</span>
<span class="go">a[0] and b[0] match for 8 elements</span>
<span class="go">a[8] and b[17] match for 21 elements</span>
<span class="go">a[29] and b[38] match for 0 elements</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が返す最後のタプルが常にダミーであることに注目してください。このダミーは <code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> であり、これはタプルの最後の要素（マッチする要素の数）が <code class="docutils literal"><span class="pre">0</span></code> となる唯一のケースです。</p>
<p>はじめのシーケンスがどのようにして2番目のものになるのかを知るには、 <code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code> を使います:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%6s</span><span class="s2"> a[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">] b[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">]"</span> <span class="o">%</span> <span class="n">opcode</span><span class="p">)</span>
<span class="go"> equal a[0:8] b[0:8]</span>
<span class="go">insert a[8:8] b[8:17]</span>
<span class="go"> equal a[8:29] b[17:38]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<ul class="last simple">
<li><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> を使った、シンプルで使えるコードを知るには、このモジュールの関数 <a class="reference internal" href="#difflib.get_close_matches" title="difflib.get_close_matches"><code class="xref py py-func docutils literal"><span class="pre">get_close_matches()</span></code></a> を参照してください。</li>
<li><a class="reference external" href="https://code.activestate.com/recipes/576729/">Simple version control recipe</a> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> で作った小規模アプリケーション。</li>
</ul>
</div>
</div>
<div class="section" id="differ-objects">
<span id="id2"></span><h2>6.3.3. Differ オブジェクト<a class="headerlink" href="#differ-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトによって生成された差分が <strong>最小</strong> であるなどとは言いません。むしろ、最小の差分はしばしば直観に反しています。その理由は、どこでもできるとなれば一致を見いだしてしまうからで、ときには思いがけなく100ページも離れたマッチになってしまうのです。一致点を互いに隣接したマッチに制限することで、場合によって長めの差分を出力するというコストを掛けることにはなっても、ある種の局所性を保つことができるのです。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> は、以下のようなコンストラクタを持ちます:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><span class="sig-paren">(</span><em>linejunk=None</em>, <em>charjunk=None</em><span class="sig-paren">)</span></dt>
<dd><p>オプションのキーワードパラメータ <em>linejunk</em> と <em>charjunk</em> は、フィルタ関数を渡します (使わないときは <code class="docutils literal"><span class="pre">None</span></code>):</p>
<p><em>linejunk</em>: ひとつの文字列引数を受け取る関数です。文字列が junk のときに真を返します。デフォルトでは、<code class="docutils literal"><span class="pre">None</span></code> であり、どんな行であっても junk とは見なされません。</p>
<p><em>charjunk</em>: この関数は文字(長さ1の文字列)を引数として受け取り、文字が junk であるときに真を返します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> であり、どんな文字も junk とは見なされません。</p>
<p>これらの junk フィルター関数により、差分を発見するマッチングが高速化し、差分の行や文字が無視されることがなくなります。説明については、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> メソッドの <em>isjunk</em> 引数の説明をご覧ください。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトは、以下の1つのメソッドを通して利用されます。（差分を生成します）:</p>
<dl class="method">
<dt id="difflib.Differ.compare">
<code class="descname">compare</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.Differ.compare" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>文字列からなる2つのシーケンスを比較し、差分（を表す文字列からなるシーケンス）を生成します。</p>
<p>各シーケンスの要素は、改行で終わる独立した単一行からなる文字列でなければなりません。そのようなシーケンスは、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code></a> メソッドによって得ることができます。（得られる）差分は改行文字で終了する文字列のシーケンスとして得られ、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-meth docutils literal"><span class="pre">writelines()</span></code></a> メソッドによって出力できる形になっています。</p>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="differ-example">
<span id="differ-examples"></span><h2>6.3.4. Differ の例<a class="headerlink" href="#differ-example" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下の例は2つのテキストを比較しています。最初に、テキストを行毎に改行で終わる文字列のシーケンスにセットアップします (そのようなシーケンスは、ファイル風オブジェクトの <code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code> メソッドからも得ることができます):</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  2. Explicit is better than implicit.</span>
<span class="gp">... </span><span class="s1">  3. Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complex is better than complicated.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">'\n'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text2</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  3.   Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complicated is better than complex.</span>
<span class="gp">... </span><span class="s1">  5. Flat is better than nested.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>次に Differ オブジェクトをインスタンス化します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Differ</span><span class="p">()</span>
</pre></div>
</div>
<p>注意:  <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトをインスタンス化するとき、行 junk と文字 junk をフィルタリングする関数を渡すことができます。詳細は <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-meth docutils literal"><span class="pre">Differ()</span></code></a> コンストラクタを参照してください。</p>
<p>最後に、2つを比較します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">result</span></code> は文字列のリストなので、pretty-printしてみましょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">['    1. Beautiful is better than ugly.\n',</span>
<span class="go"> '-   2. Explicit is better than implicit.\n',</span>
<span class="go"> '-   3. Simple is better than complex.\n',</span>
<span class="go"> '+   3.   Simple is better than complex.\n',</span>
<span class="go"> '?     ++\n',</span>
<span class="go"> '-   4. Complex is better than complicated.\n',</span>
<span class="go"> '?            ^                     ---- ^\n',</span>
<span class="go"> '+   4. Complicated is better than complex.\n',</span>
<span class="go"> '?           ++++ ^                      ^\n',</span>
<span class="go"> '+   5. Flat is better than nested.\n']</span>
</pre></div>
</div>
<p>これは、複数行の文字列として、次のように出力されます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">    1. Beautiful is better than ugly.</span>
<span class="go">-   2. Explicit is better than implicit.</span>
<span class="go">-   3. Simple is better than complex.</span>
<span class="go">+   3.   Simple is better than complex.</span>
<span class="go">?     ++</span>
<span class="go">-   4. Complex is better than complicated.</span>
<span class="go">?            ^                     ---- ^</span>
<span class="go">+   4. Complicated is better than complex.</span>
<span class="go">?           ++++ ^                      ^</span>
<span class="go">+   5. Flat is better than nested.</span>
</pre></div>
</div>
</div>
<div class="section" id="a-command-line-interface-to-difflib">
<span id="difflib-interface"></span><h2>6.3.5. difflib のコマンドラインインタフェース<a class="headerlink" href="#a-command-line-interface-to-difflib" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は、 difflib を使って <code class="docutils literal"><span class="pre">diff</span></code> に似たユーティリティーを作成する方法を示します。これは、 Python のソース配布物にも、 <code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> として含まれています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">""" Command line interface to difflib.py providing diffs in four formats:</span>

<span class="sd">* ndiff:    lists every line and highlights interline changes.</span>
<span class="sd">* context:  highlights clusters of changes in a before/after format.</span>
<span class="sd">* unified:  highlights clusters of changes in an inline format.</span>
<span class="sd">* html:     generates side by side comparison with change highlights.</span>

<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">difflib</span><span class="o">,</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="k">def</span> <span class="nf">file_mtime</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span>
                               <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a context format diff (default)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-u'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a unified format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-m'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce HTML side by side diff '</span>
                             <span class="s1">'(can use -c and -l in conjunction)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-n'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a ndiff format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-l'</span><span class="p">,</span> <span class="s1">'--lines'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Set number of context lines (default 3)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'fromfile'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'tofile'</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">lines</span>
    <span class="n">fromfile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">fromfile</span>
    <span class="n">tofile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">tofile</span>

    <span class="n">fromdate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span>
    <span class="n">todate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">fromlines</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
        <span class="n">tolines</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">u</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">m</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">HtmlDiff</span><span class="p">()</span><span class="o">.</span><span class="n">make_file</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span><span class="n">tolines</span><span class="p">,</span><span class="n">fromfile</span><span class="p">,</span><span class="n">tofile</span><span class="p">,</span><span class="n">context</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">numlines</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">context_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div aria-label="main navigation" class="sphinxsidebar" role="navigation">
<div class="sphinxsidebarwrapper">
<h3><a href="../contents.html">目次</a></h3>
<ul>
<li><a class="reference internal" href="#">6.3. <code class="docutils literal"><span class="pre">difflib</span></code>  差分の計算を助ける</a><ul>
<li><a class="reference internal" href="#sequencematcher-objects">6.3.1. SequenceMatcherオブジェクト</a></li>
<li><a class="reference internal" href="#sequencematcher-examples">6.3.2. SequenceMatcher の例</a></li>
<li><a class="reference internal" href="#differ-objects">6.3.3. Differ オブジェクト</a></li>
<li><a class="reference internal" href="#differ-example">6.3.4. Differ の例</a></li>
<li><a class="reference internal" href="#a-command-line-interface-to-difflib">6.3.5. difflib のコマンドラインインタフェース</a></li>
</ul>
</li>
</ul>
<h4>前のトピックへ</h4>
<p class="topless"><a href="re.html" title="前の章へ">6.2. <code class="docutils literal"><span class="pre">re</span></code>  正規表現操作</a></p>
<h4>次のトピックへ</h4>
<p class="topless"><a href="textwrap.html" title="次の章へ">6.4. <code class="docutils literal"><span class="pre">textwrap</span></code>  テキストの折り返しと詰め込み</a></p>
<div aria-label="source link" role="note">
<h3>このページ</h3>
<ul class="this-page-menu">
<li><a href="../bugs.html">バグ報告</a></li>
<li>
<a href="https://github.com/python/cpython/blob/3.6/Doc/library/difflib.rst" rel="nofollow">ソースの表示
        </a>
</li>
</ul>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="footer">
     <a href="../copyright.html">Copyright</a> 2001-2018, Python Software Foundation.
    <br/>
    Python Software Foundation は非営利団体です。
    <a href="https://www.python.org/psf/donations/">寄付</a>
<br/>
    最終更新日時: 7月 29, 2018
    <a href="../bugs.html">バグを見つけたら</a>?
    <br/>
    このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.5 を使って作成されました。
    </div>
</body>
</head></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="ja" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>6.3. difflib  差分の計算を助ける  Python 3.6.5 ドキュメント</title>
<link href="../_static/pydoctheme.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
<script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/underscore.js" type="text/javascript"></script>
<script src="../_static/doctools.js" type="text/javascript"></script>
<script src="../_static/translations.js" type="text/javascript"></script>
<script src="../_static/sidebar.js" type="text/javascript"></script>
<link href="../_static/opensearch.xml" rel="search" title="Python 3.6.5 ドキュメント 内を検索" type="application/opensearchdescription+xml"/>
<link href="../about.html" rel="author" title="このドキュメントについて"/>
<link href="../genindex.html" rel="index" title="索引"/>
<link href="../search.html" rel="search" title="検索"/>
<link href="../copyright.html" rel="copyright" title="Copyright"/>
<link href="textwrap.html" rel="next" title="6.4. textwrap  テキストの折り返しと詰め込み"/>
<link href="re.html" rel="prev" title="6.2. re  正規表現操作"/>
<link href="../_static/py.png" rel="shortcut icon" type="image/png"/>
<link href="https://docs.python.jp/3/library/difflib.html" rel="canonical"/><script type="text/javascript">
    $(document).ready(function() {
      var base = 'https://docs.python.org/3.6/library/difflib.html';
      $('a.headerlink').each(function() {
        var html = '<a href="' + base + $(this).attr('href') +
                   '" title="原文へのリンク"><small>(原文)</small></a>';
        $(this).after(html);
      })
    });
    </script>
<script src="../_static/copybutton.js" type="text/javascript"></script>
<script src="../_static/version_switch.js" type="text/javascript"></script>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-34175846-1', 'python.jp');
        ga('send', 'pageview');

      </script>
<body>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a accesskey="I" href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a accesskey="N" href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a accesskey="P" href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a accesskey="U" href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body" role="main">
<div class="section" id="module-difflib">
<span id="difflib-helpers-for-computing-deltas"></span><h1>6.3. <a class="reference internal" href="#module-difflib" title="difflib: Helpers for computing differences between objects."><code class="xref py py-mod docutils literal"><span class="pre">difflib</span></code></a>  差分の計算を助ける<a class="headerlink" href="#module-difflib" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><strong>ソースコード:</strong> <a class="reference external" href="https://github.com/python/cpython/tree/3.6/Lib/difflib.py">Lib/difflib.py</a></p>
<hr class="docutils"/>
<p>このモジュールは、シーケンスを比較するためのクラスや関数を提供しています。例えば、ファイルの差分を計算して、それを HTML や context diff, unified diff などいろいろなフォーマットで出力するために、このモジュールを利用することができます。ディレクトリやファイル群を比較するためには、 <a class="reference internal" href="filecmp.html#module-filecmp" title="filecmp: Compare files efficiently."><code class="xref py py-mod docutils literal"><span class="pre">filecmp</span></code></a> モジュールも参照してください。</p>
<dl class="class">
<dt id="difflib.SequenceMatcher">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><a class="headerlink" href="#difflib.SequenceMatcher" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>柔軟性のあるクラスで、二つのシーケンスの要素がハッシュ化できる(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)型であれば、どの型の要素を含むシーケンスも比較可能です。基本的なアルゴリズムは、1980年代の後半に発表された Ratcliff と Obershelp による"ゲシュタルトパターンマッチング"と大げさに名づけられたアルゴリズム以前から知られている、やや凝ったアルゴリズムです。その考え方は、"junk" 要素を含まない最も長い互いに隣接したマッチ列を探すことです。ここで、  "junk" 要素とは、空行や空白などの、意味を持たない要素のことです。 (junk を処理するのは、Ratcliff と Obershelp のアルゴリズムに追加された拡張です。)この考え方は、マッチ列の左右に隣接するシーケンスの断片に対して再帰的にあてはめられます。この方法では編集を最小にするシーケンスは生まれませんが、人間の目からみて「正しい感じ」にマッチする傾向があります。</p>
<p><strong>実行時間:</strong> 基本的な Ratcliff-Obershelp アルゴリズムは、最悪の場合3乗、期待値で2乗となります。 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトでは、最悪のケースで2乗、期待値は比較されるシーケンス中に共通に現れる要素数に非常にややこしく依存しています。最良の場合は線形時間になります。</p>
<p><strong>自動 junk ヒューリスティック:</strong> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> は、シーケンスの特定の要素を自動的に junk として扱うヒューリスティックをサポートしています。このヒューリスティックは、各個要素がシーケンス内に何回現れるかを数えます。ある要素の重複数が (最初のものは除いて) 合計でシーケンスの 1% 以上になり、そのシーケンスが 200 要素以上なら、その要素は "popular" であるものとしてマークされ、シーケンスのマッチングの目的からは junk として扱われます。このヒューリスティックは、 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> の作成時に <code class="docutils literal"><span class="pre">autojunk</span></code> パラメタを <code class="docutils literal"><span class="pre">False</span></code> に設定することで無効化できます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
</dd></dl>
<dl class="class">
<dt id="difflib.Differ">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><a class="headerlink" href="#difflib.Differ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>テキスト行からなるシーケンスを比較するクラスです。人が読むことのできる差分を作成します。 Differ クラスは <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスを利用して、行からなるシーケンスを比較したり、(ほぼ)同一の行内の文字を比較したりします。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> クラスによる差分の各行は、2文字のコードで始まります:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%"/>
<col width="81%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">コード</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'-</span> <span class="pre">'</span></code></td>
<td>行はシーケンス1にのみ存在する</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'+</span> <span class="pre">'</span></code></td>
<td>行はシーケンス2にのみ存在する</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'</span> <span class="pre">'</span></code></td>
<td>行は両方のシーケンスで同一</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'?</span> <span class="pre">'</span></code></td>
<td>行は入力シーケンスのどちらにも存在しない</td>
</tr>
</tbody>
</table>
<p>'<code class="docutils literal"><span class="pre">?</span></code>' で始まる行は、行内のどこに差異が存在するかに注意を向けようとします。その行は、入力されたシーケンスのどちらにも存在しません。シーケンスがタブ文字を含むとき、これらの行は判別しづらいものになることがあります。</p>
</dd></dl>
<dl class="class">
<dt id="difflib.HtmlDiff">
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">HtmlDiff</code><a class="headerlink" href="#difflib.HtmlDiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このクラスは、二つのテキストを左右に並べて比較表示し、行間あるいは行内の変更点を強調表示するような HTML テーブル (またはテーブルの入った完全な HTML ファイル) を生成するために使います。テーブルは完全差分モード、コンテキスト差分モードのいずれでも生成できます。</p>
<p>このクラスのコンストラクタは以下のようになっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>tabsize=8</em>, <em>wrapcolumn=None</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.__init__" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> のインスタンスを初期化します。</p>
<p><em>tabsize</em> はオプションのキーワード引数で、タブストップ幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">8</span></code> です。</p>
<p><em>wrapcolumn</em> はオプションのキーワード引数で、テキストを折り返すカラム幅を指定します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> で折り返しを行いません。</p>
<p><em>linejunk</em> および <em>charjunk</em> はオプションのキーワード引数で、 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a>  (<a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><code class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></code></a> はこの関数を使って左右のテキストの差分を HTML で生成します) に渡されます。それぞれの引数のデフォルト値および説明は <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> のドキュメントを参照してください。</p>
</dd></dl>
<p>以下のメソッドが public になっています:</p>
<dl class="method">
<dt id="difflib.HtmlDiff.make_file">
<code class="descname">make_file</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em>, <em>*</em>, <em>charset='utf-8'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_file" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った表を持つ完全な HTML ファイルを文字列で返します。</p>
<p><em>fromdesc</em> および <em>todesc</em> はオプションのキーワード引数で、差分表示テーブルにおけるそれぞれ差分元、差分先ファイルのカラムのヘッダになる文字列を指定します (いずれもデフォルト値は空文字列です)。</p>
<p><em>context</em> および <em>numlines</em> はともにオプションのキーワード引数です。<em>context</em> を <code class="docutils literal"><span class="pre">True</span></code> にするとコンテキスト差分を表示し、デフォルトの <code class="docutils literal"><span class="pre">False</span></code> にすると完全なファイル差分を表示します。<em>numlines</em> のデフォルト値は <code class="docutils literal"><span class="pre">5</span></code> で、<em>context</em> が <code class="docutils literal"><span class="pre">True</span></code> の場合、<em>numlines</em> は強調部分の前後にあるコンテキスト行の数を制御します。<em>context</em> が <code class="docutils literal"><span class="pre">False</span></code> の場合、<em>numlines</em> は "next" と書かれたハイパーリンクをたどった時に到達する場所が次の変更部分より何行前にあるかを制御します (値をゼロにした場合、"next" ハイパーリンクを辿ると変更部分の強調表示がブラウザの最上部に表示されるようになります)。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.5 で変更: </span><em>charset</em> キーワード専用引数が追加されました。HTML 文書のデフォルトの文字集合が <code class="docutils literal"><span class="pre">'ISO-8859-1'</span></code> から <code class="docutils literal"><span class="pre">'utf-8'</span></code> に変更されました。</p>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.HtmlDiff.make_table">
<code class="descname">make_table</code><span class="sig-paren">(</span><em>fromlines</em>, <em>tolines</em>, <em>fromdesc=''</em>, <em>todesc=''</em>, <em>context=False</em>, <em>numlines=5</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.HtmlDiff.make_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った完全な HTML テーブルを文字列で返します。</p>
<p>このメソッドの引数は、 <a class="reference internal" href="#difflib.HtmlDiff.make_file" title="difflib.HtmlDiff.make_file"><code class="xref py py-meth docutils literal"><span class="pre">make_file()</span></code></a> メソッドの引数と同じです。</p>
</dd></dl>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> はこのクラスへのコマンドラインフロントエンドで、使い方を学ぶ上で格好の例題が入っています。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.context_diff">
<code class="descclassname">difflib.</code><code class="descname">context_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.context_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 context diff のフォーマット(以下「コンテクスト形式」)で返します。</p>
<p>コンテクスト形式は、変更があった行に前後数行を加えてある、コンパクトな表現方法です。変更箇所は、変更前/変更後に分けて表します。コンテクスト (変更箇所前後の行) の行数は <em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">***</span></code> や <code class="docutils literal"><span class="pre">---</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">context_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">*** before.py</span>
<span class="go">--- after.py</span>
<span class="go">***************</span>
<span class="go">*** 1,4 ****</span>
<span class="go">! bacon</span>
<span class="go">! eggs</span>
<span class="go">! ham</span>
<span class="go">  guido</span>
<span class="go">--- 1,4 ----</span>
<span class="go">! python</span>
<span class="go">! eggy</span>
<span class="go">! hamster</span>
<span class="go">  guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.get_close_matches">
<code class="descclassname">difflib.</code><code class="descname">get_close_matches</code><span class="sig-paren">(</span><em>word</em>, <em>possibilities</em>, <em>n=3</em>, <em>cutoff=0.6</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.get_close_matches" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>「十分」なマッチの上位のリストを返します。<em>word</em> はマッチさせたいシーケンス (大概は文字列) です。<em>possibilities</em> は <em>word</em> にマッチさせるシーケンスのリスト (大概は文字列のリスト) です。</p>
<p>オプションの引数 <em>n</em> (デフォルトでは <code class="docutils literal"><span class="pre">3</span></code>)はメソッドの返すマッチの最大数です。<em>n</em> は <code class="docutils literal"><span class="pre">0</span></code> より大きくなければなりません。</p>
<p>オプションの引数 <em>cutoff</em> (デフォルトでは <code class="docutils literal"><span class="pre">0.6</span></code>)は、区間 [0, 1] に入る小数の値です。<em>word</em> との一致率がそれ未満の <em>possibilities</em> の要素は無視されます。</p>
<p><em>possibilities</em> の要素でマッチした上位(多くても <em>n</em> 個)は、類似度のスコアに応じて(一番似たものを先頭に)ソートされたリストとして返されます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'appel'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ape'</span><span class="p">,</span> <span class="s1">'apple'</span><span class="p">,</span> <span class="s1">'peach'</span><span class="p">,</span> <span class="s1">'puppy'</span><span class="p">])</span>
<span class="go">['apple', 'ape']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">keyword</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'wheel'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['while']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'pineapple'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s1">'accept'</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">['except']</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.ndiff">
<code class="descclassname">difflib.</code><code class="descname">ndiff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>linejunk=None</em>, <em>charjunk=IS_CHARACTER_JUNK</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.ndiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> のスタイルで返します。</p>
<p>オプションのキーワード引数 <em>linejunk</em> と <em>charjunk</em> には、フィルタ関数 (または <code class="docutils literal"><span class="pre">None</span></code>) を渡します。</p>
<p><em>linejunk</em>: 文字列型の引数 1 つを受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは <code class="docutils literal"><span class="pre">None</span></code> です。モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_LINE_JUNK" title="difflib.IS_LINE_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_LINE_JUNK()</span></code></a> は、高々 1 つのシャープ記号(<code class="docutils literal"><span class="pre">'#'</span></code>)を除いて可視の文字を含まない行をフィルタリングするものです。しかし、下層にある <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスが、どの行が雑音となるほど頻繁に登場するかを動的に分析します。このクラスによる分析は、この関数を使用するよりも通常うまく動作します。</p>
<p><em>charjunk</em>: 文字 (長さ1の文字列) を受け取る関数です。文字列が junk の場合は真を、そうでない場合は偽を返します。デフォルトでは、モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_CHARACTER_JUNK" title="difflib.IS_CHARACTER_JUNK"><code class="xref py py-func docutils literal"><span class="pre">IS_CHARACTER_JUNK()</span></code></a> であり、これは空白文字類 (空白またはタブ、改行文字をこれに含めてはいけません) をフィルタして排除します。</p>
<p><code class="file docutils literal"><span class="pre">Tools/scripts/ndiff.py</span></code> は、この関数のコマンドラインのフロントエンド（インターフェイス）です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">diff</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">- one</span>
<span class="go">?  ^</span>
<span class="go">+ ore</span>
<span class="go">?  ^</span>
<span class="go">- two</span>
<span class="go">- three</span>
<span class="go">?  -</span>
<span class="go">+ tree</span>
<span class="go">+ emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.restore">
<code class="descclassname">difflib.</code><code class="descname">restore</code><span class="sig-paren">(</span><em>sequence</em>, <em>which</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.restore" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>差分を生成した元の二つのシーケンスのうち一つを返します。</p>
<p><a class="reference internal" href="#difflib.Differ.compare" title="difflib.Differ.compare"><code class="xref py py-meth docutils literal"><span class="pre">Differ.compare()</span></code></a> または <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> によって生成された <em>sequence</em> を与えられると、行頭のプレフィクスを取りのぞいてファイル 1 または 2 (引数 <em>which</em> で指定される) に由来する行を復元します。</p>
<p>例:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s1">'one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s1">'ore</span><span class="se">\n</span><span class="s1">tree</span><span class="se">\n</span><span class="s1">emu</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="c1"># materialize the generated delta into a list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">one</span>
<span class="go">two</span>
<span class="go">three</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="go">ore</span>
<span class="go">tree</span>
<span class="go">emu</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.unified_diff">
<code class="descclassname">difflib.</code><code class="descname">unified_diff</code><span class="sig-paren">(</span><em>a</em>, <em>b</em>, <em>fromfile=''</em>, <em>tofile=''</em>, <em>fromfiledate=''</em>, <em>tofiledate=''</em>, <em>n=3</em>, <em>lineterm='\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.unified_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分 (差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)) を、 unified diff フォーマット(以下「ユニファイド形式」)で返します。</p>
<p>ユニファイド形式は変更があった行にコンテキストとなる前後数行を加えた、コンパクトな表現方法です。変更箇所は (変更前/変更後を分離したブロックではなく) インラインスタイルで表されます。コンテクストの行数は、<em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトで、 diff 制御行 (<code class="docutils literal"><span class="pre">---</span></code>, <code class="docutils literal"><span class="pre">+++</span></code>, <code class="docutils literal"><span class="pre">@@</span></code> を含む行) は改行付きで生成されます。 <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.readlines()</span></code></a> で作られた入力が <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-func docutils literal"><span class="pre">io.IOBase.writelines()</span></code></a> で扱うのに適した diff になるので (なぜなら入力と出力の両方が改行付きのため) 、これは有用です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように <em>lineterm</em> 引数に <code class="docutils literal"><span class="pre">""</span></code> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bacon</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggs</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'ham</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'eggy</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'hamster</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'guido</span><span class="se">\n</span><span class="s1">'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s1">'before.py'</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s1">'after.py'</span><span class="p">))</span>
<span class="go">--- before.py</span>
<span class="go">+++ after.py</span>
<span class="go">@@ -1,4 +1,4 @@</span>
<span class="go">-bacon</span>
<span class="go">-eggs</span>
<span class="go">-ham</span>
<span class="go">+python</span>
<span class="go">+eggy</span>
<span class="go">+hamster</span>
<span class="go"> guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><span class="std std-ref">difflib のコマンドラインインタフェース</span></a> を参照してください。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.diff_bytes">
<code class="descclassname">difflib.</code><code class="descname">diff_bytes</code><span class="sig-paren">(</span><em>dfunc</em>, <em>a</em>, <em>b</em>, <em>fromfile=b''</em>, <em>tofile=b''</em>, <em>fromfiledate=b''</em>, <em>tofiledate=b''</em>, <em>n=3</em>, <em>lineterm=b'\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.diff_bytes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>dfunc</em> を使用して <em>a</em> と <em>b</em> (bytes オブジェクトのリスト) を比較して、差分形式の行 (これも bytes オブジェクトです) を*dfunc* の戻り値の形式で返します。<em>dfunc</em> は、呼び出し可能である必要があります。一般に、これは <a class="reference internal" href="#difflib.unified_diff" title="difflib.unified_diff"><code class="xref py py-func docutils literal"><span class="pre">unified_diff()</span></code></a> または <a class="reference internal" href="#difflib.context_diff" title="difflib.context_diff"><code class="xref py py-func docutils literal"><span class="pre">context_diff()</span></code></a> です。</p>
<p>未知のエンコーディングまたは一貫性のないエンコーディングのデータ同士を比較できます。<em>n</em> 以外のすべての入力は、bytes オブジェクトである必要があります。<em>n</em> 以外のすべての入力を損失なく str に変換して、<code class="docutils literal"><span class="pre">dfunc(a,</span> <span class="pre">b,</span> <span class="pre">fromfile,</span> <span class="pre">tofile,</span> <span class="pre">fromfiledate,</span> <span class="pre">tofiledate,</span> <span class="pre">n,</span> <span class="pre">lineterm)</span></code> を呼び出すことにより動作します。<em>dfunc</em> の出力は、bytes 型に変換されます。これにより、受け取る差分形式の行のエンコーディングは、<em>a</em> と <em>b</em> の未知または一貫性のないエンコーディングと同一になります。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_LINE_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_LINE_JUNK</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_LINE_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる行のとき真を返します。行 <em>line</em> は空白、または  <code class="docutils literal"><span class="pre">'#'</span></code> ひとつのときに無視できます。それ以外のときには無視できません。古いバージョンでは <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>linejunk</em> にデフォルトで使用されました。</p>
</dd></dl>
<dl class="function">
<dt id="difflib.IS_CHARACTER_JUNK">
<code class="descclassname">difflib.</code><code class="descname">IS_CHARACTER_JUNK</code><span class="sig-paren">(</span><em>ch</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.IS_CHARACTER_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる文字のとき真を返します。文字 <em>ch</em> が空白、またはタブ文字のときには無視できます。それ以外の時には無視できません。 <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><code class="xref py py-func docutils literal"><span class="pre">ndiff()</span></code></a> の引数 <em>charjunk</em> としてデフォルトで使用されます。</p>
</dd></dl>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><a class="reference external" href="http://www.drdobbs.com/database/pattern-matching-the-gestalt-approach/184407970">Pattern Matching: The Gestalt Approach</a></dt>
<dd>John W. Ratcliff と D. E. Metzener による類似のアルゴリズムに関する議論。<a class="reference external" href="http://www.drdobbs.com/">Dr. Dobb’s Journal</a> 1988年7月号掲載。</dd>
</dl>
</div>
<div class="section" id="sequencematcher-objects">
<span id="sequence-matcher"></span><h2>6.3.1. SequenceMatcherオブジェクト<a class="headerlink" href="#sequencematcher-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> クラスには、以下のようなコンストラクタがあります:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">SequenceMatcher</code><span class="sig-paren">(</span><em>isjunk=None</em>, <em>a=''</em>, <em>b=''</em>, <em>autojunk=True</em><span class="sig-paren">)</span></dt>
<dd><p>オプションの引数 <em>isjunk</em> は、<code class="docutils literal"><span class="pre">None</span></code> (デフォルトの値です) にするか、単一の引数をとる関数でなければなりません。後者の場合、関数はシーケンスの要素を受け取り、要素が junk であり、無視すべきである場合に限り真を返すようにしなければなりません。<em>isjunk</em> に <code class="docutils literal"><span class="pre">None</span></code> を渡すと、<code class="docutils literal"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">0</span></code> を渡したのと同じになります; すなわち、いかなる要素も無視しなくなります。例えば以下のような引数を渡すと:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">" </span><span class="se">\t</span><span class="s2">"</span>
</pre></div>
</div>
<p>空白とタブ文字を無視して文字のシーケンスを比較します。</p>
<p>オプションの引数 <em>a</em> と <em>b</em> は、比較される文字列で、デフォルトでは空の文字列です。両方のシーケンスの要素は、ハッシュ化可能(<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>)である必要があります。</p>
<p>オプションの引数 <em>autojunk</em> は、自動 junk ヒューリスティックを無効にするために使えます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>autojunk</em> パラメータ。</p>
</div>
<p>SequenceMatcher オブジェクトは3つのデータ属性を持っています: <em>bjunk</em> は、 <em>isjunk</em> が <code class="docutils literal"><span class="pre">True</span></code> であるような <em>b</em> の要素の集合です; <em>bpopular</em> は、 (無効でなければ) ヒューリスティックによって popular であると考えられる非ジャンク要素の集合です; <em>b2j</em> は、 <em>b</em> の残りの要素をそれらが生じる位置のリストに写像する dict です。この 3 つは <a class="reference internal" href="#difflib.SequenceMatcher.set_seqs" title="difflib.SequenceMatcher.set_seqs"><code class="xref py py-meth docutils literal"><span class="pre">set_seqs()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> で <em>b</em> がリセットされる場合は常にリセットされます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加: </span><em>bjunk</em> および <em>bpopular</em> 属性。</p>
</div>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは以下のメソッドを持ちます:</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seqs">
<code class="descname">set_seqs</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seqs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較される2つの文字列を設定します。</p>
</dd></dl>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> オブジェクトは、2つ目のシーケンスについての詳細な情報を計算し、キャッシュします。 1つのシーケンスをいくつものシーケンスと比較する場合、まず <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><code class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></code></a> を使って文字列を設定しておき、別の文字列を1つずつ比較するために、繰り返し <a class="reference internal" href="#difflib.SequenceMatcher.set_seq1" title="difflib.SequenceMatcher.set_seq1"><code class="xref py py-meth docutils literal"><span class="pre">set_seq1()</span></code></a> を呼び出します。</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq1">
<code class="descname">set_seq1</code><span class="sig-paren">(</span><em>a</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq1" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う1つ目のシーケンスを設定します。比較される2つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq2">
<code class="descname">set_seq2</code><span class="sig-paren">(</span><em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.set_seq2" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う2つ目のシーケンスを設定します。比較される1つ目のシーケンスは変更されません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.find_longest_match">
<code class="descname">find_longest_match</code><span class="sig-paren">(</span><em>alo</em>, <em>ahi</em>, <em>blo</em>, <em>bhi</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.find_longest_match" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">a[alo:ahi]</span></code> と <code class="docutils literal"><span class="pre">b[blo:bhi]</span></code> の中から、最長のマッチ列を探します。</p>
<p><em>isjunk</em> が省略されたか <code class="docutils literal"><span class="pre">None</span></code> の時、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> は <code class="docutils literal"><span class="pre">a[i:i+k]</span></code> が <code class="docutils literal"><span class="pre">b[j:j+k]</span></code> と等しいような <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">k)</span></code> を返します。その値は <code class="docutils literal"><span class="pre">alo</span> <span class="pre">&lt;=</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i+k</span> <span class="pre">&lt;=</span> <span class="pre">ahi</span></code> かつ <code class="docutils literal"><span class="pre">blo</span> <span class="pre">&lt;=</span> <span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j+k</span> <span class="pre">&lt;=</span> <span class="pre">bhi</span></code> となります。 <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">k')</span></code> でも、同じようになります。さらに <code class="docutils literal"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">k'</span></code>, <code class="docutils literal"><span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i'</span></code> が <code class="docutils literal"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">i'</span></code>, <code class="docutils literal"><span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j'</span></code> でも同様です。言い換えると、いくつものマッチ列すべてのうち、 <em>a</em> 内で最初に始まるものを返します。そしてその <em>a</em> 内で最初のマッチ列すべてのうち <em>b</em> 内で最初に始まるものを返します。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=0, b=4, size=5)</span>
</pre></div>
</div>
<p>引数 <em>isjunk</em> が与えられている場合、上記の通り、はじめに最長のマッチ列を判定します。ブロック内に junk 要素が見当たらないような追加条件の際はこれに該当しません。次にそのマッチ列を、その両側の junk 要素にマッチするよう、できる限り広げていきます。そのため結果となる列は、探している列のたまたま直前にあった同一の junk 以外の junk にはマッチしません。</p>
<p>以下は前と同じサンプルですが、空白を junk とみなしています。これは <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> が2つ目の列の末尾にある <code class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></code> にマッチしないようにしています。代わりに <code class="docutils literal"><span class="pre">'abcd'</span></code> にはマッチします。そして 2つ目の文字列中、一番左の <code class="docutils literal"><span class="pre">'abcd'</span></code> にマッチします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">==</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">" abcd"</span><span class="p">,</span> <span class="s2">"abcd abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=1, b=0, size=4)</span>
</pre></div>
</div>
<p>どんな列にもマッチしない時は、<code class="docutils literal"><span class="pre">(alo,</span> <span class="pre">blo,</span> <span class="pre">0)</span></code> を返します。</p>
<p>このメソッドは <a class="reference internal" href="../glossary.html#term-named-tuple"><span class="xref std std-term">named tuple</span></a> <code class="docutils literal"><span class="pre">Match(a,</span> <span class="pre">b,</span> <span class="pre">size)</span></code> を返します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_matching_blocks">
<code class="descname">get_matching_blocks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_matching_blocks" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>マッチしたシーケンス中で個別にマッチしたシーケンスをあらわす、3つの値のリストを返します。それぞれの値は <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> という形式であらわされ、<code class="docutils literal"><span class="pre">a[i:i+n]</span> <span class="pre">==</span> <span class="pre">b[j:j+n]</span></code> という関係を意味します。3つの値は <em>i</em> と <em>j</em> の間で単調に増加します。</p>
<p>最後のタプルはダミーで、<code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> という値を持ちます。これは <code class="docutils literal"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">0</span></code> である唯一のタプルです。もし <code class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></code> と <code class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">n')</span></code> がリストで並んでいる3つ組で、2つ目が最後の3つ組でなければ、<code class="docutils literal"><span class="pre">i+n</span> <span class="pre">!=</span> <span class="pre">i'</span></code> または <code class="docutils literal"><span class="pre">j+n</span> <span class="pre">!=</span> <span class="pre">j'</span></code> です。言い換えると並んでいる3つ組は常に隣接していない同じブロックを表しています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abxcd"</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">()</span>
<span class="go">[Match(a=0, b=0, size=2), Match(a=3, b=2, size=2), Match(a=5, b=4, size=0)]</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_opcodes">
<code class="descname">get_opcodes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> を <em>b</em> にするための方法を記述する5つのタプルを返します。それぞれのタプルは <code class="docutils literal"><span class="pre">(tag,</span> <span class="pre">i1,</span> <span class="pre">i2,</span> <span class="pre">j1,</span> <span class="pre">j2)</span></code> という形式であらわされます。最初のタプルは <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">j1</span> <span class="pre">==</span> <span class="pre">0</span></code> であり、<em>i1</em> はその前にあるタプルの <em>i2</em> と同じ値です。同様に <em>j1</em> は前の <em>j2</em> と同じ値になります。</p>
<p><em>tag</em> の値は文字列であり、次のような意味です:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%"/>
<col width="75%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'replace'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は <code class="docutils literal"><span class="pre">b[j1:j2]</span></code> に置き換えられる。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'delete'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span></code> は削除される。この時、<code class="docutils literal"><span class="pre">j1</span> <span class="pre">==</span> <span class="pre">j2</span></code> である。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'insert'</span></code></td>
<td><code class="docutils literal"><span class="pre">b[j1:j2]</span></code> が <code class="docutils literal"><span class="pre">a[i1:i1]</span></code> に挿入される。この時 <code class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">i2</span></code> である。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'equal'</span></code></td>
<td><code class="docutils literal"><span class="pre">a[i1:i2]</span> <span class="pre">==</span> <span class="pre">b[j1:j2]</span></code> (サブシーケンスは等しい).</td>
</tr>
</tbody>
</table>
<p>例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="s2">"qabxcd"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="s2">"abycdf"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{:7}</span><span class="s1">   a[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] --&gt; b[</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">] </span><span class="si">{!r:&gt;8}</span><span class="s1"> --&gt; </span><span class="si">{!r}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">]))</span>
<span class="go">delete    a[0:1] --&gt; b[0:0]      'q' --&gt; ''</span>
<span class="go">equal     a[1:3] --&gt; b[0:2]     'ab' --&gt; 'ab'</span>
<span class="go">replace   a[3:4] --&gt; b[2:3]      'x' --&gt; 'y'</span>
<span class="go">equal     a[4:6] --&gt; b[3:5]     'cd' --&gt; 'cd'</span>
<span class="go">insert    a[6:6] --&gt; b[5:6]       '' --&gt; 'f'</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.get_grouped_opcodes">
<code class="descname">get_grouped_opcodes</code><span class="sig-paren">(</span><em>n=3</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.get_grouped_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>最大 <em>n</em> 行までのコンテクストを含むグループを生成するような、ジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">generator</span></a>)を返します。</p>
<p>このメソッドは、 <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> で返されるグループの中から、似たような差異のかたまりに分け、間に挟まっている変更の無い部分を省きます。</p>
<p>グループは <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> と同じ書式で返されます。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.ratio">
<code class="descname">ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>[0, 1] の範囲の浮動小数点数で、シーケンスの類似度を測る値を返します。</p>
<p>T が2つのシーケンスの要素数の総計だと仮定し、M をマッチした数とすると、この値は 2.0*M / T であらわされます。もしシーケンスがまったく同じ場合、値は <code class="docutils literal"><span class="pre">1.0</span></code> となり、まったく異なる場合には <code class="docutils literal"><span class="pre">0.0</span></code> となります。</p>
<p>このメソッドは <a class="reference internal" href="#difflib.SequenceMatcher.get_matching_blocks" title="difflib.SequenceMatcher.get_matching_blocks"><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code></a> または <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code></a> がまだ呼び出されていない場合には非常にコストが高いです。この場合、上限を素早く計算するために、 <a class="reference internal" href="#difflib.SequenceMatcher.quick_ratio" title="difflib.SequenceMatcher.quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code></a> もしくは <a class="reference internal" href="#difflib.SequenceMatcher.real_quick_ratio" title="difflib.SequenceMatcher.real_quick_ratio"><code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code></a> を最初に試してみる方がいいかもしれません。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.quick_ratio">
<code class="descname">quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、より高速に計算します。</p>
</dd></dl>
<dl class="method">
<dt id="difflib.SequenceMatcher.real_quick_ratio">
<code class="descname">real_quick_ratio</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#difflib.SequenceMatcher.real_quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code></a> の上界を、非常に高速に計算します。</p>
</dd></dl>
</dd></dl>
<p>この文字列全体のマッチ率を返す3つのメソッドは、精度の異なる近似値を返します。 <code class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></code> と <code class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></code> は、常に <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> 以上の値を返します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">"abcd"</span><span class="p">,</span> <span class="s2">"bcde"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">quick_ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">real_quick_ratio</span><span class="p">()</span>
<span class="go">1.0</span>
</pre></div>
</div>
</div>
<div class="section" id="sequencematcher-examples">
<span id="id1"></span><h2>6.3.2. SequenceMatcher の例<a class="headerlink" href="#sequencematcher-examples" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は2つの文字列を比較します。空白を "junk" とします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">" "</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private Thread currentThread;"</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s2">"private volatile Thread currentThread;"</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> は、[0, 1] の範囲の値を返し、シーケンスの類似度を測ります。経験によると、 <code class="xref py py-meth docutils literal"><span class="pre">ratio()</span></code> の値が0.6を超えると、シーケンスがよく似ていることを示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="go">0.866</span>
</pre></div>
</div>
<p>シーケンスのどこがマッチしているかにだけ興味のある時には <code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が手軽でしょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"a[</span><span class="si">%d</span><span class="s2">] and b[</span><span class="si">%d</span><span class="s2">] match for </span><span class="si">%d</span><span class="s2"> elements"</span> <span class="o">%</span> <span class="n">block</span><span class="p">)</span>
<span class="go">a[0] and b[0] match for 8 elements</span>
<span class="go">a[8] and b[17] match for 21 elements</span>
<span class="go">a[29] and b[38] match for 0 elements</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></code> が返す最後のタプルが常にダミーであることに注目してください。このダミーは <code class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></code> であり、これはタプルの最後の要素（マッチする要素の数）が <code class="docutils literal"><span class="pre">0</span></code> となる唯一のケースです。</p>
<p>はじめのシーケンスがどのようにして2番目のものになるのかを知るには、 <code class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></code> を使います:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%6s</span><span class="s2"> a[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">] b[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">]"</span> <span class="o">%</span> <span class="n">opcode</span><span class="p">)</span>
<span class="go"> equal a[0:8] b[0:8]</span>
<span class="go">insert a[8:8] b[8:17]</span>
<span class="go"> equal a[8:29] b[17:38]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<ul class="last simple">
<li><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> を使った、シンプルで使えるコードを知るには、このモジュールの関数 <a class="reference internal" href="#difflib.get_close_matches" title="difflib.get_close_matches"><code class="xref py py-func docutils literal"><span class="pre">get_close_matches()</span></code></a> を参照してください。</li>
<li><a class="reference external" href="https://code.activestate.com/recipes/576729/">Simple version control recipe</a> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><code class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></code></a> で作った小規模アプリケーション。</li>
</ul>
</div>
</div>
<div class="section" id="differ-objects">
<span id="id2"></span><h2>6.3.3. Differ オブジェクト<a class="headerlink" href="#differ-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトによって生成された差分が <strong>最小</strong> であるなどとは言いません。むしろ、最小の差分はしばしば直観に反しています。その理由は、どこでもできるとなれば一致を見いだしてしまうからで、ときには思いがけなく100ページも離れたマッチになってしまうのです。一致点を互いに隣接したマッチに制限することで、場合によって長めの差分を出力するというコストを掛けることにはなっても、ある種の局所性を保つことができるのです。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> は、以下のようなコンストラクタを持ちます:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">difflib.</code><code class="descname">Differ</code><span class="sig-paren">(</span><em>linejunk=None</em>, <em>charjunk=None</em><span class="sig-paren">)</span></dt>
<dd><p>オプションのキーワードパラメータ <em>linejunk</em> と <em>charjunk</em> は、フィルタ関数を渡します (使わないときは <code class="docutils literal"><span class="pre">None</span></code>):</p>
<p><em>linejunk</em>: ひとつの文字列引数を受け取る関数です。文字列が junk のときに真を返します。デフォルトでは、<code class="docutils literal"><span class="pre">None</span></code> であり、どんな行であっても junk とは見なされません。</p>
<p><em>charjunk</em>: この関数は文字(長さ1の文字列)を引数として受け取り、文字が junk であるときに真を返します。デフォルトは <code class="docutils literal"><span class="pre">None</span></code> であり、どんな文字も junk とは見なされません。</p>
<p>これらの junk フィルター関数により、差分を発見するマッチングが高速化し、差分の行や文字が無視されることがなくなります。説明については、 <a class="reference internal" href="#difflib.SequenceMatcher.find_longest_match" title="difflib.SequenceMatcher.find_longest_match"><code class="xref py py-meth docutils literal"><span class="pre">find_longest_match()</span></code></a> メソッドの <em>isjunk</em> 引数の説明をご覧ください。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトは、以下の1つのメソッドを通して利用されます。（差分を生成します）:</p>
<dl class="method">
<dt id="difflib.Differ.compare">
<code class="descname">compare</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#difflib.Differ.compare" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>文字列からなる2つのシーケンスを比較し、差分（を表す文字列からなるシーケンス）を生成します。</p>
<p>各シーケンスの要素は、改行で終わる独立した単一行からなる文字列でなければなりません。そのようなシーケンスは、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.readlines" title="io.IOBase.readlines"><code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code></a> メソッドによって得ることができます。（得られる）差分は改行文字で終了する文字列のシーケンスとして得られ、ファイル風オブジェクトの <a class="reference internal" href="io.html#io.IOBase.writelines" title="io.IOBase.writelines"><code class="xref py py-meth docutils literal"><span class="pre">writelines()</span></code></a> メソッドによって出力できる形になっています。</p>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="differ-example">
<span id="differ-examples"></span><h2>6.3.4. Differ の例<a class="headerlink" href="#differ-example" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下の例は2つのテキストを比較しています。最初に、テキストを行毎に改行で終わる文字列のシーケンスにセットアップします (そのようなシーケンスは、ファイル風オブジェクトの <code class="xref py py-meth docutils literal"><span class="pre">readlines()</span></code> メソッドからも得ることができます):</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  2. Explicit is better than implicit.</span>
<span class="gp">... </span><span class="s1">  3. Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complex is better than complicated.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">'\n'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text2</span> <span class="o">=</span> <span class="s1">'''  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s1">  3.   Simple is better than complex.</span>
<span class="gp">... </span><span class="s1">  4. Complicated is better than complex.</span>
<span class="gp">... </span><span class="s1">  5. Flat is better than nested.</span>
<span class="gp">... </span><span class="s1">'''</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>次に Differ オブジェクトをインスタンス化します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Differ</span><span class="p">()</span>
</pre></div>
</div>
<p>注意:  <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-class docutils literal"><span class="pre">Differ</span></code></a> オブジェクトをインスタンス化するとき、行 junk と文字 junk をフィルタリングする関数を渡すことができます。詳細は <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><code class="xref py py-meth docutils literal"><span class="pre">Differ()</span></code></a> コンストラクタを参照してください。</p>
<p>最後に、2つを比較します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">result</span></code> は文字列のリストなので、pretty-printしてみましょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">['    1. Beautiful is better than ugly.\n',</span>
<span class="go"> '-   2. Explicit is better than implicit.\n',</span>
<span class="go"> '-   3. Simple is better than complex.\n',</span>
<span class="go"> '+   3.   Simple is better than complex.\n',</span>
<span class="go"> '?     ++\n',</span>
<span class="go"> '-   4. Complex is better than complicated.\n',</span>
<span class="go"> '?            ^                     ---- ^\n',</span>
<span class="go"> '+   4. Complicated is better than complex.\n',</span>
<span class="go"> '?           ++++ ^                      ^\n',</span>
<span class="go"> '+   5. Flat is better than nested.\n']</span>
</pre></div>
</div>
<p>これは、複数行の文字列として、次のように出力されます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">    1. Beautiful is better than ugly.</span>
<span class="go">-   2. Explicit is better than implicit.</span>
<span class="go">-   3. Simple is better than complex.</span>
<span class="go">+   3.   Simple is better than complex.</span>
<span class="go">?     ++</span>
<span class="go">-   4. Complex is better than complicated.</span>
<span class="go">?            ^                     ---- ^</span>
<span class="go">+   4. Complicated is better than complex.</span>
<span class="go">?           ++++ ^                      ^</span>
<span class="go">+   5. Flat is better than nested.</span>
</pre></div>
</div>
</div>
<div class="section" id="a-command-line-interface-to-difflib">
<span id="difflib-interface"></span><h2>6.3.5. difflib のコマンドラインインタフェース<a class="headerlink" href="#a-command-line-interface-to-difflib" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は、 difflib を使って <code class="docutils literal"><span class="pre">diff</span></code> に似たユーティリティーを作成する方法を示します。これは、 Python のソース配布物にも、 <code class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></code> として含まれています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">""" Command line interface to difflib.py providing diffs in four formats:</span>

<span class="sd">* ndiff:    lists every line and highlights interline changes.</span>
<span class="sd">* context:  highlights clusters of changes in a before/after format.</span>
<span class="sd">* unified:  highlights clusters of changes in an inline format.</span>
<span class="sd">* html:     generates side by side comparison with change highlights.</span>

<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">difflib</span><span class="o">,</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="k">def</span> <span class="nf">file_mtime</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span>
                               <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a context format diff (default)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-u'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a unified format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-m'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce HTML side by side diff '</span>
                             <span class="s1">'(can use -c and -l in conjunction)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-n'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Produce a ndiff format diff'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-l'</span><span class="p">,</span> <span class="s1">'--lines'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'Set number of context lines (default 3)'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'fromfile'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'tofile'</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">lines</span>
    <span class="n">fromfile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">fromfile</span>
    <span class="n">tofile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">tofile</span>

    <span class="n">fromdate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span>
    <span class="n">todate</span> <span class="o">=</span> <span class="n">file_mtime</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">fromlines</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
        <span class="n">tolines</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">u</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">m</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">HtmlDiff</span><span class="p">()</span><span class="o">.</span><span class="n">make_file</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span><span class="n">tolines</span><span class="p">,</span><span class="n">fromfile</span><span class="p">,</span><span class="n">tofile</span><span class="p">,</span><span class="n">context</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">numlines</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">context_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div aria-label="main navigation" class="sphinxsidebar" role="navigation">
<div class="sphinxsidebarwrapper">
<h3><a href="../contents.html">目次</a></h3>
<ul>
<li><a class="reference internal" href="#">6.3. <code class="docutils literal"><span class="pre">difflib</span></code>  差分の計算を助ける</a><ul>
<li><a class="reference internal" href="#sequencematcher-objects">6.3.1. SequenceMatcherオブジェクト</a></li>
<li><a class="reference internal" href="#sequencematcher-examples">6.3.2. SequenceMatcher の例</a></li>
<li><a class="reference internal" href="#differ-objects">6.3.3. Differ オブジェクト</a></li>
<li><a class="reference internal" href="#differ-example">6.3.4. Differ の例</a></li>
<li><a class="reference internal" href="#a-command-line-interface-to-difflib">6.3.5. difflib のコマンドラインインタフェース</a></li>
</ul>
</li>
</ul>
<h4>前のトピックへ</h4>
<p class="topless"><a href="re.html" title="前の章へ">6.2. <code class="docutils literal"><span class="pre">re</span></code>  正規表現操作</a></p>
<h4>次のトピックへ</h4>
<p class="topless"><a href="textwrap.html" title="次の章へ">6.4. <code class="docutils literal"><span class="pre">textwrap</span></code>  テキストの折り返しと詰め込み</a></p>
<div aria-label="source link" role="note">
<h3>このページ</h3>
<ul class="this-page-menu">
<li><a href="../bugs.html">バグ報告</a></li>
<li>
<a href="https://github.com/python/cpython/blob/3.6/Doc/library/difflib.rst" rel="nofollow">ソースの表示
        </a>
</li>
</ul>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div aria-label="related navigation" class="related" role="navigation">
<h3>ナビゲーション</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a href="../genindex.html" title="総索引">索引</a></li>
<li class="right">
<a href="../py-modindex.html" title="Pythonモジュール索引">モジュール</a> |</li>
<li class="right">
<a href="textwrap.html" title="6.4. textwrap  テキストの折り返しと詰め込み">次へ</a> |</li>
<li class="right">
<a href="re.html" title="6.2. re  正規表現操作">前へ</a> |</li>
<li><img alt="" src="../_static/py.png" style="vertical-align: middle; margin-top: -1px"/></li>
<li><a href="https://www.python.org/">Python</a> </li>
<li>
<span class="version_switcher_placeholder">3.6.5</span>
<a href="../index.html">ドキュメント</a> 
        </li>
<li class="nav-item nav-item-1"><a href="index.html">Python 標準ライブラリ</a> </li>
<li class="nav-item nav-item-2"><a href="text.html">6. テキスト処理サービス</a> </li>
<li class="right">
<div class="inline-search" role="search" style="display: none">
<form action="../search.html" class="inline-search" method="get">
<input name="q" placeholder="Quick search" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
<script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>
</ul>
</div>
<div class="footer">
     <a href="../copyright.html">Copyright</a> 2001-2018, Python Software Foundation.
    <br/>
    Python Software Foundation は非営利団体です。
    <a href="https://www.python.org/psf/donations/">寄付</a>
<br/>
    最終更新日時: 7月 29, 2018
    <a href="../bugs.html">バグを見つけたら</a>?
    <br/>
    このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.5 を使って作成されました。
    </div>
</body>
</head></html>